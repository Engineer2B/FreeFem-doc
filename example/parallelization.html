<!DOCTYPE html>

<html lang="en">
	<head>
		  <meta charset="UTF-8">
  <title>Parallelization</title>
  <link rel="icon" href="../_static/img/Symbol.png" />

  <!--Let browser know website is optimized for mobile-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no" />

  <!-- Google font -->
  <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700,900" rel="stylesheet">

  <!-- FreeFEM theme specific -->
  <link rel="stylesheet" type="text/css" href="../_static/css/freefemtheme.css" />

  <!-- css -->
  <link rel="stylesheet" href="../_static/css/pygments_custom.css" type="text/css" />

  <!-- MathJax -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script>
  <script src="../_static/js/mathjax-config.js"></script>

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
	</head>
	<body>
		<header>
   <a class="header-logo" href="../introduction/index.html">
      <img alt="logo" title="FreeFEM documentation" src="../_static/img/FreeFem_Documentation_Logo_bleu.svg" />
   </a>

   <a class="header-github" href="https://github.com/FreeFem/FreeFem-sources" target="_blank">
      <i class="fab fa-github"></i>
      <p class="header-github-title" >
         FreeFEM on GitHub
      </p>

      <p class="header-github-stars" id="headerGithubStarsForks">
         <span id="headerGithubStars"></span> stars - <span id="headerGithubForks"></span> forks
      </p>
   </a>
</header>
<script async src="../_static/js/github.js"></script>
		
		<nav id="nav">
	<div style="display: none;">
		<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction/index.html">Introduction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../introduction/download.html">Download FreeFEM</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../introduction/download.html#latest-binary-packages">Latest binary packages</a></li>
<li class="toctree-l3"><a class="reference internal" href="../introduction/download.html#syntax-highlighters">Syntax highlighters</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/installation.html">Installation guide</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../introduction/installation.html#easy-installation">Easy installation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../introduction/installation.html#windows-binary-installation">Windows binary installation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../introduction/installation.html#macos-x-binary-installation">MacOS X binary installation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../introduction/installation.html#arch-aur-package">Arch AUR package</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../introduction/installation.html#text-editor">Text-editor</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../introduction/installation.html#atom">Atom</a></li>
<li class="toctree-l4"><a class="reference internal" href="../introduction/installation.html#gedit">Gedit</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../introduction/installation.html#compilation">Compilation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../introduction/installation.html#branches-os-status">Branches / OS status</a></li>
<li class="toctree-l4"><a class="reference internal" href="../introduction/installation.html#compilation-on-osx-10-13">Compilation on OSX (&gt;=10.13)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../introduction/installation.html#compilation-on-ubuntu">Compilation on Ubuntu</a></li>
<li class="toctree-l4"><a class="reference internal" href="../introduction/installation.html#compilation-on-arch-linux">Compilation on Arch Linux</a></li>
<li class="toctree-l4"><a class="reference internal" href="../introduction/installation.html#compilation-on-linux-with-intel-software-tools">Compilation on Linux with Intel software tools</a></li>
<li class="toctree-l4"><a class="reference internal" href="../introduction/installation.html#compilation-on-windows">Compilation on Windows</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../introduction/installation.html#environment-variables-and-init-file">Environment variables and init file</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/contributing.html">Contributing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../introduction/contributing.html#bug-report">Bug report</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../introduction/contributing.html#concerning-the-freefem-documentation">Concerning the <strong>FreeFEM</strong> documentation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../introduction/contributing.html#concerning-the-freefem-compilation-or-usage">Concerning the <strong>FreeFEM</strong> compilation or usage</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../introduction/contributing.html#improve-content">Improve content</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/citation.html">Citation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../introduction/citation.html#if-you-use-freefem-please-cite-the-following-reference-in-your-work">If you use <strong>FreeFEM</strong>, please cite the following reference in your work:</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../introduction/citation.html#apa">APA</a></li>
<li class="toctree-l4"><a class="reference internal" href="../introduction/citation.html#iso690">ISO690</a></li>
<li class="toctree-l4"><a class="reference internal" href="../introduction/citation.html#mla">MLA</a></li>
<li class="toctree-l4"><a class="reference internal" href="../introduction/citation.html#bibtex">BibTeX</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/authors.html">Authors</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../documentation/index.html">Documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../documentation/notations.html">Notations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../documentation/notations.html#generalities">Generalities</a></li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/notations.html#sets-mappings-matrices-vectors">Sets, Mappings, Matrices, Vectors</a></li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/notations.html#numbers">Numbers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/notations.html#differential-calculus">Differential Calculus</a></li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/notations.html#meshes">Meshes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/notations.html#finite-element-spaces">Finite Element Spaces</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../documentation/meshGeneration.html">Mesh Generation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../documentation/meshGeneration.html#square">Square</a></li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/meshGeneration.html#border">Border</a></li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/meshGeneration.html#multi-border">Multi-Border</a></li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/meshGeneration.html#data-structures-and-read-write-statements-for-a-mesh">Data Structures and Read/Write Statements for a Mesh</a></li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/meshGeneration.html#mesh-connectivity-and-data">Mesh Connectivity and data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/meshGeneration.html#the-keyword-triangulate">The keyword “triangulate”</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../documentation/meshGeneration.html#boundary-fem-spaces-built-as-empty-meshes">Boundary FEM Spaces Built as Empty Meshes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/meshGeneration.html#remeshing">Remeshing</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/meshGeneration.html#movemesh">Movemesh</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../documentation/meshGeneration.html#regular-triangulation-htriangle">Regular Triangulation: hTriangle</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/meshGeneration.html#adaptmesh">Adaptmesh</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/meshGeneration.html#trunc">Trunc</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/meshGeneration.html#splitmesh">Splitmesh</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/meshGeneration.html#meshing-examples">Meshing Examples</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/meshGeneration.html#how-to-change-the-label-of-elements-and-border-elements-of-a-mesh">How to change the label of elements and border elements of a mesh</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/meshGeneration.html#mesh-in-three-dimensions">Mesh in three dimensions</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/meshGeneration.html#cube">Cube</a></li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/meshGeneration.html#read-write-statements-for-a-mesh-in-3d">Read/Write Statements for a Mesh in 3D</a></li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/meshGeneration.html#tetgen-a-tetrahedral-mesh-generator">TetGen: A tetrahedral mesh generator</a></li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/meshGeneration.html#reconstruct-refine-a-three-dimensional-mesh-with-tetgen">Reconstruct/Refine a three dimensional mesh with TetGen</a></li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/meshGeneration.html#moving-mesh-in-three-dimensions">Moving mesh in three dimensions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/meshGeneration.html#layer-mesh">Layer mesh</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../documentation/meshGeneration.html#meshing-examples-1">Meshing examples</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/meshGeneration.html#build-a-3d-mesh-of-a-cube-with-a-balloon">Build a 3d mesh of a cube with a balloon</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../documentation/meshGeneration.html#medit">Medit</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/meshGeneration.html#mshmet">Mshmet</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/meshGeneration.html#freeyams">FreeYams</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/meshGeneration.html#mmg3d">mmg3d</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/meshGeneration.html#a-first-3d-isotrope-mesh-adaptation-process">A first 3d isotrope mesh adaptation process</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/meshGeneration.html#build-a-2d-mesh-from-a-isoline">Build a 2d mesh from a isoline</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../documentation/finiteElement.html">Finite element</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../documentation/finiteElement.html#use-of-freefem-fespace-in-2d">Use of freefem fespace in 2D</a></li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/finiteElement.html#use-of-fespace-in-3d">Use of fespace in 3D</a></li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/finiteElement.html#lagrangian-finite-elements">Lagrangian Finite Elements</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../documentation/finiteElement.html#p0-element">P0-element</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/finiteElement.html#p1-element">P1-element</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/finiteElement.html#p2-element">P2-element</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/finiteElement.html#p1-nonconforming-element">P1 Nonconforming Element</a></li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/finiteElement.html#other-fe-space">Other FE-space</a></li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/finiteElement.html#vector-valued-fe-function">Vector Valued FE-function</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../documentation/finiteElement.html#raviart-thomas-element">Raviart-Thomas Element</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/finiteElement.html#a-fast-finite-element-interpolator">A Fast Finite Element Interpolator</a></li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/finiteElement.html#keywords-problem-and-solve">Keywords: Problem and Solve</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../documentation/finiteElement.html#weak-form-and-boundary-condition">Weak Form and Boundary Condition</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/finiteElement.html#parameters-affecting-solve-and-problem">Parameters affecting solve and problem</a></li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/finiteElement.html#problem-definition">Problem definition</a></li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/finiteElement.html#numerical-integration">Numerical Integration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/finiteElement.html#variational-form-sparse-matrix-pde-data-vector">Variational Form, Sparse Matrix, PDE Data Vector</a></li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/finiteElement.html#interpolation-matrix">Interpolation matrix</a></li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/finiteElement.html#finite-elements-connectivity">Finite elements connectivity</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../documentation/visualization.html">Visualization</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../documentation/visualization.html#plot">Plot</a></li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/visualization.html#link-with-gnuplot">Link with gnuplot</a></li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/visualization.html#link-with-medit">Link with medit</a></li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/visualization.html#link-with-paraview">Link with Paraview</a></li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/visualization.html#link-with-matlab-and-octave">Link with Matlab© and Octave</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../documentation/algorithmsOptimization.html">Algorithms &amp; Optimization</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../documentation/algorithmsOptimization.html#conjugate-gradient-gmres">Conjugate Gradient/GMRES</a></li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/algorithmsOptimization.html#algorithms-for-unconstrained-optimization">Algorithms for Unconstrained Optimization</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../documentation/algorithmsOptimization.html#example-of-usage-for-bfgs-or-cmaes">Example of usage for BFGS or CMAES</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/algorithmsOptimization.html#ipopt">IPOPT</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../documentation/algorithmsOptimization.html#short-description-of-the-algorithm">Short description of the algorithm</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/algorithmsOptimization.html#ipopt-in-freefem">IPOPT in <strong>FreeFEM</strong></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/algorithmsOptimization.html#some-short-examples-using-ipopt">Some short examples using IPOPT</a></li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/algorithmsOptimization.html#d-constrained-minimum-surface-with-ipopt">3D constrained minimum surface with IPOPT</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../documentation/algorithmsOptimization.html#area-and-volume-expressions">Area and volume expressions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/algorithmsOptimization.html#derivatives">Derivatives</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/algorithmsOptimization.html#the-problem-and-its-script">The problem and its script</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/algorithmsOptimization.html#the-nlopt-optimizers">The nlOpt optimizers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/algorithmsOptimization.html#optimization-with-mpi">Optimization with MPI</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../documentation/parallelization.html">Parallelization</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../documentation/parallelization.html#mpi">MPI</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../documentation/parallelization.html#mpi-keywords">MPI Keywords</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/parallelization.html#mpi-constants">MPI Constants</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/parallelization.html#mpi-constructor">MPI Constructor</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/parallelization.html#mpi-functions">MPI Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/parallelization.html#mpi-communicator-operator">MPI Communicator operator</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/parallelization.html#schwarz-example-in-parallel">Schwarz example in parallel</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../documentation/parallelization.html#true-parallel-schwarz-example">True parallel Schwarz example</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/parallelization.html#parallel-sparse-solvers">Parallel sparse solvers</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../documentation/parallelization.html#using-parallel-sparse-solvers-in-freefem">Using parallel sparse solvers in <strong>FreeFEM</strong></a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/parallelization.html#sparse-direct-solver">Sparse direct solver</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../documentation/parallelization.html#mumps-solver">MUMPS solver</a></li>
<li class="toctree-l5"><a class="reference internal" href="../documentation/parallelization.html#superlu-distributed-solver">SuperLU distributed solver</a></li>
<li class="toctree-l5"><a class="reference internal" href="../documentation/parallelization.html#pastix-solver">PaStiX solver</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/parallelization.html#parallel-sparse-iterative-solver">Parallel sparse iterative solver</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../documentation/parallelization.html#parms-solver">pARMS solver</a></li>
<li class="toctree-l5"><a class="reference internal" href="../documentation/parallelization.html#interfacing-with-hips">Interfacing with HIPS</a></li>
<li class="toctree-l5"><a class="reference internal" href="../documentation/parallelization.html#interfacing-with-hypre">Interfacing with HYPRE</a></li>
<li class="toctree-l5"><a class="reference internal" href="../documentation/parallelization.html#conclusion">Conclusion</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/parallelization.html#domain-decomposition">Domain decomposition</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../documentation/parallelization.html#communicators-and-groups">Communicators and groups</a></li>
<li class="toctree-l5"><a class="reference internal" href="../documentation/parallelization.html#process">Process</a></li>
<li class="toctree-l5"><a class="reference internal" href="../documentation/parallelization.html#points-to-points-communicators">Points to Points communicators</a></li>
<li class="toctree-l5"><a class="reference internal" href="../documentation/parallelization.html#global-operations">Global operations</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/parallelization.html#hpddm-solvers">HPDDM solvers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/parallelization.html#time-dependent-problem">Time dependent problem</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/parallelization.html#distributed-vectors-in-hpddm">Distributed vectors in HPDDM</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../documentation/plugins.html">Plugins</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../documentation/plugins.html#gsl">gsl</a></li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/plugins.html#ffrandom">ffrandom</a></li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/plugins.html#mmap-semaphore">mmap / semaphore</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../documentation/developers.html">Developers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../documentation/developers.html#file-formats">File formats</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../documentation/developers.html#mesh-file-data-structure">Mesh file data structure</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/developers.html#bb-file-type-to-store-solutions">bb file type to Store Solutions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/developers.html#id1">BB file type to store solutions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/developers.html#metric-file">Metric file</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/developers.html#list-of-am-fmt-amdba-meshes">List of AM_FMT, AMDBA Meshes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/developers.html#sol-and-solb-files">sol and solb files</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/developers.html#adding-a-new-finite-element">Adding a new finite element</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../documentation/developers.html#some-notations">Some notations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/developers.html#which-class-to-add">Which class to add?</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/developers.html#dynamical-link">Dynamical link</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../documentation/developers.html#a-first-example-myfunction-cpp">A first example myfunction.cpp</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/developers.html#example-discrete-fast-fourier-transform">Example: Discrete Fast Fourier Transform</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/developers.html#load-module-for-dervieux-p0-p1-finite-volume-method">Load Module for Dervieux P0-P1 Finite Volume Method</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/developers.html#more-on-adding-a-new-finite-element">More on Adding a new finite element</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../documentation/developers.html#the-bernardi-raugel-element">The Bernardi-Raugel Element</a></li>
<li class="toctree-l5"><a class="reference internal" href="../documentation/developers.html#the-morley-element">The Morley Element</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../documentation/ffddm/index.html">ffddm</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../documentation/ffddm/introddm.html">Domain Decomposition (DD)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../documentation/ffddm/introddm.html#mesh-decomposition">Mesh Decomposition</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/ffddm/introddm.html#distributed-linear-algebra">Distributed Linear Algebra</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/ffddm/introddm.html#partition-of-unity-matrices-poum">Partition of Unity Matrices (POUM)</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../documentation/ffddm/introddm.html#distributed-scalar-product">Distributed scalar product</a></li>
<li class="toctree-l5"><a class="reference internal" href="../documentation/ffddm/introddm.html#update">Update</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/ffddm/introddm.html#distributed-matrix-and-vector-resulting-from-a-variational-formulation">Distributed Matrix and Vector resulting from a variational formulation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/ffddm/introddm.html#distributed-linear-solvers">Distributed Linear Solvers</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../documentation/ffddm/introddm.html#distributed-direct-solvers">Distributed Direct Solvers</a></li>
<li class="toctree-l5"><a class="reference internal" href="../documentation/ffddm/introddm.html#schwarz-methods">Schwarz methods</a><ul>
<li class="toctree-l6"><a class="reference internal" href="../documentation/ffddm/introddm.html#restricted-additive-schwarz-ras">Restricted Additive Schwarz (RAS)</a></li>
<li class="toctree-l6"><a class="reference internal" href="../documentation/ffddm/introddm.html#optimized-restricted-additive-schwarz-oras">Optimized Restricted Additive Schwarz (ORAS)</a></li>
<li class="toctree-l6"><a class="reference internal" href="../documentation/ffddm/introddm.html#two-level-methods">Two level methods</a><ul>
<li class="toctree-l7"><a class="reference internal" href="../documentation/ffddm/introddm.html#coarse-mesh">Coarse Mesh</a></li>
<li class="toctree-l7"><a class="reference internal" href="../documentation/ffddm/introddm.html#geneo">GenEO</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/ffddm/documentation.html">ffddm documentation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../documentation/ffddm/documentation.html#minimal-example">Minimal example</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/ffddm/documentation.html#overlapping-mesh-decomposition">Overlapping mesh decomposition</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/ffddm/documentation.html#local-finite-element-spaces">Local finite element spaces</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/ffddm/documentation.html#define-the-problem-to-solve">Define the problem to solve</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/ffddm/documentation.html#one-level-preconditioners">One level preconditioners</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/ffddm/documentation.html#two-level-preconditioners">Two level preconditioners</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../documentation/ffddm/documentation.html#building-the-geneo-coarse-space">Building the GenEO coarse space</a></li>
<li class="toctree-l5"><a class="reference internal" href="../documentation/ffddm/documentation.html#building-the-coarse-space-from-a-coarse-mesh">Building the coarse space from a coarse mesh</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/ffddm/documentation.html#solving-the-linear-system">Solving the linear system</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/ffddm/documentation.html#using-hpddm-within-ffddm">Using <em>HPDDM</em> within <em>ffddm</em></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/ffddm/parameters.html">Parameters</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../documentation/ffddm/parameters.html#command-line-arguments">Command-line arguments</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/ffddm/parameters.html#global-parameters">Global parameters</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/ffddm/tutorial.html">Tutorial</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../documentation/ffddm/tutorial.html#what-is-ffddm">What is <strong>ffddm</strong> ?</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/ffddm/tutorial.html#why-domain-decomposition-methods">Why Domain Decomposition Methods ?</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../documentation/ffddm/tutorial.html#step-1-decompose-the-mesh">Step 1: Decompose the mesh</a></li>
<li class="toctree-l5"><a class="reference internal" href="../documentation/ffddm/tutorial.html#step-2-define-your-finite-element">Step 2: Define your finite element</a><ul>
<li class="toctree-l6"><a class="reference internal" href="../documentation/ffddm/tutorial.html#distributed-vectors-and-restriction-operators">Distributed vectors and restriction operators</a></li>
<li class="toctree-l6"><a class="reference internal" href="../documentation/ffddm/tutorial.html#partition-of-unity">Partition of unity</a></li>
<li class="toctree-l6"><a class="reference internal" href="../documentation/ffddm/tutorial.html#data-exchange-between-neighbors">Data exchange between neighbors</a></li>
</ul>
</li>
<li class="toctree-l5"><a class="reference internal" href="../documentation/ffddm/tutorial.html#step-3-define-your-problem">Step 3: Define your problem</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/ffddm/tutorial.html#summary-so-far-translating-your-sequential-freefem-script">Summary so far: translating your sequential <em>FreeFEM</em> script</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../documentation/ffddm/tutorial.html#id1">Step 1: Decompose the mesh</a></li>
<li class="toctree-l5"><a class="reference internal" href="../documentation/ffddm/tutorial.html#solve-the-linear-system">Solve the linear system</a></li>
<li class="toctree-l5"><a class="reference internal" href="../documentation/ffddm/tutorial.html#solve-the-linear-system-with-the-parallel-direct-solver-mumps">Solve the linear system with the parallel direct solver <em>MUMPS</em></a></li>
<li class="toctree-l5"><a class="reference internal" href="../documentation/ffddm/tutorial.html#step-4-define-the-one-level-dd-preconditioner">Step 4: Define the one level DD preconditioner</a></li>
<li class="toctree-l5"><a class="reference internal" href="../documentation/ffddm/tutorial.html#step-5-solve-the-linear-system-with-preconditioned-gmres">Step 5: Solve the linear system with preconditioned GMRES</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/ffddm/tutorial.html#define-a-two-level-dd-preconditioner">Define a two level DD preconditioner</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/ffddm/tutorial.html#build-the-geneo-coarse-space">Build the GenEO coarse space</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/ffddm/tutorial.html#build-the-coarse-space-from-a-coarse-mesh">Build the coarse space from a coarse mesh</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/ffddm/tutorial.html#use-hpddm-within-ffddm">Use <strong>HPDDM</strong> within <strong>ffddm</strong></a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/ffddm/tutorial.html#some-results-heterogeneous-3d-elasticity-with-geneo">Some results: Heterogeneous 3D elasticity with GenEO</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/ffddm/tutorial.html#some-results-2-level-dd-for-maxwell-equations-scattering-from-the-cobra-cavity">Some results: 2-level DD for Maxwell equations, scattering from the COBRA cavity</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/ffddm/tutorial.html#id2">Some results: 2-level DD for Maxwell equations, scattering from the COBRA cavity</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/ffddm/examples.html">Examples</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="misc.html">Misc</a><ul>
<li class="toctree-l3"><a class="reference internal" href="misc.html#poisson-s-equation">Poisson’s Equation</a></li>
<li class="toctree-l3"><a class="reference internal" href="misc.html#poisson-s-equation-3d">Poisson’s equation 3D</a></li>
<li class="toctree-l3"><a class="reference internal" href="misc.html#stokes-equation-on-a-cube">Stokes Equation on a cube</a></li>
<li class="toctree-l3"><a class="reference internal" href="misc.html#cavity">Cavity</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="meshGeneration.html">Mesh Generation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="meshGeneration.html#square-mesh">Square mesh</a></li>
<li class="toctree-l3"><a class="reference internal" href="meshGeneration.html#mesh-adaptation">Mesh adaptation</a></li>
<li class="toctree-l3"><a class="reference internal" href="meshGeneration.html#mesh-adaptation-for-the-poisson-s-problem">Mesh adaptation for the Poisson’s problem</a></li>
<li class="toctree-l3"><a class="reference internal" href="meshGeneration.html#uniform-mesh-adaptation">Uniform mesh adaptation</a></li>
<li class="toctree-l3"><a class="reference internal" href="meshGeneration.html#borders">Borders</a></li>
<li class="toctree-l3"><a class="reference internal" href="meshGeneration.html#change">Change</a></li>
<li class="toctree-l3"><a class="reference internal" href="meshGeneration.html#cube">Cube</a></li>
<li class="toctree-l3"><a class="reference internal" href="meshGeneration.html#empty-mesh">Empty mesh</a></li>
<li class="toctree-l3"><a class="reference internal" href="meshGeneration.html#points">3 points</a></li>
<li class="toctree-l3"><a class="reference internal" href="meshGeneration.html#bezier">Bezier</a></li>
<li class="toctree-l3"><a class="reference internal" href="meshGeneration.html#build-layer-mesh">Build layer mesh</a></li>
<li class="toctree-l3"><a class="reference internal" href="meshGeneration.html#sphere">Sphere</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="finiteElement.html">Finite Element</a><ul>
<li class="toctree-l3"><a class="reference internal" href="finiteElement.html#periodic-3d">Periodic 3D</a></li>
<li class="toctree-l3"><a class="reference internal" href="finiteElement.html#lagrange-multipliers">Lagrange multipliers</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="visualization.html">Visualization</a><ul>
<li class="toctree-l3"><a class="reference internal" href="visualization.html#plot">Plot</a></li>
<li class="toctree-l3"><a class="reference internal" href="visualization.html#hsv">HSV</a></li>
<li class="toctree-l3"><a class="reference internal" href="visualization.html#medit">Medit</a></li>
<li class="toctree-l3"><a class="reference internal" href="visualization.html#paraview">Paraview</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="algoOptimizations.html">Algorithms &amp; Optimizations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="algoOptimizations.html#algorithms">Algorithms</a></li>
<li class="toctree-l3"><a class="reference internal" href="algoOptimizations.html#cmaes-variational-inequality">CMAES variational inequality</a></li>
<li class="toctree-l3"><a class="reference internal" href="algoOptimizations.html#ipopt-minimal-surface-volume">IPOPT minimal surface &amp; volume</a></li>
<li class="toctree-l3"><a class="reference internal" href="algoOptimizations.html#cmaes-mpi-variational-inequality">CMAES MPI variational inequality</a></li>
</ul>
</li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Parallelization</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#mpi-gmres-2d">MPI-GMRES 2D</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mpi-gmres-3d">MPI-GMRES 3D</a></li>
<li class="toctree-l3"><a class="reference internal" href="#direct-solvers">Direct solvers</a></li>
<li class="toctree-l3"><a class="reference internal" href="#solver-mumps">Solver MUMPS</a></li>
<li class="toctree-l3"><a class="reference internal" href="#solver-superlu-dist">Solver superLU_DIST</a></li>
<li class="toctree-l3"><a class="reference internal" href="#solver-pastix">Solver PaStiX</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="developers.html">Developers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="developers.html#fft">FFT</a></li>
<li class="toctree-l3"><a class="reference internal" href="developers.html#complex">Complex</a></li>
<li class="toctree-l3"><a class="reference internal" href="developers.html#string">String</a></li>
<li class="toctree-l3"><a class="reference internal" href="developers.html#elementary-function">Elementary function</a></li>
<li class="toctree-l3"><a class="reference internal" href="developers.html#array">Array</a></li>
<li class="toctree-l3"><a class="reference internal" href="developers.html#block-matrix">Block matrix</a></li>
<li class="toctree-l3"><a class="reference internal" href="developers.html#matrix-operations">Matrix operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="developers.html#matrix-inversion">Matrix inversion</a></li>
<li class="toctree-l3"><a class="reference internal" href="developers.html#fe-array">FE array</a></li>
<li class="toctree-l3"><a class="reference internal" href="developers.html#loop">Loop</a></li>
<li class="toctree-l3"><a class="reference internal" href="developers.html#implicit-loop">Implicit loop</a></li>
<li class="toctree-l3"><a class="reference internal" href="developers.html#i-o">I/O</a></li>
<li class="toctree-l3"><a class="reference internal" href="developers.html#file-stream">File stream</a></li>
<li class="toctree-l3"><a class="reference internal" href="developers.html#command-line-arguments">Command line arguments</a></li>
<li class="toctree-l3"><a class="reference internal" href="developers.html#macro">Macro</a></li>
<li class="toctree-l3"><a class="reference internal" href="developers.html#basic-error-handling">Basic error handling</a></li>
<li class="toctree-l3"><a class="reference internal" href="developers.html#error-handling">Error handling</a></li>
</ul>
</li>
</ul>
</li>
</ul>

	</div>

	<div class="nav-links" id="staticNav">
	</div>

	<button class="nav-btn" onclick="openNav()"><i class="fa fa-bars"></i></button>

	<div id="sideNav" class="sidenav">
		<div class="sideNavHeader">
			<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg
   xmlns:dc="http://purl.org/dc/elements/1.1/"
   xmlns:cc="http://creativecommons.org/ns#"
   xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
   xmlns:svg="http://www.w3.org/2000/svg"
   xmlns="http://www.w3.org/2000/svg"
   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
   id="Calque_1"
   data-name="Calque 1"
   viewBox="0 0 380.98 113.39"
   version="1.1"
   sodipodi:docname="Logo.svg"
   inkscape:version="0.92.4 5da689c313, 2019-01-14">
  <metadata
     id="metadata30">
    <rdf:RDF>
      <cc:Work
         rdf:about="">
        <dc:format>image/svg+xml</dc:format>
        <dc:type
           rdf:resource="http://purl.org/dc/dcmitype/StillImage" />
      </cc:Work>
    </rdf:RDF>
  </metadata>
  <sodipodi:namedview
     pagecolor="#ffffff"
     bordercolor="#666666"
     borderopacity="1"
     objecttolerance="10"
     gridtolerance="10"
     guidetolerance="10"
     inkscape:pageopacity="0"
     inkscape:pageshadow="2"
     inkscape:window-width="1920"
     inkscape:window-height="1016"
     id="namedview28"
     showgrid="false"
     inkscape:zoom="1.1312929"
     inkscape:cx="194.02578"
     inkscape:cy="53.159222"
     inkscape:window-x="0"
     inkscape:window-y="27"
     inkscape:window-maximized="1"
     inkscape:current-layer="Calque_1" />
  <defs
     id="defs4">
    <style
       id="style2">.cls-1{fill:blue;}.cls-2{fill:#00007f;}</style>
  </defs>
  <title
     id="title6">Logo</title>
  <path
     class="cls-2"
     d="M397.36,291H381.81v14.22h-11V267.42h27.75v8.44H381.74v6.67H397.3V291Z"
     transform="translate(-230.46 -229.51)"
     id="path13" />
  <path
     class="cls-2"
     d="M417.29,292.68H413v12.51H402V267.42h16.7c4.89,0,8.76,1,11.49,3a9.55,9.55,0,0,1,4.13,8.32,12.59,12.59,0,0,1-1.59,6.73,11.85,11.85,0,0,1-5.33,4.38l8.19,15v.44H423.77ZM413,284.24h5.71c3.18,0,4.76-1.4,4.76-4.25s-1.71-4.13-5.08-4.13H413Z"
     transform="translate(-230.46 -229.51)"
     id="path15" />
  <path
     class="cls-2"
     d="M465.8,289.89H450.94v6.86h17.59v8.44H440V267.42h28.76v8.44H450.94v5.59H465.8Z"
     transform="translate(-230.46 -229.51)"
     id="path17" />
  <path
     class="cls-2"
     d="M497.6,289.89H482.75v6.86h17.58v8.44H471.77V267.42h28.75v8.44H482.75v5.59H497.6Z"
     transform="translate(-230.46 -229.51)"
     id="path19" />
  <path
     class="cls-2"
     d="M530.11,291H514.55v14.22h-11V267.42h27.75v8.44H514.49v6.67h15.56V291Z"
     transform="translate(-230.46 -229.51)"
     id="path21" />
  <path
     class="cls-2"
     d="M560.58,289.89H545.73v6.86h17.58v8.44H534.74V267.42H563.5v8.44H545.73v5.59h14.85Z"
     transform="translate(-230.46 -229.51)"
     id="path23" />
  <path
     class="cls-2"
     d="M581.09,267.42,589,291.54l7.87-24.12h14.6v37.77h-11v-5.84l1.08-20.19-9,26h-7l-9-26,1.14,20.19v5.84h-11V267.42Z"
     transform="translate(-230.46 -229.51)"
     id="path25" />
  <g
     id="g833"
     transform="matrix(0.69996616,0,0,0.69996616,24.36493,-106.39712)">
    <rect
       transform="matrix(1,0,-0.17364818,0.98480775,0,0)"
       rx="3.1896071"
       y="181.58182"
       x="49.328617"
       height="86.368324"
       width="21.264048"
       id="rect1411"
       style="fill:#0000ff;fill-opacity:1;stroke:none;stroke-width:0.8504014;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" />
    <rect
       transform="matrix(1,0,-0.17364818,0.98480775,0,0)"
       rx="3.1896071"
       y="181.58182"
       x="64.966545"
       height="21.592081"
       width="53.160122"
       id="rect1413"
       style="fill:#0000ff;fill-opacity:1;stroke:none;stroke-width:0.8504014;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" />
    <rect
       transform="matrix(1,0,-0.17364818,0.98480775,0,0)"
       rx="3.1896071"
       y="218.71571"
       x="72.469795"
       height="16.194061"
       width="21.264048"
       id="rect1415"
       style="fill:#0000ff;fill-opacity:1;stroke:none;stroke-width:0.8504014;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" />
    <rect
       transform="matrix(1,0,-0.17364818,0.98480775,0,0)"
       rx="3.1896071"
       y="205.23866"
       x="95.834"
       height="86.368324"
       width="21.264048"
       id="rect1411-6"
       style="fill:#0000ff;fill-opacity:1;stroke:none;stroke-width:0.8504014;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" />
    <rect
       transform="matrix(1,0,-0.17364818,0.98480775,0,0)"
       rx="3.1896071"
       y="205.23866"
       x="111.47193"
       height="21.592081"
       width="53.160122"
       id="rect1413-7"
       style="fill:#0000ff;fill-opacity:1;stroke:none;stroke-width:0.8504014;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" />
    <rect
       transform="matrix(1,0,-0.17364818,0.98480775,0,0)"
       rx="3.1896071"
       y="242.37254"
       x="118.97518"
       height="16.194061"
       width="21.264048"
       id="rect1415-5"
       style="fill:#0000ff;fill-opacity:1;stroke:none;stroke-width:0.8504014;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" />
  </g>
</svg>
			<a class="closebtn" href="#" onclick="closeNav()"><i class="fas fa-times"></i></a>
		</div>
		<div id="dynamicSideNav">
		</div>
	</div>
	<script async src="../_static/js/lunr.js"></script>
<script async src="../_static/lunr/lunr_index.js"></script>

<div class="search-container">
	<label for="searchInput"><i class="fas fa-search"></i></label>
	<input type="search" placeholder="Search ..." id="searchInput">
	<div id="searchResults"></div>
</div>

<script src="../_static/js/search.js"></script>
<script>
   initSearch('../')
</script>
	
</nav>
<script async src="../_static/js/nav.js"></script>
		

		<div id="subnav">
	<div style="display: none">
		<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../documentation/index.html">Documentation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="misc.html">Misc</a></li>
<li class="toctree-l2"><a class="reference internal" href="meshGeneration.html">Mesh Generation</a></li>
<li class="toctree-l2"><a class="reference internal" href="finiteElement.html">Finite Element</a></li>
<li class="toctree-l2"><a class="reference internal" href="visualization.html">Visualization</a></li>
<li class="toctree-l2"><a class="reference internal" href="algoOptimizations.html">Algorithms &amp; Optimizations</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Parallelization</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#mpi-gmres-2d">MPI-GMRES 2D</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mpi-gmres-3d">MPI-GMRES 3D</a></li>
<li class="toctree-l3"><a class="reference internal" href="#direct-solvers">Direct solvers</a></li>
<li class="toctree-l3"><a class="reference internal" href="#solver-mumps">Solver MUMPS</a></li>
<li class="toctree-l3"><a class="reference internal" href="#solver-superlu-dist">Solver superLU_DIST</a></li>
<li class="toctree-l3"><a class="reference internal" href="#solver-pastix">Solver PaStiX</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="developers.html">Developers</a></li>
</ul>
</li>
</ul>

	</div>
</div>
<script async src="../_static/js/subnav.js"></script>
		
		<div id="content">
			
   <div class="section" id="parallelization">
<span id="exampleparallelization"></span><h1>Parallelization<a class="headerlink" href="#parallelization" title="Permalink to this headline"> </a></h1>
<div class="section" id="mpi-gmres-2d">
<span id="examplempigmres2d"></span><h2>MPI-GMRES 2D<a class="headerlink" href="#mpi-gmres-2d" title="Permalink to this headline"> </a></h2>
<p>To launch this script, use for example:</p>
<div class="highlight-bash notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>ff-mpirun -np <span class="m">12</span> MPIGMRES2D.edp -d <span class="m">1</span> -k <span class="m">1</span> -gmres <span class="m">2</span> -n <span class="m">50</span>
</pre></div>
</td></tr></table></div>
<div class="highlight-freefem notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444
445
446
447
448
449
450
451
452
453
454
455
456</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">//usage :</span>
<span class="c1">//ff-mpirun [mpi parameter] MPIGMRES2d.edp [-glut ffglut] [-n N] [-k K] [-d D] [-ns] [-gmres [0|1]</span>
<span class="c1">//arguments:</span>
<span class="c1">//-glut ffglut : to see graphicaly the process</span>
<span class="c1">//-n N: set the mesh cube split NxNxN</span>
<span class="c1">//-d D: set debug flag D must be one for mpiplot</span>
<span class="c1">//-k K: to refined by K all element</span>
<span class="c1">//-ns: remove script dump</span>
<span class="c1">//-gmres</span>
<span class="c1">//0: use iterative schwarz algo.</span>
<span class="c1">//1: Algo GMRES on residu of schwarz algo</span>
<span class="c1">//2: DDM GMRES</span>
<span class="c1">//3: DDM GMRES with coarse grid preconditionner (Good one)</span>

<span class="cp">load</span> <span class="s">&quot;MPICG&quot;</span>
<span class="cp">load</span> <span class="s">&quot;</span><span class="nf">medit</span><span class="s">&quot;</span>
<span class="cp">load</span> <span class="s">&quot;metis&quot;</span>
<span class="cp">include</span> <span class="s">&quot;getARGV.idp&quot;</span>
<span class="cp">include</span> <span class="s">&quot;MPIplot.idp&quot;</span>
<span class="cp">include</span> <span class="s">&quot;MPIGMRESmacro.idp&quot;</span>

<span class="kr">searchMethod</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">//more safe seach algo (warning can be very expensive in case of lot of ouside point)</span>
<span class="nf">assert</span><span class="p">(</span><span class="kr">version</span> <span class="o">&gt;=</span> <span class="mf">3.11</span><span class="p">);</span> <span class="c1">//need at least v3.11</span>
<span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">ttt</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">ittt</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
<span class="kt">macro</span> <span class="n">settt</span> <span class="p">{</span><span class="n">ttt</span><span class="p">[</span><span class="n">ittt</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="nf">mpiWtime</span><span class="p">();}</span><span class="c1">//</span>

<span class="c1">// Arguments</span>
<span class="kr">verbosity</span> <span class="o">=</span> <span class="nf">getARGV</span><span class="p">(</span><span class="s">&quot;-vv&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">vdebug</span> <span class="o">=</span> <span class="nf">getARGV</span><span class="p">(</span><span class="s">&quot;-d&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">ksplit</span> <span class="o">=</span> <span class="nf">getARGV</span><span class="p">(</span><span class="s">&quot;-k&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">nloc</span> <span class="o">=</span> <span class="nf">getARGV</span><span class="p">(</span><span class="s">&quot;-n&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
<span class="kt">string</span> <span class="n">sff</span> <span class="o">=</span> <span class="nf">getARGV</span><span class="p">(</span><span class="s">&quot;-p&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">gmres</span> <span class="o">=</span> <span class="nf">getARGV</span><span class="p">(</span><span class="s">&quot;-gmres&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
<span class="kt">bool</span> <span class="n">dplot</span> <span class="o">=</span> <span class="nf">getARGV</span><span class="p">(</span><span class="s">&quot;-dp&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">nC</span> <span class="o">=</span> <span class="nf">getARGV</span><span class="p">(</span><span class="s">&quot;-N&quot;</span><span class="p">,</span> <span class="kr">max</span><span class="p">(</span><span class="n">nloc</span><span class="o">/</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">));</span>

<span class="k">if</span> <span class="p">(</span><span class="kr">mpirank</span><span class="o">==</span><span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="kr">verbosity</span><span class="p">){</span>
    <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;ARGV: &quot;</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="kr">ARGV</span><span class="p">.</span><span class="kr">n</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
        <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="kr">ARGV</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; &quot;</span><span class="p">;</span>
    <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">if</span><span class="p">(</span><span class="kr">mpirank</span><span class="o">==</span><span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="kr">verbosity</span><span class="p">)</span>
<span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; vdebug: &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">vdebug</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;, kspilt &quot;</span><span class="o">&lt;&lt;</span> <span class="n">ksplit</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;, nloc &quot;</span><span class="o">&lt;&lt;</span> <span class="n">nloc</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;, sff &quot;</span><span class="o">&lt;&lt;</span> <span class="n">sff</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;.&quot;</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>

<span class="c1">// Parameters</span>
<span class="kt">int</span> <span class="n">withplot</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kt">bool</span> <span class="n">withmetis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="kt">bool</span> <span class="n">RAS</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="kt">string</span> <span class="n">sPk</span> <span class="o">=</span> <span class="s">&quot;P2-2gd&quot;</span><span class="p">;</span>
<span class="kt">func</span> <span class="n">Pk</span> <span class="o">=</span> <span class="nc">P2</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">sizeoverlaps</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">//size of overlap</span>
<span class="kt">int</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">l111</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">];</span> <span class="c1">//mesh labels</span>

<span class="c1">// MPI function</span>
<span class="kt">func</span> <span class="kt">bool</span> <span class="nf">plotMPIall</span><span class="p">(</span><span class="kt">mesh</span> <span class="o">&amp;</span><span class="n">Th</span><span class="p">,</span> <span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="o">&amp;</span><span class="n">u</span><span class="p">,</span> <span class="kt">string</span> <span class="n">cm</span><span class="p">){</span>
    <span class="k">if</span><span class="p">(</span><span class="n">vdebug</span><span class="p">)</span>
        <span class="n">PLOTMPIALL</span><span class="p">(</span><span class="kt">mesh</span><span class="p">,</span> <span class="n">Pk</span><span class="p">,</span> <span class="n">Th</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="p">{</span><span class="kp">cmm</span><span class="o">=</span><span class="n">cm</span><span class="p">,</span> <span class="kp">nbiso</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="kp">fill</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="kp">dim</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="kp">value</span><span class="o">=</span><span class="mi">1</span><span class="p">});</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// MPI</span>
<span class="kt">mpiComm</span> <span class="nf">comm</span><span class="p">(</span><span class="kr">mpiCommWorld</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span> <span class="c1">//trick : make a no split mpiWorld</span>

<span class="kt">int</span> <span class="n">npart</span> <span class="o">=</span> <span class="nf">mpiSize</span><span class="p">(</span><span class="n">comm</span><span class="p">);</span> <span class="c1">//total number of partion</span>
<span class="kt">int</span> <span class="n">ipart</span> <span class="o">=</span> <span class="nf">mpiRank</span><span class="p">(</span><span class="n">comm</span><span class="p">);</span> <span class="c1">//current partition number</span>

<span class="kt">int</span> <span class="n">njpart</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">//Number of part with intersection (a jpart) with ipart without ipart</span>
<span class="kt">int</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">jpart</span><span class="p">(</span><span class="n">npart</span><span class="p">);</span> <span class="c1">//list of jpart</span>
<span class="k">if</span><span class="p">(</span><span class="n">ipart</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span>
    <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; Final N = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">ksplit</span><span class="o">*</span><span class="n">nloc</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;, nloc = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">nloc</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;, split = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">ksplit</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
<span class="n">settt</span>

<span class="c1">// Mesh</span>
<span class="kt">mesh</span> <span class="n">Thg</span> <span class="o">=</span> <span class="nf">square</span><span class="p">(</span><span class="n">nloc</span><span class="p">,</span> <span class="n">nloc</span><span class="p">,</span> <span class="kr">label</span><span class="o">=</span><span class="n">l111</span><span class="p">);</span>
<span class="kt">mesh</span> <span class="n">ThC</span> <span class="o">=</span> <span class="nf">square</span><span class="p">(</span><span class="n">nC</span><span class="p">,</span> <span class="n">nC</span><span class="p">,</span> <span class="kr">label</span><span class="o">=</span><span class="n">l111</span><span class="p">);</span><span class="c1">// Coarse mesh</span>

<span class="kt">mesh</span> <span class="n">Thi</span><span class="p">,</span> <span class="n">Thin</span><span class="p">;</span> <span class="c1">//with overlap, without olverlap</span>

<span class="c1">// Fespace</span>
<span class="kt">fespace</span> <span class="nf">Phg</span><span class="p">(</span><span class="n">Thg</span><span class="p">,</span> <span class="nc">P0</span><span class="p">);</span>
<span class="n">Phg</span> <span class="n">part</span><span class="p">;</span>

<span class="kt">fespace</span> <span class="nf">Vhg</span><span class="p">(</span><span class="n">Thg</span><span class="p">,</span> <span class="nc">P1</span><span class="p">);</span>
<span class="n">Vhg</span> <span class="n">unssd</span><span class="p">;</span> <span class="c1">//boolean function: 1 in the subdomain, 0 elswhere</span>

<span class="kt">fespace</span> <span class="nf">VhC</span><span class="p">(</span><span class="n">ThC</span><span class="p">,</span> <span class="nc">P1</span><span class="p">);</span> <span class="c1">// of the coarse problem</span>

<span class="c1">// Partitioning</span>
<span class="p">{</span>
    <span class="kt">int</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">nupart</span><span class="p">(</span><span class="n">Thg</span><span class="p">.</span><span class="kr">nt</span><span class="p">);</span>
    <span class="n">nupart</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">npart</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="n">ipart</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">metisdual</span><span class="p">(</span><span class="n">nupart</span><span class="p">,</span> <span class="n">Thg</span><span class="p">,</span> <span class="n">npart</span><span class="p">);</span>

    <span class="nf">broadcast</span><span class="p">(</span><span class="nf">processor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">comm</span><span class="p">),</span> <span class="n">nupart</span><span class="p">);</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">nupart</span><span class="p">.</span><span class="kr">n</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
        <span class="n">part</span><span class="p">[][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">nupart</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="n">withplot</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
    <span class="nf">plot</span><span class="p">(</span><span class="n">part</span><span class="p">,</span> <span class="kp">fill</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="kp">cmm</span><span class="o">=</span><span class="s">&quot;dual&quot;</span><span class="p">,</span> <span class="kp">wait</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="c1">// Overlapping partition</span>
<span class="n">Phg</span> <span class="n">suppi</span> <span class="o">=</span> <span class="nf">abs</span><span class="p">(</span><span class="n">part</span><span class="o">-</span><span class="n">ipart</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.1</span><span class="p">;</span>

<span class="n">Thin</span> <span class="o">=</span> <span class="nf">trunc</span><span class="p">(</span><span class="n">Thg</span><span class="p">,</span> <span class="n">suppi</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">,</span> <span class="kr">label</span><span class="o">=</span><span class="mi">10</span><span class="p">);</span> <span class="c1">// non-overlapping mesh, interfaces have label 10</span>
<span class="kt">int</span> <span class="n">nnn</span> <span class="o">=</span> <span class="n">sizeoverlaps</span><span class="o">*</span><span class="mi">2</span><span class="p">;</span><span class="c1">// to be sure</span>
<span class="n">AddLayers</span><span class="p">(</span><span class="n">Thg</span><span class="p">,</span> <span class="n">suppi</span><span class="p">[],</span> <span class="n">nnn</span><span class="p">,</span> <span class="n">unssd</span><span class="p">[]);</span> <span class="c1">//see above! suppi and unssd are modified</span>
<span class="n">unssd</span><span class="p">[]</span> <span class="o">*=</span> <span class="n">nnn</span><span class="p">;</span> <span class="c1">//to put value nnn a 0</span>
<span class="kt">real</span> <span class="n">nnn0</span> <span class="o">=</span> <span class="n">nnn</span> <span class="o">-</span> <span class="n">sizeoverlaps</span> <span class="o">+</span> <span class="mf">0.001</span><span class="p">;</span>
<span class="n">Thi</span> <span class="o">=</span> <span class="nf">trunc</span><span class="p">(</span><span class="n">Thg</span><span class="p">,</span> <span class="n">unssd</span><span class="o">&gt;</span><span class="n">nnn0</span><span class="p">,</span> <span class="kr">label</span><span class="o">=</span><span class="mi">10</span><span class="p">);</span> <span class="c1">//overlapping mesh, interfaces have label 10</span>

<span class="n">settt</span>

<span class="c1">// Fespace</span>
<span class="kt">fespace</span> <span class="n">Vhi</span><span class="p">(</span><span class="n">Thi</span><span class="p">,</span><span class="nc">P1</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">npij</span> <span class="o">=</span> <span class="n">npart</span><span class="p">;</span>
<span class="n">Vhi</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">pij</span><span class="p">(</span><span class="n">npij</span><span class="p">);</span> <span class="c1">//local partition of unit + pii</span>
<span class="n">Vhi</span> <span class="n">pii</span><span class="p">;</span>

<span class="kt">real</span> <span class="n">nnn1</span> <span class="o">=</span> <span class="o">+</span><span class="mf">0.001</span><span class="p">;</span>
<span class="p">{</span>
    <span class="cm">/*</span>
<span class="cm">    construction of the partition of the unit,</span>
<span class="cm">    let phi_i P1 FE function 1 on Thin and zero ouside of Thi and positive</span>
<span class="cm">    the partition is build with</span>
<span class="cm">    p_i = phi_i/ \sum phi_i</span>

<span class="cm">    to build the partition of one domain i</span>
<span class="cm">    we nned to find all j such that supp(phi_j) \cap supp(phi_j) is not empty</span>
<span class="cm">    &lt;=&gt; int phi_j</span>
<span class="cm">    */</span>
    <span class="c1">//build a local mesh of thii such that all computation of the unit partition are</span>
    <span class="c1">//exact in thii</span>
    <span class="kt">mesh</span> <span class="n">Thii</span> <span class="o">=</span> <span class="nf">trunc</span><span class="p">(</span><span class="n">Thg</span><span class="p">,</span> <span class="n">unssd</span><span class="o">&gt;</span><span class="n">nnn1</span><span class="p">,</span> <span class="kr">label</span><span class="o">=</span><span class="mi">10</span><span class="p">);</span> <span class="c1">//overlapping mesh, interfaces have label 10</span>

    <span class="p">{</span>
        <span class="c1">//find all j mes (supp(p_j) cap supp(p_i)) &gt;0</span>
        <span class="c1">//compute all phi_j on Thii</span>
        <span class="c1">//remark: supp p_i include in Thi</span>

        <span class="c1">// Fespace</span>
        <span class="kt">fespace</span> <span class="n">Phii</span><span class="p">(</span><span class="n">Thii</span><span class="p">,</span> <span class="nc">P0</span><span class="p">);</span>
        <span class="kt">fespace</span> <span class="nf">Vhii</span><span class="p">(</span><span class="n">Thii</span><span class="p">,</span> <span class="nc">P1</span><span class="p">);</span>
        <span class="n">Vhi</span> <span class="n">sumphi</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">Vhii</span> <span class="n">phii</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

        <span class="n">jpart</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">njpart</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="kt">int</span> <span class="n">nlayer</span> <span class="o">=</span> <span class="n">RAS</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="n">sizeoverlaps</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">ipart</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
            <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;nlayer = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">nlayer</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
        <span class="n">pii</span> <span class="o">=</span> <span class="kr">max</span><span class="p">(</span><span class="n">unssd</span><span class="o">-</span><span class="n">nnn</span><span class="o">+</span><span class="n">nlayer</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)</span><span class="o">/</span><span class="n">nlayer</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">dplot</span><span class="p">)</span>
            <span class="nf">plot</span><span class="p">(</span><span class="n">pii</span><span class="p">,</span> <span class="kp">wait</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="kp">cmm</span><span class="o">=</span><span class="s">&quot; 0000&quot;</span><span class="p">);</span>
        <span class="n">sumphi</span><span class="p">[]</span> <span class="o">+=</span> <span class="n">pii</span><span class="p">[];</span>
        <span class="k">if</span><span class="p">(</span><span class="n">dplot</span><span class="p">)</span>
            <span class="nf">plot</span><span class="p">(</span><span class="n">sumphi</span><span class="p">,</span> <span class="kp">wait</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="kp">cmm</span><span class="o">=</span><span class="s">&quot; summ 0000&quot;</span><span class="p">);</span>

        <span class="kt">real</span> <span class="n">epsmes</span> <span class="o">=</span> <span class="mf">1e-10</span><span class="o">*</span><span class="n">Thii</span><span class="p">.</span><span class="kr">area</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">npart</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">!=</span> <span class="n">ipart</span><span class="p">){</span>
            <span class="n">Phii</span> <span class="n">suppii</span> <span class="o">=</span> <span class="nf">abs</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">part</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.2</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">suppii</span><span class="p">[].</span><span class="kr">max</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">){</span>
                <span class="n">AddLayers</span><span class="p">(</span><span class="n">Thii</span><span class="p">,</span> <span class="n">suppii</span><span class="p">[],</span> <span class="n">nlayer</span><span class="p">,</span> <span class="n">phii</span><span class="p">[]);</span>
                <span class="nf">assert</span><span class="p">(</span><span class="n">phii</span><span class="p">[].</span><span class="kr">min</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">);</span>
                <span class="kt">real</span> <span class="n">interij</span> <span class="o">=</span> <span class="nf">int2d</span><span class="p">(</span><span class="n">Thi</span><span class="p">)(</span><span class="n">phii</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">interij</span> <span class="o">&gt;</span> <span class="n">epsmes</span><span class="p">){</span>
                    <span class="n">pij</span><span class="p">[</span><span class="n">njpart</span><span class="p">]</span> <span class="o">=</span> <span class="nf">abs</span><span class="p">(</span><span class="n">phii</span><span class="p">);</span>
                    <span class="k">if</span><span class="p">(</span><span class="n">vdebug</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)</span>
                        <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; ***** &quot;</span> <span class="o">&lt;&lt;</span> <span class="nf">int2d</span><span class="p">(</span><span class="n">Thi</span><span class="p">)(</span><span class="kt">real</span><span class="p">(</span><span class="n">pij</span><span class="p">[</span><span class="n">njpart</span><span class="p">])</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; &quot;</span> <span class="o">&lt;&lt;</span><span class="n">pij</span><span class="p">[</span><span class="n">njpart</span><span class="p">][].</span><span class="kr">min</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">phii</span><span class="p">[].</span><span class="kr">min</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
                    <span class="nf">assert</span><span class="p">(</span><span class="nf">int2d</span><span class="p">(</span><span class="n">Thi</span><span class="p">)(</span><span class="kt">real</span><span class="p">(</span><span class="n">pij</span><span class="p">[</span><span class="n">njpart</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">);</span>
                    <span class="k">if</span><span class="p">(</span><span class="n">dplot</span><span class="p">)</span>
                        <span class="nf">plot</span><span class="p">(</span><span class="n">pij</span><span class="p">[</span><span class="n">njpart</span><span class="p">],</span> <span class="kp">wait</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="kp">cmm</span><span class="o">=</span><span class="s">&quot; j = &quot;</span><span class="o">+</span> <span class="n">i</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="n">njpart</span><span class="p">);</span>
                    <span class="n">sumphi</span><span class="p">[]</span> <span class="o">+=</span> <span class="n">pij</span><span class="p">[</span><span class="n">njpart</span><span class="p">][];</span>
                    <span class="k">if</span><span class="p">(</span><span class="n">dplot</span><span class="p">)</span>
                        <span class="nf">plot</span><span class="p">(</span><span class="n">sumphi</span><span class="p">,</span> <span class="kp">wait</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="kp">cmm</span><span class="o">=</span><span class="s">&quot; sum j = &quot;</span><span class="o">+</span> <span class="n">i</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="n">njpart</span><span class="p">);</span>
                    <span class="n">jpart</span><span class="p">[</span><span class="n">njpart</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">if</span><span class="p">(</span><span class="n">dplot</span><span class="p">)</span>
            <span class="nf">plot</span><span class="p">(</span><span class="n">sumphi</span><span class="p">,</span> <span class="kp">wait</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="kp">dim</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="kp">cmm</span><span class="o">=</span><span class="s">&quot;sum &quot;</span><span class="p">,</span> <span class="kp">fill</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
        <span class="n">pii</span><span class="p">[]</span> <span class="o">=</span> <span class="n">pii</span><span class="p">[]</span> <span class="p">.</span><span class="o">/</span> <span class="n">sumphi</span><span class="p">[];</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">njpart</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span>
            <span class="n">pij</span><span class="p">[</span><span class="n">j</span><span class="p">][]</span> <span class="o">=</span> <span class="n">pij</span><span class="p">[</span><span class="n">j</span><span class="p">][]</span> <span class="p">.</span><span class="o">/</span> <span class="n">sumphi</span><span class="p">[];</span>
        <span class="n">jpart</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">njpart</span><span class="p">);</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">njpart</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span>
            <span class="nf">assert</span><span class="p">(</span><span class="n">pij</span><span class="p">[</span><span class="n">j</span><span class="p">][].</span><span class="kr">max</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">);</span>
        <span class="p">{</span>
            <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="n">ipart</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; number of jpart &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">njpart</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; : &quot;</span><span class="p">;</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">njpart</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span>
                <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="n">jpart</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; &quot;</span><span class="p">;</span>
            <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">sumphi</span><span class="p">[]</span> <span class="o">=</span> <span class="n">pii</span><span class="p">[];</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">njpart</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span>
            <span class="n">sumphi</span><span class="p">[]</span> <span class="o">+=</span> <span class="n">pij</span><span class="p">[</span><span class="n">j</span><span class="p">][];</span>
        <span class="k">if</span><span class="p">(</span><span class="n">vdebug</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)</span>
            <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;sum min &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">sumphi</span><span class="p">[].</span><span class="kr">min</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">sumphi</span><span class="p">[].</span><span class="kr">max</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
        <span class="nf">assert</span><span class="p">(</span><span class="n">sumphi</span><span class="p">[].</span><span class="kr">min</span> <span class="o">&gt;</span> <span class="mf">1.</span><span class="o">-</span><span class="mf">1e-6</span> <span class="o">&amp;&amp;</span> <span class="n">sumphi</span><span class="p">[].</span><span class="kr">max</span> <span class="o">&lt;</span> <span class="mf">1.</span><span class="o">+</span><span class="mf">1e-6</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span> <span class="c1">//Thii is remove here</span>
<span class="c1">// end of the construction of the local partition of the unity ...</span>
<span class="c1">// on Thi</span>
<span class="k">if</span> <span class="p">(</span><span class="n">ipart</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;End build partition&quot;</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>

<span class="c1">// Computation of number of intersection</span>
<span class="c1">//here pii and the pij is the local partition of the unit on</span>
<span class="c1">//Thi (mesh with overlap)</span>
<span class="k">if</span> <span class="p">(</span> <span class="n">dplot</span><span class="p">){</span>
    <span class="nf">plot</span><span class="p">(</span><span class="n">Thi</span><span class="p">,</span> <span class="kp">wait</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">njpart</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span>
        <span class="nf">plot</span><span class="p">(</span><span class="n">pij</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="kp">cmm</span><span class="o">=</span><span class="s">&quot; j=&quot;</span><span class="o">+</span><span class="n">j</span><span class="p">,</span> <span class="kp">wait</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">//Partition of the unity on Thi</span>
<span class="c1">//computation of message</span>
<span class="c1">//all j &gt; we have to receive</span>
<span class="c1">//data on intersection of the support of pij[0] and pij[j]</span>
<span class="n">settt</span>

<span class="k">if</span><span class="p">(</span><span class="n">vdebug</span><span class="p">)</span>
    <span class="n">plotMPIall</span><span class="p">(</span><span class="n">Thi</span><span class="p">,</span> <span class="n">pii</span><span class="p">[],</span> <span class="s">&quot;pi_i&quot;</span><span class="p">);</span>

<span class="kt">mesh</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">aThij</span><span class="p">(</span><span class="n">njpart</span><span class="p">);</span>
<span class="kt">matrix</span> <span class="n">Pii</span><span class="p">;</span>
<span class="kt">matrix</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">sMj</span><span class="p">(</span><span class="n">njpart</span><span class="p">);</span> <span class="c1">//M of send to j</span>
<span class="kt">matrix</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">rMj</span><span class="p">(</span><span class="n">njpart</span><span class="p">);</span> <span class="c1">//M to recv from j</span>
<span class="kt">fespace</span> <span class="nf">Whi</span><span class="p">(</span><span class="n">Thi</span><span class="p">,</span> <span class="n">Pk</span><span class="p">);</span>
<span class="kt">mesh</span> <span class="n">Thij</span> <span class="o">=</span> <span class="n">Thi</span><span class="p">;</span>
<span class="kt">fespace</span> <span class="nf">Whij</span><span class="p">(</span><span class="n">Thij</span><span class="p">,</span> <span class="n">Pk</span><span class="p">);</span><span class="c1">//</span>

<span class="c1">//construction of the mesh intersect i,j part</span>
<span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">jp</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">jp</span> <span class="o">&lt;</span> <span class="n">njpart</span><span class="p">;</span> <span class="o">++</span><span class="n">jp</span><span class="p">)</span>
    <span class="n">aThij</span><span class="p">[</span><span class="n">jp</span><span class="p">]</span> <span class="o">=</span> <span class="nf">trunc</span><span class="p">(</span><span class="n">Thi</span><span class="p">,</span> <span class="n">pij</span><span class="p">[</span><span class="n">jp</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">1e-6</span><span class="p">,</span> <span class="kr">label</span><span class="o">=</span><span class="mi">10</span><span class="p">);</span> <span class="c1">//mesh of the supp of pij</span>

<span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">jp</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">jp</span> <span class="o">&lt;</span> <span class="n">njpart</span><span class="p">;</span> <span class="o">++</span><span class="n">jp</span><span class="p">)</span>
    <span class="n">aThij</span><span class="p">[</span><span class="n">jp</span><span class="p">]</span> <span class="o">=</span> <span class="nf">trunc</span><span class="p">(</span><span class="n">aThij</span><span class="p">[</span><span class="n">jp</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="kp">split</span><span class="o">=</span><span class="n">ksplit</span><span class="p">);</span>

<span class="n">Thi</span> <span class="o">=</span> <span class="nf">trunc</span><span class="p">(</span><span class="n">Thi</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="kp">split</span><span class="o">=</span><span class="n">ksplit</span><span class="p">);</span>

<span class="n">settt</span>

<span class="nf">if</span> <span class="p">(</span><span class="n">ipart</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;End build mesh intersection&quot;</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>

<span class="c1">// Construction of transfert matrix</span>
<span class="p">{</span>
    <span class="n">Whi</span> <span class="n">wpii</span> <span class="o">=</span> <span class="n">pii</span><span class="p">;</span>
    <span class="n">Pii</span> <span class="o">=</span> <span class="n">wpii</span><span class="p">[];</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">jp</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">jp</span> <span class="o">&lt;</span> <span class="n">njpart</span><span class="p">;</span> <span class="o">++</span><span class="n">jp</span><span class="p">){</span>
        <span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="n">jpart</span><span class="p">[</span><span class="n">jp</span><span class="p">];</span>
        <span class="n">Thij</span> <span class="o">=</span> <span class="n">aThij</span><span class="p">[</span><span class="n">jp</span><span class="p">];</span>
        <span class="kt">matrix</span> <span class="n">I</span> <span class="o">=</span> <span class="nf">interpolate</span><span class="p">(</span><span class="n">Whij</span><span class="p">,</span> <span class="n">Whi</span><span class="p">);</span> <span class="c1">//Whji &lt;- Whi</span>
        <span class="n">sMj</span><span class="p">[</span><span class="n">jp</span><span class="p">]</span> <span class="o">=</span> <span class="n">I</span><span class="o">*</span><span class="n">Pii</span><span class="p">;</span> <span class="c1">//Whi -&gt; s Whij</span>
        <span class="n">rMj</span><span class="p">[</span><span class="n">jp</span><span class="p">]</span> <span class="o">=</span> <span class="nf">interpolate</span><span class="p">(</span><span class="n">Whij</span><span class="p">,</span> <span class="n">Whi</span><span class="p">,</span> <span class="kp">t</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span> <span class="c1">//Whji -&gt; Whi</span>
        <span class="k">if</span><span class="p">(</span><span class="n">vdebug</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">){</span>
            <span class="p">{</span><span class="n">Whi</span> <span class="n">uuu</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">Whij</span> <span class="n">vvv</span><span class="o">=-</span><span class="mi">1</span><span class="p">;</span> <span class="n">vvv</span><span class="p">[]</span><span class="o">+=</span><span class="n">I</span><span class="o">*</span><span class="n">uuu</span><span class="p">[];</span> <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="n">jp</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; %%% &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">vvv</span><span class="p">[].</span><span class="kr">linfty</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span> <span class="nf">assert</span><span class="p">(</span><span class="n">vvv</span><span class="p">[].</span><span class="kr">linfty</span> <span class="o">&lt;</span> <span class="mf">1e-6</span><span class="p">);}</span>
            <span class="p">{</span><span class="n">Whi</span> <span class="n">uuu</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">Whij</span> <span class="n">vvv</span><span class="o">=-</span><span class="mi">1</span><span class="p">;</span> <span class="n">vvv</span><span class="p">[]</span><span class="o">+=</span><span class="n">rMj</span><span class="p">[</span><span class="n">jp</span><span class="p">]</span><span class="o">&#39;*</span><span class="n">uuu</span><span class="p">[];</span> <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="n">jp</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; ### &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">vvv</span><span class="p">[].</span><span class="kr">linfty</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span> <span class="nf">assert</span><span class="p">(</span><span class="n">vvv</span><span class="p">[].</span><span class="kr">linfty</span> <span class="o">&lt;</span> <span class="mf">1e-6</span><span class="p">);}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="k">if</span> <span class="p">(</span><span class="n">ipart</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;End build transfert matrix&quot;</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>

<span class="c1">// Allocate array of send and recv data</span>
<span class="n">InitU</span><span class="p">(</span><span class="n">njpart</span><span class="p">,</span> <span class="n">Whij</span><span class="p">,</span> <span class="n">Thij</span><span class="p">,</span> <span class="n">aThij</span><span class="p">,</span> <span class="n">Usend</span><span class="p">)</span> <span class="c1">//initU(n, Vh, Th, aTh, U)</span>
<span class="n">InitU</span><span class="p">(</span><span class="n">njpart</span><span class="p">,</span> <span class="n">Whij</span><span class="p">,</span> <span class="n">Thij</span><span class="p">,</span> <span class="n">aThij</span><span class="p">,</span> <span class="n">Vrecv</span><span class="p">)</span>
<span class="k">if</span> <span class="p">(</span><span class="n">ipart</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;End init data for send/revc&quot;</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>

<span class="n">Whi</span> <span class="n">ui</span><span class="p">,</span> <span class="n">vi</span><span class="p">;</span>

<span class="kt">func</span> <span class="kt">bool</span> <span class="nf">Update</span><span class="p">(</span><span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="o">&amp;</span><span class="n">ui</span><span class="p">,</span> <span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="o">&amp;</span><span class="n">vi</span><span class="p">){</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">njpart</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span>
        <span class="n">Usend</span><span class="p">[</span><span class="n">j</span><span class="p">][]</span> <span class="o">=</span> <span class="n">sMj</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">ui</span><span class="p">;</span>
    <span class="n">SendRecvUV</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span> <span class="n">jpart</span><span class="p">,</span> <span class="n">Usend</span><span class="p">,</span> <span class="n">Vrecv</span><span class="p">)</span>
    <span class="n">vi</span> <span class="o">=</span> <span class="n">Pii</span><span class="o">*</span><span class="n">ui</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">njpart</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span>
        <span class="n">vi</span> <span class="o">+=</span> <span class="n">rMj</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">Vrecv</span><span class="p">[</span><span class="n">j</span><span class="p">][];</span>
    <span class="k">return</span> <span class="kr">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Definition of the Problem</span>
<span class="kt">func</span> <span class="n">G</span> <span class="o">=</span> <span class="kr">x</span><span class="o">*</span><span class="mf">0.1</span><span class="p">;</span>
<span class="kt">func</span> <span class="n">F</span> <span class="o">=</span> <span class="mf">1.</span><span class="p">;</span>
<span class="kt">macro</span> <span class="n">grad</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="p">[</span><span class="nf">dx</span><span class="p">(</span><span class="n">u</span><span class="p">),</span><span class="nf">dy</span><span class="p">(</span><span class="n">u</span><span class="p">)]</span> <span class="c1">//</span>
<span class="kt">varf</span> <span class="n">vBC</span> <span class="p">(</span><span class="n">U</span><span class="p">,</span> <span class="n">V</span><span class="p">)</span> <span class="o">=</span> <span class="nf">on</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">U</span><span class="o">=</span><span class="n">G</span><span class="p">);</span>
<span class="kt">varf</span> <span class="nf">vPb</span> <span class="p">(</span><span class="n">U</span><span class="p">,</span> <span class="n">V</span><span class="p">)</span> <span class="o">=</span> <span class="nf">int2d</span><span class="p">(</span><span class="n">Thi</span><span class="p">)(</span><span class="n">grad</span><span class="p">(</span><span class="n">U</span><span class="p">)</span><span class="o">&#39;*</span><span class="n">grad</span><span class="p">(</span><span class="n">V</span><span class="p">))</span> <span class="o">+</span> <span class="nf">int2d</span><span class="p">(</span><span class="n">Thi</span><span class="p">)(</span><span class="n">F</span><span class="o">*</span><span class="n">V</span><span class="p">)</span> <span class="o">+</span> <span class="nf">on</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">U</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="nf">on</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">U</span><span class="o">=</span><span class="n">G</span><span class="p">);</span>
<span class="kt">varf</span> <span class="nf">vPbC</span> <span class="p">(</span><span class="n">U</span><span class="p">,</span> <span class="n">V</span><span class="p">)</span> <span class="o">=</span> <span class="nf">int2d</span><span class="p">(</span><span class="n">ThC</span><span class="p">)(</span><span class="n">grad</span><span class="p">(</span><span class="n">U</span><span class="p">)</span><span class="o">&#39;*</span><span class="n">grad</span><span class="p">(</span><span class="n">V</span><span class="p">))</span> <span class="o">+</span> <span class="nf">on</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">U</span><span class="o">=</span><span class="mi">0</span><span class="p">);</span>
<span class="kt">varf</span> <span class="nf">vPbon</span> <span class="p">(</span><span class="n">U</span><span class="p">,</span> <span class="n">V</span><span class="p">)</span> <span class="o">=</span> <span class="nf">on</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">U</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="nf">on</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">U</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
<span class="kt">varf</span> <span class="nf">vPbon10only</span> <span class="p">(</span><span class="n">U</span><span class="p">,</span> <span class="n">V</span><span class="p">)</span> <span class="o">=</span> <span class="nf">on</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">U</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="nf">on</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">U</span><span class="o">=</span><span class="mi">0</span><span class="p">);</span>
<span class="c1">//remark the order is important we want 0 part on 10 and 1</span>

<span class="kt">matrix</span> <span class="n">Ai</span> <span class="o">=</span> <span class="n">vPb</span><span class="p">(</span><span class="n">Whi</span><span class="p">,</span> <span class="n">Whi</span><span class="p">,</span> <span class="kp">solver</span><span class="o">=</span><span class="kr">sparsesolver</span><span class="p">);</span>
<span class="kt">matrix</span> <span class="n">AC</span><span class="p">,</span> <span class="n">Rci</span><span class="p">,</span> <span class="n">Pci</span><span class="p">;</span>

<span class="k">if</span> <span class="p">(</span><span class="nf">mpiRank</span><span class="p">(</span><span class="n">comm</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">AC</span> <span class="o">=</span> <span class="n">vPbC</span><span class="p">(</span><span class="n">VhC</span><span class="p">,</span> <span class="n">VhC</span><span class="p">,</span> <span class="kp">solver</span><span class="o">=</span><span class="kr">sparsesolver</span><span class="p">);</span>

<span class="n">Pci</span> <span class="o">=</span> <span class="nf">interpolate</span><span class="p">(</span><span class="n">Whi</span><span class="p">,</span> <span class="n">VhC</span><span class="p">);</span>
<span class="n">Rci</span> <span class="o">=</span> <span class="n">Pci</span><span class="o">&#39;*</span><span class="n">Pii</span><span class="p">;</span>

<span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">onG10</span> <span class="o">=</span> <span class="n">vPbon10only</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Whi</span><span class="p">);</span>
<span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">onG</span> <span class="o">=</span> <span class="n">vPbon</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Whi</span><span class="p">);</span>
<span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">Bi</span><span class="o">=</span><span class="n">vPb</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Whi</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">kiter</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>

<span class="kt">func</span> <span class="kt">bool</span> <span class="nf">CoarseSolve</span><span class="p">(</span><span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="o">&amp;</span><span class="n">V</span><span class="p">,</span> <span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="o">&amp;</span><span class="n">U</span><span class="p">,</span> <span class="kt">mpiComm</span> <span class="o">&amp;</span><span class="n">comm</span><span class="p">){</span>
    <span class="c1">//solving the coarse probleme</span>
    <span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">Uc</span><span class="p">(</span><span class="n">Rci</span><span class="p">.</span><span class="kr">n</span><span class="p">),</span> <span class="n">Bc</span><span class="p">(</span><span class="n">Uc</span><span class="p">.</span><span class="kr">n</span><span class="p">);</span>
    <span class="n">Uc</span> <span class="o">=</span> <span class="n">Rci</span><span class="o">*</span><span class="n">U</span><span class="p">;</span>
    <span class="nf">mpiReduce</span><span class="p">(</span><span class="n">Uc</span><span class="p">,</span> <span class="n">Bc</span><span class="p">,</span> <span class="nf">processor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">comm</span><span class="p">),</span> <span class="kr">mpiSUM</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nf">mpiRank</span><span class="p">(</span><span class="n">comm</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">Uc</span> <span class="o">=</span> <span class="n">AC</span><span class="o">^-</span><span class="mi">1</span><span class="o">*</span><span class="n">Bc</span><span class="p">;</span>
    <span class="nf">broadcast</span><span class="p">(</span><span class="nf">processor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">comm</span><span class="p">),</span> <span class="n">Uc</span><span class="p">);</span>
    <span class="n">V</span> <span class="o">=</span> <span class="n">Pci</span><span class="o">*</span><span class="n">Uc</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">func</span> <span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">DJ</span> <span class="p">(</span><span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="o">&amp;</span><span class="n">U</span><span class="p">){</span>
    <span class="o">++</span><span class="n">kiter</span><span class="p">;</span>
    <span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">V</span><span class="p">(</span><span class="n">U</span><span class="p">.</span><span class="kr">n</span><span class="p">);</span>
    <span class="n">V</span> <span class="o">=</span> <span class="n">Ai</span><span class="o">*</span><span class="n">U</span><span class="p">;</span>
    <span class="n">V</span> <span class="o">=</span> <span class="n">onG10</span> <span class="o">?</span> <span class="mf">0.</span><span class="o">:</span> <span class="n">V</span><span class="p">;</span> <span class="c1">//remove internal boundary</span>
    <span class="k">return</span> <span class="n">V</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">func</span> <span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">PDJ</span> <span class="p">(</span><span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="o">&amp;</span><span class="n">U</span><span class="p">){</span>
    <span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">V</span><span class="p">(</span><span class="n">U</span><span class="p">.</span><span class="kr">n</span><span class="p">);</span>

    <span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">b</span> <span class="o">=</span> <span class="n">onG10</span> <span class="o">?</span> <span class="mf">0.</span> <span class="o">:</span> <span class="n">U</span><span class="p">;</span>
    <span class="n">V</span> <span class="o">=</span> <span class="n">Ai</span><span class="o">^-</span><span class="mi">1</span><span class="o">*</span><span class="n">b</span><span class="p">;</span>
    <span class="n">Update</span><span class="p">(</span><span class="n">V</span><span class="p">,</span> <span class="n">U</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">U</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">func</span> <span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">PDJC</span> <span class="p">(</span><span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="o">&amp;</span><span class="n">U</span><span class="p">){</span>
    <span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">V</span><span class="p">(</span><span class="n">U</span><span class="p">.</span><span class="kr">n</span><span class="p">);</span>
    <span class="n">CoarseSolve</span><span class="p">(</span><span class="n">V</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">comm</span><span class="p">);</span>
    <span class="n">V</span> <span class="o">=</span> <span class="o">-</span><span class="n">V</span><span class="p">;</span> <span class="c1">//-C2*Uo</span>
    <span class="n">U</span> <span class="o">+=</span> <span class="n">Ai</span><span class="o">*</span><span class="n">V</span><span class="p">;</span> <span class="c1">//U = (I-A C2) Uo</span>
    <span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">b</span> <span class="o">=</span> <span class="n">onG10</span> <span class="o">?</span> <span class="mf">0.</span> <span class="o">:</span> <span class="n">U</span><span class="p">;</span>
    <span class="n">U</span> <span class="o">=</span> <span class="n">Ai</span><span class="o">^-</span><span class="mi">1</span><span class="o">*</span><span class="n">b</span><span class="p">;</span> <span class="c1">// (C1( I -A C2) Uo</span>
    <span class="n">V</span> <span class="o">=</span> <span class="n">U</span> <span class="o">-</span><span class="n">V</span><span class="p">;</span>
    <span class="n">Update</span><span class="p">(</span><span class="n">V</span><span class="p">,</span> <span class="n">U</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">U</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">func</span> <span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">DJ0</span><span class="p">(</span><span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="o">&amp;</span><span class="n">U</span><span class="p">){</span>
    <span class="o">++</span><span class="n">kiter</span><span class="p">;</span>
    <span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">V</span><span class="p">(</span><span class="n">U</span><span class="p">.</span><span class="kr">n</span><span class="p">);</span>
    <span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">b</span> <span class="o">=</span> <span class="n">onG</span> <span class="p">.</span><span class="o">*</span> <span class="n">U</span><span class="p">;</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">onG</span> <span class="o">?</span> <span class="nl">b</span> <span class="o">:</span> <span class="n">Bi</span> <span class="p">;</span>
    <span class="n">V</span> <span class="o">=</span> <span class="n">Ai</span><span class="o">^-</span><span class="mi">1</span><span class="o">*</span><span class="n">b</span><span class="p">;</span>
    <span class="n">Update</span><span class="p">(</span><span class="n">V</span><span class="p">,</span> <span class="n">U</span><span class="p">);</span>
    <span class="n">V</span> <span class="o">-=</span> <span class="n">U</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">V</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">Whi</span> <span class="n">u</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">v</span><span class="p">;</span>
<span class="p">{</span> <span class="c1">//verification</span>
    <span class="n">Whi</span> <span class="n">u</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">v</span><span class="p">;</span>
    <span class="n">Update</span><span class="p">(</span><span class="n">u</span><span class="p">[],</span> <span class="n">v</span><span class="p">[]);</span>
    <span class="n">u</span><span class="p">[]</span> <span class="o">-=</span> <span class="n">v</span><span class="p">[];</span>
    <span class="nf">assert</span><span class="p">(</span><span class="n">u</span><span class="p">[].</span><span class="kr">linfty</span> <span class="o">&lt;</span> <span class="mf">1e-6</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">settt</span>
<span class="n">u</span><span class="p">[]</span> <span class="o">=</span> <span class="n">vBC</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Whi</span><span class="p">,</span> <span class="kp">tgv</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span> <span class="c1">//set u with tgv BC value</span>

<span class="kt">real</span> <span class="n">epss</span> <span class="o">=</span> <span class="mf">1e-6</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">rgmres</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="n">gmres</span> <span class="o">==</span> <span class="mi">1</span><span class="p">){</span>
    <span class="n">rgmres</span> <span class="o">=</span> <span class="n">MPIAffineGMRES</span><span class="p">(</span><span class="n">DJ0</span><span class="p">,</span> <span class="n">u</span><span class="p">[],</span> <span class="kp">veps</span><span class="o">=</span><span class="n">epss</span><span class="p">,</span> <span class="kp">nbiter</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">comm</span><span class="o">=</span><span class="n">comm</span><span class="p">,</span> <span class="nf">dimKrylov</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="kr">verbosity</span><span class="o">=</span><span class="n">ipart</span> <span class="o">?</span> <span class="mi">0</span><span class="o">:</span> <span class="mi">50</span><span class="p">);</span>
    <span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">b</span> <span class="o">=</span> <span class="n">onG</span> <span class="p">.</span><span class="o">*</span> <span class="n">u</span><span class="p">[];</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">onG</span> <span class="o">?</span> <span class="nl">b</span> <span class="o">:</span> <span class="n">Bi</span><span class="p">;</span>
    <span class="n">v</span><span class="p">[]</span> <span class="o">=</span> <span class="n">Ai</span><span class="o">^-</span><span class="mi">1</span><span class="o">*</span><span class="n">b</span><span class="p">;</span>
    <span class="n">Update</span><span class="p">(</span><span class="n">v</span><span class="p">[],</span> <span class="n">u</span><span class="p">[]);</span>
<span class="p">}</span>
<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">gmres</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">rgmres</span> <span class="o">=</span> <span class="n">MPILinearGMRES</span><span class="p">(</span><span class="n">DJ</span><span class="p">,</span> <span class="kp">precon</span><span class="o">=</span><span class="n">PDJ</span><span class="p">,</span> <span class="n">u</span><span class="p">[],</span> <span class="n">Bi</span><span class="p">,</span> <span class="kp">veps</span><span class="o">=</span><span class="n">epss</span><span class="p">,</span> <span class="kp">nbiter</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">comm</span><span class="o">=</span><span class="n">comm</span><span class="p">,</span> <span class="nf">dimKrylov</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="kr">verbosity</span><span class="o">=</span><span class="n">ipart</span> <span class="o">?</span> <span class="mi">0</span><span class="o">:</span> <span class="mi">50</span><span class="p">);</span>
<span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="n">gmres</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">rgmres</span> <span class="o">=</span> <span class="n">MPILinearGMRES</span><span class="p">(</span><span class="n">DJ</span><span class="p">,</span> <span class="kp">precon</span><span class="o">=</span><span class="n">PDJC</span><span class="p">,</span> <span class="n">u</span><span class="p">[],</span> <span class="n">Bi</span><span class="p">,</span> <span class="kp">veps</span><span class="o">=</span><span class="n">epss</span><span class="p">,</span> <span class="kp">nbiter</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">comm</span><span class="o">=</span><span class="n">comm</span><span class="p">,</span> <span class="nf">dimKrylov</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="kr">verbosity</span><span class="o">=</span><span class="n">ipart</span> <span class="o">?</span> <span class="mi">0</span><span class="o">:</span> <span class="mi">50</span><span class="p">);</span>
<span class="k">else</span> <span class="c1">//algo Shwarz for demo</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">iter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iter</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="o">++</span><span class="n">iter</span><span class="p">){</span>
        <span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">b</span> <span class="o">=</span> <span class="n">onG</span> <span class="p">.</span><span class="o">*</span> <span class="n">u</span><span class="p">[];</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">onG</span> <span class="o">?</span> <span class="nl">b</span> <span class="o">:</span> <span class="n">Bi</span> <span class="p">;</span>
        <span class="n">v</span><span class="p">[]</span> <span class="o">=</span> <span class="n">Ai</span><span class="o">^-</span><span class="mi">1</span><span class="o">*</span><span class="n">b</span><span class="p">;</span>

        <span class="n">Update</span><span class="p">(</span><span class="n">v</span><span class="p">[],</span> <span class="n">u</span><span class="p">[]);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">vdebug</span><span class="p">)</span>
            <span class="n">plotMPIall</span><span class="p">(</span><span class="n">Thi</span><span class="p">,</span> <span class="n">u</span><span class="p">[],</span> <span class="s">&quot;u-&quot;</span><span class="o">+</span><span class="n">iter</span><span class="p">);</span>
        <span class="n">v</span><span class="p">[]</span> <span class="o">-=</span> <span class="n">u</span><span class="p">[];</span>

        <span class="kt">real</span> <span class="kp">err</span> <span class="o">=</span> <span class="n">v</span><span class="p">[].</span><span class="kr">linfty</span><span class="p">;</span>
        <span class="kt">real</span> <span class="n">umax</span> <span class="o">=</span> <span class="n">u</span><span class="p">[].</span><span class="kr">max</span><span class="p">;</span>
        <span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">aa</span> <span class="o">=</span> <span class="p">[</span><span class="kp">err</span><span class="p">,</span> <span class="n">umax</span><span class="p">],</span> <span class="kp">bb</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
        <span class="nf">mpiAllReduce</span><span class="p">(</span><span class="n">aa</span><span class="p">,</span> <span class="kp">bb</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="kr">mpiMAX</span><span class="p">);</span>
        <span class="kt">real</span> <span class="kp">errg</span> <span class="o">=</span> <span class="kp">bb</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
        <span class="kt">real</span> <span class="n">umaxg</span> <span class="o">=</span> <span class="kp">bb</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">ipart</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
            <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="n">ipart</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; err = &quot;</span> <span class="o">&lt;&lt;</span> <span class="kp">errg</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; u. max &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">umaxg</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="kp">errg</span> <span class="o">&lt;</span> <span class="mf">1e-5</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="n">vdebug</span><span class="p">)</span>
    <span class="n">plotMPIall</span><span class="p">(</span><span class="n">Thi</span><span class="p">,</span> <span class="n">u</span><span class="p">[],</span> <span class="s">&quot;u-final&quot;</span><span class="p">);</span>

<span class="n">settt</span>

<span class="kt">real</span> <span class="kp">errg</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">umaxg</span><span class="p">;</span>
<span class="p">{</span>
    <span class="kt">real</span> <span class="n">umax</span> <span class="o">=</span> <span class="n">u</span><span class="p">[].</span><span class="kr">max</span><span class="p">,</span> <span class="n">umaxg</span><span class="p">;</span>
    <span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">aa</span> <span class="o">=</span> <span class="p">[</span><span class="n">umax</span><span class="p">],</span> <span class="kp">bb</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="nf">mpiAllReduce</span><span class="p">(</span><span class="n">aa</span><span class="p">,</span> <span class="kp">bb</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="kr">mpiMAX</span><span class="p">);</span>
    <span class="kp">errg</span> <span class="o">=</span> <span class="kp">bb</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ipart</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;umax global = &quot;</span> <span class="o">&lt;&lt;</span> <span class="kp">bb</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; Wtime = &quot;</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">ttt</span><span class="p">[</span><span class="n">ittt</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ttt</span><span class="p">[</span><span class="n">ittt</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; s &quot;</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">kiter</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="n">sff</span> <span class="o">!=</span> <span class="s">&quot;&quot;</span><span class="p">){</span>
    <span class="kt">ofstream</span> <span class="n">ff</span><span class="p">(</span><span class="n">sff</span><span class="o">+</span><span class="s">&quot;.txt&quot;</span><span class="p">,</span> <span class="kr">append</span><span class="p">);</span>
    <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; ++++ &quot;</span><span class="p">;</span>
    <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="kr">mpirank</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;</span><span class="o">/</span><span class="s">&quot;</span> <span class="o">&lt;&lt;</span> <span class="kr">mpisize</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; k=&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">ksplit</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; n= &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">nloc</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">sizeoverlaps</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; it= &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">kiter</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ittt</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
        <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">ttt</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">ttt</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; &quot;</span><span class="p">;</span>
    <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="n">epss</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">Ai</span><span class="p">.</span><span class="n">nbcoef</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">Ai</span><span class="p">.</span><span class="kr">n</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>

    <span class="cm">/*</span>
<span class="cm">    1 mpirank</span>
<span class="cm">    2 mpisize</span>
<span class="cm">    3 ksplit</span>
<span class="cm">    4 nloc</span>
<span class="cm">    5 sizeoverlaps</span>
<span class="cm">    6 kiter</span>
<span class="cm">    7 mesh &amp; part build</span>
<span class="cm">    8 build the partion</span>
<span class="cm">    9 build mesh, transfere , and the fine mesh ..</span>
<span class="cm">    10 build the matrix, the trans matrix, factorizatioon</span>
<span class="cm">    11 GMRES</span>
<span class="cm">    */</span>

    <span class="n">ff</span> <span class="o">&lt;&lt;</span> <span class="kr">mpirank</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; &quot;</span> <span class="o">&lt;&lt;</span> <span class="kr">mpisize</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">sPk</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; &quot;</span><span class="p">;</span>
    <span class="n">ff</span> <span class="o">&lt;&lt;</span> <span class="n">ksplit</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">nloc</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">sizeoverlaps</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">kiter</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ittt</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
        <span class="n">ff</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">ttt</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">ttt</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; &quot;</span><span class="p">;</span>
    <span class="n">ff</span> <span class="o">&lt;&lt;</span> <span class="n">epss</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">Ai</span><span class="p">.</span><span class="n">nbcoef</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">Ai</span><span class="p">.</span><span class="kr">n</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">gmres</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<div class="figure" id="id1">
<a class="reference internal image-reference" href="../_images/MPIGMRES2D.png"><img alt="../_images/MPIGMRES2D.png" src="../_images/MPIGMRES2D.png" style="width: 50%;" /></a>
<p class="caption"><span class="caption-number">Fig. 105 </span><span class="caption-text">Results</span></p>
</div>
</div>
<div class="section" id="mpi-gmres-3d">
<span id="examplempigmres3d"></span><h2>MPI-GMRES 3D<a class="headerlink" href="#mpi-gmres-3d" title="Permalink to this headline"> </a></h2>
<div class="admonition-todo admonition" id="index-0">
<p class="first admonition-title">Todo</p>
<p class="last">todo</p>
</div>
</div>
<div class="section" id="direct-solvers">
<span id="exampledirectsolvers"></span><h2>Direct solvers<a class="headerlink" href="#direct-solvers" title="Permalink to this headline"> </a></h2>
<div class="highlight-freefem notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">load</span> <span class="s">&quot;MUMPS_FreeFem&quot;</span>
<span class="c1">//default solver: real-&gt; MUMPS, complex -&gt; MUMPS</span>
<span class="cp">load</span> <span class="s">&quot;real_SuperLU_DIST_FreeFem&quot;</span>
<span class="kr">default</span> <span class="kp">solver</span><span class="o">:</span> <span class="kt">real</span><span class="o">-&gt;</span> <span class="n">SuperLU_DIST</span><span class="p">,</span> <span class="kt">complex</span> <span class="o">-&gt;</span> <span class="n">MUMPS</span>
<span class="cp">load</span> <span class="s">&quot;real_pastix_FreeFem&quot;</span>
<span class="c1">//default solver: real-&gt; pastix, complex -&gt; MUMPS</span>

<span class="c1">// Solving with pastix</span>
<span class="p">{</span>
    <span class="kt">matrix</span> <span class="kp">A</span> <span class="o">=</span>
        <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
        <span class="p">[</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span> <span class="p">,</span> <span class="mi">10</span><span class="p">],</span>
        <span class="p">[</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
        <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span>
        <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mi">22</span><span class="p">]];</span>

    <span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">xx</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="kr">x</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="n">b</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="n">di</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
    <span class="n">b</span> <span class="o">=</span> <span class="kp">A</span><span class="o">*</span><span class="n">xx</span><span class="p">;</span>
    <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;b = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">b</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
    <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;xx = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">xx</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>

    <span class="nf">set</span><span class="p">(</span><span class="kp">A</span><span class="p">,</span> <span class="kp">solver</span><span class="o">=</span><span class="kr">sparsesolver</span><span class="p">,</span> <span class="kp">datafilename</span><span class="o">=</span><span class="s">&quot;ffpastix_iparm_dparm.txt&quot;</span><span class="p">);</span>
    <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;</span><span class="kt">solve</span><span class="s">&quot;</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
    <span class="kr">x</span> <span class="o">=</span> <span class="kp">A</span><span class="o">^-</span><span class="mi">1</span><span class="o">*</span><span class="n">b</span><span class="p">;</span>
    <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;b = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">b</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
    <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;x = &quot;</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
    <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="kr">x</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
    <span class="n">di</span> <span class="o">=</span> <span class="n">xx</span> <span class="o">-</span> <span class="kr">x</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="kr">mpirank</span> <span class="o">==</span> <span class="mi">0</span><span class="p">){</span>
        <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;x-xx = &quot;</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
        <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Linf = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">di</span><span class="p">.</span><span class="kr">linfty</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;, L2 = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">di</span><span class="p">.</span><span class="kr">l2</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Solving with SuperLU_DIST</span>
<span class="n">realdefaulttoSuperLUdist</span><span class="p">();</span>
<span class="c1">//default solver: real-&gt; SuperLU_DIST, complex -&gt; MUMPS</span>
<span class="p">{</span>
    <span class="kt">matrix</span> <span class="kp">A</span> <span class="o">=</span>
        <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
        <span class="p">[</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span> <span class="p">,</span> <span class="mi">10</span><span class="p">],</span>
        <span class="p">[</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
        <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span>
        <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mi">22</span><span class="p">]];</span>

    <span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">xx</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="kr">x</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="n">b</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="n">di</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
    <span class="n">b</span> <span class="o">=</span> <span class="kp">A</span><span class="o">*</span><span class="n">xx</span><span class="p">;</span>
    <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;b = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">b</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
    <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;xx = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">xx</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>

    <span class="nf">set</span><span class="p">(</span><span class="kp">A</span><span class="p">,</span> <span class="kp">solver</span><span class="o">=</span><span class="kr">sparsesolver</span><span class="p">,</span> <span class="kp">datafilename</span><span class="o">=</span><span class="s">&quot;ffsuperlu_dist_fileparam.txt&quot;</span><span class="p">);</span>
    <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;</span><span class="kt">solve</span><span class="s">&quot;</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
    <span class="kr">x</span> <span class="o">=</span> <span class="kp">A</span><span class="o">^-</span><span class="mi">1</span><span class="o">*</span><span class="n">b</span><span class="p">;</span>
    <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;b = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">b</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
    <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;x = &quot;</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
    <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="kr">x</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
    <span class="n">di</span> <span class="o">=</span> <span class="n">xx</span> <span class="o">-</span> <span class="kr">x</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="kr">mpirank</span> <span class="o">==</span> <span class="mi">0</span><span class="p">){</span>
        <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;x-xx = &quot;</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
        <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Linf = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">di</span><span class="p">.</span><span class="kr">linfty</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;, L2 = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">di</span><span class="p">.</span><span class="kr">l2</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Solving with MUMPS</span>
<span class="n">defaulttoMUMPS</span><span class="p">();</span>
<span class="c1">//default solver: real-&gt; MUMPS, complex -&gt; MUMPS</span>
<span class="p">{</span>
    <span class="kt">matrix</span> <span class="kp">A</span> <span class="o">=</span>
        <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
        <span class="p">[</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span> <span class="p">,</span> <span class="mi">10</span><span class="p">],</span>
        <span class="p">[</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
        <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span>
        <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mi">22</span><span class="p">]];</span>

    <span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">xx</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="kr">x</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="n">b</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="n">di</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
    <span class="n">b</span> <span class="o">=</span> <span class="kp">A</span><span class="o">*</span><span class="n">xx</span><span class="p">;</span>
    <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;b = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">b</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
    <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;xx = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">xx</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>

    <span class="nf">set</span><span class="p">(</span><span class="kp">A</span><span class="p">,</span> <span class="kp">solver</span><span class="o">=</span><span class="kr">sparsesolver</span><span class="p">,</span> <span class="kp">datafilename</span><span class="o">=</span><span class="s">&quot;ffmumps_fileparam.txt&quot;</span><span class="p">);</span>
    <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;solving solution&quot;</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
    <span class="kr">x</span> <span class="o">=</span> <span class="kp">A</span><span class="o">^-</span><span class="mi">1</span><span class="o">*</span><span class="n">b</span><span class="p">;</span>
    <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;b = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">b</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
    <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;x = &quot;</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
    <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="kr">x</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
    <span class="n">di</span> <span class="o">=</span> <span class="n">xx</span> <span class="o">-</span> <span class="kr">x</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="kr">mpirank</span> <span class="o">==</span> <span class="mi">0</span><span class="p">){</span>
        <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;x-xx = &quot;</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
        <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Linf = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">di</span><span class="p">.</span><span class="kr">linfty</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;, L2 &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">di</span><span class="p">.</span><span class="kr">l2</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="solver-mumps">
<span id="examplesolvermumps"></span><h2>Solver MUMPS<a class="headerlink" href="#solver-mumps" title="Permalink to this headline"> </a></h2>
<div class="highlight-freefem notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">load</span> <span class="s">&quot;MUMPS_FreeFem&quot;</span>

<span class="c1">// Parameters</span>
<span class="kt">int</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">ICNTL</span><span class="p">(</span><span class="mi">40</span><span class="p">);</span> <span class="c1">//declaration of ICNTL parameter for MUMPS</span>

<span class="c1">//get value of ICNTL from file</span>
<span class="k">if</span> <span class="p">(</span><span class="kr">mpirank</span> <span class="o">==</span> <span class="mi">0</span><span class="p">){</span>
    <span class="kt">ifstream</span> <span class="n">ff</span><span class="p">(</span><span class="s">&quot;ffmumps_fileparam.txt&quot;</span><span class="p">);</span>
    <span class="kt">string</span> <span class="n">line</span><span class="p">;</span>
    <span class="nf">getline</span><span class="p">(</span><span class="n">ff</span><span class="p">,</span> <span class="n">line</span><span class="p">);</span>
    <span class="nf">getline</span><span class="p">(</span><span class="n">ff</span><span class="p">,</span> <span class="n">line</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iii</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iii</span> <span class="o">&lt;</span> <span class="mi">40</span><span class="p">;</span> <span class="n">iii</span><span class="o">++</span><span class="p">){</span>
        <span class="n">ff</span> <span class="o">&gt;&gt;</span> <span class="n">ICNTL</span><span class="p">[</span><span class="n">iii</span><span class="p">];</span>
        <span class="nf">getline</span><span class="p">(</span><span class="n">ff</span><span class="p">,</span> <span class="n">line</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nf">broadcast</span><span class="p">(</span><span class="nf">processor</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">ICNTL</span><span class="p">);</span>

<span class="c1">// Given data of MUMPS solver in array lparams(SYM, PAR, ICNTL)</span>
<span class="c1">// There is no symmetric storage for a matrix associated with a sparse solver.</span>
<span class="c1">// Therefore, the matrix will be considered unsymmetric for parallel sparse solver even if symmetric.</span>
<span class="p">{</span>
    <span class="c1">// Problem</span>
    <span class="kt">int</span> <span class="n">SYM</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">PAR</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="kt">matrix</span> <span class="kp">A</span> <span class="o">=</span>
        <span class="p">[</span>
            <span class="p">[</span><span class="mi">40</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">22</span><span class="p">]</span>
        <span class="p">];</span>

    <span class="c1">// Construction of integer parameter for MUMPS</span>
    <span class="kt">int</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">MumpsLParams</span><span class="p">(</span><span class="mi">42</span><span class="p">);</span>
    <span class="n">MumpsLParams</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">SYM</span><span class="p">;</span>
    <span class="n">MumpsLParams</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">PAR</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">ii</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">ii</span> <span class="o">&lt;</span> <span class="mi">40</span><span class="p">;</span> <span class="n">ii</span><span class="o">++</span><span class="p">)</span>
        <span class="n">MumpsLParams</span><span class="p">[</span><span class="n">ii</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">ICNTL</span><span class="p">[</span><span class="n">ii</span><span class="p">];</span> <span class="c1">//ICNTL begin with index 0 here</span>

    <span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">xx</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="kr">x</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="n">b</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="n">di</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
    <span class="n">b</span> <span class="o">=</span> <span class="kp">A</span><span class="o">*</span><span class="n">xx</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="kr">mpirank</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;xx = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">xx</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>

    <span class="nf">set</span><span class="p">(</span><span class="kp">A</span><span class="p">,</span> <span class="kp">solver</span><span class="o">=</span><span class="kr">sparsesolver</span><span class="p">,</span> <span class="kp">lparams</span><span class="o">=</span><span class="n">MumpsLParams</span><span class="p">);</span> <span class="c1">//we take the default value for CNTL MUMPS parameter</span>

    <span class="c1">// Solve</span>
    <span class="k">if</span> <span class="p">(</span><span class="kr">mpirank</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Solve&quot;</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
    <span class="kr">x</span> <span class="o">=</span> <span class="kp">A</span><span class="o">^-</span><span class="mi">1</span><span class="o">*</span><span class="n">b</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="kr">mpirank</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;b = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">b</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="kr">mpirank</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;x = &quot;</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span> <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="kr">x</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
    <span class="n">di</span> <span class="o">=</span> <span class="n">xx</span><span class="o">-</span><span class="kr">x</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="kr">mpirank</span> <span class="o">==</span> <span class="mi">0</span><span class="p">){</span>
        <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;x-xx = &quot;</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
        <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Linf = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">di</span><span class="p">.</span><span class="kr">linfty</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;, L2 = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">di</span><span class="p">.</span><span class="kr">l2</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Read parameter of MUMPS solver in file ffmumps_fileparam.txt</span>
<span class="p">{</span>
    <span class="c1">// Problem</span>
    <span class="kt">matrix</span> <span class="kp">A</span> <span class="o">=</span>
        <span class="p">[</span>
            <span class="p">[</span><span class="mi">40</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">22</span><span class="p">]</span>
        <span class="p">];</span>

    <span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">xx</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">7000</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="kr">x</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="n">b</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="n">di</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
    <span class="n">b</span> <span class="o">=</span> <span class="kp">A</span><span class="o">*</span><span class="n">xx</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="kr">mpirank</span> <span class="o">==</span> <span class="mi">0</span><span class="p">){</span>
        <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;b = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">b</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
        <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;xx = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">xx</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nf">set</span><span class="p">(</span><span class="kp">A</span><span class="p">,</span> <span class="kp">solver</span><span class="o">=</span><span class="kr">sparsesolver</span><span class="p">,</span> <span class="kp">datafilename</span><span class="o">=</span><span class="s">&quot;ffmumps_fileparam.txt&quot;</span><span class="p">);</span>

    <span class="c1">// Solve</span>
    <span class="k">if</span> <span class="p">(</span><span class="kr">mpirank</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Solve&quot;</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
    <span class="kr">x</span> <span class="o">=</span> <span class="kp">A</span><span class="o">^-</span><span class="mi">1</span><span class="o">*</span><span class="n">b</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="kr">mpirank</span> <span class="o">==</span> <span class="mi">0</span><span class="p">){</span>
        <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;b = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">b</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
        <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;x = &quot;</span> <span class="o">&lt;&lt;</span> <span class="kr">x</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">di</span> <span class="o">=</span> <span class="n">xx</span><span class="o">-</span><span class="kr">x</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="kr">mpirank</span> <span class="o">==</span> <span class="mi">0</span><span class="p">){</span>
        <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;x-xx = &quot;</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
        <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Linf = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">di</span><span class="p">.</span><span class="kr">linfty</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;, L2 = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">di</span><span class="p">.</span><span class="kr">l2</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="solver-superlu-dist">
<span id="examplesolversuperludist"></span><h2>Solver superLU_DIST<a class="headerlink" href="#solver-superlu-dist" title="Permalink to this headline"> </a></h2>
<div class="admonition-todo admonition" id="index-1">
<p class="first admonition-title">Todo</p>
<p class="last">write code (SuperLU_DIST seems to have a bug)</p>
</div>
</div>
<div class="section" id="solver-pastix">
<span id="examplesolverpastix"></span><h2>Solver PaStiX<a class="headerlink" href="#solver-pastix" title="Permalink to this headline"> </a></h2>
<div class="admonition-todo admonition" id="index-2">
<p class="first admonition-title">Todo</p>
<p class="last">write code (PaStiX seems to have a bug)</p>
</div>
</div>
</div>


		</div>
		
		<div id="toc">
	<div>
		<b>Table of content</b>
		<ul>
<li><a class="reference internal" href="#">Parallelization</a><ul>
<li><a class="reference internal" href="#mpi-gmres-2d">MPI-GMRES 2D</a></li>
<li><a class="reference internal" href="#mpi-gmres-3d">MPI-GMRES 3D</a></li>
<li><a class="reference internal" href="#direct-solvers">Direct solvers</a></li>
<li><a class="reference internal" href="#solver-mumps">Solver MUMPS</a></li>
<li><a class="reference internal" href="#solver-superlu-dist">Solver superLU_DIST</a></li>
<li><a class="reference internal" href="#solver-pastix">Solver PaStiX</a></li>
</ul>
</li>
</ul>

	</div>
</div>
		<footer>
	<p>
		Coded with <i class="fas fa-heart"></i> since 1987
	</p>
	<img src='../_static/img/Symbole.svg' alt="FreeFEM logo"/>
	<div>
		<a id="lgpl" href="https://www.gnu.org/licenses/lgpl-3.0.txt" target="_blank">LGPL 3.0</a>
		<a href="http://doc.freefem.org/introduction/citation/" target="_blank">BibTeX</a>
	</div>
</footer>
		

		<script async src="../_static/js/common.js"></script>
	</body>
</html>