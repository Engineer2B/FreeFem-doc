<!DOCTYPE html>

<html lang="en">
	<head>
		  <meta charset="UTF-8">
  <title>Navier-Stokes equations</title>
  <link rel="icon" href="../_static/img/Symbol.png" />

  <!--Let browser know website is optimized for mobile-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no" />

  <!-- Google font -->
  <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700,900" rel="stylesheet">

  <!-- FreeFEM theme specific -->
  <link rel="stylesheet" type="text/css" href="../_static/css/freefemtheme.css" />

  <!-- css -->
  <link rel="stylesheet" href="../_static/css/pygments_custom.css" type="text/css" />

  <!-- MathJax -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script>
  <script src="../_static/js/mathjax-config.js"></script>

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
	</head>
	<body>
		<header>
   <a class="header-logo" href="../introduction/index.html">
      <img alt="logo" title="FreeFEM documentation" src="../_static/img/FreeFem_Documentation_Logo_bleu.svg" />
   </a>

   <a class="header-github" href="https://github.com/FreeFem/FreeFem-sources" target="_blank">
      <i class="fab fa-github"></i>
      <p class="header-github-title" >
         FreeFEM on GitHub
      </p>

      <p class="header-github-stars" id="headerGithubStarsForks">
         <span id="headerGithubStars"></span> stars - <span id="headerGithubForks"></span> forks
      </p>
   </a>
</header>
<script async src="../_static/js/github.js"></script>
		
		<nav id="nav">
	<div style="display: none;">
		<ul>
<li class="toctree-l1"><a class="reference internal" href="../introduction/index.html">Introduction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../introduction/download.html">Download FreeFEM</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../introduction/download.html#latest-binary-packages">Latest binary packages</a></li>
<li class="toctree-l3"><a class="reference internal" href="../introduction/download.html#syntax-highlighters">Syntax highlighters</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/installation.html">Installation guide</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../introduction/installation.html#easy-installation">Easy installation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../introduction/installation.html#windows-binary-installation">Windows binary installation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../introduction/installation.html#macos-x-binary-installation">MacOS X binary installation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../introduction/installation.html#arch-aur-package">Arch AUR package</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../introduction/installation.html#text-editor">Text-editor</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../introduction/installation.html#atom">Atom</a></li>
<li class="toctree-l4"><a class="reference internal" href="../introduction/installation.html#gedit">Gedit</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../introduction/installation.html#compilation">Compilation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../introduction/installation.html#branches-os-status">Branches / OS status</a></li>
<li class="toctree-l4"><a class="reference internal" href="../introduction/installation.html#compilation-on-osx-10-13">Compilation on OSX (&gt;=10.13)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../introduction/installation.html#compilation-on-ubuntu">Compilation on Ubuntu</a></li>
<li class="toctree-l4"><a class="reference internal" href="../introduction/installation.html#compilation-on-arch-linux">Compilation on Arch Linux</a></li>
<li class="toctree-l4"><a class="reference internal" href="../introduction/installation.html#compilation-on-linux-with-intel-software-tools">Compilation on Linux with Intel software tools</a></li>
<li class="toctree-l4"><a class="reference internal" href="../introduction/installation.html#compilation-on-windows">Compilation on Windows</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../introduction/installation.html#environment-variables-and-init-file">Environment variables and init file</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/contributing.html">Contributing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../introduction/contributing.html#bug-report">Bug report</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../introduction/contributing.html#concerning-the-freefem-documentation">Concerning the <strong>FreeFEM</strong> documentation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../introduction/contributing.html#concerning-the-freefem-compilation-or-usage">Concerning the <strong>FreeFEM</strong> compilation or usage</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../introduction/contributing.html#improve-content">Improve content</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/citation.html">Citation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../introduction/citation.html#if-you-use-freefem-please-cite-the-following-reference-in-your-work">If you use <strong>FreeFEM</strong>, please cite the following reference in your work:</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../introduction/citation.html#apa">APA</a></li>
<li class="toctree-l4"><a class="reference internal" href="../introduction/citation.html#iso690">ISO690</a></li>
<li class="toctree-l4"><a class="reference internal" href="../introduction/citation.html#mla">MLA</a></li>
<li class="toctree-l4"><a class="reference internal" href="../introduction/citation.html#bibtex">BibTeX</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/authors.html">Authors</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../documentation/index.html">Documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../documentation/notations.html">Notations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../documentation/notations.html#generalities">Generalities</a></li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/notations.html#sets-mappings-matrices-vectors">Sets, Mappings, Matrices, Vectors</a></li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/notations.html#numbers">Numbers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/notations.html#differential-calculus">Differential Calculus</a></li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/notations.html#meshes">Meshes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/notations.html#finite-element-spaces">Finite Element Spaces</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../documentation/meshGeneration.html">Mesh Generation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../documentation/meshGeneration.html#square">Square</a></li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/meshGeneration.html#border">Border</a></li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/meshGeneration.html#multi-border">Multi-Border</a></li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/meshGeneration.html#data-structures-and-read-write-statements-for-a-mesh">Data Structures and Read/Write Statements for a Mesh</a></li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/meshGeneration.html#mesh-connectivity-and-data">Mesh Connectivity and data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/meshGeneration.html#the-keyword-triangulate">The keyword “triangulate”</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../documentation/meshGeneration.html#boundary-fem-spaces-built-as-empty-meshes">Boundary FEM Spaces Built as Empty Meshes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/meshGeneration.html#remeshing">Remeshing</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/meshGeneration.html#movemesh">Movemesh</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../documentation/meshGeneration.html#regular-triangulation-htriangle">Regular Triangulation: hTriangle</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/meshGeneration.html#adaptmesh">Adaptmesh</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/meshGeneration.html#trunc">Trunc</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/meshGeneration.html#splitmesh">Splitmesh</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/meshGeneration.html#meshing-examples">Meshing Examples</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/meshGeneration.html#how-to-change-the-label-of-elements-and-border-elements-of-a-mesh">How to change the label of elements and border elements of a mesh</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/meshGeneration.html#mesh-in-three-dimensions">Mesh in three dimensions</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/meshGeneration.html#cube">Cube</a></li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/meshGeneration.html#read-write-statements-for-a-mesh-in-3d">Read/Write Statements for a Mesh in 3D</a></li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/meshGeneration.html#tetgen-a-tetrahedral-mesh-generator">TetGen: A tetrahedral mesh generator</a></li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/meshGeneration.html#reconstruct-refine-a-three-dimensional-mesh-with-tetgen">Reconstruct/Refine a three dimensional mesh with TetGen</a></li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/meshGeneration.html#moving-mesh-in-three-dimensions">Moving mesh in three dimensions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/meshGeneration.html#layer-mesh">Layer mesh</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../documentation/meshGeneration.html#meshing-examples-1">Meshing examples</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/meshGeneration.html#build-a-3d-mesh-of-a-cube-with-a-balloon">Build a 3d mesh of a cube with a balloon</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../documentation/meshGeneration.html#medit">Medit</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/meshGeneration.html#mshmet">Mshmet</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/meshGeneration.html#freeyams">FreeYams</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/meshGeneration.html#mmg3d">mmg3d</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/meshGeneration.html#a-first-3d-isotrope-mesh-adaptation-process">A first 3d isotrope mesh adaptation process</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/meshGeneration.html#build-a-2d-mesh-from-a-isoline">Build a 2d mesh from a isoline</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../documentation/finiteElement.html">Finite element</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../documentation/finiteElement.html#use-of-freefem-fespace-in-2d">Use of freefem fespace in 2D</a></li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/finiteElement.html#use-of-fespace-in-3d">Use of fespace in 3D</a></li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/finiteElement.html#lagrangian-finite-elements">Lagrangian Finite Elements</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../documentation/finiteElement.html#p0-element">P0-element</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/finiteElement.html#p1-element">P1-element</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/finiteElement.html#p2-element">P2-element</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/finiteElement.html#p1-nonconforming-element">P1 Nonconforming Element</a></li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/finiteElement.html#other-fe-space">Other FE-space</a></li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/finiteElement.html#vector-valued-fe-function">Vector Valued FE-function</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../documentation/finiteElement.html#raviart-thomas-element">Raviart-Thomas Element</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/finiteElement.html#a-fast-finite-element-interpolator">A Fast Finite Element Interpolator</a></li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/finiteElement.html#keywords-problem-and-solve">Keywords: Problem and Solve</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../documentation/finiteElement.html#weak-form-and-boundary-condition">Weak Form and Boundary Condition</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/finiteElement.html#parameters-affecting-solve-and-problem">Parameters affecting solve and problem</a></li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/finiteElement.html#problem-definition">Problem definition</a></li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/finiteElement.html#numerical-integration">Numerical Integration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/finiteElement.html#variational-form-sparse-matrix-pde-data-vector">Variational Form, Sparse Matrix, PDE Data Vector</a></li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/finiteElement.html#interpolation-matrix">Interpolation matrix</a></li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/finiteElement.html#finite-elements-connectivity">Finite elements connectivity</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../documentation/visualization.html">Visualization</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../documentation/visualization.html#plot">Plot</a></li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/visualization.html#link-with-gnuplot">Link with gnuplot</a></li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/visualization.html#link-with-medit">Link with medit</a></li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/visualization.html#link-with-paraview">Link with Paraview</a></li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/visualization.html#link-with-matlab-and-octave">Link with Matlab© and Octave</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../documentation/algorithmsOptimization.html">Algorithms &amp; Optimization</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../documentation/algorithmsOptimization.html#conjugate-gradient-gmres">Conjugate Gradient/GMRES</a></li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/algorithmsOptimization.html#algorithms-for-unconstrained-optimization">Algorithms for Unconstrained Optimization</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../documentation/algorithmsOptimization.html#example-of-usage-for-bfgs-or-cmaes">Example of usage for BFGS or CMAES</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/algorithmsOptimization.html#ipopt">IPOPT</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../documentation/algorithmsOptimization.html#short-description-of-the-algorithm">Short description of the algorithm</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/algorithmsOptimization.html#ipopt-in-freefem">IPOPT in <strong>FreeFEM</strong></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/algorithmsOptimization.html#some-short-examples-using-ipopt">Some short examples using IPOPT</a></li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/algorithmsOptimization.html#d-constrained-minimum-surface-with-ipopt">3D constrained minimum surface with IPOPT</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../documentation/algorithmsOptimization.html#area-and-volume-expressions">Area and volume expressions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/algorithmsOptimization.html#derivatives">Derivatives</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/algorithmsOptimization.html#the-problem-and-its-script">The problem and its script</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/algorithmsOptimization.html#the-nlopt-optimizers">The nlOpt optimizers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/algorithmsOptimization.html#optimization-with-mpi">Optimization with MPI</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../documentation/parallelization.html">Parallelization</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../documentation/parallelization.html#mpi">MPI</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../documentation/parallelization.html#mpi-keywords">MPI Keywords</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/parallelization.html#mpi-constants">MPI Constants</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/parallelization.html#mpi-constructor">MPI Constructor</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/parallelization.html#mpi-functions">MPI Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/parallelization.html#mpi-communicator-operator">MPI Communicator operator</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/parallelization.html#schwarz-example-in-parallel">Schwarz example in parallel</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../documentation/parallelization.html#true-parallel-schwarz-example">True parallel Schwarz example</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/parallelization.html#parallel-sparse-solvers">Parallel sparse solvers</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../documentation/parallelization.html#using-parallel-sparse-solvers-in-freefem">Using parallel sparse solvers in <strong>FreeFEM</strong></a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/parallelization.html#sparse-direct-solver">Sparse direct solver</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../documentation/parallelization.html#mumps-solver">MUMPS solver</a></li>
<li class="toctree-l5"><a class="reference internal" href="../documentation/parallelization.html#superlu-distributed-solver">SuperLU distributed solver</a></li>
<li class="toctree-l5"><a class="reference internal" href="../documentation/parallelization.html#pastix-solver">PaStiX solver</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/parallelization.html#parallel-sparse-iterative-solver">Parallel sparse iterative solver</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../documentation/parallelization.html#parms-solver">pARMS solver</a></li>
<li class="toctree-l5"><a class="reference internal" href="../documentation/parallelization.html#interfacing-with-hips">Interfacing with HIPS</a></li>
<li class="toctree-l5"><a class="reference internal" href="../documentation/parallelization.html#interfacing-with-hypre">Interfacing with HYPRE</a></li>
<li class="toctree-l5"><a class="reference internal" href="../documentation/parallelization.html#conclusion">Conclusion</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/parallelization.html#domain-decomposition">Domain decomposition</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../documentation/parallelization.html#communicators-and-groups">Communicators and groups</a></li>
<li class="toctree-l5"><a class="reference internal" href="../documentation/parallelization.html#process">Process</a></li>
<li class="toctree-l5"><a class="reference internal" href="../documentation/parallelization.html#points-to-points-communicators">Points to Points communicators</a></li>
<li class="toctree-l5"><a class="reference internal" href="../documentation/parallelization.html#global-operations">Global operations</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/parallelization.html#hpddm-solvers">HPDDM solvers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/parallelization.html#time-dependent-problem">Time dependent problem</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/parallelization.html#distributed-vectors-in-hpddm">Distributed vectors in HPDDM</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../documentation/plugins.html">Plugins</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../documentation/plugins.html#gsl">gsl</a></li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/plugins.html#ffrandom">ffrandom</a></li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/plugins.html#mmap-semaphore">mmap / semaphore</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../documentation/developers.html">Developers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../documentation/developers.html#file-formats">File formats</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../documentation/developers.html#mesh-file-data-structure">Mesh file data structure</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/developers.html#bb-file-type-to-store-solutions">bb file type to Store Solutions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/developers.html#id1">BB file type to store solutions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/developers.html#metric-file">Metric file</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/developers.html#list-of-am-fmt-amdba-meshes">List of AM_FMT, AMDBA Meshes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/developers.html#sol-and-solb-files">sol and solb files</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/developers.html#adding-a-new-finite-element">Adding a new finite element</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../documentation/developers.html#some-notations">Some notations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/developers.html#which-class-to-add">Which class to add?</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/developers.html#dynamical-link">Dynamical link</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../documentation/developers.html#a-first-example-myfunction-cpp">A first example myfunction.cpp</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/developers.html#example-discrete-fast-fourier-transform">Example: Discrete Fast Fourier Transform</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/developers.html#load-module-for-dervieux-p0-p1-finite-volume-method">Load Module for Dervieux P0-P1 Finite Volume Method</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/developers.html#more-on-adding-a-new-finite-element">More on Adding a new finite element</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../documentation/developers.html#the-bernardi-raugel-element">The Bernardi-Raugel Element</a></li>
<li class="toctree-l5"><a class="reference internal" href="../documentation/developers.html#the-morley-element">The Morley Element</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../documentation/ffddm/index.html">ffddm</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../documentation/ffddm/introddm.html">Domain Decomposition (DD)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../documentation/ffddm/introddm.html#mesh-decomposition">Mesh Decomposition</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/ffddm/introddm.html#distributed-linear-algebra">Distributed Linear Algebra</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/ffddm/introddm.html#partition-of-unity-matrices-poum">Partition of Unity Matrices (POUM)</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../documentation/ffddm/introddm.html#distributed-scalar-product">Distributed scalar product</a></li>
<li class="toctree-l5"><a class="reference internal" href="../documentation/ffddm/introddm.html#update">Update</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/ffddm/introddm.html#distributed-matrix-and-vector-resulting-from-a-variational-formulation">Distributed Matrix and Vector resulting from a variational formulation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/ffddm/introddm.html#distributed-linear-solvers">Distributed Linear Solvers</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../documentation/ffddm/introddm.html#distributed-direct-solvers">Distributed Direct Solvers</a></li>
<li class="toctree-l5"><a class="reference internal" href="../documentation/ffddm/introddm.html#schwarz-methods">Schwarz methods</a><ul>
<li class="toctree-l6"><a class="reference internal" href="../documentation/ffddm/introddm.html#restricted-additive-schwarz-ras">Restricted Additive Schwarz (RAS)</a></li>
<li class="toctree-l6"><a class="reference internal" href="../documentation/ffddm/introddm.html#optimized-restricted-additive-schwarz-oras">Optimized Restricted Additive Schwarz (ORAS)</a></li>
<li class="toctree-l6"><a class="reference internal" href="../documentation/ffddm/introddm.html#two-level-methods">Two level methods</a><ul>
<li class="toctree-l7"><a class="reference internal" href="../documentation/ffddm/introddm.html#coarse-mesh">Coarse Mesh</a></li>
<li class="toctree-l7"><a class="reference internal" href="../documentation/ffddm/introddm.html#geneo">GenEO</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/ffddm/documentation.html">ffddm documentation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../documentation/ffddm/documentation.html#minimal-example">Minimal example</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/ffddm/documentation.html#overlapping-mesh-decomposition">Overlapping mesh decomposition</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/ffddm/documentation.html#local-finite-element-spaces">Local finite element spaces</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/ffddm/documentation.html#define-the-problem-to-solve">Define the problem to solve</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/ffddm/documentation.html#one-level-preconditioners">One level preconditioners</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/ffddm/documentation.html#two-level-preconditioners">Two level preconditioners</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../documentation/ffddm/documentation.html#building-the-geneo-coarse-space">Building the GenEO coarse space</a></li>
<li class="toctree-l5"><a class="reference internal" href="../documentation/ffddm/documentation.html#building-the-coarse-space-from-a-coarse-mesh">Building the coarse space from a coarse mesh</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/ffddm/documentation.html#solving-the-linear-system">Solving the linear system</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/ffddm/documentation.html#using-hpddm-within-ffddm">Using <em>HPDDM</em> within <em>ffddm</em></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/ffddm/parameters.html">Parameters</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../documentation/ffddm/parameters.html#command-line-arguments">Command-line arguments</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/ffddm/parameters.html#global-parameters">Global parameters</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/ffddm/tutorial.html">Tutorial</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../documentation/ffddm/tutorial.html#what-is-ffddm">What is <strong>ffddm</strong> ?</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/ffddm/tutorial.html#why-domain-decomposition-methods">Why Domain Decomposition Methods ?</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../documentation/ffddm/tutorial.html#step-1-decompose-the-mesh">Step 1: Decompose the mesh</a></li>
<li class="toctree-l5"><a class="reference internal" href="../documentation/ffddm/tutorial.html#step-2-define-your-finite-element">Step 2: Define your finite element</a><ul>
<li class="toctree-l6"><a class="reference internal" href="../documentation/ffddm/tutorial.html#distributed-vectors-and-restriction-operators">Distributed vectors and restriction operators</a></li>
<li class="toctree-l6"><a class="reference internal" href="../documentation/ffddm/tutorial.html#partition-of-unity">Partition of unity</a></li>
<li class="toctree-l6"><a class="reference internal" href="../documentation/ffddm/tutorial.html#data-exchange-between-neighbors">Data exchange between neighbors</a></li>
</ul>
</li>
<li class="toctree-l5"><a class="reference internal" href="../documentation/ffddm/tutorial.html#step-3-define-your-problem">Step 3: Define your problem</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/ffddm/tutorial.html#summary-so-far-translating-your-sequential-freefem-script">Summary so far: translating your sequential <em>FreeFEM</em> script</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../documentation/ffddm/tutorial.html#id1">Step 1: Decompose the mesh</a></li>
<li class="toctree-l5"><a class="reference internal" href="../documentation/ffddm/tutorial.html#solve-the-linear-system">Solve the linear system</a></li>
<li class="toctree-l5"><a class="reference internal" href="../documentation/ffddm/tutorial.html#solve-the-linear-system-with-the-parallel-direct-solver-mumps">Solve the linear system with the parallel direct solver <em>MUMPS</em></a></li>
<li class="toctree-l5"><a class="reference internal" href="../documentation/ffddm/tutorial.html#step-4-define-the-one-level-dd-preconditioner">Step 4: Define the one level DD preconditioner</a></li>
<li class="toctree-l5"><a class="reference internal" href="../documentation/ffddm/tutorial.html#step-5-solve-the-linear-system-with-preconditioned-gmres">Step 5: Solve the linear system with preconditioned GMRES</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/ffddm/tutorial.html#define-a-two-level-dd-preconditioner">Define a two level DD preconditioner</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/ffddm/tutorial.html#build-the-geneo-coarse-space">Build the GenEO coarse space</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/ffddm/tutorial.html#build-the-coarse-space-from-a-coarse-mesh">Build the coarse space from a coarse mesh</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/ffddm/tutorial.html#use-hpddm-within-ffddm">Use <strong>HPDDM</strong> within <strong>ffddm</strong></a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/ffddm/tutorial.html#some-results-heterogeneous-3d-elasticity-with-geneo">Some results: Heterogeneous 3D elasticity with GenEO</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/ffddm/tutorial.html#some-results-2-level-dd-for-maxwell-equations-scattering-from-the-cobra-cavity">Some results: 2-level DD for Maxwell equations, scattering from the COBRA cavity</a></li>
<li class="toctree-l4"><a class="reference internal" href="../documentation/ffddm/tutorial.html#id2">Some results: 2-level DD for Maxwell equations, scattering from the COBRA cavity</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/ffddm/examples.html">Examples</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../example/index.html">Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../example/misc.html">Misc</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../example/misc.html#poisson-s-equation">Poisson’s Equation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../example/misc.html#poisson-s-equation-3d">Poisson’s equation 3D</a></li>
<li class="toctree-l3"><a class="reference internal" href="../example/misc.html#stokes-equation-on-a-cube">Stokes Equation on a cube</a></li>
<li class="toctree-l3"><a class="reference internal" href="../example/misc.html#cavity">Cavity</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../example/meshGeneration.html">Mesh Generation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../example/meshGeneration.html#square-mesh">Square mesh</a></li>
<li class="toctree-l3"><a class="reference internal" href="../example/meshGeneration.html#mesh-adaptation">Mesh adaptation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../example/meshGeneration.html#mesh-adaptation-for-the-poisson-s-problem">Mesh adaptation for the Poisson’s problem</a></li>
<li class="toctree-l3"><a class="reference internal" href="../example/meshGeneration.html#uniform-mesh-adaptation">Uniform mesh adaptation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../example/meshGeneration.html#borders">Borders</a></li>
<li class="toctree-l3"><a class="reference internal" href="../example/meshGeneration.html#change">Change</a></li>
<li class="toctree-l3"><a class="reference internal" href="../example/meshGeneration.html#cube">Cube</a></li>
<li class="toctree-l3"><a class="reference internal" href="../example/meshGeneration.html#empty-mesh">Empty mesh</a></li>
<li class="toctree-l3"><a class="reference internal" href="../example/meshGeneration.html#points">3 points</a></li>
<li class="toctree-l3"><a class="reference internal" href="../example/meshGeneration.html#bezier">Bezier</a></li>
<li class="toctree-l3"><a class="reference internal" href="../example/meshGeneration.html#build-layer-mesh">Build layer mesh</a></li>
<li class="toctree-l3"><a class="reference internal" href="../example/meshGeneration.html#sphere">Sphere</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../example/finiteElement.html">Finite Element</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../example/finiteElement.html#periodic-3d">Periodic 3D</a></li>
<li class="toctree-l3"><a class="reference internal" href="../example/finiteElement.html#lagrange-multipliers">Lagrange multipliers</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../example/visualization.html">Visualization</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../example/visualization.html#plot">Plot</a></li>
<li class="toctree-l3"><a class="reference internal" href="../example/visualization.html#hsv">HSV</a></li>
<li class="toctree-l3"><a class="reference internal" href="../example/visualization.html#medit">Medit</a></li>
<li class="toctree-l3"><a class="reference internal" href="../example/visualization.html#paraview">Paraview</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../example/algoOptimizations.html">Algorithms &amp; Optimizations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../example/algoOptimizations.html#algorithms">Algorithms</a></li>
<li class="toctree-l3"><a class="reference internal" href="../example/algoOptimizations.html#cmaes-variational-inequality">CMAES variational inequality</a></li>
<li class="toctree-l3"><a class="reference internal" href="../example/algoOptimizations.html#ipopt-minimal-surface-volume">IPOPT minimal surface &amp; volume</a></li>
<li class="toctree-l3"><a class="reference internal" href="../example/algoOptimizations.html#cmaes-mpi-variational-inequality">CMAES MPI variational inequality</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../example/parallelization.html">Parallelization</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../example/parallelization.html#mpi-gmres-2d">MPI-GMRES 2D</a></li>
<li class="toctree-l3"><a class="reference internal" href="../example/parallelization.html#mpi-gmres-3d">MPI-GMRES 3D</a></li>
<li class="toctree-l3"><a class="reference internal" href="../example/parallelization.html#direct-solvers">Direct solvers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../example/parallelization.html#solver-mumps">Solver MUMPS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../example/parallelization.html#solver-superlu-dist">Solver superLU_DIST</a></li>
<li class="toctree-l3"><a class="reference internal" href="../example/parallelization.html#solver-pastix">Solver PaStiX</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../example/developers.html">Developers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../example/developers.html#fft">FFT</a></li>
<li class="toctree-l3"><a class="reference internal" href="../example/developers.html#complex">Complex</a></li>
<li class="toctree-l3"><a class="reference internal" href="../example/developers.html#string">String</a></li>
<li class="toctree-l3"><a class="reference internal" href="../example/developers.html#elementary-function">Elementary function</a></li>
<li class="toctree-l3"><a class="reference internal" href="../example/developers.html#array">Array</a></li>
<li class="toctree-l3"><a class="reference internal" href="../example/developers.html#block-matrix">Block matrix</a></li>
<li class="toctree-l3"><a class="reference internal" href="../example/developers.html#matrix-operations">Matrix operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../example/developers.html#matrix-inversion">Matrix inversion</a></li>
<li class="toctree-l3"><a class="reference internal" href="../example/developers.html#fe-array">FE array</a></li>
<li class="toctree-l3"><a class="reference internal" href="../example/developers.html#loop">Loop</a></li>
<li class="toctree-l3"><a class="reference internal" href="../example/developers.html#implicit-loop">Implicit loop</a></li>
<li class="toctree-l3"><a class="reference internal" href="../example/developers.html#i-o">I/O</a></li>
<li class="toctree-l3"><a class="reference internal" href="../example/developers.html#file-stream">File stream</a></li>
<li class="toctree-l3"><a class="reference internal" href="../example/developers.html#command-line-arguments">Command line arguments</a></li>
<li class="toctree-l3"><a class="reference internal" href="../example/developers.html#macro">Macro</a></li>
<li class="toctree-l3"><a class="reference internal" href="../example/developers.html#basic-error-handling">Basic error handling</a></li>
<li class="toctree-l3"><a class="reference internal" href="../example/developers.html#error-handling">Error handling</a></li>
</ul>
</li>
</ul>
</li>
</ul>

	</div>

	<div class="nav-links" id="staticNav">
	</div>

	<button class="nav-btn" onclick="openNav()"><i class="fa fa-bars"></i></button>

	<div id="sideNav" class="sidenav">
		<div class="sideNavHeader">
			<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg
   xmlns:dc="http://purl.org/dc/elements/1.1/"
   xmlns:cc="http://creativecommons.org/ns#"
   xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
   xmlns:svg="http://www.w3.org/2000/svg"
   xmlns="http://www.w3.org/2000/svg"
   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
   id="Calque_1"
   data-name="Calque 1"
   viewBox="0 0 380.98 113.39"
   version="1.1"
   sodipodi:docname="Logo.svg"
   inkscape:version="0.92.4 5da689c313, 2019-01-14">
  <metadata
     id="metadata30">
    <rdf:RDF>
      <cc:Work
         rdf:about="">
        <dc:format>image/svg+xml</dc:format>
        <dc:type
           rdf:resource="http://purl.org/dc/dcmitype/StillImage" />
      </cc:Work>
    </rdf:RDF>
  </metadata>
  <sodipodi:namedview
     pagecolor="#ffffff"
     bordercolor="#666666"
     borderopacity="1"
     objecttolerance="10"
     gridtolerance="10"
     guidetolerance="10"
     inkscape:pageopacity="0"
     inkscape:pageshadow="2"
     inkscape:window-width="1920"
     inkscape:window-height="1016"
     id="namedview28"
     showgrid="false"
     inkscape:zoom="1.1312929"
     inkscape:cx="194.02578"
     inkscape:cy="53.159222"
     inkscape:window-x="0"
     inkscape:window-y="27"
     inkscape:window-maximized="1"
     inkscape:current-layer="Calque_1" />
  <defs
     id="defs4">
    <style
       id="style2">.cls-1{fill:blue;}.cls-2{fill:#00007f;}</style>
  </defs>
  <title
     id="title6">Logo</title>
  <path
     class="cls-2"
     d="M397.36,291H381.81v14.22h-11V267.42h27.75v8.44H381.74v6.67H397.3V291Z"
     transform="translate(-230.46 -229.51)"
     id="path13" />
  <path
     class="cls-2"
     d="M417.29,292.68H413v12.51H402V267.42h16.7c4.89,0,8.76,1,11.49,3a9.55,9.55,0,0,1,4.13,8.32,12.59,12.59,0,0,1-1.59,6.73,11.85,11.85,0,0,1-5.33,4.38l8.19,15v.44H423.77ZM413,284.24h5.71c3.18,0,4.76-1.4,4.76-4.25s-1.71-4.13-5.08-4.13H413Z"
     transform="translate(-230.46 -229.51)"
     id="path15" />
  <path
     class="cls-2"
     d="M465.8,289.89H450.94v6.86h17.59v8.44H440V267.42h28.76v8.44H450.94v5.59H465.8Z"
     transform="translate(-230.46 -229.51)"
     id="path17" />
  <path
     class="cls-2"
     d="M497.6,289.89H482.75v6.86h17.58v8.44H471.77V267.42h28.75v8.44H482.75v5.59H497.6Z"
     transform="translate(-230.46 -229.51)"
     id="path19" />
  <path
     class="cls-2"
     d="M530.11,291H514.55v14.22h-11V267.42h27.75v8.44H514.49v6.67h15.56V291Z"
     transform="translate(-230.46 -229.51)"
     id="path21" />
  <path
     class="cls-2"
     d="M560.58,289.89H545.73v6.86h17.58v8.44H534.74V267.42H563.5v8.44H545.73v5.59h14.85Z"
     transform="translate(-230.46 -229.51)"
     id="path23" />
  <path
     class="cls-2"
     d="M581.09,267.42,589,291.54l7.87-24.12h14.6v37.77h-11v-5.84l1.08-20.19-9,26h-7l-9-26,1.14,20.19v5.84h-11V267.42Z"
     transform="translate(-230.46 -229.51)"
     id="path25" />
  <g
     id="g833"
     transform="matrix(0.69996616,0,0,0.69996616,24.36493,-106.39712)">
    <rect
       transform="matrix(1,0,-0.17364818,0.98480775,0,0)"
       rx="3.1896071"
       y="181.58182"
       x="49.328617"
       height="86.368324"
       width="21.264048"
       id="rect1411"
       style="fill:#0000ff;fill-opacity:1;stroke:none;stroke-width:0.8504014;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" />
    <rect
       transform="matrix(1,0,-0.17364818,0.98480775,0,0)"
       rx="3.1896071"
       y="181.58182"
       x="64.966545"
       height="21.592081"
       width="53.160122"
       id="rect1413"
       style="fill:#0000ff;fill-opacity:1;stroke:none;stroke-width:0.8504014;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" />
    <rect
       transform="matrix(1,0,-0.17364818,0.98480775,0,0)"
       rx="3.1896071"
       y="218.71571"
       x="72.469795"
       height="16.194061"
       width="21.264048"
       id="rect1415"
       style="fill:#0000ff;fill-opacity:1;stroke:none;stroke-width:0.8504014;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" />
    <rect
       transform="matrix(1,0,-0.17364818,0.98480775,0,0)"
       rx="3.1896071"
       y="205.23866"
       x="95.834"
       height="86.368324"
       width="21.264048"
       id="rect1411-6"
       style="fill:#0000ff;fill-opacity:1;stroke:none;stroke-width:0.8504014;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" />
    <rect
       transform="matrix(1,0,-0.17364818,0.98480775,0,0)"
       rx="3.1896071"
       y="205.23866"
       x="111.47193"
       height="21.592081"
       width="53.160122"
       id="rect1413-7"
       style="fill:#0000ff;fill-opacity:1;stroke:none;stroke-width:0.8504014;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" />
    <rect
       transform="matrix(1,0,-0.17364818,0.98480775,0,0)"
       rx="3.1896071"
       y="242.37254"
       x="118.97518"
       height="16.194061"
       width="21.264048"
       id="rect1415-5"
       style="fill:#0000ff;fill-opacity:1;stroke:none;stroke-width:0.8504014;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" />
  </g>
</svg>
			<a class="closebtn" href="#" onclick="closeNav()"><i class="fas fa-times"></i></a>
		</div>
		<div id="dynamicSideNav">
		</div>
	</div>
	<script async src="../_static/js/lunr.js"></script>
<script async src="../_static/lunr/lunr_index.js"></script>

<div class="search-container">
	<label for="searchInput"><i class="fas fa-search"></i></label>
	<input type="search" placeholder="Search ..." id="searchInput">
	<div id="searchResults"></div>
</div>

<script src="../_static/js/search.js"></script>
<script>
   initSearch('../')
</script>
	
</nav>
<script async src="../_static/js/nav.js"></script>
		

		<div id="subnav">
	<div style="display: none">
		<ul>
<li class="toctree-l1"><a class="reference internal" href="../introduction/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../documentation/index.html">Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../example/index.html">Examples</a></li>
</ul>

	</div>
</div>
<script async src="../_static/js/subnav.js"></script>
		
		<div id="content">
			
   <div class="section" id="navier-stokes-equations">
<h1>Navier-Stokes equations<a class="headerlink" href="#navier-stokes-equations" title="Permalink to this headline"> </a></h1>
<p>The Stokes equations are: for a given <span class="math notranslate nohighlight">\(\mathbf{f}\in L^2(\Omega)^2\)</span>:</p>
<div class="math notranslate nohighlight" id="equation-eqn-stokes">
<span class="eqno">()<a class="headerlink" href="#equation-eqn-stokes" title="Permalink to this equation"> </a></span>\[\begin{split}\left.\begin{array}{cl}
    -\Delta \mathbf{u}+\nabla p &amp; =\mathbf{f} \\
    \nabla\cdot \mathbf{u} &amp;=0
\end{array}\right\}\quad \hbox{ in }\Omega\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(\mathbf{u}=(u_1,u_2)\)</span> is the velocity vector and <span class="math notranslate nohighlight">\(p\)</span> the pressure.
For simplicity, let us choose Dirichlet boundary conditions on the velocity, <span class="math notranslate nohighlight">\(\mathbf{u}=\mathbf{u}_{\Gamma}\)</span> on <span class="math notranslate nohighlight">\(\Gamma\)</span>.</p>
<p>In <a class="reference internal" href="../references.html#temam1977" id="id1">[TEMAM1977]</a>, Theorem 2.2, there is a weak form of <a class="reference internal" href="#equation-eqn-stokes">()</a>:</p>
<p>Find <span class="math notranslate nohighlight">\(\mathbf{v}=(v_1,v_2)\in \mathbf{V}(\Omega)\)</span>:</p>
<div class="math notranslate nohighlight">
\[\mathbf{V}(\Omega)=\{\mathbf{w}\in H^1_0(\Omega)^2|\; \textrm{div}\mathbf{w}=0\}\]</div>
<p>which satisfy:</p>
<div class="math notranslate nohighlight">
\[\sum_{i=1}^2\int_{\Omega}\nabla u_i\cdot \nabla v_i=\int_{\Omega}\mathbf{f}\cdot \mathbf{w}
\quad \textrm{for all }v\in V\]</div>
<p>Here it is used the existence <span class="math notranslate nohighlight">\(p\in H^1(\Omega)\)</span> such that <span class="math notranslate nohighlight">\(\mathbf{u}=\nabla p\)</span>, if:</p>
<div class="math notranslate nohighlight">
\[\int_{\Omega}\mathbf{u}\cdot \mathbf{v}=0\quad \textrm{for all }\mathbf{v}\in V\]</div>
<p>Another weak form is derived as follows: We put:</p>
<div class="math notranslate nohighlight">
\[\mathbf{V}=H^1_0(\Omega)^2;\quad
W=\left\{q\in L^2(\Omega)\left|\; \int_{\Omega}q=0\right.\right\}\]</div>
<p>By multiplying the first equation in <a class="reference internal" href="#equation-eqn-stokes">()</a> with <span class="math notranslate nohighlight">\(v\in V\)</span> and the second with <span class="math notranslate nohighlight">\(q\in W\)</span>, subsequent integration over <span class="math notranslate nohighlight">\(\Omega\)</span>, and an application of Green’s formula, we have:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}{rcl}
    \int_{\Omega}\nabla\mathbf{u}\cdot \nabla\mathbf{v}-\int_{\Omega}\textrm{div}\mathbf{v}\, p
    &amp;=&amp;\int_{\Omega}\mathbf{f}\cdot\mathbf{v}\\
    \int_{\Omega}\textrm{div}\mathbf{u}\, q&amp;=&amp;0
\end{array}\end{split}\]</div>
<p>This yields the weak form of <a class="reference internal" href="#equation-eqn-stokes">()</a>:</p>
<p>Find <span class="math notranslate nohighlight">\((\mathbf{u},p)\in \mathbf{V}\times W\)</span> such that:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}{rcl}
    a(\mathbf{u},\mathbf{v})+b(\mathbf{v},p)&amp;=&amp;(\mathbf{f},\mathbf{v})\\
    b(\mathbf{u},q)&amp;=&amp;0
\end{array}\end{split}\]</div>
<p>for all <span class="math notranslate nohighlight">\((\mathbf{v},q)\in V\times W\)</span>, where:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}{rcl}
    a(\mathbf{u},\mathbf{v})&amp;=&amp;\int_{\Omega}\nabla \mathbf{u}\cdot \nabla\mathbf{v}
    =\sum_{i=1}^2\int_{\Omega}\nabla u_i\cdot \nabla v_i\\
    b(\mathbf{u},q)&amp;=&amp;-\int_{\Omega}\textrm{div}\mathbf{u}\, q
\end{array}\end{split}\]</div>
<p>Now, we consider finite element spaces <span class="math notranslate nohighlight">\(\mathbf{V}_h\subset \mathbf{V}\)</span> and <span class="math notranslate nohighlight">\(W_h\subset W\)</span>, and we assume the following basis functions:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}{rcl}
    &amp;&amp;\mathbf{V}_h=V_h\times V_h,\quad
    V_h=\{v_h|\; v_h=v_1\phi_1+\cdots +v_{M_V}\phi_{M_V}\},\\
    &amp;&amp;W_h=\{q_h|\; q_h=q_1\varphi_1+\cdots +q_{M_W}\varphi_{M_W}\}
\end{array}\end{split}\]</div>
<p>The discrete weak form is: Find <span class="math notranslate nohighlight">\((\mathbf{u}_{h},p_{h}) \in \mathbf{V}_{h} \times W_{h}\)</span> such that:</p>
<div class="math notranslate nohighlight" id="equation-eqn-vfstokes">
<span class="eqno">()<a class="headerlink" href="#equation-eqn-vfstokes" title="Permalink to this equation"> </a></span>\[\begin{split}\begin{array}{cll}
    a(\mathbf{u}_h,\mathbf{v}_h)+b(\mathbf{v}_h,p) &amp;= (\mathbf{f},\mathbf{v}_h) ,
    &amp;\forall \mathbf{v}_{h} \in \mathbf{V}_{h} \\
    b(\mathbf{u}_h,q_h)&amp;= 0,
    &amp;\forall q_{h} \in W_{h}
\end{array}\end{split}\]</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Assume that:</p>
<ol class="last arabic">
<li><p class="first">There is a constant <span class="math notranslate nohighlight">\(\alpha_h&gt;0\)</span> such that:</p>
<blockquote>
<div><div class="math notranslate nohighlight">
\[a(\mathbf{v}_h,\mathbf{v}_h)\ge \alpha\| \mathbf{v}_h\|_{1,\Omega}^2\quad \textrm{for all }\mathbf{v}_h\in Z_h\]</div>
<p>where:</p>
<div class="math notranslate nohighlight">
\[Z_h=\{\mathbf{v}_h\in \mathbf{V}_h|\; b(\mathbf{w}_h,q_h)=0\quad \textrm{for all }q_h\in W_h\}\]</div>
</div></blockquote>
</li>
<li><p class="first">There is a constant <span class="math notranslate nohighlight">\(\beta_h&gt;0\)</span> such that:</p>
<blockquote>
<div><div class="math notranslate nohighlight">
\[\sup_{\mathbf{v}_h\in \mathbf{V}_h}\frac{b(\mathbf{v}_h,q_h)}{\| \mathbf{v}_h\|_{1,\Omega}}
\ge \beta_h\| q_h\|_{0,\Omega}\quad \textrm{for all }q_h\in W_h\]</div>
<p>Then we have an unique solution <span class="math notranslate nohighlight">\((\mathbf{u}_h,p_h)\)</span> of <a class="reference internal" href="#equation-eqn-vfstokes">()</a> satisfying:</p>
<div class="math notranslate nohighlight">
\[\| \mathbf{u}-\mathbf{u}_h\|_{1,\Omega}+\| p-p_h\|_{0,\Omega}
\le C\left(
\inf_{\mathbf{v}_h\in \mathbf{V}_h}\| u-v_h\|_{1,\Omega}
+\inf_{q_h\in W_h}\| p-q_h\|_{0,\Omega}\right)\]</div>
<p>with a constant <span class="math notranslate nohighlight">\(C&gt;0\)</span> (see e.g. <a class="reference internal" href="../references.html#roberts1993" id="id2">[ROBERTS1993]</a>, Theorem 10.4).</p>
</div></blockquote>
</li>
</ol>
</div>
<p>Let us denote that:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}{rcl}
    A&amp;=&amp;(A_{ij}),\, A_{ij}=\int_{\Omega}\nabla \phi_j\cdot \nabla \phi_i\qquad
    i,j=1,\cdots,M_{\mathbf{V}}\\
    \mathbf{B}&amp;=&amp;(Bx_{ij},By_{ij}),\,
    Bx_{ij}=-\int_{\Omega}\p \phi_j/\p x\, \varphi_i\qquad
    By_{ij}=-\int_{\Omega}\p \phi_j/\p y\, \varphi_i\nonumber\\
    &amp;&amp;\qquad i=1,\cdots,M_W;j=1,\cdots,M_V\nonumber
\end{array}\end{split}\]</div>
<p>then <a class="reference internal" href="#equation-eqn-vfstokes">()</a> is written by:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\left(
\begin{array}{cc}
    \mathbf{A}&amp;\mathbf{\mathbf{B}}^*\\
    \mathbf{B}&amp;0
\end{array}
\right)
\left(
\begin{array}{cc}
    \mathbf{U}_h\\
    \{p_h\}
\end{array}
\right)
=
\left(
\begin{array}{cc}
    \mathbf{F}_h\\
    0
\end{array}
\right)\end{split}\]</div>
<p>where:</p>
<div class="math notranslate nohighlight">
\[\begin{split}&amp;\mathbf{A}=\left(
\begin{array}{cc}
A&amp;0\\
0&amp;A
\end{array}
\right)
\qquad
\mathbf{B}^*=\left\{
\begin{array}{c}
Bx^T\\
By^T
\end{array}
\right\}
\qquad
\mathbf{U}_h=\left\{
\begin{array}{c}
\{u_{1,h}\}\\
\{u_{2,h}\}
\end{array}
\right\}
\qquad
\mathbf{F}_h=\left\{
\begin{array}{c}
\{\textstyle{\int_{\Omega}f_1\phi_i}\}\\
\{\textstyle{\int_{\Omega}f_2\phi_i}\}
\end{array}
\right\}\end{split}\]</div>
<p><strong>Penalty method:</strong> This method consists of replacing <a class="reference internal" href="#equation-eqn-vfstokes">()</a> by a more regular problem:</p>
<p>Find <span class="math notranslate nohighlight">\((\mathbf{v}_h^{\epsilon},p_h^{\epsilon})\in \mathbf{V}_h\times \tilde{W}_{h}\)</span> satisfying:</p>
<div class="math notranslate nohighlight" id="equation-eqn-pvfstokes">
<span class="eqno">()<a class="headerlink" href="#equation-eqn-pvfstokes" title="Permalink to this equation"> </a></span>\[\begin{split}\begin{array}{cll}
    a(\mathbf{u}_h^\epsilon,\mathbf{v}_h)+b(\mathbf{v}_h,p_h^{\epsilon}) &amp;= (\mathbf{f},\mathbf{v}_h) ,
    &amp;\forall \mathbf{v}_{h} \in \mathbf{V}_{h} \\
    b(\mathbf{u}_h^{\epsilon},q_h)-\epsilon(p_h^{\epsilon},q_h)&amp;= 0,
    &amp;\forall q_{h} \in \tilde{W}_{h}
\end{array}\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(\tilde{W}_h\subset L^2(\Omega)\)</span>.
Formally, we have:</p>
<div class="math notranslate nohighlight">
\[\textrm{div}\mathbf{u}_h^{\epsilon}=\epsilon p_h^{\epsilon}\]</div>
<p>and the corresponding algebraic problem:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\left(
\begin{array}{cc}
\mathbf{A}&amp;B^*\\
B&amp;-\epsilon I
\end{array}
\right)
\left(
\begin{array}{cc}
\mathbf{U}_h^{\epsilon}\\
\{p_h^{\epsilon}\}
\end{array}
\right)
=
\left(
\begin{array}{cc}
\mathbf{F}_h\\
0
\end{array}
\right)\end{split}\]</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>We can eliminate <span class="math notranslate nohighlight">\(p_h^\epsilon=(1/\epsilon)BU_h^{\epsilon}\)</span> to obtain:</p>
<div class="math notranslate nohighlight" id="equation-eqn-stiffpvfstokes">
<span class="eqno">()<a class="headerlink" href="#equation-eqn-stiffpvfstokes" title="Permalink to this equation"> </a></span>\[(A+(1/\epsilon)B^*B)\mathbf{U}_h^{\epsilon}=\mathbf{F}_h^{\epsilon}\]</div>
<p>Since the matrix <span class="math notranslate nohighlight">\(A+(1/\epsilon)B^*B\)</span> is symmetric, positive-definite, and sparse, <a class="reference internal" href="#equation-eqn-stiffpvfstokes">()</a> can be solved by known technique.
There is a constant <span class="math notranslate nohighlight">\(C&gt;0\)</span> independent of <span class="math notranslate nohighlight">\(\epsilon\)</span> such that:</p>
<div class="math notranslate nohighlight">
\[\|\mathbf{u}_h-\mathbf{u}_h^\epsilon\|_{1,\Omega}+
\|p_h-p_h^{\epsilon}\|_{0,\Omega}\le C\epsilon\]</div>
<p class="last">(see e.g. <a class="reference internal" href="../references.html#roberts1993" id="id3">[ROBERTS1993]</a>, 17.2)</p>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>Cavity</p>
<p>The driven cavity flow problem is solved first at zero Reynolds number (Stokes flow) and then at Reynolds 100.
The velocity pressure formulation is used first and then the calculation is repeated with the stream function vorticity formulation.</p>
<p>We solve the driven cavity problem by the penalty method <a class="reference internal" href="#equation-eqn-pvfstokes">()</a> where <span class="math notranslate nohighlight">\(\mathbf{u}_{\Gamma}\cdot \mathbf{n}=0\)</span> and <span class="math notranslate nohighlight">\(\mathbf{u}_{\Gamma}\cdot \mathbf{s}=1\)</span> on the top boundary and zero elsewhere (<span class="math notranslate nohighlight">\(\mathbf{n}\)</span> is the unit normal to <span class="math notranslate nohighlight">\(\Gamma\)</span>, and <span class="math notranslate nohighlight">\(\mathbf{s}\)</span> the unit tangent to <span class="math notranslate nohighlight">\(\Gamma\)</span>).</p>
<p>The mesh is constructed by:</p>
<div class="highlight-freefem notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">mesh</span> <span class="n">Th</span> <span class="o">=</span> <span class="nf">square</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
</pre></div>
</td></tr></table></div>
<p>We use a classical Taylor-Hood element technique to solve the problem:</p>
<p>The velocity is approximated with the <span class="math notranslate nohighlight">\(P_{2}\)</span> FE (<span class="math notranslate nohighlight">\(X_{h}\)</span> space), and the pressure is approximated with the <span class="math notranslate nohighlight">\(P_{1}\)</span> FE (<span class="math notranslate nohighlight">\(M_{h}\)</span> space), where:</p>
<div class="math notranslate nohighlight">
\[X_{h} = \left\{ \mathbf{v} \in H^{1}(]0,1[^2) \left|\; \forall K \in \mathcal{T}_{h}\quad v_{|K} \in P_{2}\right.\right\}\]</div>
<p>and:</p>
<div class="math notranslate nohighlight">
\[M_{h} = \left\{ v \in H^{1}(]0,1[^2) \left|\; \forall K \in \mathcal{T}_{h}\quad v_{|K} \in P_{1} \right.\right\}\]</div>
<p>The FE spaces and functions are constructed by:</p>
<div class="highlight-freefem notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">fespace</span> <span class="nf">Xh</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="nc">P2</span><span class="p">);</span> <span class="c1">//definition of the velocity component space</span>
<span class="kt">fespace</span> <span class="nf">Mh</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="nc">P1</span><span class="p">);</span> <span class="c1">//definition of the pressure space</span>
<span class="n">Xh</span> <span class="n">u2</span><span class="p">,</span> <span class="n">v2</span><span class="p">;</span>
<span class="n">Xh</span> <span class="n">u1</span><span class="p">,</span> <span class="n">v1</span><span class="p">;</span>
<span class="n">Mh</span> <span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">;</span>
</pre></div>
</td></tr></table></div>
<p>The Stokes operator is implemented as a system-solve for the velocity <span class="math notranslate nohighlight">\((u1,u2)\)</span> and the pressure <span class="math notranslate nohighlight">\(p\)</span>.
The test function for the velocity is <span class="math notranslate nohighlight">\((v1,v2)\)</span> and <span class="math notranslate nohighlight">\(q\)</span> for the pressure, so the variational form <a class="reference internal" href="#equation-eqn-vfstokes">()</a> in freefem language is:</p>
<div class="highlight-freefem notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">solve</span> <span class="nf">Stokes</span> <span class="p">(</span><span class="n">u1</span><span class="p">,</span> <span class="n">u2</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="kp">solver</span><span class="o">=</span><span class="kr">Crout</span><span class="p">)</span>
    <span class="o">=</span> <span class="nf">int2d</span><span class="p">(</span><span class="n">Th</span><span class="p">)(</span>
        <span class="p">(</span>
            <span class="nf">dx</span><span class="p">(</span><span class="n">u1</span><span class="p">)</span><span class="o">*</span><span class="nf">dx</span><span class="p">(</span><span class="n">v1</span><span class="p">)</span>
            <span class="o">+</span> <span class="nf">dy</span><span class="p">(</span><span class="n">u1</span><span class="p">)</span><span class="o">*</span><span class="nf">dy</span><span class="p">(</span><span class="n">v1</span><span class="p">)</span>
            <span class="o">+</span> <span class="nf">dx</span><span class="p">(</span><span class="n">u2</span><span class="p">)</span><span class="o">*</span><span class="nf">dx</span><span class="p">(</span><span class="n">v2</span><span class="p">)</span>
            <span class="o">+</span> <span class="nf">dy</span><span class="p">(</span><span class="n">u2</span><span class="p">)</span><span class="o">*</span><span class="nf">dy</span><span class="p">(</span><span class="n">v2</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="o">-</span> <span class="n">p</span><span class="o">*</span><span class="n">q</span><span class="o">*</span><span class="p">(</span><span class="mf">0.000001</span><span class="p">)</span>
        <span class="o">-</span> <span class="n">p</span><span class="o">*</span><span class="nf">dx</span><span class="p">(</span><span class="n">v1</span><span class="p">)</span> <span class="o">-</span> <span class="n">p</span><span class="o">*</span><span class="nf">dy</span><span class="p">(</span><span class="n">v2</span><span class="p">)</span>
        <span class="o">-</span> <span class="nf">dx</span><span class="p">(</span><span class="n">u1</span><span class="p">)</span><span class="o">*</span><span class="n">q</span> <span class="o">-</span> <span class="nf">dy</span><span class="p">(</span><span class="n">u2</span><span class="p">)</span><span class="o">*</span><span class="n">q</span>
    <span class="p">)</span>
    <span class="o">+</span> <span class="nf">on</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">u1</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">u2</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="o">+</span> <span class="nf">on</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">u1</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">u2</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="p">;</span>
</pre></div>
</td></tr></table></div>
<p>Each unknown has its own boundary conditions.</p>
<p>If the streamlines are required, they can be computed by finding <span class="math notranslate nohighlight">\(\psi\)</span> such that <span class="math notranslate nohighlight">\(rot\psi=u\)</span> or better:</p>
<div class="math notranslate nohighlight">
\[-\Delta\psi=\nabla\times u\]</div>
<div class="highlight-freefem notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">Xh</span> <span class="n">psi</span><span class="p">,</span> <span class="n">phi</span><span class="p">;</span>

<span class="kt">solve</span> <span class="nf">streamlines</span> <span class="p">(</span><span class="n">psi</span><span class="p">,</span> <span class="n">phi</span><span class="p">)</span>
    <span class="o">=</span> <span class="nf">int2d</span><span class="p">(</span><span class="n">Th</span><span class="p">)(</span>
          <span class="nf">dx</span><span class="p">(</span><span class="n">psi</span><span class="p">)</span><span class="o">*</span><span class="nf">dx</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
        <span class="o">+</span> <span class="nf">dy</span><span class="p">(</span><span class="n">psi</span><span class="p">)</span><span class="o">*</span><span class="nf">dy</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="o">+</span> <span class="nf">int2d</span><span class="p">(</span><span class="n">Th</span><span class="p">)(</span>
        <span class="o">-</span> <span class="n">phi</span><span class="o">*</span><span class="p">(</span><span class="nf">dy</span><span class="p">(</span><span class="n">u1</span><span class="p">)</span> <span class="o">-</span> <span class="nf">dx</span><span class="p">(</span><span class="n">u2</span><span class="p">))</span>
    <span class="p">)</span>
    <span class="o">+</span> <span class="nf">on</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">psi</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="p">;</span>
</pre></div>
</td></tr></table></div>
<p>Now the Navier-Stokes equations are solved:</p>
<div class="math notranslate nohighlight">
\[{\p {u}\over\p t} +u\cdot\nabla u-\nu \Delta u+\nabla p=0, \nabla\cdot u=0\]</div>
<p>with the same boundary conditions and with initial conditions <span class="math notranslate nohighlight">\(u=0\)</span>.</p>
<p>This is implemented by using the convection operator <code class="code freefem docutils literal highlight highlight-freefem"><span></span><span class="nf">convect</span></code> for the term <span class="math notranslate nohighlight">\({\p u\over\p t} +u\cdot\nabla u\)</span>, giving a discretization in time</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}{cl}
    \frac{1}{\tau } (u^{n+1}-u^n\circ X^n) -\nu\Delta u^{n+1} + \nabla p^{n+1} &amp;=0,\\
    \nabla\cdot u^{n+1} &amp;= 0
\end{array}\end{split}\]</div>
<p>The term <span class="math notranslate nohighlight">\(u^n\circ X^n(x)\approx u^n(x-u^n(x)\tau )\)</span> will be computed by the operator <code class="code freefem docutils literal highlight highlight-freefem"><span></span><span class="nf">convect</span></code>, so we obtain:</p>
<div class="highlight-freefem notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
<span class="kt">real</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="n">dt</span><span class="p">;</span>
<span class="kt">problem</span> <span class="nf">NS</span> <span class="p">(</span><span class="n">u1</span><span class="p">,</span> <span class="n">u2</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="kp">solver</span><span class="o">=</span><span class="kr">Crout</span><span class="p">,</span> <span class="kp">init</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
    <span class="o">=</span> <span class="nf">int2d</span><span class="p">(</span><span class="n">Th</span><span class="p">)(</span>
          <span class="n">alpha</span><span class="o">*</span><span class="p">(</span><span class="n">u1</span><span class="o">*</span><span class="n">v1</span> <span class="o">+</span> <span class="n">u2</span><span class="o">*</span><span class="n">v2</span><span class="p">)</span>
        <span class="o">+</span> <span class="n">nu</span> <span class="o">*</span> <span class="p">(</span>
              <span class="nf">dx</span><span class="p">(</span><span class="n">u1</span><span class="p">)</span><span class="o">*</span><span class="nf">dx</span><span class="p">(</span><span class="n">v1</span><span class="p">)</span> <span class="o">+</span> <span class="nf">dy</span><span class="p">(</span><span class="n">u1</span><span class="p">)</span><span class="o">*</span><span class="nf">dy</span><span class="p">(</span><span class="n">v1</span><span class="p">)</span>
            <span class="o">+</span> <span class="nf">dx</span><span class="p">(</span><span class="n">u2</span><span class="p">)</span><span class="o">*</span><span class="nf">dx</span><span class="p">(</span><span class="n">v2</span><span class="p">)</span> <span class="o">+</span> <span class="nf">dy</span><span class="p">(</span><span class="n">u2</span><span class="p">)</span><span class="o">*</span><span class="nf">dy</span><span class="p">(</span><span class="n">v2</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="o">-</span> <span class="n">p</span><span class="o">*</span><span class="n">q</span><span class="o">*</span><span class="p">(</span><span class="mf">0.000001</span><span class="p">)</span>
        <span class="o">-</span> <span class="n">p</span><span class="o">*</span><span class="nf">dx</span><span class="p">(</span><span class="n">v1</span><span class="p">)</span> <span class="o">-</span> <span class="n">p</span><span class="o">*</span><span class="nf">dy</span><span class="p">(</span><span class="n">v2</span><span class="p">)</span>
        <span class="o">-</span> <span class="nf">dx</span><span class="p">(</span><span class="n">u1</span><span class="p">)</span><span class="o">*</span><span class="n">q</span> <span class="o">-</span> <span class="nf">dy</span><span class="p">(</span><span class="n">u2</span><span class="p">)</span><span class="o">*</span><span class="n">q</span>
    <span class="p">)</span>
    <span class="o">+</span> <span class="nf">int2d</span><span class="p">(</span><span class="n">Th</span><span class="p">)(</span>
        <span class="o">-</span> <span class="n">alpha</span><span class="o">*</span><span class="nf">convect</span><span class="p">([</span><span class="n">up1</span><span class="p">,</span><span class="n">up2</span><span class="p">],</span><span class="o">-</span><span class="n">dt</span><span class="p">,</span><span class="n">up1</span><span class="p">)</span><span class="o">*</span><span class="n">v1</span>
        <span class="o">-</span> <span class="n">alpha</span><span class="o">*</span><span class="nf">convect</span><span class="p">([</span><span class="n">up1</span><span class="p">,</span><span class="n">up2</span><span class="p">],</span><span class="o">-</span><span class="n">dt</span><span class="p">,</span><span class="n">up2</span><span class="p">)</span><span class="o">*</span><span class="n">v2</span>
    <span class="p">)</span>
    <span class="o">+</span> <span class="nf">on</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">u1</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">u2</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="o">+</span> <span class="nf">on</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span><span class="n">u1</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">u2</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="p">;</span>

<span class="c1">// Time loop</span>
<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">10</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">){</span>
    <span class="c1">// Update</span>
    <span class="n">up1</span> <span class="o">=</span> <span class="n">u1</span><span class="p">;</span>
    <span class="n">up2</span> <span class="o">=</span> <span class="n">u2</span><span class="p">;</span>

    <span class="c1">// Solve</span>
    <span class="n">NS</span><span class="p">;</span>

    <span class="c1">// Plot</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">10</span><span class="p">))</span>
    <span class="nf">plot</span><span class="p">(</span><span class="kp">coef</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="kp">cmm</span><span class="o">=</span><span class="s">&quot;[u1,u2] and p&quot;</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="p">[</span><span class="n">u1</span><span class="p">,</span> <span class="n">u2</span><span class="p">]);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>Notice that the stiffness matrices are reused (keyword <code class="code freefem docutils literal highlight highlight-freefem"><span></span><span class="kp">init</span><span class="o">=</span><span class="n">i</span></code>)</p>
<p class="last">The complete script is available in <a class="reference internal" href="../example/misc.html#examplecavity"><span class="std std-ref">cavity example</span></a>.</p>
</div>
<div class="section" id="uzawa-algorithm-and-conjugate-gradients">
<span id="navierstokesuzawaconjugategradients"></span><h2>Uzawa Algorithm and Conjugate Gradients<a class="headerlink" href="#uzawa-algorithm-and-conjugate-gradients" title="Permalink to this headline"> </a></h2>
<p>We solve Stokes problem without penalty.
The classical iterative method of Uzawa is described by the algorithm (see e.g. <a class="reference internal" href="../references.html#roberts1993" id="id4">[ROBERTS1993]</a>, 17.3, <a class="reference internal" href="../references.html#glowinski1979" id="id5">[GLOWINSKI1979]</a>, 13 or <a class="reference internal" href="../references.html#glowinski1985" id="id6">[GLOWINSKI1985]</a>, 13):</p>
<ul>
<li><p class="first"><strong>Initialize:</strong> Let <span class="math notranslate nohighlight">\(p_h^0\)</span> be an arbitrary chosen element of <span class="math notranslate nohighlight">\(L^2(\Omega)\)</span>.</p>
</li>
<li><p class="first"><strong>Calculate :math:`mathbf{u}_h`:</strong> Once <span class="math notranslate nohighlight">\(p_h^n\)</span> is known, <span class="math notranslate nohighlight">\(\mathbf{v}_h^n\)</span> is the solution of:</p>
<blockquote>
<div><div class="math notranslate nohighlight">
\[\mathbf{u}_h^n = A^{-1}(\mathbf{f}_h-\mathbf{B}^*p_h^n)\]</div>
</div></blockquote>
</li>
<li><p class="first"><strong>Advance :math:`p_h`:</strong> Let <span class="math notranslate nohighlight">\(p_h^{n+1}\)</span> be defined by;</p>
<blockquote>
<div><div class="math notranslate nohighlight">
\[p_h^{n+1}=p_h^n+\rho_n\mathbf{B}\mathbf{u}_h^n\]</div>
</div></blockquote>
</li>
</ul>
<p>There is a constant <span class="math notranslate nohighlight">\(\alpha&gt;0\)</span> such that <span class="math notranslate nohighlight">\(\alpha\le \rho_n\le 2\)</span> for each <span class="math notranslate nohighlight">\(n\)</span>, then <span class="math notranslate nohighlight">\(\mathbf{u}_h^n\)</span> converges to the solution <span class="math notranslate nohighlight">\(\mathbf{u}_h\)</span>, and then <span class="math notranslate nohighlight">\(B\mathbf{v}_h^n\to 0\)</span> as <span class="math notranslate nohighlight">\(n\to \infty\)</span> from the <em>Advance</em> <span class="math notranslate nohighlight">\(p_h\)</span>. This method in general converges quite slowly.</p>
<p>First we define mesh, and the Taylor-Hood approximation.
So <span class="math notranslate nohighlight">\(X_{h}\)</span> is the velocity space, and <span class="math notranslate nohighlight">\(M_{h}\)</span> is the pressure space.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>Stokes Uzawa</p>
<div class="last highlight-freefem notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// Mesh</span>
<span class="kt">mesh</span> <span class="n">Th</span> <span class="o">=</span> <span class="nf">square</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>

<span class="c1">// Fespace</span>
<span class="kt">fespace</span> <span class="nf">Xh</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="nc">P2</span><span class="p">);</span>
<span class="n">Xh</span> <span class="n">u1</span><span class="p">,</span> <span class="n">u2</span><span class="p">;</span>
<span class="n">Xh</span> <span class="n">bc1</span><span class="p">,</span> <span class="n">bc2</span><span class="p">;</span>
<span class="n">Xh</span> <span class="n">b</span><span class="p">;</span>

<span class="kt">fespace</span> <span class="nf">Mh</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="nc">P1</span><span class="p">);</span>
<span class="n">Mh</span> <span class="n">p</span><span class="p">;</span>
<span class="n">Mh</span> <span class="n">ppp</span><span class="p">;</span> <span class="c1">//ppp is a working pressure</span>

<span class="c1">// Problem</span>
<span class="kt">varf</span> <span class="nf">bx</span> <span class="p">(</span><span class="n">u1</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span> <span class="o">=</span> <span class="nf">int2d</span><span class="p">(</span><span class="n">Th</span><span class="p">)(</span><span class="o">-</span><span class="p">(</span><span class="nf">dx</span><span class="p">(</span><span class="n">u1</span><span class="p">)</span><span class="o">*</span><span class="n">q</span><span class="p">));</span>
<span class="kt">varf</span> <span class="nf">by</span> <span class="p">(</span><span class="n">u1</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span> <span class="o">=</span> <span class="nf">int2d</span><span class="p">(</span><span class="n">Th</span><span class="p">)(</span><span class="o">-</span><span class="p">(</span><span class="nf">dy</span><span class="p">(</span><span class="n">u1</span><span class="p">)</span><span class="o">*</span><span class="n">q</span><span class="p">));</span>
<span class="kt">varf</span> <span class="nf">a</span> <span class="p">(</span><span class="n">u1</span><span class="p">,</span> <span class="n">u2</span><span class="p">)</span>
<span class="o">=</span> <span class="nf">int2d</span><span class="p">(</span><span class="n">Th</span><span class="p">)(</span>
          <span class="nf">dx</span><span class="p">(</span><span class="n">u1</span><span class="p">)</span><span class="o">*</span><span class="nf">dx</span><span class="p">(</span><span class="n">u2</span><span class="p">)</span>
        <span class="o">+</span> <span class="nf">dy</span><span class="p">(</span><span class="n">u1</span><span class="p">)</span><span class="o">*</span><span class="nf">dy</span><span class="p">(</span><span class="n">u2</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="o">+</span> <span class="nf">on</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">u1</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="o">+</span> <span class="nf">on</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">u1</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">;</span>
<span class="c1">//remark: put the on(3,u1=1) before on(1,2,4,u1=0)</span>
<span class="c1">//because we want zero on intersection</span>

<span class="kt">matrix</span> <span class="kp">A</span> <span class="o">=</span> <span class="n">a</span><span class="p">(</span><span class="n">Xh</span><span class="p">,</span> <span class="n">Xh</span><span class="p">,</span> <span class="kp">solver</span><span class="o">=</span><span class="kr">CG</span><span class="p">);</span>
<span class="kt">matrix</span> <span class="n">Bx</span> <span class="o">=</span> <span class="n">bx</span><span class="p">(</span><span class="n">Xh</span><span class="p">,</span> <span class="n">Mh</span><span class="p">);</span> <span class="c1">//B=(Bx, By)</span>
<span class="kt">matrix</span> <span class="n">By</span> <span class="o">=</span> <span class="n">by</span><span class="p">(</span><span class="n">Xh</span><span class="p">,</span> <span class="n">Mh</span><span class="p">);</span>

<span class="n">bc1</span><span class="p">[]</span> <span class="o">=</span> <span class="n">a</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">Xh</span><span class="p">);</span> <span class="c1">//boundary condition contribution on u1</span>
<span class="n">bc2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">//no boundary condition contribution on u2</span>

<span class="c1">//p_h^n -&gt; B A^-1 - B^* p_h^n = -div u_h</span>
<span class="c1">//is realized as the function divup</span>
<span class="kt">func</span> <span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">divup</span> <span class="p">(</span><span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">pp</span><span class="p">){</span>
    <span class="c1">//compute u1(pp)</span>
    <span class="n">b</span><span class="p">[]</span> <span class="o">=</span> <span class="n">Bx</span><span class="o">&#39;*</span><span class="n">pp</span><span class="p">;</span>
    <span class="n">b</span><span class="p">[]</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="n">b</span><span class="p">[]</span> <span class="o">+=</span> <span class="n">bc1</span><span class="p">[];</span>
    <span class="n">u1</span><span class="p">[]</span> <span class="o">=</span> <span class="kp">A</span><span class="o">^-</span><span class="mi">1</span><span class="o">*</span><span class="n">b</span><span class="p">[];</span>
    <span class="c1">//compute u2(pp)</span>
    <span class="n">b</span><span class="p">[]</span> <span class="o">=</span> <span class="n">By</span><span class="o">&#39;*</span><span class="n">pp</span><span class="p">;</span>
    <span class="n">b</span><span class="p">[]</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="n">b</span><span class="p">[]</span> <span class="o">+=</span> <span class="n">bc2</span><span class="p">[];</span>
    <span class="n">u2</span><span class="p">[]</span> <span class="o">=</span> <span class="kp">A</span><span class="o">^-</span><span class="mi">1</span><span class="o">*</span><span class="n">b</span><span class="p">[];</span>
    <span class="c1">//u^n = (A^-1 Bx^T p^n, By^T p^n)^T</span>
    <span class="n">ppp</span><span class="p">[]</span> <span class="o">=</span> <span class="n">Bx</span><span class="o">*</span><span class="n">u1</span><span class="p">[];</span> <span class="c1">//ppp = Bx u_1</span>
    <span class="n">ppp</span><span class="p">[]</span> <span class="o">+=</span> <span class="n">By</span><span class="o">*</span><span class="n">u2</span><span class="p">[];</span> <span class="c1">//+ By u_2</span>

    <span class="k">return</span> <span class="n">ppp</span><span class="p">[]</span> <span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Initialization</span>
<span class="n">p</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="c1">//p_h^0 = 0</span>
<span class="nf">LinearCG</span><span class="p">(</span><span class="n">divup</span><span class="p">,</span> <span class="n">p</span><span class="p">[],</span> <span class="kp">eps</span><span class="o">=</span><span class="mf">1.e-6</span><span class="p">,</span> <span class="kp">nbiter</span><span class="o">=</span><span class="mi">50</span><span class="p">);</span> <span class="c1">//p_h^{n+1} = p_h^n + B u_h^n</span>
<span class="c1">// if n&gt; 50 or |p_h^{n+1} - p_h^n| &lt;= 10^-6, then the loop end</span>
<span class="n">divup</span><span class="p">(</span><span class="n">p</span><span class="p">[]);</span> <span class="c1">//compute the final solution</span>

<span class="nf">plot</span><span class="p">([</span><span class="n">u1</span><span class="p">,</span> <span class="n">u2</span><span class="p">],</span> <span class="n">p</span><span class="p">,</span> <span class="kp">wait</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="kp">value</span><span class="o">=</span><span class="kr">true</span><span class="p">,</span> <span class="kp">coef</span><span class="o">=</span><span class="mf">0.1</span><span class="p">);</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="nsuzawacahouetchabart-edp">
<h2>NSUzawaCahouetChabart.edp<a class="headerlink" href="#nsuzawacahouetchabart-edp" title="Permalink to this headline"> </a></h2>
<p>In this example we solve the Navier-Stokes equation past a cylinder with the Uzawa algorithm preconditioned by the Cahouet-Chabart method (see <a class="reference internal" href="../references.html#glowinski2003" id="id7">[GLOWINSKI2003]</a> for all the details).</p>
<p>The idea of the preconditioner is that in a periodic domain, all differential operators commute and the Uzawa algorithm comes to solving the linear operator <span class="math notranslate nohighlight">\(\nabla. ( (\alpha Id + \nu \Delta)^{-1} \nabla\)</span>, where <span class="math notranslate nohighlight">\(Id\)</span> is the identity operator.
So the preconditioner suggested is <span class="math notranslate nohighlight">\(\alpha \Delta^{-1} + \nu Id\)</span>.</p>
<p>To implement this, we do:</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>NS Uzawa Cahouet Chabart</p>
<div class="highlight-freefem notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// Parameters</span>
<span class="kr">verbosity</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kt">real</span> <span class="n">D</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">;</span>
<span class="kt">real</span> <span class="n">H</span> <span class="o">=</span> <span class="mf">0.41</span><span class="p">;</span>
<span class="kt">real</span> <span class="n">cx0</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">;</span>
<span class="kt">real</span> <span class="n">cy0</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">;</span> <span class="c1">//center of cylinder</span>
<span class="kt">real</span> <span class="n">xa</span> <span class="o">=</span> <span class="mf">0.15</span><span class="p">;</span>
<span class="kt">real</span> <span class="n">ya</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">;</span>
<span class="kt">real</span> <span class="n">xe</span> <span class="o">=</span> <span class="mf">0.25</span><span class="p">;</span>
<span class="kt">real</span> <span class="n">ye</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">nn</span> <span class="o">=</span> <span class="mi">15</span><span class="p">;</span>

<span class="c1">//TODO</span>
<span class="kt">real</span> <span class="n">Um</span> <span class="o">=</span> <span class="mf">1.5</span><span class="p">;</span> <span class="c1">//max velocity (Rey 100)</span>
<span class="kt">real</span> <span class="n">nu</span> <span class="o">=</span> <span class="mf">1e-3</span><span class="p">;</span>

<span class="kt">func</span> <span class="n">U1</span> <span class="o">=</span> <span class="mf">4.</span><span class="o">*</span><span class="n">Um</span><span class="o">*</span><span class="kr">y</span><span class="o">*</span><span class="p">(</span><span class="n">H</span><span class="o">-</span><span class="kr">y</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">H</span><span class="o">*</span><span class="n">H</span><span class="p">);</span> <span class="c1">//Boundary condition</span>
<span class="kt">func</span> <span class="n">U2</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">;</span>
<span class="kt">real</span> <span class="n">T</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span>
<span class="kt">real</span> <span class="n">dt</span> <span class="o">=</span> <span class="n">D</span><span class="o">/</span><span class="n">nn</span><span class="o">/</span><span class="n">Um</span><span class="p">;</span> <span class="c1">//CFL = 1</span>
<span class="kt">real</span> <span class="n">epspq</span> <span class="o">=</span> <span class="mf">1e-10</span><span class="p">;</span>
<span class="kt">real</span> <span class="kp">eps</span> <span class="o">=</span> <span class="mf">1e-6</span><span class="p">;</span>

<span class="c1">// Variables</span>
<span class="kt">func</span> <span class="n">Ub</span> <span class="o">=</span> <span class="n">Um</span><span class="o">*</span><span class="mf">2.</span><span class="o">/</span><span class="mf">3.</span><span class="p">;</span>
<span class="kt">real</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">dt</span><span class="p">;</span>
<span class="kt">real</span> <span class="n">Rey</span> <span class="o">=</span> <span class="n">Ub</span><span class="o">*</span><span class="n">D</span><span class="o">/</span><span class="n">nu</span><span class="p">;</span>
<span class="kt">real</span> <span class="kp">t</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">;</span>

<span class="c1">// Mesh</span>
<span class="kt">border</span> <span class="nf">fr1</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mf">2.2</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="kp">t</span><span class="p">;</span> <span class="kr">y</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="kr">label</span><span class="o">=</span><span class="mi">1</span><span class="p">;}</span>
<span class="kt">border</span> <span class="nf">fr2</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">H</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="mf">2.2</span><span class="p">;</span> <span class="kr">y</span><span class="o">=</span><span class="kp">t</span><span class="p">;</span> <span class="kr">label</span><span class="o">=</span><span class="mi">2</span><span class="p">;}</span>
<span class="kt">border</span> <span class="nf">fr3</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mf">2.2</span><span class="p">,</span> <span class="mi">0</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="kp">t</span><span class="p">;</span> <span class="kr">y</span><span class="o">=</span><span class="n">H</span><span class="p">;</span> <span class="kr">label</span><span class="o">=</span><span class="mi">1</span><span class="p">;}</span>
<span class="kt">border</span> <span class="nf">fr4</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="n">H</span><span class="p">,</span> <span class="mi">0</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="kr">y</span><span class="o">=</span><span class="kp">t</span><span class="p">;</span> <span class="kr">label</span><span class="o">=</span><span class="mi">1</span><span class="p">;}</span>
<span class="kt">border</span> <span class="nf">fr5</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="kr">pi</span><span class="p">,</span> <span class="mi">0</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="n">cx0</span><span class="o">+</span><span class="n">D</span><span class="o">*</span><span class="nf">sin</span><span class="p">(</span><span class="kp">t</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span> <span class="kr">y</span><span class="o">=</span><span class="n">cy0</span><span class="o">+</span><span class="n">D</span><span class="o">*</span><span class="nf">cos</span><span class="p">(</span><span class="kp">t</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span> <span class="kr">label</span><span class="o">=</span><span class="mi">3</span><span class="p">;}</span>
<span class="kt">mesh</span> <span class="n">Th</span> <span class="o">=</span> <span class="nf">buildmesh</span><span class="p">(</span><span class="n">fr1</span><span class="p">(</span><span class="mi">5</span><span class="o">*</span><span class="n">nn</span><span class="p">)</span> <span class="o">+</span> <span class="n">fr2</span><span class="p">(</span><span class="n">nn</span><span class="p">)</span> <span class="o">+</span> <span class="n">fr3</span><span class="p">(</span><span class="mi">5</span><span class="o">*</span><span class="n">nn</span><span class="p">)</span> <span class="o">+</span> <span class="n">fr4</span><span class="p">(</span><span class="n">nn</span><span class="p">)</span> <span class="o">+</span> <span class="n">fr5</span><span class="p">(</span><span class="o">-</span><span class="n">nn</span><span class="o">*</span><span class="mi">3</span><span class="p">));</span>

<span class="c1">// Fespace</span>
<span class="kt">fespace</span> <span class="nf">Mh</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="p">[</span><span class="nc">P1</span><span class="p">]);</span>
<span class="n">Mh</span> <span class="n">p</span><span class="p">;</span>

<span class="kt">fespace</span> <span class="nf">Xh</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="p">[</span><span class="nc">P2</span><span class="p">]);</span>
<span class="n">Xh</span> <span class="n">u1</span><span class="p">,</span> <span class="n">u2</span><span class="p">;</span>

<span class="kt">fespace</span> <span class="nf">Wh</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="p">[</span><span class="nc">P1dc</span><span class="p">]);</span>
<span class="n">Wh</span> <span class="n">w</span><span class="p">;</span> <span class="c1">//vorticity</span>

<span class="c1">// Macro</span>
<span class="kt">macro</span> <span class="n">grad</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="p">[</span><span class="nf">dx</span><span class="p">(</span><span class="n">u</span><span class="p">),</span> <span class="nf">dy</span><span class="p">(</span><span class="n">u</span><span class="p">)]</span> <span class="c1">//</span>
<span class="kt">macro</span> <span class="n">div</span><span class="p">(</span><span class="n">u1</span><span class="p">,</span> <span class="n">u2</span><span class="p">)</span> <span class="p">(</span><span class="nf">dx</span><span class="p">(</span><span class="n">u1</span><span class="p">)</span> <span class="o">+</span> <span class="nf">dy</span><span class="p">(</span><span class="n">u2</span><span class="p">))</span> <span class="c1">//</span>

<span class="c1">// Problem</span>
<span class="kt">varf</span> <span class="n">von1</span> <span class="p">([</span><span class="n">u1</span><span class="p">,</span> <span class="n">u2</span><span class="p">,</span> <span class="n">p</span><span class="p">],</span> <span class="p">[</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">q</span><span class="p">])</span>
    <span class="o">=</span> <span class="nf">on</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">u1</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">u2</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="o">+</span> <span class="nf">on</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">u1</span><span class="o">=</span><span class="n">U1</span><span class="p">,</span> <span class="n">u2</span><span class="o">=</span><span class="n">U2</span><span class="p">)</span>
    <span class="p">;</span>

<span class="c1">//remark : the value 100 in next varf is manualy fitted, because free outlet.</span>
<span class="kt">varf</span> <span class="nf">vA</span> <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span> <span class="o">=</span>
    <span class="nf">int2d</span><span class="p">(</span><span class="n">Th</span><span class="p">)(</span>
          <span class="n">grad</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">&#39;</span> <span class="o">*</span> <span class="n">grad</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="o">+</span> <span class="nf">int1d</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="mi">2</span><span class="p">)(</span>
          <span class="mi">100</span><span class="o">*</span><span class="n">p</span><span class="o">*</span><span class="n">q</span>
    <span class="p">)</span>
    <span class="p">;</span>

<span class="kt">varf</span> <span class="nf">vM</span> <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>
    <span class="o">=</span> <span class="nf">int2d</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="kp">qft</span><span class="o">=</span><span class="kr">qf2pT</span><span class="p">)(</span>
          <span class="n">p</span><span class="o">*</span><span class="n">q</span>
    <span class="p">)</span>
    <span class="o">+</span> <span class="nf">on</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="p">;</span>

<span class="kt">varf</span> <span class="nf">vu</span> <span class="p">([</span><span class="n">u1</span><span class="p">],</span> <span class="p">[</span><span class="n">v1</span><span class="p">])</span>
    <span class="o">=</span> <span class="nf">int2d</span><span class="p">(</span><span class="n">Th</span><span class="p">)(</span>
          <span class="n">alpha</span><span class="o">*</span><span class="p">(</span><span class="n">u1</span><span class="o">*</span><span class="n">v1</span><span class="p">)</span>
        <span class="o">+</span> <span class="n">nu</span><span class="o">*</span><span class="p">(</span><span class="n">grad</span><span class="p">(</span><span class="n">u1</span><span class="p">)</span><span class="o">&#39;</span> <span class="o">*</span> <span class="n">grad</span><span class="p">(</span><span class="n">v1</span><span class="p">))</span>
    <span class="p">)</span>
    <span class="o">+</span> <span class="nf">on</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">u1</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="p">;</span>

<span class="kt">varf</span> <span class="nf">vu1</span> <span class="p">([</span><span class="n">p</span><span class="p">],</span> <span class="p">[</span><span class="n">v1</span><span class="p">])</span> <span class="o">=</span> <span class="nf">int2d</span><span class="p">(</span><span class="n">Th</span><span class="p">)(</span><span class="n">p</span><span class="o">*</span><span class="nf">dx</span><span class="p">(</span><span class="n">v1</span><span class="p">));</span>
<span class="kt">varf</span> <span class="nf">vu2</span> <span class="p">([</span><span class="n">p</span><span class="p">],</span> <span class="p">[</span><span class="n">v1</span><span class="p">])</span> <span class="o">=</span> <span class="nf">int2d</span><span class="p">(</span><span class="n">Th</span><span class="p">)(</span><span class="n">p</span><span class="o">*</span><span class="nf">dy</span><span class="p">(</span><span class="n">v1</span><span class="p">));</span>

<span class="kt">varf</span> <span class="nf">vonu1</span> <span class="p">([</span><span class="n">u1</span><span class="p">],</span> <span class="p">[</span><span class="n">v1</span><span class="p">])</span> <span class="o">=</span> <span class="nf">on</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">u1</span><span class="o">=</span><span class="n">U1</span><span class="p">)</span> <span class="o">+</span> <span class="nf">on</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">u1</span><span class="o">=</span><span class="mi">0</span><span class="p">);</span>
<span class="kt">varf</span> <span class="nf">vonu2</span> <span class="p">([</span><span class="n">u1</span><span class="p">],</span> <span class="p">[</span><span class="n">v1</span><span class="p">])</span> <span class="o">=</span> <span class="nf">on</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">u1</span><span class="o">=</span><span class="n">U2</span><span class="p">)</span> <span class="o">+</span> <span class="nf">on</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">u1</span><span class="o">=</span><span class="mi">0</span><span class="p">);</span>

<span class="kt">matrix</span> <span class="n">pAM</span> <span class="o">=</span> <span class="n">vM</span><span class="p">(</span><span class="n">Mh</span><span class="p">,</span> <span class="n">Mh</span><span class="p">,</span> <span class="kp">solver</span><span class="o">=</span><span class="kr">UMFPACK</span><span class="p">);</span>
<span class="kt">matrix</span> <span class="n">pAA</span> <span class="o">=</span> <span class="n">vA</span><span class="p">(</span><span class="n">Mh</span><span class="p">,</span> <span class="n">Mh</span><span class="p">,</span> <span class="kp">solver</span><span class="o">=</span><span class="kr">UMFPACK</span><span class="p">);</span>
<span class="kt">matrix</span> <span class="n">AU</span> <span class="o">=</span> <span class="n">vu</span><span class="p">(</span><span class="n">Xh</span><span class="p">,</span> <span class="n">Xh</span><span class="p">,</span> <span class="kp">solver</span><span class="o">=</span><span class="kr">UMFPACK</span><span class="p">);</span>
<span class="kt">matrix</span> <span class="kp">B1</span> <span class="o">=</span> <span class="n">vu1</span><span class="p">(</span><span class="n">Mh</span><span class="p">,</span> <span class="n">Xh</span><span class="p">);</span>
<span class="kt">matrix</span> <span class="n">B2</span> <span class="o">=</span> <span class="n">vu2</span><span class="p">(</span><span class="n">Mh</span><span class="p">,</span> <span class="n">Xh</span><span class="p">);</span>

<span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">brhs1</span> <span class="o">=</span> <span class="n">vonu1</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Xh</span><span class="p">);</span>
<span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">brhs2</span> <span class="o">=</span> <span class="n">vonu2</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Xh</span><span class="p">);</span>

<span class="kt">varf</span> <span class="nf">vrhs1</span><span class="p">(</span><span class="n">uu</span><span class="p">,</span> <span class="n">vv</span><span class="p">)</span> <span class="o">=</span> <span class="nf">int2d</span><span class="p">(</span><span class="n">Th</span><span class="p">)(</span><span class="nf">convect</span><span class="p">([</span><span class="n">u1</span><span class="p">,</span> <span class="n">u2</span><span class="p">],</span> <span class="o">-</span><span class="n">dt</span><span class="p">,</span> <span class="n">u1</span><span class="p">)</span><span class="o">*</span><span class="n">vv</span><span class="o">*</span><span class="n">alpha</span><span class="p">)</span> <span class="o">+</span> <span class="n">vonu1</span><span class="p">;</span>
<span class="kt">varf</span> <span class="nf">vrhs2</span><span class="p">(</span><span class="n">v2</span><span class="p">,</span> <span class="n">v1</span><span class="p">)</span> <span class="o">=</span> <span class="nf">int2d</span><span class="p">(</span><span class="n">Th</span><span class="p">)(</span><span class="nf">convect</span><span class="p">([</span><span class="n">u1</span><span class="p">,</span> <span class="n">u2</span><span class="p">],</span> <span class="o">-</span><span class="n">dt</span><span class="p">,</span> <span class="n">u2</span><span class="p">)</span><span class="o">*</span><span class="n">v1</span><span class="o">*</span><span class="n">alpha</span><span class="p">)</span> <span class="o">+</span> <span class="n">vonu2</span><span class="p">;</span>

<span class="c1">// Uzawa function</span>
<span class="kt">func</span> <span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">JUzawa</span> <span class="p">(</span><span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">pp</span><span class="p">){</span>
    <span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">b1</span> <span class="o">=</span> <span class="n">brhs1</span><span class="p">;</span> <span class="n">b1</span> <span class="o">+=</span> <span class="kp">B1</span><span class="o">*</span><span class="n">pp</span><span class="p">;</span>
    <span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">b2</span> <span class="o">=</span> <span class="n">brhs2</span><span class="p">;</span> <span class="n">b2</span> <span class="o">+=</span> <span class="n">B2</span><span class="o">*</span><span class="n">pp</span><span class="p">;</span>
    <span class="n">u1</span><span class="p">[]</span> <span class="o">=</span> <span class="n">AU</span><span class="o">^-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">b1</span><span class="p">;</span>
    <span class="n">u2</span><span class="p">[]</span> <span class="o">=</span> <span class="n">AU</span><span class="o">^-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">b2</span><span class="p">;</span>
    <span class="n">pp</span> <span class="o">=</span> <span class="kp">B1</span><span class="o">&#39;*</span><span class="n">u1</span><span class="p">[];</span>
    <span class="n">pp</span> <span class="o">+=</span> <span class="n">B2</span><span class="o">&#39;*</span><span class="n">u2</span><span class="p">[];</span>
    <span class="n">pp</span> <span class="o">=</span> <span class="o">-</span><span class="n">pp</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">pp</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Preconditioner function</span>
<span class="kt">func</span> <span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">Precon</span> <span class="p">(</span><span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">p</span><span class="p">){</span>
    <span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">pa</span> <span class="o">=</span> <span class="n">pAA</span><span class="o">^-</span><span class="mi">1</span><span class="o">*</span><span class="n">p</span><span class="p">;</span>
    <span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">pm</span> <span class="o">=</span> <span class="n">pAM</span><span class="o">^-</span><span class="mi">1</span><span class="o">*</span><span class="n">p</span><span class="p">;</span>
    <span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">pp</span> <span class="o">=</span> <span class="n">alpha</span><span class="o">*</span><span class="n">pa</span> <span class="o">+</span> <span class="n">nu</span><span class="o">*</span><span class="n">pm</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">pp</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Initialization</span>
<span class="n">p</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="c1">// Time loop</span>
<span class="kt">int</span> <span class="n">ndt</span> <span class="o">=</span> <span class="n">T</span><span class="o">/</span><span class="n">dt</span><span class="p">;</span>
<span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ndt</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">){</span>
    <span class="c1">// Update</span>
    <span class="n">brhs1</span> <span class="o">=</span> <span class="n">vrhs1</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Xh</span><span class="p">);</span>
    <span class="n">brhs2</span> <span class="o">=</span> <span class="n">vrhs2</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Xh</span><span class="p">);</span>

    <span class="c1">// Solve</span>
    <span class="kt">int</span> <span class="n">res</span> <span class="o">=</span> <span class="nf">LinearCG</span><span class="p">(</span><span class="n">JUzawa</span><span class="p">,</span> <span class="n">p</span><span class="p">[],</span> <span class="kp">precon</span><span class="o">=</span><span class="n">Precon</span><span class="p">,</span> <span class="kp">nbiter</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="kr">verbosity</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="kp">veps</span><span class="o">=</span><span class="kp">eps</span><span class="p">);</span>
    <span class="nf">assert</span><span class="p">(</span><span class="n">res</span><span class="o">==</span><span class="mi">1</span><span class="p">);</span>
    <span class="kp">eps</span> <span class="o">=</span> <span class="o">-</span><span class="nf">abs</span><span class="p">(</span><span class="kp">eps</span><span class="p">);</span>

    <span class="c1">// Vorticity</span>
    <span class="n">w</span> <span class="o">=</span> <span class="o">-</span><span class="nf">dy</span><span class="p">(</span><span class="n">u1</span><span class="p">)</span> <span class="o">+</span> <span class="nf">dx</span><span class="p">(</span><span class="n">u2</span><span class="p">);</span>
    <span class="nf">plot</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="kp">fill</span><span class="o">=</span><span class="kr">true</span><span class="p">,</span> <span class="kp">wait</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="kp">nbiso</span><span class="o">=</span><span class="mi">40</span><span class="p">);</span>

    <span class="c1">// Update</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="kr">min</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span> <span class="n">T</span><span class="o">-</span><span class="kp">t</span><span class="p">);</span>
    <span class="kp">t</span> <span class="o">+=</span> <span class="n">dt</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">dt</span> <span class="o">&lt;</span> <span class="mf">1e-10</span><span class="o">*</span><span class="n">T</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Plot</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="kp">fill</span><span class="o">=</span><span class="kr">true</span><span class="p">,</span> <span class="kp">nbiso</span><span class="o">=</span><span class="mi">40</span><span class="p">);</span>

<span class="c1">// Display</span>
<span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;u1 max = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">u1</span><span class="p">[].</span><span class="kr">linfty</span>
    <span class="o">&lt;&lt;</span> <span class="s">&quot;, u2 max = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">u2</span><span class="p">[].</span><span class="kr">linfty</span>
    <span class="o">&lt;&lt;</span> <span class="s">&quot;, p max = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">p</span><span class="p">[].</span><span class="kr">max</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
</pre></div>
</td></tr></table></div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>Stop test of the conjugate gradient</p>
<p class="last">Because we start from the previous solution and the end the previous solution is close to the final solution, don’t take a relative stop test to the first residual, take an absolute stop test (negative here).</p>
</div>
<div class="last figure" id="id8">
<img alt="navierStokesEquations" src="../_images/NavierStokesEquations.png" />
<p class="caption"><span class="caption-text">The vorticity at Reynolds number 100 a time 2s with the Cahouet-Chabart method.</span></p>
</div>
</div>
</div>
</div>


		</div>
		
		<div id="toc">
	<div>
		<b>Table of content</b>
		<ul>
<li><a class="reference internal" href="#">Navier-Stokes equations</a><ul>
<li><a class="reference internal" href="#uzawa-algorithm-and-conjugate-gradients">Uzawa Algorithm and Conjugate Gradients</a></li>
<li><a class="reference internal" href="#nsuzawacahouetchabart-edp">NSUzawaCahouetChabart.edp</a></li>
</ul>
</li>
</ul>

	</div>
</div>
		<footer>
	<p>
		Coded with <i class="fas fa-heart"></i> since 1987
	</p>
	<img src='../_static/img/Symbole.svg' alt="FreeFEM logo"/>
	<div>
		<a id="lgpl" href="https://www.gnu.org/licenses/lgpl-3.0.txt" target="_blank">LGPL 3.0</a>
		<a href="http://doc.freefem.org/introduction/citation/" target="_blank">BibTeX</a>
	</div>
</footer>
		

		<script async src="../_static/js/common.js"></script>
	</body>
</html>