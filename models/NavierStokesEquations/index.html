



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="FreeFEM++ documentation">
      
      
        <link rel="canonical" href="https://doc.freefem.org/models/NavierStokesEquations/">
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.0.1">
    
    
      
        <title>Navier-Stokes equations - FreeFem++ documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.982221ab.css">
      
      
    
    
      <script src="../../assets/javascripts/modernizr.1f0bcf2b.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#uzawa-algorithm-and-conjugate-gradients" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://doc.freefem.org" title="FreeFem++ documentation" class="md-header-nav__button md-logo">
          
            <img src="../../images/favicon.png" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              FreeFem++ documentation
            </span>
            <span class="md-header-nav__topic">
              Navier-Stokes equations
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/FreeFem/FreeFem-doc/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    FreeFem++ on Github
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../.." title="Introduction" class="md-tabs__link">
          Introduction
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../documentation/" title="Documentation" class="md-tabs__link">
          Documentation
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../reference/" title="Language References" class="md-tabs__link">
          Language References
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../tutorials/" title="Tutorials" class="md-tabs__link">
          Tutorials
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../examples/" title="Examples" class="md-tabs__link">
          Examples
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../" title="Models" class="md-tabs__link md-tabs__link--active">
          Models
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://doc.freefem.org" title="FreeFem++ documentation" class="md-nav__button md-logo">
      
        <img src="../../images/favicon.png" width="48" height="48">
      
    </a>
    FreeFem++ documentation
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/FreeFem/FreeFem-doc/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    FreeFem++ on Github
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1">
    
    <label class="md-nav__link" for="nav-1">
      Introduction
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        Introduction
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../.." title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../introduction/download/" title="Download" class="md-nav__link">
      Download
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../introduction/installation/" title="Installation" class="md-nav__link">
      Installation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../introduction/contributing/" title="How to contribute?" class="md-nav__link">
      How to contribute?
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../introduction/citation/" title="Citation" class="md-nav__link">
      Citation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../introduction/authors/" title="Authors" class="md-nav__link">
      Authors
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../introduction/TODO/" title="TODO" class="md-nav__link">
      TODO
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Documentation
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Documentation
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../documentation/" title="Home" class="md-nav__link">
      Home
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../documentation/Notations/" title="Some Notations" class="md-nav__link">
      Some Notations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../documentation/MeshGeneration/" title="Mesh Generation" class="md-nav__link">
      Mesh Generation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../documentation/FiniteElement/" title="Finite Element" class="md-nav__link">
      Finite Element
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../documentation/Visualization/" title="Visualization" class="md-nav__link">
      Visualization
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../documentation/AlgorithmsOptimization/" title="Algorithms & Optimization" class="md-nav__link">
      Algorithms & Optimization
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../documentation/Parallelization/" title="Parallelization" class="md-nav__link">
      Parallelization
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-8" type="checkbox" id="nav-2-8">
    
    <label class="md-nav__link" for="nav-2-8">
      ffddm
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-8">
        ffddm
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../documentation/ffddm/ffddm/" title="What is ffddm ?" class="md-nav__link">
      What is ffddm ?
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../documentation/ffddm/tutorial-slides.html" title="Tutorial slides" class="md-nav__link">
      Tutorial slides
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../documentation/ffddm/introddm/" title="Introduction to DDM" class="md-nav__link">
      Introduction to DDM
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../documentation/ffddm/documentation/" title="ffddm Documentation" class="md-nav__link">
      ffddm Documentation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../documentation/ffddm/examples/" title="Examples" class="md-nav__link">
      Examples
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../documentation/Plugins/" title="Plugins" class="md-nav__link">
      Plugins
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../documentation/Developers/" title="Developers" class="md-nav__link">
      Developers
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../documentation/TODO/" title="TODO" class="md-nav__link">
      TODO
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Language References
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Language References
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/" title="Home" class="md-nav__link">
      Home
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/Types/" title="Types" class="md-nav__link">
      Types
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/GlobalVariables/" title="Global variables" class="md-nav__link">
      Global variables
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/QuadratureFormulae/" title="Quadrature formulae" class="md-nav__link">
      Quadrature formulae
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/Operators/" title="Operators" class="md-nav__link">
      Operators
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/Loops/" title="Loops" class="md-nav__link">
      Loops
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/IO/" title="I/O" class="md-nav__link">
      I/O
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/Functions/" title="Functions" class="md-nav__link">
      Functions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/ExternalLibraries/" title="External libraries" class="md-nav__link">
      External libraries
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/TODO/" title="TODO" class="md-nav__link">
      TODO
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Tutorials
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Tutorials
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/" title="Getting started" class="md-nav__link">
      Getting started
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/Poisson/" title="Poisson's equation" class="md-nav__link">
      Poisson's equation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/EquationsClassification/" title="Classification of the equations" class="md-nav__link">
      Classification of the equations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/Membrane/" title="Membrane" class="md-nav__link">
      Membrane
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/HeatExchanger/" title="Heat Exchanger" class="md-nav__link">
      Heat Exchanger
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/Acoustics/" title="Acoustics" class="md-nav__link">
      Acoustics
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/ThermalConduction/" title="Thermal Conduction" class="md-nav__link">
      Thermal Conduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/FanBlade/" title="Irrotational Fan Blade Flow and Thermal effects" class="md-nav__link">
      Irrotational Fan Blade Flow and Thermal effects
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/RotatingHill/" title="Pure convection, The rotating hill" class="md-nav__link">
      Pure convection, The rotating hill
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/Elasticity/" title="The system of elasticity" class="md-nav__link">
      The system of elasticity
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/Stokes/" title="The system of Stokes for fluids" class="md-nav__link">
      The system of Stokes for fluids
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/NavierStokesProjection/" title="A projection Algorithm for the Navier-Stokes equations" class="md-nav__link">
      A projection Algorithm for the Navier-Stokes equations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/NavierStokesNewton/" title="Newton method for the steady Navier-Stokes equations" class="md-nav__link">
      Newton method for the steady Navier-Stokes equations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/ALargeFluidProblem/" title="A large fluid problem" class="md-nav__link">
      A large fluid problem
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/ComplexNumbers/" title="An example with complex numbers" class="md-nav__link">
      An example with complex numbers
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/OptimalControl/" title="Optimal control" class="md-nav__link">
      Optimal control
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/FlowWithShocks/" title="A flow with shocks" class="md-nav__link">
      A flow with shocks
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/HeatEquationOptimization/" title="Time dependent schema optimization for heat equations" class="md-nav__link">
      Time dependent schema optimization for heat equations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/TimeDependentStokes/" title="A transient Stokes solver in matrix form" class="md-nav__link">
      A transient Stokes solver in matrix form
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/WifiPropagation/" title="Wifi Propagation" class="md-nav__link">
      Wifi Propagation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/MatlabOctavePlot/" title="Matlab / Octave Plots" class="md-nav__link">
      Matlab / Octave Plots
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/TODO/" title="TODO" class="md-nav__link">
      TODO
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Examples
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Examples
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../examples/" title="Home" class="md-nav__link">
      Home
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../examples/TODO/" title="TODO" class="md-nav__link">
      TODO
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6" checked>
    
    <label class="md-nav__link" for="nav-6">
      Models
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Models
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../" title="Home" class="md-nav__link">
      Home
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../StaticProblems/" title="Static problems" class="md-nav__link">
      Static problems
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Elasticity/" title="Elasticity" class="md-nav__link">
      Elasticity
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../NonLinearStaticProblems/" title="Non-linear static problems" class="md-nav__link">
      Non-linear static problems
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../EigenValueProblems/" title="Eigenvalue problems" class="md-nav__link">
      Eigenvalue problems
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../EvolutionProblems/" title="Evolution problems" class="md-nav__link">
      Evolution problems
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Navier-Stokes equations
      </label>
    
    <a href="./" title="Navier-Stokes equations" class="md-nav__link md-nav__link--active">
      Navier-Stokes equations
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#uzawa-algorithm-and-conjugate-gradients" title="Uzawa Algorithm and Conjugate Gradients" class="md-nav__link">
    Uzawa Algorithm and Conjugate Gradients
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nsuzawacahouetchabartedp" title="NSUzawaCahouetChabart.edp" class="md-nav__link">
    NSUzawaCahouetChabart.edp
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" title="References" class="md-nav__link">
    References
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../VariationalInequality/" title="Variational inequality" class="md-nav__link">
      Variational inequality
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../DomainDecomposition/" title="Domain decomposition" class="md-nav__link">
      Domain decomposition
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../FluidStructureCoupledProblem/" title="Fluid-Structure coupled problem" class="md-nav__link">
      Fluid-Structure coupled problem
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../TransmissionProblem/" title="Transmission problem" class="md-nav__link">
      Transmission problem
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../FreeBoundaryProblem/" title="Free boundary problem" class="md-nav__link">
      Free boundary problem
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../NonLinearElasticity/" title="Non-linear elasticity" class="md-nav__link">
      Non-linear elasticity
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../CompressibleNeoHookeanMaterials/" title="Compressible Neo-Hookean materials" class="md-nav__link">
      Compressible Neo-Hookean materials
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../WhisperingGalleryModes/" title="Whispering gallery modes" class="md-nav__link">
      Whispering gallery modes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../TODO/" title="TODO" class="md-nav__link">
      TODO
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#uzawa-algorithm-and-conjugate-gradients" title="Uzawa Algorithm and Conjugate Gradients" class="md-nav__link">
    Uzawa Algorithm and Conjugate Gradients
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nsuzawacahouetchabartedp" title="NSUzawaCahouetChabart.edp" class="md-nav__link">
    NSUzawaCahouetChabart.edp
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" title="References" class="md-nav__link">
    References
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/FreeFem/FreeFem-doc/edit/master/docs/models/NavierStokesEquations.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                  <h1>Navier-Stokes equations</h1>
                
                <p>The Stokes equations are: for a given <span><span class="MathJax_Preview">\mathbf{f}\in L^2(\Omega)^2</span><script type="math/tex">\mathbf{f}\in L^2(\Omega)^2</script></span>,</p>
<div>
<div class="MathJax_Preview">\begin{equation}
    \left.\begin{array}{cl}
        \label{eqn::Stokes}
        -\Delta \mathbf{u}+\nabla p &amp; =\mathbf{f} \\
        \nabla\cdot \mathbf{u} &amp;=0
    \end{array}\right\}\quad \hbox{ in }\Omega
\end{equation}</div>
<script type="math/tex; mode=display">\begin{equation}
    \left.\begin{array}{cl}
        \label{eqn::Stokes}
        -\Delta \mathbf{u}+\nabla p & =\mathbf{f} \\
        \nabla\cdot \mathbf{u} &=0
    \end{array}\right\}\quad \hbox{ in }\Omega
\end{equation}</script>
</div>
<p>where <span><span class="MathJax_Preview">\mathbf{u}=(u_1,u_2)</span><script type="math/tex">\mathbf{u}=(u_1,u_2)</script></span> is the velocity vector and <span><span class="MathJax_Preview">p</span><script type="math/tex">p</script></span> the pressure. For simplicity, let us choose Dirichlet boundary conditions on the velocity, <span><span class="MathJax_Preview">\mathbf{u}=\mathbf{u}_{\Gamma}</span><script type="math/tex">\mathbf{u}=\mathbf{u}_{\Gamma}</script></span> on <span><span class="MathJax_Preview">\Gamma</span><script type="math/tex">\Gamma</script></span>.</p>
<p>In <a href="#TEMAM1977">TEMAM1977</a>, Theorem 2.2, there is a weak form of \eqref{eqn::Stokes}:</p>
<p>Find <span><span class="MathJax_Preview">\mathbf{v}=(v_1,v_2)\in \mathbf{V}(\Omega)</span><script type="math/tex">\mathbf{v}=(v_1,v_2)\in \mathbf{V}(\Omega)</script></span></p>
<div>
<div class="MathJax_Preview">
\mathbf{V}(\Omega)=\{\mathbf{w}\in H^1_0(\Omega)^2|\; \textrm{div}\mathbf{w}=0\}
</div>
<script type="math/tex; mode=display">
\mathbf{V}(\Omega)=\{\mathbf{w}\in H^1_0(\Omega)^2|\; \textrm{div}\mathbf{w}=0\}
</script>
</div>
<p>which satisfy</p>
<div>
<div class="MathJax_Preview">
\sum_{i=1}^2\int_{\Omega}\nabla u_i\cdot \nabla v_i=\int_{\Omega}\mathbf{f}\cdot \mathbf{w}
\quad \textrm{for all }v\in V
</div>
<script type="math/tex; mode=display">
\sum_{i=1}^2\int_{\Omega}\nabla u_i\cdot \nabla v_i=\int_{\Omega}\mathbf{f}\cdot \mathbf{w}
\quad \textrm{for all }v\in V
</script>
</div>
<p>Here it is used the existence <span><span class="MathJax_Preview">p\in H^1(\Omega)</span><script type="math/tex">p\in H^1(\Omega)</script></span> such that <span><span class="MathJax_Preview">\mathbf{u}=\nabla p</span><script type="math/tex">\mathbf{u}=\nabla p</script></span>, if</p>
<div>
<div class="MathJax_Preview">
\int_{\Omega}\mathbf{u}\cdot \mathbf{v}=0\quad \textrm{for all }\mathbf{v}\in
V
</div>
<script type="math/tex; mode=display">
\int_{\Omega}\mathbf{u}\cdot \mathbf{v}=0\quad \textrm{for all }\mathbf{v}\in
V
</script>
</div>
<p>Another weak form is derived as follows: We put</p>
<div>
<div class="MathJax_Preview">\begin{eqnarray*}
\mathbf{V}=H^1_0(\Omega)^2;\quad
W=\left\{q\in L^2(\Omega)\left|\; \int_{\Omega}q=0\right.\right\}
\end{eqnarray*}</div>
<script type="math/tex; mode=display">\begin{eqnarray*}
\mathbf{V}=H^1_0(\Omega)^2;\quad
W=\left\{q\in L^2(\Omega)\left|\; \int_{\Omega}q=0\right.\right\}
\end{eqnarray*}</script>
</div>
<p>By multiplying the first equation in \eqref{eqn::Stokes} with <span><span class="MathJax_Preview">v\in V</span><script type="math/tex">v\in V</script></span> and the second with <span><span class="MathJax_Preview">q\in W</span><script type="math/tex">q\in W</script></span>, subsequent integration over <span><span class="MathJax_Preview">\Omega</span><script type="math/tex">\Omega</script></span>, and an application of Green's formula, we have</p>
<div>
<div class="MathJax_Preview">\begin{eqnarray*}
\int_{\Omega}\nabla\mathbf{u}\cdot \nabla\mathbf{v}-\int_{\Omega}\textrm{div}\mathbf{v}\, p
&amp;=&amp;\int_{\Omega}\mathbf{f}\cdot\mathbf{v}\\
\int_{\Omega}\textrm{div}\mathbf{u}\, q&amp;=&amp;0
\end{eqnarray*}</div>
<script type="math/tex; mode=display">\begin{eqnarray*}
\int_{\Omega}\nabla\mathbf{u}\cdot \nabla\mathbf{v}-\int_{\Omega}\textrm{div}\mathbf{v}\, p
&=&\int_{\Omega}\mathbf{f}\cdot\mathbf{v}\\
\int_{\Omega}\textrm{div}\mathbf{u}\, q&=&0
\end{eqnarray*}</script>
</div>
<p>This yields the weak form of \eqref{eqn::Stokes}:</p>
<p>Find <span><span class="MathJax_Preview">(\mathbf{u},p)\in \mathbf{V}\times W</span><script type="math/tex">(\mathbf{u},p)\in \mathbf{V}\times W</script></span> such that</p>
<div>
<div class="MathJax_Preview">\begin{eqnarray}
a(\mathbf{u},\mathbf{v})+b(\mathbf{v},p)&amp;=&amp;(\mathbf{f},\mathbf{v})\\
b(\mathbf{u},q)&amp;=&amp;0
\end{eqnarray}</div>
<script type="math/tex; mode=display">\begin{eqnarray}
a(\mathbf{u},\mathbf{v})+b(\mathbf{v},p)&=&(\mathbf{f},\mathbf{v})\\
b(\mathbf{u},q)&=&0
\end{eqnarray}</script>
</div>
<p>for all <span><span class="MathJax_Preview">(\mathbf{v},q)\in V\times W</span><script type="math/tex">(\mathbf{v},q)\in V\times W</script></span>, where</p>
<div>
<div class="MathJax_Preview">\begin{eqnarray}
a(\mathbf{u},\mathbf{v})&amp;=&amp;\int_{\Omega}\nabla \mathbf{u}\cdot \nabla\mathbf{v}
=\sum_{i=1}^2\int_{\Omega}\nabla u_i\cdot \nabla v_i\\
b(\mathbf{u},q)&amp;=&amp;-\int_{\Omega}\textrm{div}\mathbf{u}\, q
\end{eqnarray}</div>
<script type="math/tex; mode=display">\begin{eqnarray}
a(\mathbf{u},\mathbf{v})&=&\int_{\Omega}\nabla \mathbf{u}\cdot \nabla\mathbf{v}
=\sum_{i=1}^2\int_{\Omega}\nabla u_i\cdot \nabla v_i\\
b(\mathbf{u},q)&=&-\int_{\Omega}\textrm{div}\mathbf{u}\, q
\end{eqnarray}</script>
</div>
<p>Now, we consider finite element spaces <span><span class="MathJax_Preview">\mathbf{V}_h\subset \mathbf{V}</span><script type="math/tex">\mathbf{V}_h\subset \mathbf{V}</script></span> and <span><span class="MathJax_Preview">W_h\subset W</span><script type="math/tex">W_h\subset W</script></span>,
and we assume the following basis functions</p>
<div>
<div class="MathJax_Preview">\begin{eqnarray*}
&amp;&amp;\mathbf{V}_h=V_h\times V_h,\quad
V_h=\{v_h|\; v_h=v_1\phi_1+\cdots +v_{M_V}\phi_{M_V}\},\\
&amp;&amp;W_h=\{q_h|\; q_h=q_1\varphi_1+\cdots +q_{M_W}\varphi_{M_W}\}
\end{eqnarray*}</div>
<script type="math/tex; mode=display">\begin{eqnarray*}
&&\mathbf{V}_h=V_h\times V_h,\quad
V_h=\{v_h|\; v_h=v_1\phi_1+\cdots +v_{M_V}\phi_{M_V}\},\\
&&W_h=\{q_h|\; q_h=q_1\varphi_1+\cdots +q_{M_W}\varphi_{M_W}\}
\end{eqnarray*}</script>
</div>
<p>The discrete weak form is:
Find <span><span class="MathJax_Preview">(\mathbf{u}_{h},p_{h}) \in \mathbf{V}_{h} \times W_{h}</span><script type="math/tex">(\mathbf{u}_{h},p_{h}) \in \mathbf{V}_{h} \times W_{h}</script></span> such that</p>
<div>
<div class="MathJax_Preview">\begin{equation}
    \label{eqn::vfStokes}
    \begin{array}{cll}
    a(\mathbf{u}_h,\mathbf{v}_h)+b(\mathbf{v}_h,p) &amp;= (\mathbf{f},\mathbf{v}_h) ,
    &amp;\forall \mathbf{v}_{h} \in \mathbf{V}_{h} \\
    b(\mathbf{u}_h,q_h)&amp;= 0,
    &amp;\forall q_{h} \in W_{h}
    \end{array}
\end{equation}</div>
<script type="math/tex; mode=display">\begin{equation}
    \label{eqn::vfStokes}
    \begin{array}{cll}
    a(\mathbf{u}_h,\mathbf{v}_h)+b(\mathbf{v}_h,p) &= (\mathbf{f},\mathbf{v}_h) ,
    &\forall \mathbf{v}_{h} \in \mathbf{V}_{h} \\
    b(\mathbf{u}_h,q_h)&= 0,
    &\forall q_{h} \in W_{h}
    \end{array}
\end{equation}</script>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Assume that:</p>
<ol>
<li>
<p>There is a constant <span><span class="MathJax_Preview">\alpha_h&gt;0</span><script type="math/tex">\alpha_h>0</script></span> such that</p>
<div>
<div class="MathJax_Preview">
a(\mathbf{v}_h,\mathbf{v}_h)\ge \alpha\| \mathbf{v}_h\|_{1,\Omega}^2\quad \textrm{for all }\mathbf{v}_h\in Z_h
</div>
<script type="math/tex; mode=display">
a(\mathbf{v}_h,\mathbf{v}_h)\ge \alpha\| \mathbf{v}_h\|_{1,\Omega}^2\quad \textrm{for all }\mathbf{v}_h\in Z_h
</script>
</div>
<!--- __ --->

<p>where</p>
<div>
<div class="MathJax_Preview">
Z_h=\{\mathbf{v}_h\in \mathbf{V}_h|\; b(\mathbf{w}_h,q_h)=0\quad \textrm{for all }q_h\in W_h\}
</div>
<script type="math/tex; mode=display">
Z_h=\{\mathbf{v}_h\in \mathbf{V}_h|\; b(\mathbf{w}_h,q_h)=0\quad \textrm{for all }q_h\in W_h\}
</script>
</div>
</li>
<li>
<p>There is a constant <span><span class="MathJax_Preview">\beta_h&gt;0</span><script type="math/tex">\beta_h>0</script></span> such that</p>
<div>
<div class="MathJax_Preview">
\sup_{\mathbf{v}_h\in \mathbf{V}_h}\frac{b(\mathbf{v}_h,q_h)}{\| \mathbf{v}_h\|_{1,\Omega}}
\ge \beta_h\| q_h\|_{0,\Omega}\quad \textrm{for all }q_h\in W_h
</div>
<script type="math/tex; mode=display">
\sup_{\mathbf{v}_h\in \mathbf{V}_h}\frac{b(\mathbf{v}_h,q_h)}{\| \mathbf{v}_h\|_{1,\Omega}}
\ge \beta_h\| q_h\|_{0,\Omega}\quad \textrm{for all }q_h\in W_h
</script>
</div>
</li>
</ol>
<p>Then we have an unique solution <span><span class="MathJax_Preview">(\mathbf{u}_h,p_h)</span><script type="math/tex">(\mathbf{u}_h,p_h)</script></span> of \eqref{eqn::vfStokes} satisfying</p>
<div>
<div class="MathJax_Preview">
\| \mathbf{u}-\mathbf{u}_h\|_{1,\Omega}+\| p-p_h\|_{0,\Omega}
\le C\left(
\inf_{\mathbf{v}_h\in \mathbf{V}_h}\| u-v_h\|_{1,\Omega}
+\inf_{q_h\in W_h}\| p-q_h\|_{0,\Omega}\right)
</div>
<script type="math/tex; mode=display">
\| \mathbf{u}-\mathbf{u}_h\|_{1,\Omega}+\| p-p_h\|_{0,\Omega}
\le C\left(
\inf_{\mathbf{v}_h\in \mathbf{V}_h}\| u-v_h\|_{1,\Omega}
+\inf_{q_h\in W_h}\| p-q_h\|_{0,\Omega}\right)
</script>
</div>
<!--- __ --->

<p>with a constant <span><span class="MathJax_Preview">C&gt;0</span><script type="math/tex">C>0</script></span> (see e.g. <a href="#ROBERTS1993">ROBERTS1993</a>, Theorem 10.4).</p>
</div>
<p>Let us denote that</p>
<div>
<div class="MathJax_Preview">\begin{eqnarray}
A&amp;=&amp;(A_{ij}),\, A_{ij}=\int_{\Omega}\nabla \phi_j\cdot \nabla \phi_i\qquad
i,j=1,\cdots,M_{\mathbf{V}}\\
\mathbf{B}&amp;=&amp;(Bx_{ij},By_{ij}),\,
Bx_{ij}=-\int_{\Omega}\p \phi_j/\p x\, \varphi_i\qquad
By_{ij}=-\int_{\Omega}\p \phi_j/\p y\, \varphi_i\nonumber\\
&amp;&amp;\qquad i=1,\cdots,M_W;j=1,\cdots,M_V\nonumber
\end{eqnarray}</div>
<script type="math/tex; mode=display">\begin{eqnarray}
A&=&(A_{ij}),\, A_{ij}=\int_{\Omega}\nabla \phi_j\cdot \nabla \phi_i\qquad
i,j=1,\cdots,M_{\mathbf{V}}\\
\mathbf{B}&=&(Bx_{ij},By_{ij}),\,
Bx_{ij}=-\int_{\Omega}\p \phi_j/\p x\, \varphi_i\qquad
By_{ij}=-\int_{\Omega}\p \phi_j/\p y\, \varphi_i\nonumber\\
&&\qquad i=1,\cdots,M_W;j=1,\cdots,M_V\nonumber
\end{eqnarray}</script>
</div>
<p>then \eqref{eqn::vfStokes} is written by</p>
<p>
<script type="math/tex; mode=display">\begin{eqnarray}
\left(
\begin{array}{cc}
\mathbf{A}&\mathbf{\mathbf{B}}^*\\
\mathbf{B}&0
\end{array}
\right)
\left(
\begin{array}{cc}
\mathbf{U}_h\\
\{p_h\}
\end{array}
\right)
=
\left(
\begin{array}{cc}
\mathbf{F}_h\\
0
\end{array}
\right)
\end{eqnarray}</script>
where
<script type="math/tex; mode=display">\begin{eqnarray*}
&&\mathbf{A}=\left(
\begin{array}{cc}
A&0\\
0&A
\end{array}
\right)
\qquad
\mathbf{B}^*=\left\{
\begin{array}{c}
Bx^T\\
By^T
\end{array}
\right\}
\qquad
\mathbf{U}_h=\left\{
\begin{array}{c}
\{u_{1,h}\}\\
\{u_{2,h}\}
\end{array}
\right\}
\qquad
\mathbf{F}_h=\left\{
\begin{array}{c}
\{\textstyle{\int_{\Omega}f_1\phi_i}\}\\
\{\textstyle{\int_{\Omega}f_2\phi_i}\}
\end{array}
\right\}
\end{eqnarray*}</script>
</p>
<p><strong>Penalty method:</strong> This method consists of replacing \eqref{eqn::vfStokes} by a more regular problem: Find <span><span class="MathJax_Preview">(\mathbf{v}_h^{\epsilon},p_h^{\epsilon})\in \mathbf{V}_h\times \tilde{W}_{h}</span><script type="math/tex">(\mathbf{v}_h^{\epsilon},p_h^{\epsilon})\in \mathbf{V}_h\times \tilde{W}_{h}</script></span> satisfying</p>
<div>
<div class="MathJax_Preview">\begin{equation}
    \begin{array}{cll}
    a(\mathbf{u}_h^\epsilon,\mathbf{v}_h)+b(\mathbf{v}_h,p_h^{\epsilon}) &amp;= (\mathbf{f},\mathbf{v}_h) ,
    &amp;\forall \mathbf{v}_{h} \in \mathbf{V}_{h} \\
    b(\mathbf{u}_h^{\epsilon},q_h)-\epsilon(p_h^{\epsilon},q_h)&amp;= 0,
    &amp;\forall q_{h} \in \tilde{W}_{h}
    \end{array}
\end{equation}</div>
<script type="math/tex; mode=display">\begin{equation}
    \begin{array}{cll}
    a(\mathbf{u}_h^\epsilon,\mathbf{v}_h)+b(\mathbf{v}_h,p_h^{\epsilon}) &= (\mathbf{f},\mathbf{v}_h) ,
    &\forall \mathbf{v}_{h} \in \mathbf{V}_{h} \\
    b(\mathbf{u}_h^{\epsilon},q_h)-\epsilon(p_h^{\epsilon},q_h)&= 0,
    &\forall q_{h} \in \tilde{W}_{h}
    \end{array}
\end{equation}</script>
</div>
<p>where <span><span class="MathJax_Preview">\tilde{W}_h\subset L^2(\Omega)</span><script type="math/tex">\tilde{W}_h\subset L^2(\Omega)</script></span>. Formally, we have</p>
<div>
<div class="MathJax_Preview">
\textrm{div}\mathbf{u}_h^{\epsilon}=\epsilon p_h^{\epsilon}
</div>
<script type="math/tex; mode=display">
\textrm{div}\mathbf{u}_h^{\epsilon}=\epsilon p_h^{\epsilon}
</script>
</div>
<p>and the corresponding algebraic problem</p>
<div>
<div class="MathJax_Preview">\begin{eqnarray*}
\left(
\begin{array}{cc}
\mathbf{A}&amp;B^*\\
B&amp;-\epsilon I
\end{array}
\right)
\left(
\begin{array}{cc}
\mathbf{U}_h^{\epsilon}\\
\{p_h^{\epsilon}\}
\end{array}
\right)
=
\left(
\begin{array}{cc}
\mathbf{F}_h\\
0
\end{array}
\right)
\end{eqnarray*}</div>
<script type="math/tex; mode=display">\begin{eqnarray*}
\left(
\begin{array}{cc}
\mathbf{A}&B^*\\
B&-\epsilon I
\end{array}
\right)
\left(
\begin{array}{cc}
\mathbf{U}_h^{\epsilon}\\
\{p_h^{\epsilon}\}
\end{array}
\right)
=
\left(
\begin{array}{cc}
\mathbf{F}_h\\
0
\end{array}
\right)
\end{eqnarray*}</script>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>We can eliminate <span><span class="MathJax_Preview">p_h^\epsilon=(1/\epsilon)BU_h^{\epsilon}</span><script type="math/tex">p_h^\epsilon=(1/\epsilon)BU_h^{\epsilon}</script></span> to obtain</p>
<div>
<div class="MathJax_Preview">\begin{eqnarray}
\label{eqn::StiffPvfStokes}
(A+(1/\epsilon)B^*B)\mathbf{U}_h^{\epsilon}=\mathbf{F}_h^{\epsilon}
\end{eqnarray}</div>
<script type="math/tex; mode=display">\begin{eqnarray}
\label{eqn::StiffPvfStokes}
(A+(1/\epsilon)B^*B)\mathbf{U}_h^{\epsilon}=\mathbf{F}_h^{\epsilon}
\end{eqnarray}</script>
</div>
<!--- ** --->

<p>Since the matrix <span><span class="MathJax_Preview">A+(1/\epsilon)B^*B</span><script type="math/tex">A+(1/\epsilon)B^*B</script></span> is symmetric, positive-definite, and sparse, \eqref{eqn::StiffPvfStokes} can be solved by known technique. There is a constant <span><span class="MathJax_Preview">C&gt;0</span><script type="math/tex">C>0</script></span> independent of <span><span class="MathJax_Preview">\epsilon</span><script type="math/tex">\epsilon</script></span> such that</p>
<!--- ** --->

<div>
<div class="MathJax_Preview">
\|\mathbf{u}_h-\mathbf{u}_h^\epsilon\|_{1,\Omega}+
\|p_h-p_h^{\epsilon}\|_{0,\Omega}\le C\epsilon
</div>
<script type="math/tex; mode=display">
\|\mathbf{u}_h-\mathbf{u}_h^\epsilon\|_{1,\Omega}+
\|p_h-p_h^{\epsilon}\|_{0,\Omega}\le C\epsilon
</script>
</div>
<p>(see e.g. <a href="#ROBERTS1993">ROBERTS1993</a>, 17.2)</p>
</div>
<div class="admonition example">
<p class="admonition-title">Cavity</p>
<p>The driven cavity flow problem is solved first at zero Reynolds number (Stokes flow) and then at Reynolds 100. The velocity pressure formulation is used first and then the calculation is repeated with the stream function vorticity formulation.</p>
<p>We solve the driven cavity problem by the penalty method \eqref{eqn::PvfStokes} where <span><span class="MathJax_Preview">\mathbf{u}_{\Gamma}\cdot \mathbf{n}=0</span><script type="math/tex">\mathbf{u}_{\Gamma}\cdot \mathbf{n}=0</script></span> and <span><span class="MathJax_Preview">\mathbf{u}_{\Gamma}\cdot \mathbf{s}=1</span><script type="math/tex">\mathbf{u}_{\Gamma}\cdot \mathbf{s}=1</script></span> on the top boundary and zero elsewhere (<span><span class="MathJax_Preview">\mathbf{n}</span><script type="math/tex">\mathbf{n}</script></span> is the unit normal to <span><span class="MathJax_Preview">\Gamma</span><script type="math/tex">\Gamma</script></span>, and <span><span class="MathJax_Preview">\mathbf{s}</span><script type="math/tex">\mathbf{s}</script></span> the unit tangent to <span><span class="MathJax_Preview">\Gamma</span><script type="math/tex">\Gamma</script></span>).</p>
<p>The mesh is constructed by</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">mesh</span> <span class="n">Th</span> <span class="o">=</span> <span class="nf">square</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
</pre></div>
</td></tr></table>

<p>We use a classical Taylor-Hood element technique to solve the problem:</p>
<p>The velocity is approximated with the <span><span class="MathJax_Preview">P_{2}</span><script type="math/tex">P_{2}</script></span> FE (<span><span class="MathJax_Preview">X_{h}</span><script type="math/tex">X_{h}</script></span> space), and the pressure is approximated with the <span><span class="MathJax_Preview">P_{1}</span><script type="math/tex">P_{1}</script></span> FE (<span><span class="MathJax_Preview">M_{h}</span><script type="math/tex">M_{h}</script></span> space), where</p>
<div>
<div class="MathJax_Preview">
X_{h} = \left\{ \mathbf{v} \in H^{1}(]0,1[^2) \left|\; \forall K \in \mathcal{T}_{h}\quad v_{|K} \in P_{2}\right.\right\}
</div>
<script type="math/tex; mode=display">
X_{h} = \left\{ \mathbf{v} \in H^{1}(]0,1[^2) \left|\; \forall K \in \mathcal{T}_{h}\quad v_{|K} \in P_{2}\right.\right\}
</script>
</div>
<p>and</p>
<div>
<div class="MathJax_Preview">
M_{h} = \left\{ v \in H^{1}(]0,1[^2) \left|\; \forall K \in \mathcal{T}_{h}\quad v_{|K} \in P_{1} \right.\right\}
</div>
<script type="math/tex; mode=display">
M_{h} = \left\{ v \in H^{1}(]0,1[^2) \left|\; \forall K \in \mathcal{T}_{h}\quad v_{|K} \in P_{1} \right.\right\}
</script>
</div>
<p>The FE spaces and functions are constructed by</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">fespace</span> <span class="nf">Xh</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="nc">P2</span><span class="p">);</span> <span class="c1">//definition of the velocity component space</span>
<span class="kt">fespace</span> <span class="nf">Mh</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="nc">P1</span><span class="p">);</span> <span class="c1">//definition of the pressure space</span>
<span class="n">Xh</span> <span class="n">u2</span><span class="p">,</span> <span class="n">v2</span><span class="p">;</span>
<span class="n">Xh</span> <span class="n">u1</span><span class="p">,</span> <span class="n">v1</span><span class="p">;</span>
<span class="n">Mh</span> <span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p>The Stokes operator is implemented as a system-solve for the velocity <span><span class="MathJax_Preview">(u1,u2)</span><script type="math/tex">(u1,u2)</script></span> and the pressure <span><span class="MathJax_Preview">p</span><script type="math/tex">p</script></span>. The test function for the velocity is <span><span class="MathJax_Preview">(v1,v2)</span><script type="math/tex">(v1,v2)</script></span> and <span><span class="MathJax_Preview">q</span><script type="math/tex">q</script></span> for the pressure, so the variational form \eqref{eqn::vfStokes} in freefem language is:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">solve</span> <span class="nf">Stokes</span> <span class="p">(</span><span class="n">u1</span><span class="p">,</span> <span class="n">u2</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="kp">solver</span><span class="o">=</span><span class="kr">Crout</span><span class="p">)</span>
    <span class="o">=</span> <span class="nf">int2d</span><span class="p">(</span><span class="n">Th</span><span class="p">)(</span>
          <span class="p">(</span>
              <span class="nf">dx</span><span class="p">(</span><span class="n">u1</span><span class="p">)</span><span class="o">*</span><span class="nf">dx</span><span class="p">(</span><span class="n">v1</span><span class="p">)</span>
            <span class="o">+</span> <span class="nf">dy</span><span class="p">(</span><span class="n">u1</span><span class="p">)</span><span class="o">*</span><span class="nf">dy</span><span class="p">(</span><span class="n">v1</span><span class="p">)</span>
            <span class="o">+</span> <span class="nf">dx</span><span class="p">(</span><span class="n">u2</span><span class="p">)</span><span class="o">*</span><span class="nf">dx</span><span class="p">(</span><span class="n">v2</span><span class="p">)</span>
            <span class="o">+</span> <span class="nf">dy</span><span class="p">(</span><span class="n">u2</span><span class="p">)</span><span class="o">*</span><span class="nf">dy</span><span class="p">(</span><span class="n">v2</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="o">-</span> <span class="n">p</span><span class="o">*</span><span class="n">q</span><span class="o">*</span><span class="p">(</span><span class="mf">0.000001</span><span class="p">)</span>
        <span class="o">-</span> <span class="n">p</span><span class="o">*</span><span class="nf">dx</span><span class="p">(</span><span class="n">v1</span><span class="p">)</span> <span class="o">-</span> <span class="n">p</span><span class="o">*</span><span class="nf">dy</span><span class="p">(</span><span class="n">v2</span><span class="p">)</span>
        <span class="o">-</span> <span class="nf">dx</span><span class="p">(</span><span class="n">u1</span><span class="p">)</span><span class="o">*</span><span class="n">q</span> <span class="o">-</span> <span class="nf">dy</span><span class="p">(</span><span class="n">u2</span><span class="p">)</span><span class="o">*</span><span class="n">q</span>
    <span class="p">)</span>
    <span class="o">+</span> <span class="nf">on</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">u1</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">u2</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="o">+</span> <span class="nf">on</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">u1</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">u2</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="p">;</span>
</pre></div>
</td></tr></table>

<p>Each unknown has its own boundary conditions.</p>
<p>If the streamlines are required, they can be computed by finding <span><span class="MathJax_Preview">\psi</span><script type="math/tex">\psi</script></span> such that rot<span><span class="MathJax_Preview">\psi=u</span><script type="math/tex">\psi=u</script></span> or better,</p>
<div>
<div class="MathJax_Preview">
-\Delta\psi=\nabla\times u
</div>
<script type="math/tex; mode=display">
-\Delta\psi=\nabla\times u
</script>
</div>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">Xh</span> <span class="n">psi</span><span class="p">,</span> <span class="n">phi</span><span class="p">;</span>

<span class="kt">solve</span> <span class="nf">streamlines</span> <span class="p">(</span><span class="n">psi</span><span class="p">,</span> <span class="n">phi</span><span class="p">)</span>
    <span class="o">=</span> <span class="nf">int2d</span><span class="p">(</span><span class="n">Th</span><span class="p">)(</span>
          <span class="nf">dx</span><span class="p">(</span><span class="n">psi</span><span class="p">)</span><span class="o">*</span><span class="nf">dx</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
        <span class="o">+</span> <span class="nf">dy</span><span class="p">(</span><span class="n">psi</span><span class="p">)</span><span class="o">*</span><span class="nf">dy</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="o">+</span> <span class="nf">int2d</span><span class="p">(</span><span class="n">Th</span><span class="p">)(</span>
        <span class="o">-</span> <span class="n">phi</span><span class="o">*</span><span class="p">(</span><span class="nf">dy</span><span class="p">(</span><span class="n">u1</span><span class="p">)</span> <span class="o">-</span> <span class="nf">dx</span><span class="p">(</span><span class="n">u2</span><span class="p">))</span>
    <span class="p">)</span>
    <span class="o">+</span> <span class="nf">on</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">psi</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="p">;</span>
</pre></div>
</td></tr></table>

<p>Now the Navier-Stokes equations are solved</p>
<div>
<div class="MathJax_Preview">{\p {u}\over\p t} +u\cdot\nabla u-\nu \Delta u+\nabla p=0, \nabla\cdot u=0</div>
<script type="math/tex; mode=display">{\p {u}\over\p t} +u\cdot\nabla u-\nu \Delta u+\nabla p=0, \nabla\cdot u=0</script>
</div>
<p>with the same boundary conditions and with initial conditions <span><span class="MathJax_Preview">u=0</span><script type="math/tex">u=0</script></span>.</p>
<p>This is implemented by using the convection operator <code class="codehilite"><span class="nf">convect</span></code> for the term <span><span class="MathJax_Preview">{\p u\over\p t} +u\cdot\nabla u</span><script type="math/tex">{\p u\over\p t} +u\cdot\nabla u</script></span>, giving a discretization in time</p>
<div>
<div class="MathJax_Preview">\begin{equation}
\begin{array}{cl}
\frac{1}{\tau } (u^{n+1}-u^n\circ X^n) -\nu\Delta u^{n+1} + \nabla p^{n+1} &amp;=0,\\
 \nabla\cdot u^{n+1} &amp;= 0
 \end{array}
\end{equation}</div>
<script type="math/tex; mode=display">\begin{equation}
\begin{array}{cl}
\frac{1}{\tau } (u^{n+1}-u^n\circ X^n) -\nu\Delta u^{n+1} + \nabla p^{n+1} &=0,\\
 \nabla\cdot u^{n+1} &= 0
 \end{array}
\end{equation}</script>
</div>
<p>The term <span><span class="MathJax_Preview">u^n\circ X^n(x)\approx u^n(x-u^n(x)\tau )</span><script type="math/tex">u^n\circ X^n(x)\approx u^n(x-u^n(x)\tau )</script></span> will be computed by the operator <code class="codehilite"><span class="nf">convect</span></code>, so we obtain</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
<span class="kt">real</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="n">dt</span><span class="p">;</span>
<span class="kt">problem</span> <span class="nf">NS</span> <span class="p">(</span><span class="n">u1</span><span class="p">,</span> <span class="n">u2</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="kp">solver</span><span class="o">=</span><span class="kr">Crout</span><span class="p">,</span> <span class="kp">init</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
    <span class="o">=</span> <span class="nf">int2d</span><span class="p">(</span><span class="n">Th</span><span class="p">)(</span>
          <span class="n">alpha</span><span class="o">*</span><span class="p">(</span><span class="n">u1</span><span class="o">*</span><span class="n">v1</span> <span class="o">+</span> <span class="n">u2</span><span class="o">*</span><span class="n">v2</span><span class="p">)</span>
        <span class="o">+</span> <span class="n">nu</span> <span class="o">*</span> <span class="p">(</span>
              <span class="nf">dx</span><span class="p">(</span><span class="n">u1</span><span class="p">)</span><span class="o">*</span><span class="nf">dx</span><span class="p">(</span><span class="n">v1</span><span class="p">)</span> <span class="o">+</span> <span class="nf">dy</span><span class="p">(</span><span class="n">u1</span><span class="p">)</span><span class="o">*</span><span class="nf">dy</span><span class="p">(</span><span class="n">v1</span><span class="p">)</span>
            <span class="o">+</span> <span class="nf">dx</span><span class="p">(</span><span class="n">u2</span><span class="p">)</span><span class="o">*</span><span class="nf">dx</span><span class="p">(</span><span class="n">v2</span><span class="p">)</span> <span class="o">+</span> <span class="nf">dy</span><span class="p">(</span><span class="n">u2</span><span class="p">)</span><span class="o">*</span><span class="nf">dy</span><span class="p">(</span><span class="n">v2</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="o">-</span> <span class="n">p</span><span class="o">*</span><span class="n">q</span><span class="o">*</span><span class="p">(</span><span class="mf">0.000001</span><span class="p">)</span>
        <span class="o">-</span> <span class="n">p</span><span class="o">*</span><span class="nf">dx</span><span class="p">(</span><span class="n">v1</span><span class="p">)</span> <span class="o">-</span> <span class="n">p</span><span class="o">*</span><span class="nf">dy</span><span class="p">(</span><span class="n">v2</span><span class="p">)</span>
        <span class="o">-</span> <span class="nf">dx</span><span class="p">(</span><span class="n">u1</span><span class="p">)</span><span class="o">*</span><span class="n">q</span> <span class="o">-</span> <span class="nf">dy</span><span class="p">(</span><span class="n">u2</span><span class="p">)</span><span class="o">*</span><span class="n">q</span>
    <span class="p">)</span>
    <span class="o">+</span> <span class="nf">int2d</span><span class="p">(</span><span class="n">Th</span><span class="p">)(</span>
        <span class="o">-</span> <span class="n">alpha</span><span class="o">*</span><span class="nf">convect</span><span class="p">([</span><span class="n">up1</span><span class="p">,</span><span class="n">up2</span><span class="p">],</span><span class="o">-</span><span class="n">dt</span><span class="p">,</span><span class="n">up1</span><span class="p">)</span><span class="o">*</span><span class="n">v1</span>
        <span class="o">-</span> <span class="n">alpha</span><span class="o">*</span><span class="nf">convect</span><span class="p">([</span><span class="n">up1</span><span class="p">,</span><span class="n">up2</span><span class="p">],</span><span class="o">-</span><span class="n">dt</span><span class="p">,</span><span class="n">up2</span><span class="p">)</span><span class="o">*</span><span class="n">v2</span>
    <span class="p">)</span>
    <span class="o">+</span> <span class="nf">on</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">u1</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">u2</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="o">+</span> <span class="nf">on</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span><span class="n">u1</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">u2</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="p">;</span>

<span class="c1">// Time loop</span>
<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">10</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">){</span>
    <span class="c1">// Update</span>
    <span class="n">up1</span> <span class="o">=</span> <span class="n">u1</span><span class="p">;</span>
    <span class="n">up2</span> <span class="o">=</span> <span class="n">u2</span><span class="p">;</span>

    <span class="c1">// Solve</span>
    <span class="n">NS</span><span class="p">;</span>

    <span class="c1">// Plot</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">10</span><span class="p">))</span>
        <span class="nf">plot</span><span class="p">(</span><span class="kp">coef</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="kp">cmm</span><span class="o">=</span><span class="s">&quot;[u1,u2] and p&quot;</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="p">[</span><span class="n">u1</span><span class="p">,</span> <span class="n">u2</span><span class="p">]);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>Notice that the stiffness matrices are reused (keyword <code class="codehilite"><span class="kp">init</span><span class="o">=</span><span class="n">i</span></code>)</p>
<p>The complete script is available in <a href="/examples/#cavity">Examples</a>.</p>
</div>
<h2 id="uzawa-algorithm-and-conjugate-gradients">Uzawa Algorithm and Conjugate Gradients<a class="headerlink" href="#uzawa-algorithm-and-conjugate-gradients" title="Permanent link">#</a></h2>
<p>We solve Stokes problem without penalty. The classical iterative method of Uzawa is described by the algorithm (see e.g.<a href="#ROBERTS1993">ROBERTS1993</a>, 17.3, <a href="#GLOWINSKI1979">GLOWINSKI1979</a>, 13 or <a href="#GLOWINSKI1985">GLOWINSKI1985</a>, 13):</p>
<ul>
<li>
<p><strong>Initialize:</strong> Let <span><span class="MathJax_Preview">p_h^0</span><script type="math/tex">p_h^0</script></span> be an arbitrary chosen element of <span><span class="MathJax_Preview">L^2(\Omega)</span><script type="math/tex">L^2(\Omega)</script></span>.</p>
</li>
<li>
<p><strong>Calculate <span><span class="MathJax_Preview">\mathbf{u}_h</span><script type="math/tex">\mathbf{u}_h</script></span>:</strong> Once <span><span class="MathJax_Preview">p_h^n</span><script type="math/tex">p_h^n</script></span> is known, <span><span class="MathJax_Preview">\mathbf{v}_h^n</span><script type="math/tex">\mathbf{v}_h^n</script></span> is the solution of</p>
<div>
<div class="MathJax_Preview">
\mathbf{u}_h^n = A^{-1}(\mathbf{f}_h-\mathbf{B}^*p_h^n)
</div>
<script type="math/tex; mode=display">
\mathbf{u}_h^n = A^{-1}(\mathbf{f}_h-\mathbf{B}^*p_h^n)
</script>
</div>
<!-- ** --->

</li>
<li>
<p><strong>Advance <span><span class="MathJax_Preview">p_h</span><script type="math/tex">p_h</script></span>:</strong> Let <span><span class="MathJax_Preview">p_h^{n+1}</span><script type="math/tex">p_h^{n+1}</script></span> be defined by</p>
<div>
<div class="MathJax_Preview">
p_h^{n+1}=p_h^n+\rho_n\mathbf{B}\mathbf{u}_h^n
</div>
<script type="math/tex; mode=display">
p_h^{n+1}=p_h^n+\rho_n\mathbf{B}\mathbf{u}_h^n
</script>
</div>
</li>
</ul>
<p>There is a constant <span><span class="MathJax_Preview">\alpha&gt;0</span><script type="math/tex">\alpha>0</script></span> such that <span><span class="MathJax_Preview">\alpha\le \rho_n\le 2</span><script type="math/tex">\alpha\le \rho_n\le 2</script></span> for each <span><span class="MathJax_Preview">n</span><script type="math/tex">n</script></span>, then <span><span class="MathJax_Preview">\mathbf{u}_h^n</span><script type="math/tex">\mathbf{u}_h^n</script></span> converges to the solution <span><span class="MathJax_Preview">\mathbf{u}_h</span><script type="math/tex">\mathbf{u}_h</script></span>, and then <span><span class="MathJax_Preview">B\mathbf{v}_h^n\to 0</span><script type="math/tex">B\mathbf{v}_h^n\to 0</script></span> as <span><span class="MathJax_Preview">n\to \infty</span><script type="math/tex">n\to \infty</script></span> from the <em>Advance <span><span class="MathJax_Preview">p_h</span><script type="math/tex">p_h</script></span></em>. This method in general converges quite slowly.</p>
<p>First we define mesh, and the Taylor-Hood approximation.
So <span><span class="MathJax_Preview">X_{h}</span><script type="math/tex">X_{h}</script></span> is the velocity space, and <span><span class="MathJax_Preview">M_{h}</span><script type="math/tex">M_{h}</script></span> is the pressure space.</p>
<div class="admonition example">
<p class="admonition-title">Stokes Uzawa</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1">// Mesh</span>
<span class="kt">mesh</span> <span class="n">Th</span> <span class="o">=</span> <span class="nf">square</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>

<span class="c1">// Fespace</span>
<span class="kt">fespace</span> <span class="nf">Xh</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="nc">P2</span><span class="p">);</span>
<span class="n">Xh</span> <span class="n">u1</span><span class="p">,</span> <span class="n">u2</span><span class="p">;</span>
<span class="n">Xh</span> <span class="n">bc1</span><span class="p">,</span> <span class="n">bc2</span><span class="p">;</span>
<span class="n">Xh</span> <span class="n">b</span><span class="p">;</span>

<span class="kt">fespace</span> <span class="nf">Mh</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="nc">P1</span><span class="p">);</span>
<span class="n">Mh</span> <span class="n">p</span><span class="p">;</span>
<span class="n">Mh</span> <span class="n">ppp</span><span class="p">;</span> <span class="c1">//ppp is a working pressure</span>

<span class="c1">// Problem</span>
<span class="kt">varf</span> <span class="nf">bx</span> <span class="p">(</span><span class="n">u1</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span> <span class="o">=</span> <span class="nf">int2d</span><span class="p">(</span><span class="n">Th</span><span class="p">)(</span><span class="o">-</span><span class="p">(</span><span class="nf">dx</span><span class="p">(</span><span class="n">u1</span><span class="p">)</span><span class="o">*</span><span class="n">q</span><span class="p">));</span>
<span class="kt">varf</span> <span class="nf">by</span> <span class="p">(</span><span class="n">u1</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span> <span class="o">=</span> <span class="nf">int2d</span><span class="p">(</span><span class="n">Th</span><span class="p">)(</span><span class="o">-</span><span class="p">(</span><span class="nf">dy</span><span class="p">(</span><span class="n">u1</span><span class="p">)</span><span class="o">*</span><span class="n">q</span><span class="p">));</span>
<span class="kt">varf</span> <span class="nf">a</span> <span class="p">(</span><span class="n">u1</span><span class="p">,</span> <span class="n">u2</span><span class="p">)</span>
    <span class="o">=</span> <span class="nf">int2d</span><span class="p">(</span><span class="n">Th</span><span class="p">)(</span>
          <span class="nf">dx</span><span class="p">(</span><span class="n">u1</span><span class="p">)</span><span class="o">*</span><span class="nf">dx</span><span class="p">(</span><span class="n">u2</span><span class="p">)</span>
        <span class="o">+</span> <span class="nf">dy</span><span class="p">(</span><span class="n">u1</span><span class="p">)</span><span class="o">*</span><span class="nf">dy</span><span class="p">(</span><span class="n">u2</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="o">+</span> <span class="nf">on</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">u1</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="o">+</span> <span class="nf">on</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">u1</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">;</span>
<span class="c1">//remark: put the on(3,u1=1) before on(1,2,4,u1=0)</span>
<span class="c1">//because we want zero on intersection</span>

<span class="kt">matrix</span> <span class="kp">A</span> <span class="o">=</span> <span class="n">a</span><span class="p">(</span><span class="n">Xh</span><span class="p">,</span> <span class="n">Xh</span><span class="p">,</span> <span class="kp">solver</span><span class="o">=</span><span class="kr">CG</span><span class="p">);</span>
<span class="kt">matrix</span> <span class="n">Bx</span> <span class="o">=</span> <span class="n">bx</span><span class="p">(</span><span class="n">Xh</span><span class="p">,</span> <span class="n">Mh</span><span class="p">);</span> <span class="c1">//B=(Bx, By)$</span>
<span class="kt">matrix</span> <span class="n">By</span> <span class="o">=</span> <span class="n">by</span><span class="p">(</span><span class="n">Xh</span><span class="p">,</span> <span class="n">Mh</span><span class="p">);</span>

<span class="n">bc1</span><span class="p">[]</span> <span class="o">=</span> <span class="n">a</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">Xh</span><span class="p">);</span> <span class="c1">//boundary condition contribution on u1</span>
<span class="n">bc2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">//no boundary condition contribution on u2</span>

<span class="c1">//p_h^n -&gt; B A^-1 - B^* p_h^n = -div u_h</span>
<span class="c1">//is realized as the function divup</span>
<span class="kt">func</span> <span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">divup</span> <span class="p">(</span><span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">pp</span><span class="p">){</span>
    <span class="c1">//compute u1(pp)</span>
    <span class="n">b</span><span class="p">[]</span> <span class="o">=</span> <span class="n">Bx</span><span class="o">&#39;*</span><span class="n">pp</span><span class="p">;</span>
    <span class="n">b</span><span class="p">[]</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="n">b</span><span class="p">[]</span> <span class="o">+=</span> <span class="n">bc1</span><span class="p">[];</span>
    <span class="n">u1</span><span class="p">[]</span> <span class="o">=</span> <span class="kp">A</span><span class="o">^-</span><span class="mi">1</span><span class="o">*</span><span class="n">b</span><span class="p">[];</span>
    <span class="c1">//compute u2(pp)</span>
    <span class="n">b</span><span class="p">[]</span> <span class="o">=</span> <span class="n">By</span><span class="o">&#39;*</span><span class="n">pp</span><span class="p">;</span>
    <span class="n">b</span><span class="p">[]</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="n">b</span><span class="p">[]</span> <span class="o">+=</span> <span class="n">bc2</span><span class="p">[];</span>
    <span class="n">u2</span><span class="p">[]</span> <span class="o">=</span> <span class="kp">A</span><span class="o">^-</span><span class="mi">1</span><span class="o">*</span><span class="n">b</span><span class="p">[];</span>
    <span class="c1">//u^n = (A^-1 Bx^T p^n, By^T p^n)^T$</span>
    <span class="n">ppp</span><span class="p">[]</span> <span class="o">=</span> <span class="n">Bx</span><span class="o">*</span><span class="n">u1</span><span class="p">[];</span> <span class="c1">//ppp = Bx u_1</span>
    <span class="n">ppp</span><span class="p">[]</span> <span class="o">+=</span> <span class="n">By</span><span class="o">*</span><span class="n">u2</span><span class="p">[];</span> <span class="c1">//+ By u_2</span>

    <span class="k">return</span> <span class="n">ppp</span><span class="p">[]</span> <span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Initialization</span>
<span class="n">p</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="c1">//p_h^0 = 0</span>
<span class="nf">LinearCG</span><span class="p">(</span><span class="n">divup</span><span class="p">,</span> <span class="n">p</span><span class="p">[],</span> <span class="kp">eps</span><span class="o">=</span><span class="mf">1.e-6</span><span class="p">,</span> <span class="kp">nbiter</span><span class="o">=</span><span class="mi">50</span><span class="p">);</span> <span class="c1">//p_h^{n+1} = p_h^n + B u_h^n</span>
<span class="c1">// if n&gt; 50 or |p_h^{n+1} - p_h^n| &lt;= 10^-6, then the loop end</span>
<span class="n">divup</span><span class="p">(</span><span class="n">p</span><span class="p">[]);</span> <span class="c1">//compute the final solution</span>

<span class="nf">plot</span><span class="p">([</span><span class="n">u1</span><span class="p">,</span> <span class="n">u2</span><span class="p">],</span> <span class="n">p</span><span class="p">,</span> <span class="kp">wait</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="kp">value</span><span class="o">=</span><span class="kr">true</span><span class="p">,</span> <span class="kp">coef</span><span class="o">=</span><span class="mf">0.1</span><span class="p">);</span>
</pre></div>
</td></tr></table>

</div>
<h2 id="nsuzawacahouetchabartedp">NSUzawaCahouetChabart.edp<a class="headerlink" href="#nsuzawacahouetchabartedp" title="Permanent link">#</a></h2>
<p>In this example we solve the Navier-Stokes equation past a cylinder with the Uzawa algorithm preconditioned by the Cahouet-Chabart method (see <a href="#GLOWINSKI2003">GLOWINSKI2003</a> for all the details).</p>
<p>The idea of the preconditioner is that in a periodic domain, all differential operators commute and the Uzawa algorithm comes to solving the linear operator <span><span class="MathJax_Preview">\nabla. ( (\alpha Id + \nu \Delta)^{-1} \nabla</span><script type="math/tex">\nabla. ( (\alpha Id + \nu \Delta)^{-1} \nabla</script></span>, where $ Id $ is the identity operator. So the preconditioner suggested is <span><span class="MathJax_Preview">\alpha \Delta^{-1} + \nu Id</span><script type="math/tex">\alpha \Delta^{-1} + \nu Id</script></span>.</p>
<p>To implement this, we do</p>
<div class="admonition example">
<p class="admonition-title">NS Uzawa Cahouet Chabart</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1">// Parameters</span>
<span class="kr">verbosity</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="kt">real</span> <span class="n">D</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">;</span>
<span class="kt">real</span> <span class="n">H</span> <span class="o">=</span> <span class="mf">0.41</span><span class="p">;</span>
<span class="kt">real</span> <span class="n">cx0</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">;</span>
<span class="kt">real</span> <span class="n">cy0</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">;</span> <span class="c1">//center of cylinder</span>
<span class="kt">real</span> <span class="n">xa</span> <span class="o">=</span> <span class="mf">0.15</span><span class="p">;</span>
<span class="kt">real</span> <span class="n">ya</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">;</span>
<span class="kt">real</span> <span class="n">xe</span> <span class="o">=</span> <span class="mf">0.25</span><span class="p">;</span>
<span class="kt">real</span> <span class="n">ye</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">nn</span> <span class="o">=</span> <span class="mi">15</span><span class="p">;</span>

<span class="c1">//TODO</span>
<span class="kt">real</span> <span class="n">Um</span> <span class="o">=</span> <span class="mf">1.5</span><span class="p">;</span> <span class="c1">//max velocity (Rey 100)</span>
<span class="kt">real</span> <span class="n">nu</span> <span class="o">=</span> <span class="mf">1e-3</span><span class="p">;</span>

<span class="kt">func</span> <span class="n">U1</span> <span class="o">=</span> <span class="mf">4.</span><span class="o">*</span><span class="n">Um</span><span class="o">*</span><span class="kr">y</span><span class="o">*</span><span class="p">(</span><span class="n">H</span><span class="o">-</span><span class="kr">y</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">H</span><span class="o">*</span><span class="n">H</span><span class="p">);</span> <span class="c1">//Boundary condition</span>
<span class="kt">func</span> <span class="n">U2</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">;</span>
<span class="kt">real</span> <span class="n">T</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span>
<span class="kt">real</span> <span class="n">dt</span> <span class="o">=</span> <span class="n">D</span><span class="o">/</span><span class="n">nn</span><span class="o">/</span><span class="n">Um</span><span class="p">;</span> <span class="c1">//CFL = 1</span>
<span class="kt">real</span> <span class="n">epspq</span> <span class="o">=</span> <span class="mf">1e-10</span><span class="p">;</span>
<span class="kt">real</span> <span class="kp">eps</span> <span class="o">=</span> <span class="mf">1e-6</span><span class="p">;</span>

<span class="c1">// Variables</span>
<span class="kt">func</span> <span class="n">Ub</span> <span class="o">=</span> <span class="n">Um</span><span class="o">*</span><span class="mf">2.</span><span class="o">/</span><span class="mf">3.</span><span class="p">;</span>
<span class="kt">real</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">dt</span><span class="p">;</span>
<span class="kt">real</span> <span class="n">Rey</span> <span class="o">=</span> <span class="n">Ub</span><span class="o">*</span><span class="n">D</span><span class="o">/</span><span class="n">nu</span><span class="p">;</span>
<span class="kt">real</span> <span class="kp">t</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">;</span>

<span class="c1">// Mesh</span>
<span class="kt">border</span> <span class="nf">fr1</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mf">2.2</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="kp">t</span><span class="p">;</span> <span class="kr">y</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="kr">label</span><span class="o">=</span><span class="mi">1</span><span class="p">;}</span>
<span class="kt">border</span> <span class="nf">fr2</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">H</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="mf">2.2</span><span class="p">;</span> <span class="kr">y</span><span class="o">=</span><span class="kp">t</span><span class="p">;</span> <span class="kr">label</span><span class="o">=</span><span class="mi">2</span><span class="p">;}</span>
<span class="kt">border</span> <span class="nf">fr3</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mf">2.2</span><span class="p">,</span> <span class="mi">0</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="kp">t</span><span class="p">;</span> <span class="kr">y</span><span class="o">=</span><span class="n">H</span><span class="p">;</span> <span class="kr">label</span><span class="o">=</span><span class="mi">1</span><span class="p">;}</span>
<span class="kt">border</span> <span class="nf">fr4</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="n">H</span><span class="p">,</span> <span class="mi">0</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="kr">y</span><span class="o">=</span><span class="kp">t</span><span class="p">;</span> <span class="kr">label</span><span class="o">=</span><span class="mi">1</span><span class="p">;}</span>
<span class="kt">border</span> <span class="nf">fr5</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="kr">pi</span><span class="p">,</span> <span class="mi">0</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="n">cx0</span><span class="o">+</span><span class="n">D</span><span class="o">*</span><span class="nf">sin</span><span class="p">(</span><span class="kp">t</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span> <span class="kr">y</span><span class="o">=</span><span class="n">cy0</span><span class="o">+</span><span class="n">D</span><span class="o">*</span><span class="nf">cos</span><span class="p">(</span><span class="kp">t</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span> <span class="kr">label</span><span class="o">=</span><span class="mi">3</span><span class="p">;}</span>
<span class="kt">mesh</span> <span class="n">Th</span> <span class="o">=</span> <span class="nf">buildmesh</span><span class="p">(</span><span class="n">fr1</span><span class="p">(</span><span class="mi">5</span><span class="o">*</span><span class="n">nn</span><span class="p">)</span> <span class="o">+</span> <span class="n">fr2</span><span class="p">(</span><span class="n">nn</span><span class="p">)</span> <span class="o">+</span> <span class="n">fr3</span><span class="p">(</span><span class="mi">5</span><span class="o">*</span><span class="n">nn</span><span class="p">)</span> <span class="o">+</span> <span class="n">fr4</span><span class="p">(</span><span class="n">nn</span><span class="p">)</span> <span class="o">+</span> <span class="n">fr5</span><span class="p">(</span><span class="o">-</span><span class="n">nn</span><span class="o">*</span><span class="mi">3</span><span class="p">));</span>

<span class="c1">// Fespace</span>
<span class="kt">fespace</span> <span class="nf">Mh</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="p">[</span><span class="nc">P1</span><span class="p">]);</span>
<span class="n">Mh</span> <span class="n">p</span><span class="p">;</span>

<span class="kt">fespace</span> <span class="nf">Xh</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="p">[</span><span class="nc">P2</span><span class="p">]);</span>
<span class="n">Xh</span> <span class="n">u1</span><span class="p">,</span> <span class="n">u2</span><span class="p">;</span>

<span class="kt">fespace</span> <span class="nf">Wh</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="p">[</span><span class="nc">P1dc</span><span class="p">]);</span>
<span class="n">Wh</span> <span class="n">w</span><span class="p">;</span> <span class="c1">//vorticity</span>

<span class="c1">// Macro</span>
<span class="kt">macro</span> <span class="n">grad</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="p">[</span><span class="nf">dx</span><span class="p">(</span><span class="n">u</span><span class="p">),</span> <span class="nf">dy</span><span class="p">(</span><span class="n">u</span><span class="p">)]</span> <span class="c1">//</span>
<span class="kt">macro</span> <span class="n">div</span><span class="p">(</span><span class="n">u1</span><span class="p">,</span> <span class="n">u2</span><span class="p">)</span> <span class="p">(</span><span class="nf">dx</span><span class="p">(</span><span class="n">u1</span><span class="p">)</span> <span class="o">+</span> <span class="nf">dy</span><span class="p">(</span><span class="n">u2</span><span class="p">))</span> <span class="c1">//</span>

<span class="c1">// Problem</span>
<span class="kt">varf</span> <span class="n">von1</span> <span class="p">([</span><span class="n">u1</span><span class="p">,</span> <span class="n">u2</span><span class="p">,</span> <span class="n">p</span><span class="p">],</span> <span class="p">[</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">q</span><span class="p">])</span>
    <span class="o">=</span> <span class="nf">on</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">u1</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">u2</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="o">+</span> <span class="nf">on</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">u1</span><span class="o">=</span><span class="n">U1</span><span class="p">,</span> <span class="n">u2</span><span class="o">=</span><span class="n">U2</span><span class="p">)</span>
    <span class="p">;</span>

<span class="c1">//remark : the value 100 in next varf is manualy fitted, because free outlet.</span>
<span class="kt">varf</span> <span class="nf">vA</span> <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span> <span class="o">=</span>
    <span class="nf">int2d</span><span class="p">(</span><span class="n">Th</span><span class="p">)(</span>
          <span class="n">grad</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">&#39;</span> <span class="o">*</span> <span class="n">grad</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="o">+</span> <span class="nf">int1d</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="mi">2</span><span class="p">)(</span>
          <span class="mi">100</span><span class="o">*</span><span class="n">p</span><span class="o">*</span><span class="n">q</span>
    <span class="p">)</span>
    <span class="p">;</span>

<span class="kt">varf</span> <span class="nf">vM</span> <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>
    <span class="o">=</span> <span class="nf">int2d</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="kp">qft</span><span class="o">=</span><span class="kr">qf2pT</span><span class="p">)(</span>
          <span class="n">p</span><span class="o">*</span><span class="n">q</span>
    <span class="p">)</span>
    <span class="o">+</span> <span class="nf">on</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="p">;</span>

<span class="kt">varf</span> <span class="nf">vu</span> <span class="p">([</span><span class="n">u1</span><span class="p">],</span> <span class="p">[</span><span class="n">v1</span><span class="p">])</span>
    <span class="o">=</span> <span class="nf">int2d</span><span class="p">(</span><span class="n">Th</span><span class="p">)(</span>
          <span class="n">alpha</span><span class="o">*</span><span class="p">(</span><span class="n">u1</span><span class="o">*</span><span class="n">v1</span><span class="p">)</span>
        <span class="o">+</span> <span class="n">nu</span><span class="o">*</span><span class="p">(</span><span class="n">grad</span><span class="p">(</span><span class="n">u1</span><span class="p">)</span><span class="o">&#39;</span> <span class="o">*</span> <span class="n">grad</span><span class="p">(</span><span class="n">v1</span><span class="p">))</span>
    <span class="p">)</span>
    <span class="o">+</span> <span class="nf">on</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">u1</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="p">;</span>

<span class="kt">varf</span> <span class="nf">vu1</span> <span class="p">([</span><span class="n">p</span><span class="p">],</span> <span class="p">[</span><span class="n">v1</span><span class="p">])</span> <span class="o">=</span> <span class="nf">int2d</span><span class="p">(</span><span class="n">Th</span><span class="p">)(</span><span class="n">p</span><span class="o">*</span><span class="nf">dx</span><span class="p">(</span><span class="n">v1</span><span class="p">));</span>
<span class="kt">varf</span> <span class="nf">vu2</span> <span class="p">([</span><span class="n">p</span><span class="p">],</span> <span class="p">[</span><span class="n">v1</span><span class="p">])</span> <span class="o">=</span> <span class="nf">int2d</span><span class="p">(</span><span class="n">Th</span><span class="p">)(</span><span class="n">p</span><span class="o">*</span><span class="nf">dy</span><span class="p">(</span><span class="n">v1</span><span class="p">));</span>

<span class="kt">varf</span> <span class="nf">vonu1</span> <span class="p">([</span><span class="n">u1</span><span class="p">],</span> <span class="p">[</span><span class="n">v1</span><span class="p">])</span> <span class="o">=</span> <span class="nf">on</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">u1</span><span class="o">=</span><span class="n">U1</span><span class="p">)</span> <span class="o">+</span> <span class="nf">on</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">u1</span><span class="o">=</span><span class="mi">0</span><span class="p">);</span>
<span class="kt">varf</span> <span class="nf">vonu2</span> <span class="p">([</span><span class="n">u1</span><span class="p">],</span> <span class="p">[</span><span class="n">v1</span><span class="p">])</span> <span class="o">=</span> <span class="nf">on</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">u1</span><span class="o">=</span><span class="n">U2</span><span class="p">)</span> <span class="o">+</span> <span class="nf">on</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">u1</span><span class="o">=</span><span class="mi">0</span><span class="p">);</span>

<span class="kt">matrix</span> <span class="n">pAM</span> <span class="o">=</span> <span class="n">vM</span><span class="p">(</span><span class="n">Mh</span><span class="p">,</span> <span class="n">Mh</span><span class="p">,</span> <span class="kp">solver</span><span class="o">=</span><span class="kr">UMFPACK</span><span class="p">);</span>
<span class="kt">matrix</span> <span class="n">pAA</span> <span class="o">=</span> <span class="n">vA</span><span class="p">(</span><span class="n">Mh</span><span class="p">,</span> <span class="n">Mh</span><span class="p">,</span> <span class="kp">solver</span><span class="o">=</span><span class="kr">UMFPACK</span><span class="p">);</span>
<span class="kt">matrix</span> <span class="n">AU</span> <span class="o">=</span> <span class="n">vu</span><span class="p">(</span><span class="n">Xh</span><span class="p">,</span> <span class="n">Xh</span><span class="p">,</span> <span class="kp">solver</span><span class="o">=</span><span class="kr">UMFPACK</span><span class="p">);</span>
<span class="kt">matrix</span> <span class="kp">B1</span> <span class="o">=</span> <span class="n">vu1</span><span class="p">(</span><span class="n">Mh</span><span class="p">,</span> <span class="n">Xh</span><span class="p">);</span>
<span class="kt">matrix</span> <span class="n">B2</span> <span class="o">=</span> <span class="n">vu2</span><span class="p">(</span><span class="n">Mh</span><span class="p">,</span> <span class="n">Xh</span><span class="p">);</span>

<span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">brhs1</span> <span class="o">=</span> <span class="n">vonu1</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Xh</span><span class="p">);</span>
<span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">brhs2</span> <span class="o">=</span> <span class="n">vonu2</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Xh</span><span class="p">);</span>

<span class="kt">varf</span> <span class="nf">vrhs1</span><span class="p">(</span><span class="n">uu</span><span class="p">,</span> <span class="n">vv</span><span class="p">)</span> <span class="o">=</span> <span class="nf">int2d</span><span class="p">(</span><span class="n">Th</span><span class="p">)(</span><span class="nf">convect</span><span class="p">([</span><span class="n">u1</span><span class="p">,</span> <span class="n">u2</span><span class="p">],</span> <span class="o">-</span><span class="n">dt</span><span class="p">,</span> <span class="n">u1</span><span class="p">)</span><span class="o">*</span><span class="n">vv</span><span class="o">*</span><span class="n">alpha</span><span class="p">)</span> <span class="o">+</span> <span class="n">vonu1</span><span class="p">;</span>
<span class="kt">varf</span> <span class="nf">vrhs2</span><span class="p">(</span><span class="n">v2</span><span class="p">,</span> <span class="n">v1</span><span class="p">)</span> <span class="o">=</span> <span class="nf">int2d</span><span class="p">(</span><span class="n">Th</span><span class="p">)(</span><span class="nf">convect</span><span class="p">([</span><span class="n">u1</span><span class="p">,</span> <span class="n">u2</span><span class="p">],</span> <span class="o">-</span><span class="n">dt</span><span class="p">,</span> <span class="n">u2</span><span class="p">)</span><span class="o">*</span><span class="n">v1</span><span class="o">*</span><span class="n">alpha</span><span class="p">)</span> <span class="o">+</span> <span class="n">vonu2</span><span class="p">;</span>

<span class="c1">// Uzawa function</span>
<span class="kt">func</span> <span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">JUzawa</span> <span class="p">(</span><span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">pp</span><span class="p">){</span>
    <span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">b1</span> <span class="o">=</span> <span class="n">brhs1</span><span class="p">;</span> <span class="n">b1</span> <span class="o">+=</span> <span class="kp">B1</span><span class="o">*</span><span class="n">pp</span><span class="p">;</span>
    <span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">b2</span> <span class="o">=</span> <span class="n">brhs2</span><span class="p">;</span> <span class="n">b2</span> <span class="o">+=</span> <span class="n">B2</span><span class="o">*</span><span class="n">pp</span><span class="p">;</span>
    <span class="n">u1</span><span class="p">[]</span> <span class="o">=</span> <span class="n">AU</span><span class="o">^-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">b1</span><span class="p">;</span>
    <span class="n">u2</span><span class="p">[]</span> <span class="o">=</span> <span class="n">AU</span><span class="o">^-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">b2</span><span class="p">;</span>
    <span class="n">pp</span> <span class="o">=</span> <span class="kp">B1</span><span class="o">&#39;*</span><span class="n">u1</span><span class="p">[];</span>
    <span class="n">pp</span> <span class="o">+=</span> <span class="n">B2</span><span class="o">&#39;*</span><span class="n">u2</span><span class="p">[];</span>
    <span class="n">pp</span> <span class="o">=</span> <span class="o">-</span><span class="n">pp</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">pp</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Preconditioner function</span>
<span class="kt">func</span> <span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">Precon</span> <span class="p">(</span><span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">p</span><span class="p">){</span>
    <span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">pa</span> <span class="o">=</span> <span class="n">pAA</span><span class="o">^-</span><span class="mi">1</span><span class="o">*</span><span class="n">p</span><span class="p">;</span>
    <span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">pm</span> <span class="o">=</span> <span class="n">pAM</span><span class="o">^-</span><span class="mi">1</span><span class="o">*</span><span class="n">p</span><span class="p">;</span>
    <span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">pp</span> <span class="o">=</span> <span class="n">alpha</span><span class="o">*</span><span class="n">pa</span> <span class="o">+</span> <span class="n">nu</span><span class="o">*</span><span class="n">pm</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">pp</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Initialization</span>
<span class="n">p</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="c1">// Time loop</span>
<span class="kt">int</span> <span class="n">ndt</span> <span class="o">=</span> <span class="n">T</span><span class="o">/</span><span class="n">dt</span><span class="p">;</span>
<span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ndt</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">){</span>
    <span class="c1">// Update</span>
    <span class="n">brhs1</span> <span class="o">=</span> <span class="n">vrhs1</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Xh</span><span class="p">);</span>
    <span class="n">brhs2</span> <span class="o">=</span> <span class="n">vrhs2</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Xh</span><span class="p">);</span>

    <span class="c1">// Solve</span>
    <span class="kt">int</span> <span class="n">res</span> <span class="o">=</span> <span class="nf">LinearCG</span><span class="p">(</span><span class="n">JUzawa</span><span class="p">,</span> <span class="n">p</span><span class="p">[],</span> <span class="kp">precon</span><span class="o">=</span><span class="n">Precon</span><span class="p">,</span> <span class="kp">nbiter</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="kr">verbosity</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="kp">veps</span><span class="o">=</span><span class="kp">eps</span><span class="p">);</span>
    <span class="nf">assert</span><span class="p">(</span><span class="n">res</span><span class="o">==</span><span class="mi">1</span><span class="p">);</span>
    <span class="kp">eps</span> <span class="o">=</span> <span class="o">-</span><span class="nf">abs</span><span class="p">(</span><span class="kp">eps</span><span class="p">);</span>

    <span class="c1">// Vorticity</span>
    <span class="n">w</span> <span class="o">=</span> <span class="o">-</span><span class="nf">dy</span><span class="p">(</span><span class="n">u1</span><span class="p">)</span> <span class="o">+</span> <span class="nf">dx</span><span class="p">(</span><span class="n">u2</span><span class="p">);</span>
    <span class="nf">plot</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="kp">fill</span><span class="o">=</span><span class="kr">true</span><span class="p">,</span> <span class="kp">wait</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="kp">nbiso</span><span class="o">=</span><span class="mi">40</span><span class="p">);</span>

    <span class="c1">// Update</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="kr">min</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span> <span class="n">T</span><span class="o">-</span><span class="kp">t</span><span class="p">);</span>
    <span class="kp">t</span> <span class="o">+=</span> <span class="n">dt</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">dt</span> <span class="o">&lt;</span> <span class="mf">1e-10</span><span class="o">*</span><span class="n">T</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Plot</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="kp">fill</span><span class="o">=</span><span class="kr">true</span><span class="p">,</span> <span class="kp">nbiso</span><span class="o">=</span><span class="mi">40</span><span class="p">);</span>

<span class="c1">// Display</span>
<span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;u1 max = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">u1</span><span class="p">[].</span><span class="kr">linfty</span>
     <span class="o">&lt;&lt;</span> <span class="s">&quot;, u2 max = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">u2</span><span class="p">[].</span><span class="kr">linfty</span>
     <span class="o">&lt;&lt;</span> <span class="s">&quot;, p max = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">p</span><span class="p">[].</span><span class="kr">max</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<div class="admonition warning">
<p class="admonition-title">Stop test of the conjugate gradient</p>
<p>Because we start from the previous solution and the end the previous solution is close to the final solution, don't take a relative stop test to the first residual, take an absolute stop test (negative here).</p>
</div>
<table>
<thead>
<tr>
<th align="center"><a name="Fig24">Fig. 24</a>: The vorticity at Reynolds number 100 a time 2s with the Cahouet-Chabart method.</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="NSCahouetChabart" src="../images/NavierStokesEquations.png" /></td>
</tr>
</tbody>
</table>
</div>
<h2 id="references">References<a class="headerlink" href="#references" title="Permanent link">#</a></h2>
<p><a name="TEMAM1977">[TEMAM1977]</a> TEMAM, Roger. Navier-Stokes equations: theory and numerical analysis. 1977.</p>
<p><a name="ROBERTS1993">[ROBERTS1993]</a> ROBERTS, J. E. et THOMAS, J. M. Mixed and Hybrid Methods, Handbook of Numerical Anaysis, Vol. II. North-Holland, 1993, vol. 183, p. 184.</p>
<p><a name"GLOWINSKI1979">[GLOWINSKI1979]</a> GLOWINSKI, R. et PIRONNEAU, O. On numerical methods for the Stokes problem. In: Energy methods in finite element analysis.(A79-53076 24-39) Chichester, Sussex, England, Wiley-Interscience, 1979, p. 243-264., 1979, p. 243-264.</p>
<p><a name="GLOWINSKI1985">[GLOWINSKI1985]</a> GLOWINSKI, Roland et ODEN, J. Tinsley. Numerical methods for nonlinear variational problems. Journal of Applied Mechanics, 1985, vol. 52, p. 739.</p>
<p><a name="GLOWINSKI2003">[GLOWINSKI2003]</a> GLOWINSKI, Roland. Finite element methods for incompressible viscous flow. Handbook of numerical analysis, 2003, vol. 9, p. 3-1176.</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../EvolutionProblems/" title="Evolution problems" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Evolution problems
              </span>
            </div>
          </a>
        
        
          <a href="../VariationalInequality/" title="Variational inequality" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Variational inequality
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../assets/fonts/font-awesome.css">
    
      <a href="https://github.com/FreeFem/FreeFem-doc" class="md-footer-social__link fa fa-github"></a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.b806dc00.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_CHTML"></script>
      
        <script src="../../mathjax-config.js"></script>
      
    
  </body>
</html>