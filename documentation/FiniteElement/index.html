



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-3.1.0">
    
    
      
        <title>Finite Element - FreeFem++</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.11e41852.css">
      
      
    
    
      <script src="../../assets/javascripts/modernizr.20ef595d.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#use-of-fespace-in-2d" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="FreeFem++" class="md-header-nav__button md-logo">
          
            <img src="../../images/favicon.png" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                FreeFem++
              </span>
              <span class="md-header-nav__topic">
                Finite Element
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/FreeFem/FreeFem-doc/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      FreeFem++ on Github
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../.." title="Introduction" class="md-tabs__link">
          Introduction
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../" title="Documentation" class="md-tabs__link md-tabs__link--active">
          Documentation
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../reference/" title="Language References" class="md-tabs__link">
          Language References
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../tutorials/" title="Tutorials" class="md-tabs__link">
          Tutorials
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../examples/" title="Examples" class="md-tabs__link">
          Examples
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../models/" title="Models" class="md-tabs__link">
          Models
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../.." title="FreeFem++" class="md-nav__button md-logo">
      
        <img src="../../images/favicon.png" width="48" height="48">
      
    </a>
    FreeFem++
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/FreeFem/FreeFem-doc/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      FreeFem++ on Github
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1">
    
    <label class="md-nav__link" for="nav-1">
      Introduction
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        Introduction
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../.." title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../introduction/download/" title="Download" class="md-nav__link">
      Download
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../introduction/installation/" title="Installation" class="md-nav__link">
      Installation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../introduction/contributing/" title="How to contribute?" class="md-nav__link">
      How to contribute?
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../introduction/citation/" title="Citation" class="md-nav__link">
      Citation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../introduction/authors/" title="Authors" class="md-nav__link">
      Authors
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../introduction/TODO/" title="TODO" class="md-nav__link">
      TODO
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      Documentation
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Documentation
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../" title="Home" class="md-nav__link">
      Home
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Notations/" title="Some Notations" class="md-nav__link">
      Some Notations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../MeshGeneration/" title="Mesh Generation" class="md-nav__link">
      Mesh Generation
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Finite Element
      </label>
    
    <a href="./" title="Finite Element" class="md-nav__link md-nav__link--active">
      Finite Element
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#use-of-fespace-in-2d" title="Use of fespace in 2D" class="md-nav__link">
    Use of fespace in 2D
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#use-of-fespace-in-3d" title="Use of fespace in 3D" class="md-nav__link">
    Use of fespace in 3D
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lagrangian-finite-elements" title="Lagrangian Finite Elements" class="md-nav__link">
    Lagrangian Finite Elements
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#p0-element" title="P0-element" class="md-nav__link">
    P0-element
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#p1-element" title="P1-element" class="md-nav__link">
    P1-element
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#p2-element" title="P2-element" class="md-nav__link">
    P2-element
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#p1-nonconforming-element" title="P1 Nonconforming Element" class="md-nav__link">
    P1 Nonconforming Element
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#other-fe-space" title="Other FE-space" class="md-nav__link">
    Other FE-space
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vector-valued-fe-function" title="Vector Valued FE-function" class="md-nav__link">
    Vector Valued FE-function
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#raviart-thomas-element" title="Raviart-Thomas Element" class="md-nav__link">
    Raviart-Thomas Element
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a-fast-finite-element-interpolator" title="A Fast Finite Element Interpolator" class="md-nav__link">
    A Fast Finite Element Interpolator
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#keywords-problem-and-solve" title="Keywords: Problem and Solve" class="md-nav__link">
    Keywords: Problem and Solve
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#weak-form-and-boundary-condition" title="Weak Form and Boundary Condition" class="md-nav__link">
    Weak Form and Boundary Condition
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#parameters-affecting-solve-and-problem" title="Parameters affecting solve and problem" class="md-nav__link">
    Parameters affecting solve and problem
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#problem-definition" title="Problem definition" class="md-nav__link">
    Problem definition
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerical-integration" title="Numerical Integration" class="md-nav__link">
    Numerical Integration
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#variational-form-sparse-matrix-pde-data-vector" title="Variational Form, Sparse Matrix, PDE Data Vector" class="md-nav__link">
    Variational Form, Sparse Matrix, PDE Data Vector
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#interpolation-matrix" title="Interpolation matrix" class="md-nav__link">
    Interpolation matrix
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#finite-elements-connectivity" title="Finite elements connectivity" class="md-nav__link">
    Finite elements connectivity
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" title="References" class="md-nav__link">
    References
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Visualization/" title="Visualization" class="md-nav__link">
      Visualization
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../AlgorithmsOptimization/" title="Algorithms & Optimization" class="md-nav__link">
      Algorithms & Optimization
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Parallelization/" title="Parallelization" class="md-nav__link">
      Parallelization
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Plugins/" title="Plugins" class="md-nav__link">
      Plugins
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Developers/" title="Developers" class="md-nav__link">
      Developers
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../TODO/" title="TODO" class="md-nav__link">
      TODO
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Language References
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Language References
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/" title="Home" class="md-nav__link">
      Home
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/Types/" title="Types" class="md-nav__link">
      Types
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/GlobalVariables/" title="Global variables" class="md-nav__link">
      Global variables
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/QuadratureFormulae/" title="Quadrature formulae" class="md-nav__link">
      Quadrature formulae
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/Operators/" title="Operators" class="md-nav__link">
      Operators
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/Loops/" title="Loops" class="md-nav__link">
      Loops
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/IO/" title="I/O" class="md-nav__link">
      I/O
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/Functions/" title="Functions" class="md-nav__link">
      Functions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/ExternalLibraries/" title="External libraries" class="md-nav__link">
      External libraries
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/TODO/" title="TODO" class="md-nav__link">
      TODO
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Tutorials
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Tutorials
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/" title="Getting started" class="md-nav__link">
      Getting started
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/Poisson/" title="Poisson's equation" class="md-nav__link">
      Poisson's equation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/EquationsClassification/" title="Classification of the equations" class="md-nav__link">
      Classification of the equations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/Membrane/" title="Membrane" class="md-nav__link">
      Membrane
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/HeatExchanger/" title="Heat Exchanger" class="md-nav__link">
      Heat Exchanger
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/Acoustics/" title="Acoustics" class="md-nav__link">
      Acoustics
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/ThermalConduction/" title="Thermal Conduction" class="md-nav__link">
      Thermal Conduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/FanBlade/" title="Irrotational Fan Blade Flow and Thermal effects" class="md-nav__link">
      Irrotational Fan Blade Flow and Thermal effects
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/RotatingHill/" title="Pure convection, The rotating hill" class="md-nav__link">
      Pure convection, The rotating hill
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/Elasticity/" title="The system of elasticity" class="md-nav__link">
      The system of elasticity
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/Stokes/" title="The system of Stokes for fluids" class="md-nav__link">
      The system of Stokes for fluids
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/NavierStokesProjection/" title="A projection Algorithm for the Navier-Stokes equations" class="md-nav__link">
      A projection Algorithm for the Navier-Stokes equations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/NavierStokesNewton/" title="Newton method for the steady Navier-Stokes equations" class="md-nav__link">
      Newton method for the steady Navier-Stokes equations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/ALargeFluidProblem/" title="A large fluid problem" class="md-nav__link">
      A large fluid problem
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/ComplexNumbers/" title="An example with complex numbers" class="md-nav__link">
      An example with complex numbers
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/OptimalControl/" title="Optimal control" class="md-nav__link">
      Optimal control
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/FlowWithShocks/" title="A flow with shocks" class="md-nav__link">
      A flow with shocks
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/HeatEquationOptimization/" title="Time dependent schema optimization for heat equations" class="md-nav__link">
      Time dependent schema optimization for heat equations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/TimeDependentStokes/" title="A transient Stokes solver in matrix form" class="md-nav__link">
      A transient Stokes solver in matrix form
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/WifiPropagation/" title="Wifi Propagation" class="md-nav__link">
      Wifi Propagation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/MatlabOctavePlot/" title="Matlab / Octave Plots" class="md-nav__link">
      Matlab / Octave Plots
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/TODO/" title="TODO" class="md-nav__link">
      TODO
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Examples
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Examples
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../examples/" title="Home" class="md-nav__link">
      Home
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../examples/TODO/" title="TODO" class="md-nav__link">
      TODO
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Models
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Models
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../models/" title="Home" class="md-nav__link">
      Home
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../models/StaticProblems/" title="Static problems" class="md-nav__link">
      Static problems
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../models/Elasticity/" title="Elasticity" class="md-nav__link">
      Elasticity
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../models/NonLinearStaticProblems/" title="Non-linear static problems" class="md-nav__link">
      Non-linear static problems
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../models/EigenValueProblems/" title="Eigenvalue problems" class="md-nav__link">
      Eigenvalue problems
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../models/EvolutionProblems/" title="Evolution problems" class="md-nav__link">
      Evolution problems
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../models/NavierStokesEquations/" title="Navier-Stokes equations" class="md-nav__link">
      Navier-Stokes equations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../models/VariationalInequality/" title="Variational inequality" class="md-nav__link">
      Variational inequality
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../models/DomainDecomposition/" title="Domain decomposition" class="md-nav__link">
      Domain decomposition
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../models/FluidStructureCoupledProblem/" title="Fluid-Structure coupled problem" class="md-nav__link">
      Fluid-Structure coupled problem
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../models/TransmissionProblem/" title="Transmission problem" class="md-nav__link">
      Transmission problem
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../models/FreeBoundaryProblem/" title="Free boundary problem" class="md-nav__link">
      Free boundary problem
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../models/NonLinearElasticity/" title="Non-linear elasticity" class="md-nav__link">
      Non-linear elasticity
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../models/CompressibleNeoHookeanMaterials/" title="Compressible Neo-Hookean materials" class="md-nav__link">
      Compressible Neo-Hookean materials
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../models/WhisperingGalleryModes/" title="Whispering gallery modes" class="md-nav__link">
      Whispering gallery modes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../models/TODO/" title="TODO" class="md-nav__link">
      TODO
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#use-of-fespace-in-2d" title="Use of fespace in 2D" class="md-nav__link">
    Use of fespace in 2D
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#use-of-fespace-in-3d" title="Use of fespace in 3D" class="md-nav__link">
    Use of fespace in 3D
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lagrangian-finite-elements" title="Lagrangian Finite Elements" class="md-nav__link">
    Lagrangian Finite Elements
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#p0-element" title="P0-element" class="md-nav__link">
    P0-element
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#p1-element" title="P1-element" class="md-nav__link">
    P1-element
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#p2-element" title="P2-element" class="md-nav__link">
    P2-element
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#p1-nonconforming-element" title="P1 Nonconforming Element" class="md-nav__link">
    P1 Nonconforming Element
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#other-fe-space" title="Other FE-space" class="md-nav__link">
    Other FE-space
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vector-valued-fe-function" title="Vector Valued FE-function" class="md-nav__link">
    Vector Valued FE-function
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#raviart-thomas-element" title="Raviart-Thomas Element" class="md-nav__link">
    Raviart-Thomas Element
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a-fast-finite-element-interpolator" title="A Fast Finite Element Interpolator" class="md-nav__link">
    A Fast Finite Element Interpolator
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#keywords-problem-and-solve" title="Keywords: Problem and Solve" class="md-nav__link">
    Keywords: Problem and Solve
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#weak-form-and-boundary-condition" title="Weak Form and Boundary Condition" class="md-nav__link">
    Weak Form and Boundary Condition
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#parameters-affecting-solve-and-problem" title="Parameters affecting solve and problem" class="md-nav__link">
    Parameters affecting solve and problem
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#problem-definition" title="Problem definition" class="md-nav__link">
    Problem definition
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerical-integration" title="Numerical Integration" class="md-nav__link">
    Numerical Integration
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#variational-form-sparse-matrix-pde-data-vector" title="Variational Form, Sparse Matrix, PDE Data Vector" class="md-nav__link">
    Variational Form, Sparse Matrix, PDE Data Vector
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#interpolation-matrix" title="Interpolation matrix" class="md-nav__link">
    Interpolation matrix
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#finite-elements-connectivity" title="Finite elements connectivity" class="md-nav__link">
    Finite elements connectivity
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" title="References" class="md-nav__link">
    References
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/FreeFem/FreeFem-doc/edit/master/docs/documentation/FiniteElement.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                  <h1>Finite Element</h1>
                
                <div>
<div class="MathJax_Preview">
\newcommand{\vecttwo}[2]{\left|\begin{array}{c}{#1}\\#2\end{array}\right.}
\newcommand{\vectthree}[3]{\left|\begin{array}{c}{#1}\\#2\\#3\end{array}\right.}
</div>
<script type="math/tex; mode=display">
\newcommand{\vecttwo}[2]{\left|\begin{array}{c}{#1}\\#2\end{array}\right.}
\newcommand{\vectthree}[3]{\left|\begin{array}{c}{#1}\\#2\\#3\end{array}\right.}
</script>
</div>
<p>As stated in <a href="../tutorials">tutorials</a>, FEM approximates all functions <span><span class="MathJax_Preview">w</span><script type="math/tex">w</script></span> as
<script type="math/tex; mode=display">
w(x,y)\simeq w_0\phi_0(x,y)+w_1\phi_1(x,y)+\cdots+w_{M-1}\phi_{M-1}(x,y)
</script>
with finite element basis functions <span><span class="MathJax_Preview">\phi_k(x,y)</span><script type="math/tex">\phi_k(x,y)</script></span> and numbers <span><span class="MathJax_Preview">w_k</span><script type="math/tex">w_k</script></span> (<span><span class="MathJax_Preview">k=0,\cdots,M-1</span><script type="math/tex">k=0,\cdots,M-1</script></span>). The functions <span><span class="MathJax_Preview">\phi_k(x,y)</span><script type="math/tex">\phi_k(x,y)</script></span> are constructed from the triangle <span><span class="MathJax_Preview">T_{i_k}</span><script type="math/tex">T_{i_k}</script></span>, and called <em>shape functions</em>.</p>
<p>In FreeFem++ the finite element space
<script type="math/tex; mode=display">
V_h=\left\{w\left|\; w_0\phi_0+w_1\phi_1+\cdots+w_{M-1}\phi_{M-1},\, w_i\in \R\right.\right\}
</script>
is easily created by :</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>fespace IDspace(IDmesh,&lt;IDFE&gt;);
</pre></div>
</td></tr></table>

<p>or with <span><span class="MathJax_Preview">\ell</span><script type="math/tex">\ell</script></span> pairs of periodic boundary conditions in 2D :</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>fespace IDspace(IDmesh,&lt;IDFE&gt;,
    periodic=[[la1, sa1], [lb1, sb1],
              ...
              [lak, sak], [lbk, sbl]]);
</pre></div>
</td></tr></table>

<p>and in 3D :</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>fespace IDspace(IDmesh,&lt;IDFE&gt;,
    periodic=[[la1, sa1, ta1], [lb1, sb1, tb1],
              ...
              [lak, sak, tak], [lbk, sbl, tbl]]);
</pre></div>
</td></tr></table>

<p>where <code class="codehilite">IDspace</code> is the name of the space (e.g. <code class="codehilite">Vh</code>), <code class="codehilite">IDmesh</code> is the name of the associated mesh and <code class="codehilite">&lt;IDFE&gt;</code> is an identifier of finite element type.</p>
<p>In 2D we have a pair of periodic boundary conditions, if <span><span class="MathJax_Preview">[la_i, sa_i]</span><script type="math/tex">[la_i, sa_i]</script></span>, <span><span class="MathJax_Preview">[lb_i, sb_i]</span><script type="math/tex">[lb_i, sb_i]</script></span> is a pair of <code class="codehilite">int</code>, and the 2 labels <span><span class="MathJax_Preview">la_i</span><script type="math/tex">la_i</script></span> and <span><span class="MathJax_Preview">lb_i</span><script type="math/tex">lb_i</script></span> refer to 2 pieces of boundary to be in equivalence. If <span><span class="MathJax_Preview">[la_i, sa_i]</span><script type="math/tex">[la_i, sa_i]</script></span>, <span><span class="MathJax_Preview">[lb_i, sb_i]</span><script type="math/tex">[lb_i, sb_i]</script></span> is a pair of <code class="codehilite">real</code>, then <span><span class="MathJax_Preview">sa_i</span><script type="math/tex">sa_i</script></span> and <span><span class="MathJax_Preview">sb_i</span><script type="math/tex">sb_i</script></span> give two common abscissa on the two boundary curves, and two points are identified as one if the two abscissa are equal.</p>
<p>In 2D, we have a pair of periodic boundary conditions, if <span><span class="MathJax_Preview">[la_i, sa_i, ta_i]</span><script type="math/tex">[la_i, sa_i, ta_i]</script></span>, <span><span class="MathJax_Preview">[lb_i, sb_i, tb_i]</span><script type="math/tex">[lb_i, sb_i, tb_i]</script></span> is a pair of <code class="codehilite">int</code>, the 2 labels <span><span class="MathJax_Preview">la_i</span><script type="math/tex">la_i</script></span> and <span><span class="MathJax_Preview">lb_i</span><script type="math/tex">lb_i</script></span> define the 2 pieces of boundary to be in equivalence. If <span><span class="MathJax_Preview">[la_i, sa_i, ta_i]</span><script type="math/tex">[la_i, sa_i, ta_i]</script></span>, <span><span class="MathJax_Preview">[lb_i, sb_i, tb_i]</span><script type="math/tex">[lb_i, sb_i, tb_i]</script></span> is a pair of <code class="codehilite">real</code>, then <span><span class="MathJax_Preview">sa_i</span><script type="math/tex">sa_i</script></span>, <span><span class="MathJax_Preview">ta_i</span><script type="math/tex">ta_i</script></span> and <span><span class="MathJax_Preview">sb_i</span><script type="math/tex">sb_i</script></span>, <span><span class="MathJax_Preview">tb_i</span><script type="math/tex">tb_i</script></span> give two common parameters on the two boundary surfaces, and two points are identified as one if the two parameters are equal.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The 2D mesh of the two identified borders must be the same, so to be sure, use the parameter <code class="codehilite">fixedborder=true</code> in <code class="codehilite">buildmesh</code> command (see <a href="MeshGeneration/#border"><code class="codehilite">fixedborder</code></a>).
<!-- like in example <code class="codehilite">wzxhzdk:480</code> (see \ref{exm:periodic4bis}). --></p>
</div>
<p>As of today, the known types of finite elements are:</p>
<ul>
<li>
<p><code class="codehilite">[P0, P03d]</code> piecewise constant discontinuous finite element (2d, 3d), the degrees of freedom are the barycenter element value.
    <script type="math/tex; mode=display">\begin{equation*}
        \label{eq:P0}
        \P^0_{h} = \left\{ v \in L^2(\Omega) \left|\; \textrm{for all }K \in \mathcal{T}_{h}\;\;\textrm{there is }\alpha_{K}\in \R : \;\; v_{|K} = \alpha_{K } \right.\right\}
    \end{equation*}</script>
</p>
</li>
<li>
<p><code class="codehilite">[P1, P13d]</code> piecewise linear continuous finite element (2d, 3d), the degrees of freedom are the vertices values.
    <script type="math/tex; mode=display">\begin{equation*}
        \label{eq:P1}
        \P^1_{h} = \left\{ v \in H^{1}(\Omega) \left|\; \forall K \in \mathcal{T}_{h},\ v_{|K} \in P_{1} \right.\right\}
    \end{equation*}</script>
</p>
</li>
<li>
<p><code class="codehilite">[P1dc]</code> piecewise linear discontinuous finite element
    <script type="math/tex; mode=display">\begin{equation*}
        \label{eq:P1dc}
        \P^1_{dc|h} = \left\{ v \in L^{2}(\Omega) \left|\; \forall K \in \mathcal{T}_{h}, \ v_{|K} \in P_{1} \right.\right\}
    \end{equation*}</script>
</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Due to an interpolation problem, the degree of freedom is not the vertices but three vertices which move inside <span><span class="MathJax_Preview">T(X)= G + .99 (X-G)</span><script type="math/tex">T(X)= G + .99 (X-G)</script></span> where <span><span class="MathJax_Preview">G</span><script type="math/tex">G</script></span> is the barycenter.</p>
</div>
</li>
<li>
<p><code class="codehilite">[P1b, P1b3d]</code> piecewise linear continuous finite element plus bubble (2d, 3d)</p>
<p><strong>The 2D Case:</strong>
<script type="math/tex; mode=display">\begin{equation*}
    \label{eq:P1b}
    \P^1_{b|h} = \left\{ v \in H^{1}(\Omega) \left|\; \forall K \in \mathcal{T}_{h}, \ v_{|K} \in P_{1} \oplus \mathrm{Span}\{ \lambda^{K}_{0} \lambda^{K}_{1} \lambda^{K}_{2} \} \right.\right\}
\end{equation*}</script>
</p>
<p><strong>The 3D Case:</strong>
<script type="math/tex; mode=display">\begin{equation*}
    \label{eq:P1b-3d}
    \P^1_{b|h} = \left\{ v \in H^{1}(\Omega) \left|\; \forall K \in \mathcal{T}_{h}, \ v_{|K} \in P_{1} \oplus \mathrm{Span}\{ \lambda^{K}_{0} \lambda^{K}_{1} \lambda^{K}_{2} \lambda^{K}_{3} \} \right.\right\}
\end{equation*}</script>
where <span><span class="MathJax_Preview">\lambda^{K}_{i}, i=0,..,d</span><script type="math/tex">\lambda^{K}_{i}, i=0,..,d</script></span> are the <span><span class="MathJax_Preview">d+1</span><script type="math/tex">d+1</script></span> barycentric coordinate functions of the element <span><span class="MathJax_Preview">K</span><script type="math/tex">K</script></span> (triangle or tetrahedron).</p>
</li>
<li>
<p><code class="codehilite">P1bl,P1bl3d</code> piecewise linear continuous finite element plus linear bubble (2d, 3d). The bubble is built by splitting the <span><span class="MathJax_Preview">K</span><script type="math/tex">K</script></span>, a barycenter in <span><span class="MathJax_Preview">d+1</span><script type="math/tex">d+1</script></span> sub element. (need <code class="codehilite">load &quot;Element_P1bl&quot;</code>)</p>
</li>
<li>
<p><code class="codehilite">[P2, P23d]</code> piecewise <span><span class="MathJax_Preview">P_{2}</span><script type="math/tex">P_{2}</script></span> continuous finite element (2d, 3d)
    <script type="math/tex; mode=display">\begin{equation*}
        \P^2_{h} = \left\{ v \in H^{1}(\Omega) \left|\; \forall K \in \mathcal{T}_{h}, \ v_{|K} \in P_{2} \right.\right\}
    \end{equation*}</script>
    where <span><span class="MathJax_Preview">P_{2}</span><script type="math/tex">P_{2}</script></span> is the set of polynomials of <span><span class="MathJax_Preview">\R^{2}</span><script type="math/tex">\R^{2}</script></span> of degrees <span><span class="MathJax_Preview">\le 2</span><script type="math/tex">\le 2</script></span>.</p>
</li>
<li>
<p><code class="codehilite">[P2b]</code> piecewise $P_{2} $ continuous finite element plus bubble
    <script type="math/tex; mode=display">\begin{equation*}
        \P^2_{h} = \left\{ v \in H^{1}(\Omega) \left|\; \forall K \in \mathcal{T}_{h}, \ v_{|K} \in P_{2} \oplus \mathrm{Span}\{ \lambda^{K}_{0} \lambda^{K}_{1} \lambda^{K}_{2} \} \right.\right\}
    \end{equation*}</script>
</p>
</li>
<li>
<p><code class="codehilite">[P2dc]</code> piecewise <span><span class="MathJax_Preview">P_{2}</span><script type="math/tex">P_{2}</script></span> discontinuous finite element
    <script type="math/tex; mode=display">\begin{equation*}
        \P^2_{dc|h} = \left\{ v \in L^{2}(\Omega) \left|\; \forall K \in \mathcal{T}_{h}, \ v_{|K} \in P_{2} \right.\right\}
    \end{equation*}</script>
</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Due to an interpolation problem, the degree of freedom is not the six P2 nodes but six nodes which move inside $T(X)= G + .99 (X-G) $ where <span><span class="MathJax_Preview">G</span><script type="math/tex">G</script></span> is the barycenter.</p>
</div>
</li>
<li>
<p><code class="codehilite">[P2h]</code> quadratic homogeneous continuous (without <code class="codehilite">P1</code>).</p>
</li>
<li>
<p><code class="codehilite">[P3]</code> piecewise <span><span class="MathJax_Preview">P_{3}</span><script type="math/tex">P_{3}</script></span> continuous finite element (2d) (needs <code class="codehilite">load &quot;Element_P3&quot;</code>)
    <script type="math/tex; mode=display">\begin{equation*}
        \P^3_{h} = \left\{ v \in H^{1}(\Omega) \left|\; \forall K \in \mathcal{T}_{h}, \ v_{|K} \in P_{3} \right.\right\}
    \end{equation*}</script>
    where <span><span class="MathJax_Preview">P_{3}</span><script type="math/tex">P_{3}</script></span> is the set of polynomials of <span><span class="MathJax_Preview">\R^{2}</span><script type="math/tex">\R^{2}</script></span> of degrees <span><span class="MathJax_Preview">\le 3</span><script type="math/tex">\le 3</script></span>.</p>
</li>
<li>
<p><code class="codehilite">[P3dc]</code> piecewise <span><span class="MathJax_Preview">P_{3}</span><script type="math/tex">P_{3}</script></span> discontinuous finite element (2d) (needs <code class="codehilite">load &quot;Element_P3dc&quot;</code>)
    <script type="math/tex; mode=display">\begin{equation*}
        \P^3_{dc|h} = \left\{ v \in L^2(\Omega) \left|\; \forall K \in \mathcal{T}_{h}, \ v_{|K} \in P_{3} \right.\right\}
    \end{equation*}</script>
    where <span><span class="MathJax_Preview">P_{3}</span><script type="math/tex">P_{3}</script></span> is the set of polynomials of <span><span class="MathJax_Preview">\R^{2}</span><script type="math/tex">\R^{2}</script></span> of degrees <span><span class="MathJax_Preview">\le 3</span><script type="math/tex">\le 3</script></span>.</p>
</li>
<li>
<p><code class="codehilite">[P4]</code> piecewise <span><span class="MathJax_Preview">P_{4}</span><script type="math/tex">P_{4}</script></span> continuous finite element (2d) (needs <code class="codehilite">load &quot;Element_P4&quot;</code>)
    <script type="math/tex; mode=display">\begin{equation*}
        \P^4_{h} = \left\{ v \in H^{1}(\Omega) \left|\; \forall K \in \mathcal{T}_{h},\ v_{|K} \in P_{4} \right.\right\}
    \end{equation*}</script>
    where <span><span class="MathJax_Preview">P_{4}</span><script type="math/tex">P_{4}</script></span> is the set of polynomials of <span><span class="MathJax_Preview">\R^{2}</span><script type="math/tex">\R^{2}</script></span> of degrees <span><span class="MathJax_Preview">\le 4</span><script type="math/tex">\le 4</script></span>.</p>
</li>
<li>
<p><code class="codehilite">[P4dc]</code> piecewise <span><span class="MathJax_Preview">P_{4}</span><script type="math/tex">P_{4}</script></span> discontinuous finite element (2d) (needs <code class="codehilite">load &quot;Element_P4dc&quot;</code>)
    <script type="math/tex; mode=display">\begin{equation*}
        \P^4_{dc|h} = \left\{ v \in L^2(\Omega) \left|\; \forall K \in \mathcal{T}_{h}, \ v_{|K} \in P_{3} \right.\right\}
    \end{equation*}</script>
    where <span><span class="MathJax_Preview">P_{4}</span><script type="math/tex">P_{4}</script></span> is the set of polynomials of <span><span class="MathJax_Preview">\R^{2}</span><script type="math/tex">\R^{2}</script></span> of degrees <span><span class="MathJax_Preview">\le 3</span><script type="math/tex">\le 3</script></span>.</p>
</li>
<li>
<p><code class="codehilite">[P0Edge]</code> piecewise <span><span class="MathJax_Preview">P_{0}</span><script type="math/tex">P_{0}</script></span> discontinuous finite element (2d) contained on each edge of the mesh.</p>
</li>
<li>
<p><code class="codehilite">[P1Edge]</code> piecewise <span><span class="MathJax_Preview">P_{1}</span><script type="math/tex">P_{1}</script></span> discontinuous finite element (2d) (needs <code class="codehilite">load &quot;Element_PkEdge&quot;</code>) <span><span class="MathJax_Preview">P_1</span><script type="math/tex">P_1</script></span> on each edge of the mesh.</p>
</li>
<li>
<p><code class="codehilite">[P2Edge]</code> piecewise <span><span class="MathJax_Preview">P_{2}</span><script type="math/tex">P_{2}</script></span> discontinuous finite element (2d) (needs <code class="codehilite">load &quot;Element_PkEdge&quot;</code>) <span><span class="MathJax_Preview">P_2</span><script type="math/tex">P_2</script></span> on each edge of the mesh.</p>
</li>
<li>
<p><code class="codehilite">[P3Edge]</code> piecewise <span><span class="MathJax_Preview">P_{3}</span><script type="math/tex">P_{3}</script></span> discontinuous finite element (2d) (needs <code class="codehilite">load &quot;Element_PkEdge&quot;</code>) <span><span class="MathJax_Preview">P_3</span><script type="math/tex">P_3</script></span> on each edge of the mesh.</p>
</li>
<li>
<p><code class="codehilite">[P4Edge]</code> piecewise <span><span class="MathJax_Preview">P_{4}</span><script type="math/tex">P_{4}</script></span> discontinuous finite element (2d) (needs <code class="codehilite">load &quot;Element_PkEdge&quot;</code>) <span><span class="MathJax_Preview">P_4</span><script type="math/tex">P_4</script></span> on each edge of the mesh.</p>
</li>
<li>
<p><code class="codehilite">[P5Edge]</code> piecewise <span><span class="MathJax_Preview">P_{5}</span><script type="math/tex">P_{5}</script></span> discontinuous finite element (2d) (needs <code class="codehilite">load &quot;Element_PkEdge&quot;</code>) <span><span class="MathJax_Preview">P_5</span><script type="math/tex">P_5</script></span> on each edge of the mesh.</p>
</li>
<li>
<p><code class="codehilite">[P2Morley]</code> piecewise <span><span class="MathJax_Preview">P_{2}</span><script type="math/tex">P_{2}</script></span> non conform finite element (2d) (needs <code class="codehilite">load &quot;Morley&quot;</code>)
    <script type="math/tex; mode=display">\begin{equation*}
        \P^2_{h} = \left\{ v \in L^2(\Omega) \left|\; \forall K \in \mathcal{T}_{h}, \ v_{|K} \in P_{3},
        \left\{\begin{array}{c}
            v \mbox{ continuous at vertices,}\\
            \p_n{v} \mbox{ continuous at middle of edge,}
        \end{array}\right.
        \right.\right\}
    \end{equation*}</script>
    where
    <span><span class="MathJax_Preview">P_{2}</span><script type="math/tex">P_{2}</script></span> is the set of polynomials of <span><span class="MathJax_Preview">\R^{2}</span><script type="math/tex">\R^{2}</script></span> of degrees <span><span class="MathJax_Preview">\le 2</span><script type="math/tex">\le 2</script></span>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>To build the interplant of a function <span><span class="MathJax_Preview">u</span><script type="math/tex">u</script></span> (scalar) for this finite element, we need the function and 2 partial derivatives <span><span class="MathJax_Preview">(u,u_x, u_y)</span><script type="math/tex">(u,u_x, u_y)</script></span>, creating this vectorial finite element with 3 components <span><span class="MathJax_Preview">(u,u_x,u_y)</span><script type="math/tex">(u,u_x,u_y)</script></span>.</p>
</div>
<p>See our example for solving the BiLaplacien problem:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>load &quot;Morley&quot;

// Parameters
int nn = 10;
real h = 0.01;

real f = 1;

// Mesh
mesh Th = square(nn, nn);
Th = adaptmesh(Th, h, IsMetric=1);

// Fespace
fespace Vh(Th, P2Morley); //The Morley finite element space
Vh [u, ux, uy], [v, vx, vy];

// Macro
macro bilaplacien(u, v) (dxx(u)*dxx(v) + dyy(u)*dyy(v) + 2.*dxy(u)*dxy(v)) //

// Problem
solve bilap ([u, ux, uy], [v, vx, vy])
    = int2d(Th)(
          bilaplacien(u, v)
    )
    - int2d(Th)(
          f*v
    )
    + on(1, 2, 3, 4, u=0, ux=0, uy=0)
    ;

// Plot
plot(u, cmm=&quot;u&quot;);
</pre></div>
</td></tr></table>

</li>
<li>
<p><code class="codehilite">[HCT]</code> <span><span class="MathJax_Preview">P_3</span><script type="math/tex">P_3</script></span> <span><span class="MathJax_Preview">C^1</span><script type="math/tex">C^1</script></span> conforms finite element (2d) (needs <code class="codehilite">load &quot;Element_HCT&quot;</code>) one 3 sub triangles.</p>
<p>Lets call <span><span class="MathJax_Preview">\mathcal{T}^\triangle_{h}</span><script type="math/tex">\mathcal{T}^\triangle_{h}</script></span> the sub mesh of <span><span class="MathJax_Preview">\mathcal{T}_{h}</span><script type="math/tex">\mathcal{T}_{h}</script></span> where all triangles are split in 3 at the barycenter.
<script type="math/tex; mode=display">\begin{equation*}
    \P^{HCT}_{h} = \left\{ v \in C^1(\Omega) \left|\; \forall K \in \mathcal{T}^\triangle_{h}, \ v_{|K} \in P_{3} \right.\right\}
\end{equation*}</script>
where
<span><span class="MathJax_Preview">P_{3}</span><script type="math/tex">P_{3}</script></span> is the set of polynomials of <span><span class="MathJax_Preview">\R^{2}</span><script type="math/tex">\R^{2}</script></span> of degrees <span><span class="MathJax_Preview">\le 3</span><script type="math/tex">\le 3</script></span>. The degrees of freedom are the values of the normal derivative at the mid-point of each edge <a href="#BERNADOU1980">BERNADOU1980</a>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>To build the interplant of a function <span><span class="MathJax_Preview">u</span><script type="math/tex">u</script></span> (scalar) for this finite element, we need the function and 2 partial derivatives <span><span class="MathJax_Preview">(u,u_x, u_y)</span><script type="math/tex">(u,u_x, u_y)</script></span>, creating this vectorial finite element with 3 components <span><span class="MathJax_Preview">(u,u_x,u_y)</span><script type="math/tex">(u,u_x,u_y)</script></span> like in previous Finite Element.</p>
</div>
</li>
<li>
<p><code class="codehilite">[P2BR]</code> (needs <code class="codehilite">load &quot;BernadiRaugel&quot;</code>) the Bernadi Raugel Finite Element is a Vectorial element (2d) with 2 components, see <a href="#BERNARDI1985">BERNARDI1985</a>. It is a 2D coupled Finite Element, where the Polynomial space is <span><span class="MathJax_Preview">P_1^2</span><script type="math/tex">P_1^2</script></span> with 3 normal bubble edge functions <span><span class="MathJax_Preview">(P_2)</span><script type="math/tex">(P_2)</script></span>.
There are 9 degrees of freedom:</p>
<ul>
<li>2 components at each of the 3 vertices and</li>
<li>the 3 flux on the 3 edges.</li>
</ul>
</li>
<li>
<p><code class="codehilite">[RT0, RT03d]</code> Raviart-Thomas finite element of degree <span><span class="MathJax_Preview">0</span><script type="math/tex">0</script></span>.</p>
<p><strong>The 2D Case:</strong>
<script type="math/tex; mode=display">\begin{equation*}
    \label{eq:RT0}
    RT0_{h} = \left\{ \mathbf{v} \in H(\textrm{div}) \left|\; \forall K \in \mathcal{T}_{h} ,\ \mathbf{v}_{|K}(x,y) =
        \vecttwo{\alpha^1_{K}}{\alpha^2_{K}} + \beta_{K}\vecttwo{x}{y} \right.\right\}
\end{equation*}</script>
<strong>The 3D Case:</strong>
<script type="math/tex; mode=display">\begin{equation*}
    \label{eq:RT03d}
    RT0_{h} = \left\{ \mathbf{v} \in H(\textrm{div}) \left|\; \forall K \in \mathcal{T}_{h},\ \mathbf{v}_{|K}(x,y,z) =
        \vectthree{\alpha^1_{K}}{\alpha^2_{K}}{\alpha^3_{K}} + \beta_{K}\vectthree{x}{y}{z} \right.\right\}
\end{equation*}</script>
where by writing <span><span class="MathJax_Preview">\textrm{div }\mathbf{w}=\sum_{i=1}^d\p w_i/\p x_i</span><script type="math/tex">\textrm{div }\mathbf{w}=\sum_{i=1}^d\p w_i/\p x_i</script></span> with <span><span class="MathJax_Preview">\mathbf{w}=(w_i)_{i=1}^d</span><script type="math/tex">\mathbf{w}=(w_i)_{i=1}^d</script></span>:
<script type="math/tex; mode=display">
H(\textrm{div})=\left\{\mathbf{w}\in L^{2}(\Omega)^d\left|\textrm{div } \mathbf{w}\in L^{2}(\Omega)\right.\right\}
</script>
and where <span><span class="MathJax_Preview">\alpha^1_{K}</span><script type="math/tex">\alpha^1_{K}</script></span>, <span><span class="MathJax_Preview">\alpha^2_{K}</span><script type="math/tex">\alpha^2_{K}</script></span>, <span><span class="MathJax_Preview">\alpha^3_{K}</span><script type="math/tex">\alpha^3_{K}</script></span>, <span><span class="MathJax_Preview">\beta_{K}</span><script type="math/tex">\beta_{K}</script></span> are real numbers.</p>
</li>
<li>
<p><code class="codehilite">[RT0Ortho]</code> Raviart-Thomas Orthogonal, or Nedelec finite element type I of degree <span><span class="MathJax_Preview">0</span><script type="math/tex">0</script></span> in dimension 2
    <script type="math/tex; mode=display">\begin{equation*}
        \label{RT0Ortho}
        RT0Ortho{h} = \left\{ \mathbf{v} \in H(\textrm{curl}) \left|\; \forall K \in \mathcal{T}_{h},\ \mathbf{v}_{|K}(x,y) =
            \vecttwo{\alpha^1_{K}}{\alpha^2_{K}} + \beta_{K}\vecttwo{-y}{x} \right.\right\}
    \end{equation*}</script>
</p>
</li>
<li>
<p><code class="codehilite">[Edge03d]</code> 3d Nedelec finite element or Edge Element of degree <span><span class="MathJax_Preview">0</span><script type="math/tex">0</script></span>.</p>
<p><strong>The 3D Case:</strong>
<script type="math/tex; mode=display">\begin{equation*}
    \label{eq:Edge03d}
    Edge0_{h} = \left\{ \mathbf{v} \in H(\textrm{Curl}) \left|\; \forall K \in\mathcal{T}_{h}, \ \mathbf{v}_{|K}(x,y,z) =
        \vectthree{\alpha^1_{K}}{\alpha^2_{K}}{\alpha^3_{K}} + \vectthree{\beta^1_{K}}{\beta^2_{K}}{\beta^3_{K}}\times\vectthree{x}{y}{z} \right.\right\}
\end{equation*}</script>
where by writing <span><span class="MathJax_Preview">\textrm{curl}\mathbf{w}=\vectthree{\p w_2/\p x_3-\p w_3/\p x_2}{\p w_3/\p x_1-\p w_1/\p x_3}{\p w_1/\p x_2-\p w_2/\p x_1}</span><script type="math/tex">\textrm{curl}\mathbf{w}=\vectthree{\p w_2/\p x_3-\p w_3/\p x_2}{\p w_3/\p x_1-\p w_1/\p x_3}{\p w_1/\p x_2-\p w_2/\p x_1}</script></span> with $ \mathbf{w}=(w_i)_{i=1}^d$:
<script type="math/tex; mode=display">
H(\textrm{curl})=\left\{\mathbf{w}\in L^{2}(\Omega)^d\left|\textrm{curl } \mathbf{w}\in L^{2}(\Omega)^d\right.\right\}
</script>
and <span><span class="MathJax_Preview">\alpha^1_{K},\alpha^2_{K},\alpha^3_{K},\beta^1_{K},\beta^2_{K},\beta^3_{K}</span><script type="math/tex">\alpha^1_{K},\alpha^2_{K},\alpha^3_{K},\beta^1_{K},\beta^2_{K},\beta^3_{K}</script></span> are real numbers.</p>
</li>
<li>
<p><code class="codehilite">[Edge13d]</code> (needs <code class="codehilite">load &quot;Element_Mixte3d&quot;</code>) 3d Nedelec finite element or Edge Element of degree <span><span class="MathJax_Preview">1</span><script type="math/tex">1</script></span>.</p>
</li>
<li>
<p><code class="codehilite">[Edge23d]</code> (needs <code class="codehilite">load &quot;Element_Mixte3d&quot;</code>) 3d Nedelec finite element or Edge Element of degree <span><span class="MathJax_Preview">2</span><script type="math/tex">2</script></span>.</p>
</li>
<li>
<p><code class="codehilite">[P1nc]</code> piecewise linear element continuous at the mid-point of the edge only in 2D (Crouzeix-Raviart Finite Element 2D).</p>
</li>
<li>
<p><code class="codehilite">[P2pnc]</code> piecewise quadratic plus a P3 bubble element with the continuity of the 2 moments on each edge (needs <code class="codehilite">load &quot;Element_P2pnc&quot;</code>)</p>
</li>
<li>
<p><code class="codehilite">[RT1]</code> (needs <code class="codehilite">load &quot;Element_Mixte&quot;</code>)
    <script type="math/tex; mode=display">\begin{equation*}
        \label{eq:RT1}
        RT1_{h} = \left\{ \mathbf{v} \in H(\textrm{div}) \left|\; \forall K \in\mathcal{T}_{h}, \ \alpha^1_{K}, \alpha^2_{K}, \beta_{K} \in P_1^2,P_0, \mathbf{v}_{|K}(x,y) =
            \vecttwo{\alpha^1_{K}}{\alpha^2_{K}} + \beta_{K}\vecttwo{x}{y} \right.\right\}
    \end{equation*}</script>
</p>
</li>
<li>
<p><code class="codehilite">[RT1Ortho]</code> (needs <code class="codehilite">load &quot;Element_Mixte&quot;</code>)
    <script type="math/tex; mode=display">\begin{equation*}
        \label{eq:RT1Ortho}
        RT1_{h} = \left\{ \mathbf{v} \in H(\textrm{curl}) \left|\; \forall K \in\mathcal{T}_{h},\ \alpha^1_{K}, \alpha^2_{K}, \beta_{K} \in P_1^2,P_0, \mathbf{v}_{|K}(x,y) =
            \vecttwo{\alpha^1_{K}}{\alpha^2_{K}} + \beta_{K}\vecttwo{-y}{x} \right.\right\}
    \end{equation*}</script>
</p>
</li>
<li>
<p><code class="codehilite">[RT2]</code> (needs <code class="codehilite">load &quot;Element_Mixte&quot;</code>)
    <script type="math/tex; mode=display">\begin{equation*}
        \label{eq:RT2}
        RT2_{h} = \left\{ \mathbf{v} \in H(\textrm{div}) \left|\; \forall K \in\mathcal{T}_{h},\ \alpha^1_{K}, \alpha^2_{K}, \beta_{K} \in P_2^2, P_1, \mathbf{v}_{|K}(x,y) =
            \vecttwo{\alpha^1_{K}}{\alpha^2_{K}} + \beta_{K}\vecttwo{x}{y} \right.\right\}
    \end{equation*}</script>
</p>
</li>
<li>
<p><code class="codehilite">[RT2Ortho]</code> (needs <code class="codehilite">load &quot;Element_Mixte&quot;</code>)
    <script type="math/tex; mode=display">\begin{equation*}
        \label{eq:RT2Ortho}
        RT2_{h} = \left\{ \mathbf{v} \in H(\textrm{curl}) \left|\; \forall K \in\mathcal{T}_{h} ,\ \alpha^1_{K}, \alpha^2_{K}, \beta_{K} \in P_2^2, P_1,\ \mathbf{v}_{|K}(x,y) =
            \vecttwo{\alpha^1_{K}}{\alpha^2_{K}} + \beta_{K}\vecttwo{-y}{x} \right.\right\}
    \end{equation*}</script>
</p>
</li>
<li>
<p><code class="codehilite">[BDM1]</code> (needs <code class="codehilite">load &quot;Element_Mixte&quot;</code>) the Brezzi-Douglas-Marini finite element
    <script type="math/tex; mode=display">\begin{equation*}
        \label{eq:BDM1}
        BDM1_{h} = \left\{ \mathbf{v} \in H(\textrm{div}) \left|\; \forall K \in\mathcal{T}_{h},\ \mathbf{v}_{|K} \in P_1^2\right.\right\}
    \end{equation*}</script>
</p>
</li>
<li>
<p><code class="codehilite">[BDM1Ortho]</code> (needs <code class="codehilite">load &quot;Element_Mixte&quot;</code>) the Brezzi-Douglas-Marini Orthogonal also call Nedelec of type II , finite element
    <script type="math/tex; mode=display">\begin{equation*}
        \label{eq:BDM1Ortho}
        BDM1Ortho_{h} = \left\{ \mathbf{v} \in H(\textrm{curl}) \left|\; \forall K \in\mathcal{T}_{h},\ \mathbf{v}_{|K} \in P_1^2\right.\right\}
    \end{equation*}</script>
</p>
</li>
<li>
<p><code class="codehilite">[FEQF]</code> (needs <code class="codehilite">load &quot;Element_QF&quot;</code>) the finite element to store functions at default quadrature points (so the quadrature is <code class="codehilite">qf5pT</code> in 2D and is <code class="codehilite">qfV5</code> in 3d). For over quadrature you have the following corresponding finite element's quadrature formula.</p>
<ul>
<li><code class="codehilite">FEQF1</code> <span><span class="MathJax_Preview">\mapsto</span><script type="math/tex">\mapsto</script></span> <code class="codehilite">qf1pT</code>,</li>
<li><code class="codehilite">FEQF2</code> <span><span class="MathJax_Preview">\mapsto</span><script type="math/tex">\mapsto</script></span> <code class="codehilite">qf2pT</code>,</li>
<li><code class="codehilite">FEQF5</code> <span><span class="MathJax_Preview">\mapsto</span><script type="math/tex">\mapsto</script></span> <code class="codehilite">qf5pT</code>,</li>
<li><code class="codehilite">FEQF7</code> <span><span class="MathJax_Preview">\mapsto</span><script type="math/tex">\mapsto</script></span> <code class="codehilite">qf7pT</code>,</li>
<li><code class="codehilite">FEQF9</code> <span><span class="MathJax_Preview">\mapsto</span><script type="math/tex">\mapsto</script></span> <code class="codehilite">qf9pT</code>,</li>
<li><code class="codehilite">FEQF13d</code> <span><span class="MathJax_Preview">\mapsto</span><script type="math/tex">\mapsto</script></span> <code class="codehilite">qfV1</code>,</li>
<li><code class="codehilite">FEQF23d</code> <span><span class="MathJax_Preview">\mapsto</span><script type="math/tex">\mapsto</script></span> <code class="codehilite">qfV2</code>,</li>
<li><code class="codehilite">FEQF53d</code> <span><span class="MathJax_Preview">\mapsto</span><script type="math/tex">\mapsto</script></span> <code class="codehilite">qfV5</code></li>
</ul>
</li>
</ul>
<p>You can use this element to optimize the storage and reuse of functions with a long formula inside an integral for non linear processes.</p>
<h2 id="use-of-fespace-in-2d">Use of <code class="codehilite">fespace</code> in 2D<a class="headerlink" href="#use-of-fespace-in-2d" title="Permanent link">#</a></h2>
<p>With the 2D finite element spaces</p>
<div>
<div class="MathJax_Preview">
X_{h} = \left\{ v \in H^{1}(]0,1[^2) |\; \forall K \in \mathcal{T}_{h}\quad v_{|K} \in P_{1} \right\}
</div>
<script type="math/tex; mode=display">
X_{h} = \left\{ v \in H^{1}(]0,1[^2) |\; \forall K \in \mathcal{T}_{h}\quad v_{|K} \in P_{1} \right\}
</script>
</div>
<div>
<div class="MathJax_Preview">
X_{ph} = \left\{ v \in X_{h} |\; v\left(\vecttwo{0}{.}\right) = v\left(\vecttwo{1}{.}\right) , v\left(\vecttwo{.}{0}\right) = v\left(\vecttwo{.}{1}\right) \right\}
</div>
<script type="math/tex; mode=display">
X_{ph} = \left\{ v \in X_{h} |\; v\left(\vecttwo{0}{.}\right) = v\left(\vecttwo{1}{.}\right) , v\left(\vecttwo{.}{0}\right) = v\left(\vecttwo{.}{1}\right) \right\}
</script>
</div>
<div>
<div class="MathJax_Preview">
M_{h} = \left\{ v \in H^{1}(]0,1[^2) |\; \forall K \in \mathcal{T}_{h}\quad v_{|K} \in P_{2} \right\}
</div>
<script type="math/tex; mode=display">
M_{h} = \left\{ v \in H^{1}(]0,1[^2) |\; \forall K \in \mathcal{T}_{h}\quad v_{|K} \in P_{2} \right\}
</script>
</div>
<div>
<div class="MathJax_Preview">
R_{h} = \left\{ \mathbf{v} \in H^{1}(]0,1[^2)^{2} |\; \forall K \in \mathcal{T}_{h}\quad \mathbf{v}_{|K}(x,y) = \vecttwo{\alpha_{K}}{\beta_{K}} + \gamma_{K}\vecttwo{x}{y} \right\}
</div>
<script type="math/tex; mode=display">
R_{h} = \left\{ \mathbf{v} \in H^{1}(]0,1[^2)^{2} |\; \forall K \in \mathcal{T}_{h}\quad \mathbf{v}_{|K}(x,y) = \vecttwo{\alpha_{K}}{\beta_{K}} + \gamma_{K}\vecttwo{x}{y} \right\}
</script>
</div>
<p>when <span><span class="MathJax_Preview">\mathcal{T}_h</span><script type="math/tex">\mathcal{T}_h</script></span> is a mesh <span><span class="MathJax_Preview">10\times 10</span><script type="math/tex">10\times 10</script></span> of the unit square <span><span class="MathJax_Preview">]0,1[^2</span><script type="math/tex">]0,1[^2</script></span>, we only write in FreeFem++ :</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>mesh Th = square(10, 10);
fespace Xh(Th, P1); //scalar FE
fespace Xph(Th,P1,
            periodic=[[2, y], [4, y], [1, x], [3, x]]); //bi-periodic FE
fespace Mh(Th, P2); //scalar FE
fespace Rh(Th, RT0); //vectorial FE
</pre></div>
</td></tr></table>

<p>where <code class="codehilite">Xh, Mh, Rh</code> expresses finite element spaces (called FE spaces) <span><span class="MathJax_Preview">X_h,\, M_h,\, R_h</span><script type="math/tex">X_h,\, M_h,\, R_h</script></span>, respectively.</p>
<p>To use FE-functions $u_{h},v_{h} \in X_{h} $, <span><span class="MathJax_Preview">p_{h},q_{h} \in M_{h}</span><script type="math/tex">p_{h},q_{h} \in M_{h}</script></span> and <span><span class="MathJax_Preview">U_{h},V_{h} \in R_{h}</span><script type="math/tex">U_{h},V_{h} \in R_{h}</script></span>, we write :</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>Xh uh, vh;
Xph uph, vph;
Mh ph, qh;
Rh [Uxh, Uyh], [Vxh, Vyh];
Xh[int] Uh(10);         //array of 10 functions in Xh
Rh[int] [Wxh, Wyh](10); //array of 10 functions in Rh
Wxh[5](0.5,0.5);        //the 6th function at point (0.5, 0.5)
Wxh[5][];               //the array of the degree of freedom of the 6th function
</pre></div>
</td></tr></table>

<p>The functions <span><span class="MathJax_Preview">U_{h}, V_{h}</span><script type="math/tex">U_{h}, V_{h}</script></span> have two components so we have
<script type="math/tex; mode=display">
U_{h}=\vecttwo{Uxh}{Uyh} \quad \mbox{and}\quad V_{h}=\vecttwo{Vxh}{Vyh}
</script>
</p>
<h2 id="use-of-fespace-in-3d">Use of <code class="codehilite">fespace</code> in 3D<a class="headerlink" href="#use-of-fespace-in-3d" title="Permanent link">#</a></h2>
<p>With the 3D finite element spaces
<script type="math/tex; mode=display">
X_{h} = \{ v \in H^{1}(]0,1[^3) |\; \forall K \in \mathcal{T}_{h}\quad v_{|K} \in P_{1} \}
</script>
</p>
<div>
<div class="MathJax_Preview">
X_{ph} = \left\{ v \in X_{h} |\; v\left(\vecttwo{0}{.}\right) = v\left(\vecttwo{1}{.}\right) , v\left(\vecttwo{.}{0}\right) = v\left(\vecttwo{.}{1}\right) \right\}
</div>
<script type="math/tex; mode=display">
X_{ph} = \left\{ v \in X_{h} |\; v\left(\vecttwo{0}{.}\right) = v\left(\vecttwo{1}{.}\right) , v\left(\vecttwo{.}{0}\right) = v\left(\vecttwo{.}{1}\right) \right\}
</script>
</div>
<div>
<div class="MathJax_Preview">
M_{h} = \{ v \in H^{1}(]0,1[^2) |\; \forall K \in \mathcal{T}_{h}\quad v_{|K} \in P_{2} \}
</div>
<script type="math/tex; mode=display">
M_{h} = \{ v \in H^{1}(]0,1[^2) |\; \forall K \in \mathcal{T}_{h}\quad v_{|K} \in P_{2} \}
</script>
</div>
<div>
<div class="MathJax_Preview">
R_{h} = \left\{ \mathbf{v} \in H^{1}(]0,1[^2)^{2} |\; \forall K \in \mathcal{T}_{h}\quad \mathbf{v}_{|K}(x,y) = \vecttwo{\alpha_{K}}{\beta_{K}} + \gamma_{K}\vecttwo{x}{y} \right\}
</div>
<script type="math/tex; mode=display">
R_{h} = \left\{ \mathbf{v} \in H^{1}(]0,1[^2)^{2} |\; \forall K \in \mathcal{T}_{h}\quad \mathbf{v}_{|K}(x,y) = \vecttwo{\alpha_{K}}{\beta_{K}} + \gamma_{K}\vecttwo{x}{y} \right\}
</script>
</div>
<p>when <span><span class="MathJax_Preview">\mathcal{T}_h</span><script type="math/tex">\mathcal{T}_h</script></span> is a mesh <span><span class="MathJax_Preview">10\times 10\times 10</span><script type="math/tex">10\times 10\times 10</script></span> of the unit cubic <span><span class="MathJax_Preview">]0,1[^2</span><script type="math/tex">]0,1[^2</script></span>, we write in FreeFem++ :</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>mesh3 Th = buildlayers(square(10, 10),10, zbound=[0,1]);
//label: 0 up, 1 down, 2 front, 3 left, 4 back, 5 right
fespace Xh(Th, P1); //scalar FE
fespace Xph(Th, P1,
        periodic=[[0, x, y], [1, x, y],
                  [2, x, z], [4, x, z],
                  [3, y, z], [5, y, z]]); //three-periodic FE
fespace Mh(Th, P2); //scalar FE
fespace Rh(Th, RT03d); //vectorial FE
</pre></div>
</td></tr></table>

<p>where <code class="codehilite">Xh, Mh, Rh</code> expresses finite element spaces (called FE spaces) <span><span class="MathJax_Preview">X_h,\, M_h,\, R_h</span><script type="math/tex">X_h,\, M_h,\, R_h</script></span>, respectively.</p>
<p>To define and use FE-functions <span><span class="MathJax_Preview">u_{h},v_{h} \in X_{h}</span><script type="math/tex">u_{h},v_{h} \in X_{h}</script></span>, <span><span class="MathJax_Preview">p_{h},q_{h} \in M_{h}</span><script type="math/tex">p_{h},q_{h} \in M_{h}</script></span> and <span><span class="MathJax_Preview">U_{h},V_{h} \in R_{h}</span><script type="math/tex">U_{h},V_{h} \in R_{h}</script></span>, we write:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>Xh uh, vh;
Xph uph, vph;
Mh ph, qh;
Rh [Uxh, Uyh, Uyzh], [Vxh, Vyh, Vyzh];
Xh[int] Uh(10);             //array of 10 functions in Xh
Rh[int] [Wxh,Wyh,Wzh](10);  // array of 10 functions in Rh
Wxh[5](0.5,0.5,0.5);        //the 6th function at point (0.5, 0.5, 0.5)
Wxh[5][];                   //the array of the degree of freedom of the 6th function
</pre></div>
</td></tr></table>

<p>The functions <span><span class="MathJax_Preview">U_{h}, V_{h}</span><script type="math/tex">U_{h}, V_{h}</script></span> have three components, so we have
<script type="math/tex; mode=display">
U_{h}=\vectthree{Uxh}{Uyh}{Uzh} \quad \mbox{and}\quad V_{h}=\vectthree{Vxh}{Vyh}{Vzh}
</script>
</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>One challenge of the periodic boundary condition is that the mesh must have equivalent faces. The <code>::freefem buildlayers</code> mesh generator splits each quadrilateral face with the diagonal passing through the vertex with maximum number, so to be sure to have the same mesh one both face periodic the 2D numbering in corresponding edges must be compatible (for example the same variation).
<span><span class="MathJax_Preview">\codecheck</span><script type="math/tex">\codecheck</script></span> <span><span class="MathJax_Preview">\codered</span><script type="math/tex">\codered</script></span></p>
<p>By Default, the numbering of square vertex is correct.</p>
<p>To change the mesh numbering you can use the <code class="codehilite">change</code> function like:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>{
    int[int] old2new(0:Th.nv-1); //array set on 0, 1, .., nv-1
    fespace Vh2(Th, P1);
    Vh2 sorder = x+y; //choose an order increasing on 4 square borders with x or y
    sort(sorder[], old2new); //build the inverse permutation
    int[int] new2old = old2new^-1; //inverse the permutation
    Th = change(Th, renumv=new2old);
}
</pre></div>
</td></tr></table>

<p>The full example is in <a href="../examples/periodic-3d">Examples</a>.</p>
</div>
<h2 id="lagrangian-finite-elements">Lagrangian Finite Elements<a class="headerlink" href="#lagrangian-finite-elements" title="Permanent link">#</a></h2>
<h3 id="p0-element">P0-element<a class="headerlink" href="#p0-element" title="Permanent link">#</a></h3>
<p>For each triangle (d=2) or tetrahedron (d=3) <span><span class="MathJax_Preview">T_k</span><script type="math/tex">T_k</script></span>, the basis function <span><span class="MathJax_Preview">\phi_k</span><script type="math/tex">\phi_k</script></span> in <code class="codehilite">Vh(Th, P0)</code> is given by</p>
<div>
<div class="MathJax_Preview">
\phi_k(\mathbf{x})=
\left\{
\begin{array}{cl}
    1 &amp; \textrm{ if }(\mathbf{x})\in T_k\\
    0 &amp; \textrm{ if }(\mathbf{x})\not\in T_k
\end{array}
\right.
</div>
<script type="math/tex; mode=display">
\phi_k(\mathbf{x})=
\left\{
\begin{array}{cl}
    1 & \textrm{ if }(\mathbf{x})\in T_k\\
    0 & \textrm{ if }(\mathbf{x})\not\in T_k
\end{array}
\right.
</script>
</div>
<p>If we write</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>Vh(Th, P0);
Vh fh = f(x,y);
</pre></div>
</td></tr></table>

<p>then for vertices $q^{k_i},\, i=1,2,.. d+1 $ in <a href="#Fig1">Fig. 1(a)</a>, <span><span class="MathJax_Preview">f_h</span><script type="math/tex">f_h</script></span> is built as</p>
<p><center>
<code class="codehilite">fh=</code> <span><span class="MathJax_Preview">\displaystyle f_h(x,y)=\sum_k f(\frac{\sum_i q^{k_i}}{d+1}) \phi_k</span><script type="math/tex">\displaystyle f_h(x,y)=\sum_k f(\frac{\sum_i q^{k_i}}{d+1}) \phi_k</script></span>
</center></p>
<p>See <a href="#Fig3">Fig. 3</a> for the projection of <span><span class="MathJax_Preview">f(x,y)=\sin(\pi x)\cos(\pi y)</span><script type="math/tex">f(x,y)=\sin(\pi x)\cos(\pi y)</script></span> on <code class="codehilite">Vh(Th, P0)</code> when the mesh <code class="codehilite">Th</code> is a <span><span class="MathJax_Preview">4\times 4</span><script type="math/tex">4\times 4</script></span>-grid of <span><span class="MathJax_Preview">[-1,1]^2</span><script type="math/tex">[-1,1]^2</script></span> as in <a href="#Fig2">Fig. 2</a>.</p>
<h3 id="p1-element">P1-element<a class="headerlink" href="#p1-element" title="Permanent link">#</a></h3>
<p><center></p>
<table>
<thead>
<tr>
<th align="center"><a name="Fig1">Fig. 1</a>: <span><span class="MathJax_Preview">P_1</span><script type="math/tex">P_1</script></span> and <span><span class="MathJax_Preview">P_2</span><script type="math/tex">P_2</script></span> degrees of freedom on triangle <span><span class="MathJax_Preview">T_k</span><script type="math/tex">T_k</script></span></th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="P1P2" src="../images/FiniteElement_P1P2.png" /></td>
</tr>
</tbody>
</table>
<p></center></p>
<p>For each vertex <span><span class="MathJax_Preview">q^i</span><script type="math/tex">q^i</script></span>, the basis function <span><span class="MathJax_Preview">\phi_i</span><script type="math/tex">\phi_i</script></span> in <code class="codehilite">Vh(Th, P1)</code> is given by</p>
<div>
<div class="MathJax_Preview">\begin{eqnarray*}
&amp;&amp;\phi_i(x,y)=a^k_i+b^k_ix+c^k_iy \textrm{ for }(x,y)\in T_k,\\
&amp;&amp;\phi_i(q^i)=1,\quad \phi_i(q^j)=0 \textrm{ if }i\neq j
\end{eqnarray*}</div>
<script type="math/tex; mode=display">\begin{eqnarray*}
&&\phi_i(x,y)=a^k_i+b^k_ix+c^k_iy \textrm{ for }(x,y)\in T_k,\\
&&\phi_i(q^i)=1,\quad \phi_i(q^j)=0 \textrm{ if }i\neq j
\end{eqnarray*}</script>
</div>
<p>The basis function <span><span class="MathJax_Preview">\phi_{k_1}(x,y)</span><script type="math/tex">\phi_{k_1}(x,y)</script></span> with the vertex <span><span class="MathJax_Preview">q^{k_1}</span><script type="math/tex">q^{k_1}</script></span> in <a href="#Fig1">Fig. 1(a)</a> at point <span><span class="MathJax_Preview">p=(x,y)</span><script type="math/tex">p=(x,y)</script></span> in triangle <span><span class="MathJax_Preview">T_k</span><script type="math/tex">T_k</script></span> simply coincide with the <em>barycentric coordinates <span><span class="MathJax_Preview">\lambda^k_1</span><script type="math/tex">\lambda^k_1</script></span> (area coordinates)</em> :
<script type="math/tex; mode=display">
\phi_{k_1}(x,y) = \lambda^k_{1}(x,y)=
\frac{\textrm{area of triangle} (p, q^{k_2},q^{k_3})}
{\textrm{area of triangle}(q^{k_1},q^{k_2},q^{k_3})}
</script>
</p>
<p>If we write</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>Vh(Th, P1);
Vh fh = g(x.y);
</pre></div>
</td></tr></table>

<p>then</p>
<p><center>
<code class="codehilite">fh =</code> <span><span class="MathJax_Preview">\displaystyle f_h(x,y)=\sum_{i=1}^{n_v}f(q^i)\phi_i(x,y)</span><script type="math/tex">\displaystyle f_h(x,y)=\sum_{i=1}^{n_v}f(q^i)\phi_i(x,y)</script></span>
</center></p>
<p>See <a href="#Fig4">Fig. 4</a> for the projection of <span><span class="MathJax_Preview">f(x,y)=\sin(\pi x)\cos(\pi y)</span><script type="math/tex">f(x,y)=\sin(\pi x)\cos(\pi y)</script></span> into <code class="codehilite">Vh(Th, P1)</code>.</p>
<table>
<thead>
<tr>
<th align="center"><a name"Fig2">Fig. 2</a>: Test mesh <code class="codehilite">Th</code> for projection</th>
<th align="center"><a name="Fig3">Fig. 3</a>: Projection to <code class="codehilite">Vh(Th, P0)</code></th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="P0P1P2nc" src="../images/FiniteElement_P0P1P2P1nc.png" /></td>
<td align="center"><img alt="peojP0" src="../images/FiniteElement_projP0.png" /></td>
</tr>
</tbody>
</table>
<h3 id="p2-element">P2-element<a class="headerlink" href="#p2-element" title="Permanent link">#</a></h3>
<p>For each vertex or mid-point <span><span class="MathJax_Preview">q^i</span><script type="math/tex">q^i</script></span>. The basis function <span><span class="MathJax_Preview">\phi_i</span><script type="math/tex">\phi_i</script></span> in <code class="codehilite">Vh(Th, P2)</code> is given by :</p>
<div>
<div class="MathJax_Preview">\begin{eqnarray*}
&amp;&amp;\phi_i(x,y)=a^k_i+b^k_ix+c^k_iy+d^k_ix^2+e^k_ixy+f^f_jy^2\textrm{ for }(x,y)\in T_k,\\
&amp;&amp;\phi_i(q^i)=1,\quad \phi_i(q^j)=0\textrm{ if }i\neq j
\end{eqnarray*}</div>
<script type="math/tex; mode=display">\begin{eqnarray*}
&&\phi_i(x,y)=a^k_i+b^k_ix+c^k_iy+d^k_ix^2+e^k_ixy+f^f_jy^2\textrm{ for }(x,y)\in T_k,\\
&&\phi_i(q^i)=1,\quad \phi_i(q^j)=0\textrm{ if }i\neq j
\end{eqnarray*}</script>
</div>
<p>The basis function <span><span class="MathJax_Preview">\phi_{k_1}(x,y)</span><script type="math/tex">\phi_{k_1}(x,y)</script></span> with the vertex <span><span class="MathJax_Preview">q^{k_1}</span><script type="math/tex">q^{k_1}</script></span> in <a href="#Fig1">Fig. 1(b)</a> is defined by the <em>barycentric coordinates</em>:</p>
<div>
<div class="MathJax_Preview">
\phi_{k_1}(x,y) = \lambda^k_{1}(x,y)(2\lambda^k_1(x,y)-1)
</div>
<script type="math/tex; mode=display">
\phi_{k_1}(x,y) = \lambda^k_{1}(x,y)(2\lambda^k_1(x,y)-1)
</script>
</div>
<p>and for the mid-point <span><span class="MathJax_Preview">q^{k_2}</span><script type="math/tex">q^{k_2}</script></span></p>
<div>
<div class="MathJax_Preview">
\phi_{k_2}(x,y) = 4\lambda^k_1(x,y)\lambda^k_4(x,y)
</div>
<script type="math/tex; mode=display">
\phi_{k_2}(x,y) = 4\lambda^k_1(x,y)\lambda^k_4(x,y)
</script>
</div>
<p>If we write :</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>Vh(Th, P2);
Vh fh = f(x.y);
</pre></div>
</td></tr></table>

<p>then :
<center>
<code class="codehilite">fh =</code> <span><span class="MathJax_Preview">\displaystyle f_h(x,y)=\sum_{i=1}^{M}f(q^i)\phi_i(x,y)\quad (\textrm{summation over all vertex or mid-point})</span><script type="math/tex">\displaystyle f_h(x,y)=\sum_{i=1}^{M}f(q^i)\phi_i(x,y)\quad (\textrm{summation over all vertex or mid-point})</script></span>
</center></p>
<p>See <a href="#Fig5">Fig. 5</a> for the projection of <span><span class="MathJax_Preview">f(x,y)=\sin(\pi x)\cos(\pi y)</span><script type="math/tex">f(x,y)=\sin(\pi x)\cos(\pi y)</script></span> into <code class="codehilite">Vh(Th, P2)</code>.</p>
<table>
<thead>
<tr>
<th align="center"><a name="Fig4">Fig. 4</a>: projection to <code class="codehilite">Vh(Th, P1)</code></th>
<th align="center"><a name="Fig5">Fig. 5</a>: projection to <code class="codehilite">Vh(Th, P2)</code></th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="projP1" src="../images/FiniteElement_projP1.png" /></td>
<td align="center"><img alt="projP2" src="../images/FiniteElement_projP2.png" /></td>
</tr>
</tbody>
</table>
<h2 id="p1-nonconforming-element">P1 Nonconforming Element<a class="headerlink" href="#p1-nonconforming-element" title="Permanent link">#</a></h2>
<p>Refer to <a href="#THOMASSET2012">THOMASSET2012</a> for details; briefly, we now consider non-continuous approximations so we will lose the property</p>
<div>
<div class="MathJax_Preview">
w_h\in V_h\subset H^1(\Omega)
</div>
<script type="math/tex; mode=display">
w_h\in V_h\subset H^1(\Omega)
</script>
</div>
<p>If we write</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>Vh(Th, P1nc);
Vh fh = f(x.y);
</pre></div>
</td></tr></table>

<p>then</p>
<p><center>
<code class="codehilite">fh =</code> <span><span class="MathJax_Preview">\displaystyle f_h(x,y)=\sum_{i=1}^{n_v}f(m^i)\phi_i(x,y)\quad (\textrm{summation over all midpoint})</span><script type="math/tex">\displaystyle f_h(x,y)=\sum_{i=1}^{n_v}f(m^i)\phi_i(x,y)\quad (\textrm{summation over all midpoint})</script></span>
</center></p>
<p>Here the basis function <span><span class="MathJax_Preview">\phi_i</span><script type="math/tex">\phi_i</script></span> associated with the mid-point <span><span class="MathJax_Preview">m^i=(q^{k_i}+q^{k_{i+1}})/2</span><script type="math/tex">m^i=(q^{k_i}+q^{k_{i+1}})/2</script></span> where <span><span class="MathJax_Preview">q^{k_i}</span><script type="math/tex">q^{k_i}</script></span> is the <span><span class="MathJax_Preview">i</span><script type="math/tex">i</script></span>-th point in <span><span class="MathJax_Preview">T_k</span><script type="math/tex">T_k</script></span>, and we assume that <span><span class="MathJax_Preview">j+1=0</span><script type="math/tex">j+1=0</script></span> if <span><span class="MathJax_Preview">j=3</span><script type="math/tex">j=3</script></span>:</p>
<div>
<div class="MathJax_Preview">\begin{eqnarray*}
&amp;&amp;\phi_i(x,y)=a^k_i+b^k_ix+c^k_iy~\textrm{for }(x,y)\in T_k,\\
&amp;&amp;\phi_i(m^i)=1,\quad \phi_i(m^j)=0\textrm{ if }i\neq j
\end{eqnarray*}</div>
<script type="math/tex; mode=display">\begin{eqnarray*}
&&\phi_i(x,y)=a^k_i+b^k_ix+c^k_iy~\textrm{for }(x,y)\in T_k,\\
&&\phi_i(m^i)=1,\quad \phi_i(m^j)=0\textrm{ if }i\neq j
\end{eqnarray*}</script>
</div>
<p>Strictly speaking <span><span class="MathJax_Preview">\p \phi_i/\p x,\, \p \phi_i/\p y</span><script type="math/tex">\p \phi_i/\p x,\, \p \phi_i/\p y</script></span> contain Dirac distribution <span><span class="MathJax_Preview">\rho \delta_{\p T_k}</span><script type="math/tex">\rho \delta_{\p T_k}</script></span>.</p>
<p>The numerical calculations will automatically <em>ignore</em> them. In <a href="#THOMASSET2012">THOMASSET2012</a>, there is a proof of the estimation
<script type="math/tex; mode=display">
\left(\sum_{k=1}^{n_v}\int_{T_k}|\nabla w-\nabla w_h|^2\d x\d y\right)^{1/2}
=O(h)
</script>
</p>
<p>The basis functions <span><span class="MathJax_Preview">\phi_k</span><script type="math/tex">\phi_k</script></span> have the following properties.</p>
<ol>
<li>
<p>For the bilinear form <span><span class="MathJax_Preview">a</span><script type="math/tex">a</script></span> defined in <a href="#Fig6">Fig. 6</a> satisfy
    <script type="math/tex; mode=display">\begin{eqnarray*}
    &&a(\phi_i,\phi_i)>0,\qquad a(\phi_i,\phi_j)\le 0\quad\textrm{if }i\neq j\\
    &&\sum_{k=1}^{n_v}a(\phi_i,\phi_k)\ge 0
    \end{eqnarray*}</script>
</p>
</li>
<li>
<p><span><span class="MathJax_Preview">f\ge 0 \Rightarrow u_h\ge 0</span><script type="math/tex">f\ge 0 \Rightarrow u_h\ge 0</script></span></p>
</li>
<li>
<p>If <span><span class="MathJax_Preview">i\neq j</span><script type="math/tex">i\neq j</script></span>, the basis function <span><span class="MathJax_Preview">\phi_i</span><script type="math/tex">\phi_i</script></span> and <span><span class="MathJax_Preview">\phi_j</span><script type="math/tex">\phi_j</script></span> are <span><span class="MathJax_Preview">L^2</span><script type="math/tex">L^2</script></span>-orthogonal:
    <script type="math/tex; mode=display">
    \int_{\Omega}\phi_i\phi_j\, \d x\d y=0\qquad \textrm{if }i\neq j
    </script>
    which is false for <span><span class="MathJax_Preview">P_1</span><script type="math/tex">P_1</script></span>-element.</p>
</li>
</ol>
<p>See <a href="#Fig6">Fig. 6</a> for the projection of <span><span class="MathJax_Preview">f(x,y)=\sin(\pi x)\cos(\pi y)</span><script type="math/tex">f(x,y)=\sin(\pi x)\cos(\pi y)</script></span> into <code class="codehilite">Vh(Th, P1nc)</code>.</p>
<table>
<thead>
<tr>
<th align="center"><a name="Fig6">Fig. 6</a>: Projection to <code class="codehilite">Vh(Th, P1nc)</code></th>
<th align="center"><a name="Fig7">Fig. 7</a>: Projection to <code class="codehilite">Vh(Th, P1b)</code></th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="p1nc" src="../images/FiniteElement_projP1nc.png" /></td>
<td align="center"><img alt="projP1b" src="../images/FiniteElement_projP1b.png" /></td>
</tr>
</tbody>
</table>
<h2 id="other-fe-space">Other FE-space<a class="headerlink" href="#other-fe-space" title="Permanent link">#</a></h2>
<p>For each triangle <span><span class="MathJax_Preview">T_k\in \mathcal{T}_h</span><script type="math/tex">T_k\in \mathcal{T}_h</script></span>, let <span><span class="MathJax_Preview">\lambda_{k_1}(x,y),\, \lambda_{k_2}(x,y),\, \lambda_{k_3}(x,y)</span><script type="math/tex">\lambda_{k_1}(x,y),\, \lambda_{k_2}(x,y),\, \lambda_{k_3}(x,y)</script></span> be the area cordinate of the triangle (see <a href="#Fig1">Fig. 1</a>), and put</p>
<div>
<div class="MathJax_Preview">\begin{equation}
\beta_k(x,y)=27\lambda_{k_1}(x,y)\lambda_{k_2}(x,y)\lambda_{k_3}(x,y)
\end{equation}</div>
<script type="math/tex; mode=display">\begin{equation}
\beta_k(x,y)=27\lambda_{k_1}(x,y)\lambda_{k_2}(x,y)\lambda_{k_3}(x,y)
\end{equation}</script>
</div>
<p>called <em>bubble</em> function on <span><span class="MathJax_Preview">T_k</span><script type="math/tex">T_k</script></span>. The bubble function has the feature:
1. <span><span class="MathJax_Preview">\beta_k(x,y)=0\quad \textrm{if }(x,y)\in \p T_k</span><script type="math/tex">\beta_k(x,y)=0\quad \textrm{if }(x,y)\in \p T_k</script></span>.</p>
<ol>
<li><span><span class="MathJax_Preview">\beta_k(q^{k_b})=1</span><script type="math/tex">\beta_k(q^{k_b})=1</script></span> where <span><span class="MathJax_Preview">q^{k_b}</span><script type="math/tex">q^{k_b}</script></span> is the barycenter <span><span class="MathJax_Preview">\frac{q^{k_1}+q^{k_2}+q^{k_3}}{3}</span><script type="math/tex">\frac{q^{k_1}+q^{k_2}+q^{k_3}}{3}</script></span>.</li>
</ol>
<p>If we write :</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>Vh(Th, P1b);
Vh fh = f(x.y);
</pre></div>
</td></tr></table>

<p>then</p>
<p><center>
<code class="codehilite">fh =</code> <span><span class="MathJax_Preview">\displaystyle f_h(x,y)=\sum_{i=1}^{n_v}f(q^i)\phi_i(x,y)+\sum_{k=1}^{n_t}f(q^{k_b})\beta_k(x,y)</span><script type="math/tex">\displaystyle f_h(x,y)=\sum_{i=1}^{n_v}f(q^i)\phi_i(x,y)+\sum_{k=1}^{n_t}f(q^{k_b})\beta_k(x,y)</script></span>
</center></p>
<p>See <a href="#Fig7">Fig. 7</a> for the projection of <span><span class="MathJax_Preview">f(x,y)=\sin(\pi x)\cos(\pi y)</span><script type="math/tex">f(x,y)=\sin(\pi x)\cos(\pi y)</script></span> into <code class="codehilite">Vh(Th, P1b)</code>.</p>
<h2 id="vector-valued-fe-function">Vector Valued FE-function<a class="headerlink" href="#vector-valued-fe-function" title="Permanent link">#</a></h2>
<p>Functions from <span><span class="MathJax_Preview">\R^{2}</span><script type="math/tex">\R^{2}</script></span> to <span><span class="MathJax_Preview">\R^{N}</span><script type="math/tex">\R^{N}</script></span> with <span><span class="MathJax_Preview">N=1</span><script type="math/tex">N=1</script></span> is called scalar function and called <em>vector valued</em> when <span><span class="MathJax_Preview">N&gt;1</span><script type="math/tex">N>1</script></span>. When <span><span class="MathJax_Preview">N=2</span><script type="math/tex">N=2</script></span></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>fespace Vh(Th, [P0, P1]) ;
</pre></div>
</td></tr></table>

<p>make the space</p>
<div>
<div class="MathJax_Preview">
V_h=\{\mathbf{w}=(w_1,w_2)|\; w_1\in V_h(\mathcal{T}_h,P_0),\,
w_2\in V_h(\mathcal{T}_h,P_1)\}
</div>
<script type="math/tex; mode=display">
V_h=\{\mathbf{w}=(w_1,w_2)|\; w_1\in V_h(\mathcal{T}_h,P_0),\,
w_2\in V_h(\mathcal{T}_h,P_1)\}
</script>
</div>
<h3 id="raviart-thomas-element">Raviart-Thomas Element<a class="headerlink" href="#raviart-thomas-element" title="Permanent link">#</a></h3>
<p>In the Raviart-Thomas finite element <span><span class="MathJax_Preview">RT0_{h}</span><script type="math/tex">RT0_{h}</script></span>, the degrees of freedom are the fluxes across edges <span><span class="MathJax_Preview">e</span><script type="math/tex">e</script></span> of the mesh, where the flux of the function $\mathbf{f} : \R^2 \longrightarrow \R^2 $ is <span><span class="MathJax_Preview">\int_{e} \mathbf{f}.n_{e}</span><script type="math/tex">\int_{e} \mathbf{f}.n_{e}</script></span>, <span><span class="MathJax_Preview">n_{e}</span><script type="math/tex">n_{e}</script></span> is the unit normal of edge <span><span class="MathJax_Preview">e</span><script type="math/tex">e</script></span>.</p>
<p>This implies an orientation of all the edges of the mesh, for example we can use the global numbering of the edge vertices and we just go from small to large numbers.</p>
<p>To compute the flux, we use a quadrature with one Gauss point, the mid-point of the edge.</p>
<p>Consider a triangle <span><span class="MathJax_Preview">T_k</span><script type="math/tex">T_k</script></span> with three vertices <span><span class="MathJax_Preview">(\mathbf{a},\mathbf{b},\mathbf{c})</span><script type="math/tex">(\mathbf{a},\mathbf{b},\mathbf{c})</script></span>. Lets denote the vertices numbers by <span><span class="MathJax_Preview">i_{a},i_{b},i_{c}</span><script type="math/tex">i_{a},i_{b},i_{c}</script></span>, and define the three edge vectors <span><span class="MathJax_Preview">\mathbf{e}^{1},\mathbf{e}^{2},\mathbf{e}^{3}</span><script type="math/tex">\mathbf{e}^{1},\mathbf{e}^{2},\mathbf{e}^{3}</script></span> by $ sgn(i_{b}-i_{c})(\mathbf{b}-\mathbf{c})$, <span><span class="MathJax_Preview">sgn(i_{c}-i_{a})(\mathbf{c}-\mathbf{a})</span><script type="math/tex">sgn(i_{c}-i_{a})(\mathbf{c}-\mathbf{a})</script></span>, <span><span class="MathJax_Preview">sgn(i_{a}-i_{b})(\mathbf{a}-\mathbf{b})</span><script type="math/tex">sgn(i_{a}-i_{b})(\mathbf{a}-\mathbf{b})</script></span>.</p>
<p>We get three basis functions :</p>
<div>
<div class="MathJax_Preview">\begin{equation}
\boldsymbol{\phi}^{k}_{1}= \frac{sgn(i_{b}-i_{c})}{2|T_k|}(\mathbf{x}-\mathbf{a}),\quad
\boldsymbol{\phi}^{k}_{2}= \frac{sgn(i_{c}-i_{a})}{2|T_k|}(\mathbf{x}-\mathbf{b}),\quad
\boldsymbol{\phi}^{k}_{3}= \frac{sgn(i_{a}-i_{b})}{2|T_k|}(\mathbf{x}-\mathbf{c}),
\end{equation}</div>
<script type="math/tex; mode=display">\begin{equation}
\boldsymbol{\phi}^{k}_{1}= \frac{sgn(i_{b}-i_{c})}{2|T_k|}(\mathbf{x}-\mathbf{a}),\quad
\boldsymbol{\phi}^{k}_{2}= \frac{sgn(i_{c}-i_{a})}{2|T_k|}(\mathbf{x}-\mathbf{b}),\quad
\boldsymbol{\phi}^{k}_{3}= \frac{sgn(i_{a}-i_{b})}{2|T_k|}(\mathbf{x}-\mathbf{c}),
\end{equation}</script>
</div>
<p>where <span><span class="MathJax_Preview">|T_k|</span><script type="math/tex">|T_k|</script></span> is the area of the triangle <span><span class="MathJax_Preview">T_k</span><script type="math/tex">T_k</script></span>. If we write</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>Vh(Th, RT0);
Vh [f1h, f2h] = [f1(x, y), f2(x, y)];
</pre></div>
</td></tr></table>

<p>then</p>
<p><center>
<code class="codehilite">fh =</code> <span><span class="MathJax_Preview">\displaystyle \mathbf{f}_h(x,y)=\sum_{k=1}^{n_t}\sum_{l=1}^6
n_{i_lj_l}|\mathbf{e^{i_l}}|f_{j_l}(m^{i_l})\phi_{i_lj_l}</span><script type="math/tex">\displaystyle \mathbf{f}_h(x,y)=\sum_{k=1}^{n_t}\sum_{l=1}^6
n_{i_lj_l}|\mathbf{e^{i_l}}|f_{j_l}(m^{i_l})\phi_{i_lj_l}</script></span>
</center></p>
<p>where <span><span class="MathJax_Preview">n_{i_lj_l}</span><script type="math/tex">n_{i_lj_l}</script></span> is the <span><span class="MathJax_Preview">j_l</span><script type="math/tex">j_l</script></span>-th component of the normal vector <span><span class="MathJax_Preview">\mathbf{n}_{i_l}</span><script type="math/tex">\mathbf{n}_{i_l}</script></span>,</p>
<div>
<div class="MathJax_Preview">
\{m_1,m_2,m_3\} = \left\{\frac{\mathbf{b}+\mathbf{c}}{2},
\frac{\mathbf{a}+\mathbf{c}}{2},
\frac{\mathbf{b}+\mathbf{a}}{2} \right\}
</div>
<script type="math/tex; mode=display">
\{m_1,m_2,m_3\} = \left\{\frac{\mathbf{b}+\mathbf{c}}{2},
\frac{\mathbf{a}+\mathbf{c}}{2},
\frac{\mathbf{b}+\mathbf{a}}{2} \right\}
</script>
</div>
<p>and <span><span class="MathJax_Preview">i_l=\{1,1,2,2,3,3\},\, j_l=\{1,2,1,2,1,2\}</span><script type="math/tex">i_l=\{1,1,2,2,3,3\},\, j_l=\{1,2,1,2,1,2\}</script></span> with the order of <span><span class="MathJax_Preview">l</span><script type="math/tex">l</script></span>.</p>
<p><center></p>
<table>
<thead>
<tr>
<th align="center"><a name="Fig8">Fig. 8</a>: Normal vectors of each edge</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="RT0" src="../images/FiniteElement_RT0.png" /></td>
</tr>
</tbody>
</table>
<p></center></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>// Mesh
mesh Th = square(2, 2);

// Fespace
fespace Xh(Th, P1);
Xh uh = x^2 + y^2, vh;

fespace Vh(Th, RT0);
Vh [Uxh, Uyh] = [sin(x), cos(y)]; //vectorial FE function

// Change the mesh
Th = square(5,5);

//Xh is unchanged
//Uxh = x; //error: impossible to set only 1 component
           //of a vector FE function
vh = Uxh;//ok
//and now vh use the 5x5 mesh
//but the fespace of vh is always the 2x2 mesh

// Plot
plot(uh);
uh = uh; //do a interpolation of uh (old) of 5x5 mesh
         //to get the new uh on 10x10 mesh
plot(uh);

vh([x-1/2, y]) = x^2 + y^2; //interpolate vh = ((x-1/2)^2 + y^2)
</pre></div>
</td></tr></table>

<table>
<thead>
<tr>
<th align="center"><a name="Fig9">Fig. 9</a>: <code class="codehilite">vh</code> Iso on mesh <span><span class="MathJax_Preview">2\times 2</span><script type="math/tex">2\times 2</script></span></th>
<th align="center"><a name="Fig10">Fig. 10</a>: <code class="codehilite">vh</code> Iso on mesh <span><span class="MathJax_Preview">5\times 5</span><script type="math/tex">5\times 5</script></span></th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="onoldmesh" src="../images/FiniteElement_onoldmesh.png" /></td>
<td align="center"><img alt="onnewmesh" src="../images/FiniteElement_onnewmesh.png" /></td>
</tr>
</tbody>
</table>
<p>To get the value at a point <span><span class="MathJax_Preview">x=1,y=2</span><script type="math/tex">x=1,y=2</script></span> of the FE function <code class="codehilite">uh</code>, or <code class="codehilite">[Uxh, Uyh]</code>, one writes :</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>real value;
value = uh(2,4); //get value = uh(2, 4)
value = Uxh(2, 4); //get value = Uxh(2, 4)
//OR
x = 1; y = 2;
value = uh; //get value = uh(1, 2)
value = Uxh; //get value = Uxh(1, 2)
value = Uyh; //get value = Uyh(1, 2)
</pre></div>
</td></tr></table>

<p>To get the value of the array associated to the FE function <code class="codehilite">uh</code>, one writes</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>real value = uh[][0]; //get the value of degree of freedom 0
real maxdf = uh[].max; //maximum value of degree of freedom
int size = uh.n; //the number of degree of freedom
real[int] array(uh.n) = uh[]; //copy the array of the function uh
</pre></div>
</td></tr></table>

<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>For a non-scalar finite element function <code class="codehilite">[Uxh, Uyh]</code> the two arrays <code class="codehilite">Uxh[]</code> and <code class="codehilite">Uyh[]</code> are the same array, because the degree of freedom can touch more than one component.</p>
</div>
<h2 id="a-fast-finite-element-interpolator">A Fast Finite Element Interpolator<a class="headerlink" href="#a-fast-finite-element-interpolator" title="Permanent link">#</a></h2>
<p>In practice, one may discretize the variational equations by the Finite Element method. Then there will be one mesh for <span><span class="MathJax_Preview">\Omega_1</span><script type="math/tex">\Omega_1</script></span> and another one for <span><span class="MathJax_Preview">\Omega_2</span><script type="math/tex">\Omega_2</script></span>. The computation of integrals of products of functions defined on different meshes is difficult.</p>
<p>Quadrature formula and interpolations from one mesh to another at quadrature points are needed. We present below the interpolation operator which we have used and which is new, to the best of our knowledge.</p>
<p>Let <span><span class="MathJax_Preview">{\cal T}_{h}^0=\cup_k T^0_k,{\cal T}_{h}^1=\cup_k T^1_k</span><script type="math/tex">{\cal T}_{h}^0=\cup_k T^0_k,{\cal T}_{h}^1=\cup_k T^1_k</script></span> be two triangulations of a domain <span><span class="MathJax_Preview">\Omega</span><script type="math/tex">\Omega</script></span>. Let</p>
<div>
<div class="MathJax_Preview">
V({\hbox{${\cal T}$}_{h}^i}) =\{ C^0(\Omega_h^i)~:~f|_{T^i_k}\in P_0\},~~~i=0,1
</div>
<script type="math/tex; mode=display">
V({\hbox{${\cal T}$}_{h}^i}) =\{ C^0(\Omega_h^i)~:~f|_{T^i_k}\in P_0\},~~~i=0,1
</script>
</div>
<!--- __ --->

<p>be the spaces of continuous piecewise affine functions on each triangulation.</p>
<p>Let <span><span class="MathJax_Preview">f\in V({\cal T}_{h}^0)</span><script type="math/tex">f\in V({\cal T}_{h}^0)</script></span>. The problem is to find <span><span class="MathJax_Preview">g\in V({\cal T}_{h}^1)</span><script type="math/tex">g\in V({\cal T}_{h}^1)</script></span> such that</p>
<div>
<div class="MathJax_Preview">
g(q) = f(q) \quad \forall q\hbox{~vertex of ~} {\cal T}_{h}^1
</div>
<script type="math/tex; mode=display">
g(q) = f(q) \quad \forall q\hbox{~vertex of ~} {\cal T}_{h}^1
</script>
</div>
<p>Although this is a seemingly simple problem, it is difficult to find an efficient algorithm in practice.</p>
<p>We propose an algorithm which is of complexity <span><span class="MathJax_Preview">N^1\log N^0</span><script type="math/tex">N^1\log N^0</script></span>, where <span><span class="MathJax_Preview">N^i</span><script type="math/tex">N^i</script></span> is the number of vertices of <span><span class="MathJax_Preview">\cal T_{h}^i</span><script type="math/tex">\cal T_{h}^i</script></span>, and which is very fast for most practical 2D applications.</p>
<p><strong>Algorithm</strong></p>
<p>The method has 5 steps. First a quadtree is built containing all the vertices of the mesh <span><span class="MathJax_Preview">{\cal T}_{h}^0</span><script type="math/tex">{\cal T}_{h}^0</script></span> such that in each terminal cell there are at least one, and at most 4, vertices of <span><span class="MathJax_Preview">{\cal T}_{h}^0</span><script type="math/tex">{\cal T}_{h}^0</script></span>. For each <span><span class="MathJax_Preview">q^1</span><script type="math/tex">q^1</script></span>, vertex of <span><span class="MathJax_Preview">{\cal T}_{h}^1</span><script type="math/tex">{\cal T}_{h}^1</script></span> do:</p>
<ol>
<li>Find the terminal cell of the quadtree containing <span><span class="MathJax_Preview">q^1</span><script type="math/tex">q^1</script></span>.</li>
<li>Find the the nearest vertex <span><span class="MathJax_Preview">q^0_j</span><script type="math/tex">q^0_j</script></span> to <span><span class="MathJax_Preview">q^1</span><script type="math/tex">q^1</script></span> in that cell.</li>
<li>Choose one triangle <span><span class="MathJax_Preview">T_k^0\in{\cal T}_{h}^0</span><script type="math/tex">T_k^0\in{\cal T}_{h}^0</script></span> which has <span><span class="MathJax_Preview">q^0_j</span><script type="math/tex">q^0_j</script></span> for vertex.</li>
<li>
<p>Compute the barycentric coordinates <span><span class="MathJax_Preview">\{\lambda_j\}_{j=1,2,3}</span><script type="math/tex">\{\lambda_j\}_{j=1,2,3}</script></span> of <span><span class="MathJax_Preview">q^1</span><script type="math/tex">q^1</script></span> in <span><span class="MathJax_Preview">T^0_k</span><script type="math/tex">T^0_k</script></span>.</p>
<ul>
<li>if all barycentric coordinates are positive, go to Step 5</li>
<li>otherwise, if one barycentric coordinate <span><span class="MathJax_Preview">\lambda_i</span><script type="math/tex">\lambda_i</script></span> is negative, replace <span><span class="MathJax_Preview">T^0_k</span><script type="math/tex">T^0_k</script></span> by the adjacent triangle opposite <span><span class="MathJax_Preview">q^0_i</span><script type="math/tex">q^0_i</script></span> and go to Step 4.</li>
<li>otherwise, if two barycentric coordinates are negative, take one of the two randomly and replace <span><span class="MathJax_Preview">T^0_k</span><script type="math/tex">T^0_k</script></span> by the adjacent triangle as above.</li>
</ul>
</li>
<li>
<p>Calculate <span><span class="MathJax_Preview">g(q^1)</span><script type="math/tex">g(q^1)</script></span> on <span><span class="MathJax_Preview">T^0_k</span><script type="math/tex">T^0_k</script></span> by linear interpolation of <span><span class="MathJax_Preview">f</span><script type="math/tex">f</script></span>:
    <script type="math/tex; mode=display">
    g(q^1) = \sum_{j=1,2,3} \lambda_j f(q^0_j)
    </script>
</p>
</li>
</ol>
<p><center></p>
<table>
<thead>
<tr>
<th align="left"><a name="Fig11">Fig. 11</a>: To interpolate a function at <span><span class="MathJax_Preview">q^0</span><script type="math/tex">q^0</script></span>, the knowledge of the triangle which contains <span><span class="MathJax_Preview">q^0</span><script type="math/tex">q^0</script></span> is needed. The algorithm may start at <span><span class="MathJax_Preview">q^1\in T_k^0</span><script type="math/tex">q^1\in T_k^0</script></span> and stall on the boundary (thick line) because the line <span><span class="MathJax_Preview">q^0q^1</span><script type="math/tex">q^0q^1</script></span> is not inside <span><span class="MathJax_Preview">\Omega</span><script type="math/tex">\Omega</script></span>. But if the holes are triangulated too (doted line) then the problem does not arise.</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><img alt="fastInterpolate" src="../images/FiniteElement_fastInterpolate.png" /></td>
</tr>
</tbody>
</table>
<p></center></p>
<p>Two problems need to be solved:</p>
<ul>
<li>
<p><em>What if <span><span class="MathJax_Preview">q^1</span><script type="math/tex">q^1</script></span> is not in <span><span class="MathJax_Preview">\Omega^0_h</span><script type="math/tex">\Omega^0_h</script></span> ?</em> Then Step 5 will stop with a boundary triangle. So we add a step which tests the distance of <span><span class="MathJax_Preview">q^1</span><script type="math/tex">q^1</script></span> with the two adjacent boundary edges and selects the nearest, and so on till the distance grows.</p>
</li>
<li>
<p><em>What if <span><span class="MathJax_Preview">\Omega^0_h</span><script type="math/tex">\Omega^0_h</script></span> is not convex and the marching process of Step 4 locks on a boundary?</em> By construction Delaunay-Voronoï's mesh generators always triangulate the convex hull of the vertices of the domain. Therefore, we make sure that this information is not lost when <span><span class="MathJax_Preview">{\cal T}_{h}^0,{\cal T}_{h}^1</span><script type="math/tex">{\cal T}_{h}^0,{\cal T}_{h}^1</script></span> are constructed and we keep the triangles which are outside the domain on a special list. That way, in step 5 we can use that list to step over holes if needed.</p>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Sometimes, in rare cases, the interpolation process misses some points, we can change the search algorithm through a global variable <code class="codehilite">searchMethod</code></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>searchMethod = 0; // default value for fast search algorithm
searchMethod = 1; // safe search algorithm, uses brute force in case of missing point
// (warning: can be very expensive in cases where a lot of points are outside of the domain)
searchMethod = 2; // always uses brute force. It is very computationally expensive.
</pre></div>
</td></tr></table>

</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Step 3 requires an array of pointers such that each vertex points to one triangle of the triangulation.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The operator <code class="codehilite">=</code> is the interpolation operator of FreeFem++, the continuous finite functions are extended by continuity to the outside of the domain.</p>
<p>Try the following example :</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>// Mesh
mesh Ths = square(10, 10);
mesh Thg = square(30, 30, [x*3-1, y*3-1]);
plot(Ths, Thg, wait=true);

// Fespace
fespace Ch(Ths, P2);
Ch us = (x-0.5)*(y-0.5);

fespace Dh(Ths, P2dc);
Dh vs = (x-0.5)*(y-0.5);

fespace Fh(Thg, P2dc);
Fh ug=us, vg=vs;

// Plot
plot(us, ug, wait=true);
plot(vs, vg, wait=true);
</pre></div>
</td></tr></table>

<p><center></p>
<table>
<thead>
<tr>
<th align="center"><a name="Fig12">Fig. 12</a>: Extension of a continuous FE-function</th>
<th align="center"><a name="Fig13">Fig. 13</a>: Extension of discontinuous FE-function</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="us-ug" src="../images/FiniteElement_UsUg.png" /></td>
<td align="center"><img alt="vs-vg" src="../images/FiniteElement_VsVg.png" /></td>
</tr>
</tbody>
</table>
<p></center></p>
</div>
<h2 id="keywords-problem-and-solve">Keywords: Problem and Solve<a class="headerlink" href="#keywords-problem-and-solve" title="Permanent link">#</a></h2>
<p>For FreeFem++, a problem must be given in variational form, so we need a bilinear form <span><span class="MathJax_Preview">a(u,v)</span><script type="math/tex">a(u,v)</script></span>, a linear form <span><span class="MathJax_Preview">\ell(f,v)</span><script type="math/tex">\ell(f,v)</script></span>, and possibly a boundary condition form must be added.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>problem P (u, v)
    = a(u,v) - l(f,v)
    + (boundary condition)
    ;
</pre></div>
</td></tr></table>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When you want to formulate the problem and solve it in the same time, you can use the keyword <code class="codehilite">solve</code>.</p>
</div>
<h3 id="weak-form-and-boundary-condition">Weak Form and Boundary Condition<a class="headerlink" href="#weak-form-and-boundary-condition" title="Permanent link">#</a></h3>
<p>To present the principles of Variational Formulations, also called weak form, for the Partial Differential Equations, let's take a model problem: a Poisson equation with Dirichlet and Robin Boundary condition.</p>
<p>The problem: Find <span><span class="MathJax_Preview">u</span><script type="math/tex">u</script></span> a real function defined on a domain <span><span class="MathJax_Preview">\Omega</span><script type="math/tex">\Omega</script></span> of <span><span class="MathJax_Preview">\R^d</span><script type="math/tex">\R^d</script></span> <span><span class="MathJax_Preview">(d=2,3)</span><script type="math/tex">(d=2,3)</script></span> such that</p>
<div>
<div class="MathJax_Preview">\begin{equation}
    \begin{array}{rcll}
        -\nabla\cdot(\kappa \nabla u) &amp;=&amp; f &amp; \mbox{ in }\Omega\\
        a u + \kappa \frac{\p u}{\p n} &amp;=&amp; b &amp; \mbox{ on }\Gamma_r\\
        u &amp;=&amp; g &amp; \mbox{ on }\Gamma_d
    \end{array}
\end{equation}</div>
<script type="math/tex; mode=display">\begin{equation}
    \begin{array}{rcll}
        -\nabla\cdot(\kappa \nabla u) &=& f & \mbox{ in }\Omega\\
        a u + \kappa \frac{\p u}{\p n} &=& b & \mbox{ on }\Gamma_r\\
        u &=& g & \mbox{ on }\Gamma_d
    \end{array}
\end{equation}</script>
</div>
<p>where</p>
<ul>
<li>
<p>if <span><span class="MathJax_Preview">d=2</span><script type="math/tex">d=2</script></span> then $ \nabla.(\kappa \nabla u) = \p_x(\kappa \p_x u ) + \p_y(\kappa \p_y u ) $ with $ \p_x u = \frac{\p u}{\p x}$ and <span><span class="MathJax_Preview">\p_y u = \frac{\p u}{\p y}</span><script type="math/tex">\p_y u = \frac{\p u}{\p y}</script></span></p>
</li>
<li>
<p>if <span><span class="MathJax_Preview">d=3</span><script type="math/tex">d=3</script></span> then <span><span class="MathJax_Preview">\nabla.(\kappa \nabla u) = \p_x(\kappa \p_x u) + \p_y(\kappa \p_y u) + \p_z(\kappa \p_z u)</span><script type="math/tex">\nabla.(\kappa \nabla u) = \p_x(\kappa \p_x u) + \p_y(\kappa \p_y u) + \p_z(\kappa \p_z u)</script></span> with $ \p_x u = \frac{\p u}{\p x}$, <span><span class="MathJax_Preview">\p_y u = \frac{\p u}{\p y}</span><script type="math/tex">\p_y u = \frac{\p u}{\p y}</script></span> and , <span><span class="MathJax_Preview">\p_z u = \frac{\p u}{\p z}</span><script type="math/tex">\p_z u = \frac{\p u}{\p z}</script></span></p>
</li>
<li>
<p>The border <span><span class="MathJax_Preview">\Gamma=\p \Omega</span><script type="math/tex">\Gamma=\p \Omega</script></span> is split in <span><span class="MathJax_Preview">\Gamma_d</span><script type="math/tex">\Gamma_d</script></span> and <span><span class="MathJax_Preview">\Gamma_n</span><script type="math/tex">\Gamma_n</script></span> such that <span><span class="MathJax_Preview">\Gamma_d \cap \Gamma_n = \emptyset</span><script type="math/tex">\Gamma_d \cap \Gamma_n = \emptyset</script></span> and $ \Gamma_d \cup \Gamma_n = \p \Omega$,</p>
</li>
<li>
<p><span><span class="MathJax_Preview">\kappa</span><script type="math/tex">\kappa</script></span> is a given positive function, such that $\exists \kappa_0 \in \R ,\quad 0 &lt; \kappa_0 \leq \kappa $.</p>
</li>
<li>
<p><span><span class="MathJax_Preview">a</span><script type="math/tex">a</script></span> a given non negative function,</p>
</li>
<li>
<p><span><span class="MathJax_Preview">b</span><script type="math/tex">b</script></span> a given function.</p>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This is the well known Neumann boundary condition if <span><span class="MathJax_Preview">a=0</span><script type="math/tex">a=0</script></span>, and if <span><span class="MathJax_Preview">\Gamma_d</span><script type="math/tex">\Gamma_d</script></span> is empty. In this case the function appears in the problem just by its derivatives, so it is defined only up to a constant (if <span><span class="MathJax_Preview">u</span><script type="math/tex">u</script></span> is a solution then <span><span class="MathJax_Preview">u+c</span><script type="math/tex">u+c</script></span> is also a solution).</p>
</div>
<p>Let <span><span class="MathJax_Preview">{v}</span><script type="math/tex">{v}</script></span>, a regular test function, null on <span><span class="MathJax_Preview">\Gamma_d</span><script type="math/tex">\Gamma_d</script></span>, by integration by parts we get :
<script type="math/tex; mode=display">\begin{equation}
    - \int_{\Omega} \nabla\cdot(\kappa \nabla u) \, {v} \,d\omega
    = \int_{\Omega} \kappa \nabla{ v} \cdot \nabla u \,d\omega
    - \int_{\Gamma} {v}\kappa \frac{ \p u}{\p \mathbf{n}} \,d\gamma,= \int_{\Omega} f {v} \,d\omega
\end{equation}</script>
</p>
<p>where if <span><span class="MathJax_Preview">d=2</span><script type="math/tex">d=2</script></span> the $ \nabla{ v} . \nabla u = (\frac{\p u}{\p x}\frac{\p { v}}{\p x}+\frac{\p u}{\p y}\frac{\p { v}}{\p y})$,</p>
<p>where if <span><span class="MathJax_Preview">d=3</span><script type="math/tex">d=3</script></span> the $ \nabla{ v} . \nabla u = (\frac{\p u}{\p x}\frac{\p { v}}{\p x}+\frac{\p u}{\p y}\frac{\p { v}}{\p y} + \frac{\p u}{\p z}\frac{\p { v}}{\p z})$,</p>
<p>and where <span><span class="MathJax_Preview">\mathbf{n}</span><script type="math/tex">\mathbf{n}</script></span> is the unitary outer-pointing normal of the <span><span class="MathJax_Preview">\Gamma</span><script type="math/tex">\Gamma</script></span>.</p>
<p>Now we note that $\kappa \frac{ \p u}{\p n} = - a u + b $ on <span><span class="MathJax_Preview">\Gamma_r</span><script type="math/tex">\Gamma_r</script></span> and <span><span class="MathJax_Preview">v=0</span><script type="math/tex">v=0</script></span> on $ \Gamma_d $ and $ \Gamma = \Gamma_d \cup \Gamma_n$
thus</p>
<div>
<div class="MathJax_Preview">
- \int_{\Gamma} {v}
\kappa \frac{ \p u}{\p n} = \int_{\Gamma_r} a u v - \int_{\Gamma_r} b v
</div>
<script type="math/tex; mode=display">
- \int_{\Gamma} {v}
\kappa \frac{ \p u}{\p n} = \int_{\Gamma_r} a u v - \int_{\Gamma_r} b v
</script>
</div>
<p>The problem becomes:</p>
<p>Find <span><span class="MathJax_Preview">u \in V_g = \{w \in H^1(\Omega) / w = g \mbox{ on } \Gamma_d \}</span><script type="math/tex">u \in V_g = \{w \in H^1(\Omega) / w = g \mbox{ on } \Gamma_d \}</script></span> such that
<script type="math/tex; mode=display">\begin{equation}
{\int_{\Omega} \kappa \nabla{ v} . \nabla u \,d\omega + \int_{\Gamma_r} a u v \,d\gamma = \int_{\Omega} f {v}} \,d\omega
+ \int_{\Gamma_r} b v \,d\gamma , \quad \forall v \in V_0
\label{eqn::v-poisson}
\end{equation}</script>
</p>
<p>where <span><span class="MathJax_Preview">V_0 = \{v \in H^1(\Omega) / v = 0 \mbox{ on } \Gamma_d \}</span><script type="math/tex">V_0 = \{v \in H^1(\Omega) / v = 0 \mbox{ on } \Gamma_d \}</script></span></p>
<p>Except in the case of Neumann conditions everywhere, the problem \eqref{eqn::v-poisson} is well posed when <span><span class="MathJax_Preview">\kappa\geq \kappa_0&gt;0</span><script type="math/tex">\kappa\geq \kappa_0>0</script></span>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If we have only the Neumann boundary condition, linear algebra tells us that the right hand side must be orthogonal to the kernel of the operator for the solution to exist. One way of writing the compatibility condition is:</p>
<div>
<div class="MathJax_Preview">
 \int_{\Omega} f \,d\omega + \int_{\Gamma} b \,d\gamma=0
</div>
<script type="math/tex; mode=display">
 \int_{\Omega} f \,d\omega + \int_{\Gamma} b \,d\gamma=0
</script>
</div>
<p>and a way to fix the constant is to solve for <span><span class="MathJax_Preview">u \in H^1(\Omega)</span><script type="math/tex">u \in H^1(\Omega)</script></span> such that:
<script type="math/tex; mode=display">\begin{equation}
{\int_{\Omega} (\varepsilon u v \; + \; \kappa \nabla{ v} . \nabla u) \,d\omega
= \int_{\Omega} f {v}} \,d\omega + \int_{\Gamma_r} b v \,d\gamma , \quad \forall v \in H^1(\Omega)
\end{equation}</script>
where <span><span class="MathJax_Preview">\varepsilon</span><script type="math/tex">\varepsilon</script></span> is a small parameter ($ \sim \kappa\; 10^{-10} |\Omega|^{\frac2d} $).</p>
<p>Remark that if the solution is of order <span><span class="MathJax_Preview">\frac{1}{\varepsilon}</span><script type="math/tex">\frac{1}{\varepsilon}</script></span> then the compatibility condition is unsatisfied, otherwise we get the solution such that $\int_\Omega u = 0 $, you can also add a Lagrange multiplier to solve the real mathematical problem like in the <a href="../examples/lagrange-multipliers">Lagrange multipliers example</a>.</p>
</div>
<p>In FreeFem++, the bidimensional problem \eqref{eqn::v-poisson} becomes :</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>problem Pw (u, v)
    = int2d(Th)( //int_{Omega} kappa nabla v . nabla u
          kappa*(dx(u)*dx(v) + dy(u)*dy(v))
    )
    + int1d(Th, gn)( //int_{Gamma_r} a u v
          a * u*v
    )
    - int2d(Th)( //int_{Omega} f v
          f*v
    )
    - int1d(Th, gn)( //int_{Gamma_r} b v
          b * v
    )
    + on(gd, u=g) //u = g on Gamma_d
    ;
</pre></div>
</td></tr></table>

<p>where <code class="codehilite">Th</code> is a mesh of the bi-dimensional domain <span><span class="MathJax_Preview">\Omega</span><script type="math/tex">\Omega</script></span>, and <code class="codehilite">gd</code> and <code class="codehilite">gn</code> are respectively the boundary labels of boundary <span><span class="MathJax_Preview">\Gamma_d</span><script type="math/tex">\Gamma_d</script></span> and <span><span class="MathJax_Preview">\Gamma_n</span><script type="math/tex">\Gamma_n</script></span>.</p>
<p>And the three dimensional problem \eqref{eqn::v-poisson} becomes</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>macro Grad(u) [dx(u), dy(u), dz(u) ]//
problem Pw (u, v)
    = int3d(Th)( //int_{Omega} kappa nabla v . nabla u
          kappa*(Grad(u)&#39;*Grad(v))
    )
    + int2d(Th, gn)( //int_{Gamma_r} a u v
          a * u*v
    )
    - int3d(Th)( //int_{Omega} f v
          f*v
    )
    - int2d(Th, gn)( //int_{Gamma_r} b v
          b * v
    )
    + on(gd, u=g) //u = g on Gamma_d
    ;
</pre></div>
</td></tr></table>

<p>where <code class="codehilite">Th</code> is a mesh of the three dimensional domain <span><span class="MathJax_Preview">\Omega</span><script type="math/tex">\Omega</script></span>, and <code class="codehilite">gd</code> and <code class="codehilite">gn</code> are respectively the boundary labels of boundary <span><span class="MathJax_Preview">\Gamma_d</span><script type="math/tex">\Gamma_d</script></span> and <span><span class="MathJax_Preview">\Gamma_n</span><script type="math/tex">\Gamma_n</script></span>.</p>
<h2 id="parameters-affecting-solve-and-problem">Parameters affecting <code class="codehilite">solve</code> and <code class="codehilite">problem</code><a class="headerlink" href="#parameters-affecting-solve-and-problem" title="Permanent link">#</a></h2>
<p>The parameters are FE functions real or complex, the number <span><span class="MathJax_Preview">n</span><script type="math/tex">n</script></span> of parameters is even (<span><span class="MathJax_Preview">n=2*k</span><script type="math/tex">n=2*k</script></span>), the <span><span class="MathJax_Preview">k</span><script type="math/tex">k</script></span> first function parameters are unknown, and the <span><span class="MathJax_Preview">k</span><script type="math/tex">k</script></span> last are test functions.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If the functions are a part of vectorial FE then you must give all the functions of the vectorial FE in the same order (see <a href=".models/StaticProblems/#poisson-with-mixed-finite-element">Poisson problem with mixed finite element</a> for example).</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Don't mix complex and real parameters FE function.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p><strong>Bug :</strong> The mixing of multiple <code class="codehilite">fespace</code> with different periodic boundary conditions are not implemented. So all the finite element spaces used for tests or unknown functions in a problem, must have the same type of periodic boundary conditions or no periodic boundary conditions. No clean message is given and the result is unpredictable.</p>
</div>
<p>The parameters are:</p>
<ul>
<li>
<p><strong>solver=</strong> <code class="codehilite">LU</code>, <code class="codehilite">CG</code>, <code class="codehilite">Crout</code>,<code class="codehilite">Cholesky</code>,<code class="codehilite">GMRES</code>,<code class="codehilite">sparsesolver</code>, <code class="codehilite">UMFPACK</code> ...</p>
<p>The default solver is <code class="codehilite">sparsesolver</code> (it is equal to <code class="codehilite">UMFPACK</code> if no other sparse solver is defined) or is set to <code class="codehilite">LU</code> if no direct sparse solver is available.</p>
<p>The storage mode of the matrix of the underlying linear system depends on the type of solver chosen; for <code class="codehilite">LU</code> the matrix is sky-line non symmetric, for <code class="codehilite">Crout</code> the matrix is sky-line symmetric, for <code class="codehilite">Cholesky</code> the matrix is sky-line symmetric positive definite, for <code class="codehilite">CG</code> the matrix is sparse symmetric positive, and for <code class="codehilite">GMRES</code>, <code class="codehilite">sparsesolver</code> or <code class="codehilite">UMFPACK</code> the matrix is just sparse.</p>
</li>
<li>
<p><strong>eps=</strong> a real expression. <span><span class="MathJax_Preview">\varepsilon</span><script type="math/tex">\varepsilon</script></span> sets the stopping test for the iterative methods like <code class="codehilite">CG</code>. Note that if <span><span class="MathJax_Preview">\varepsilon</span><script type="math/tex">\varepsilon</script></span> is negative then the stopping test is:
    <script type="math/tex; mode=display">
    || A x - b || < |\varepsilon|
    </script>
    if it is positive, then the stopping test is
    <script type="math/tex; mode=display">
    || A x - b || < \frac{|\varepsilon|}{|| A x_{0} - b ||}
    </script>
</p>
</li>
<li>
<p><strong>init=</strong> boolean expression, if it is false or 0 the matrix is reconstructed. Note that if the mesh changes the matrix is reconstructed too.</p>
</li>
<li>
<p><strong>precon=</strong> name of a function (for example <code class="codehilite">P</code>) to set the preconditioner. The prototype for the function <code class="codehilite">P</code> must be</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>func real[int] P(real[int] &amp; xx);
</pre></div>
</td></tr></table>

</li>
<li>
<p><strong>tgv=</strong> Huge value (<span><span class="MathJax_Preview">10^{30}</span><script type="math/tex">10^{30}</script></span>) used to implement Dirichlet boundary conditions.</p>
</li>
<li>
<p><strong>tolpivot=</strong> sets the tolerance of the pivot in <code class="codehilite">UMFPACK</code> (<span><span class="MathJax_Preview">10^{-1}</span><script type="math/tex">10^{-1}</script></span>) and, <code class="codehilite">LU</code>, <code class="codehilite">Crout</code>, <code class="codehilite">Cholesky</code> factorisation (<span><span class="MathJax_Preview">10^{-20}</span><script type="math/tex">10^{-20}</script></span>).</p>
</li>
<li>
<p><strong>tolpivotsym=</strong> sets the tolerance of the pivot sym in <code class="codehilite">UMFPACK</code></p>
</li>
<li>
<p><strong>strategy=</strong> sets the integer <code class="codehilite">UMFPACK</code> strategy (<span><span class="MathJax_Preview">0</span><script type="math/tex">0</script></span> by default).</p>
</li>
</ul>
<h2 id="problem-definition">Problem definition<a class="headerlink" href="#problem-definition" title="Permanent link">#</a></h2>
<p>Below <code class="codehilite">v</code> is the unknown function and <code class="codehilite">w</code> is the test function. After the "=" sign, one may find sums of:</p>
<ul>
<li>
<p>Identifier(s); this is the name given earlier to the variational form(s) (type <code class="codehilite">varf</code> ) for possible reuse.</p>
<p>Remark, that the name in the <code class="codehilite">varf</code> of the unknown test function is forgotten, we use the order in the argument list to recall names as in a <code>C++</code> function,</p>
</li>
<li>
<p>The terms of the bilinear form itself: if <span><span class="MathJax_Preview">K</span><script type="math/tex">K</script></span> is a given function,</p>
</li>
<li>
<p>Bilinear part for 3D meshes <code class="codehilite">Th</code></p>
<ul>
<li>
<p><code class="codehilite">int3d(Th)(K*v*w) =</code> $\displaystyle\sum_{T\in\mathtt{Th}}\int_{T } K\,v\,w $</p>
</li>
<li>
<p><code class="codehilite">int3d(Th, 1)(K*v*w) =</code> $\displaystyle\sum_{T\in\mathtt{Th},T\subset \Omega_{1}}\int_{T} K\,v\,w $</p>
</li>
<li>
<p><code class="codehilite">int3d(Th, levelset=phi)(K*v*w) =</code> <span><span class="MathJax_Preview">\displaystyle\sum_{T\in\mathtt{Th}}\int_{T,\phi&lt;0} K\,v\,w</span><script type="math/tex">\displaystyle\sum_{T\in\mathtt{Th}}\int_{T,\phi<0} K\,v\,w</script></span></p>
</li>
<li>
<p><code class="codehilite">int3d(Th, l, levelset=phi)(K*v*w) =</code> <span><span class="MathJax_Preview">\displaystyle\sum_{T\in\mathtt{Th},T\subset \Omega_{l}}\int_{T,\phi&lt;0} K\,v\,w</span><script type="math/tex">\displaystyle\sum_{T\in\mathtt{Th},T\subset \Omega_{l}}\int_{T,\phi<0} K\,v\,w</script></span></p>
</li>
<li>
<p><code class="codehilite">int2d(Th, 2, 5)(K*v*w) =</code> $\displaystyle\sum_{T\in\mathtt{Th}}\int_{(\p T\cup\Gamma) \cap ( \Gamma_2 \cup \Gamma_{5})} K\,v\,w $</p>
</li>
<li>
<p><code class="codehilite">int2d(Th, 1)(K*v*w) =</code> <span><span class="MathJax_Preview">\displaystyle\sum_{T\in\mathtt{Th},T\subset \Omega_{1}}\int_{T} K\,v\,w</span><script type="math/tex">\displaystyle\sum_{T\in\mathtt{Th},T\subset \Omega_{1}}\int_{T} K\,v\,w</script></span></p>
</li>
<li>
<p><code class="codehilite">int2d(Th, 2, 5)(K*v*w) =</code> <span><span class="MathJax_Preview">\displaystyle\sum_{T\in\mathtt{Th}}\int_{(\p T\cup\Gamma) \cap (\Gamma_2 \cup \Gamma_{5})} K\,v\,w</span><script type="math/tex">\displaystyle\sum_{T\in\mathtt{Th}}\int_{(\p T\cup\Gamma) \cap (\Gamma_2 \cup \Gamma_{5})} K\,v\,w</script></span></p>
</li>
<li>
<p><code class="codehilite">int2d(Th, levelset=phi)(K*v*w) =</code> <span><span class="MathJax_Preview">\displaystyle\sum_{T\in\mathtt{Th}}\int_{T,\phi=0} K\,v\,w</span><script type="math/tex">\displaystyle\sum_{T\in\mathtt{Th}}\int_{T,\phi=0} K\,v\,w</script></span></p>
</li>
<li>
<p><code class="codehilite">int2d(Th, l, levelset=phi)(K*v*w) =</code> <span><span class="MathJax_Preview">\displaystyle\sum_{T\in\mathtt{Th},T\subset \Omega_{l}}\int_{T,\phi=0} K\,v\,w</span><script type="math/tex">\displaystyle\sum_{T\in\mathtt{Th},T\subset \Omega_{l}}\int_{T,\phi=0} K\,v\,w</script></span></p>
</li>
<li>
<p><code class="codehilite">intallfaces(Th)(K*v*w) =</code> <span><span class="MathJax_Preview">\displaystyle\sum_{T\in\mathtt{Th}}\int_{\p T } K\,v\,w</span><script type="math/tex">\displaystyle\sum_{T\in\mathtt{Th}}\int_{\p T } K\,v\,w</script></span></p>
</li>
<li>
<p><code class="codehilite">intallfaces(Th, 1)(K*v*w) =</code> <span><span class="MathJax_Preview">\displaystyle\sum_{{T\in\mathtt{Th},T\subset \Omega_{1}}}\int_{\p T } K\,v\,w</span><script type="math/tex">\displaystyle\sum_{{T\in\mathtt{Th},T\subset \Omega_{1}}}\int_{\p T } K\,v\,w</script></span></p>
</li>
<li>
<p>They contribute to the sparse matrix of type <code class="codehilite">matrix</code> which, whether declared explicitly or not, is constructed by FreeFem++.</p>
</li>
</ul>
</li>
<li>
<p>Bilinear part for 2D meshes <code class="codehilite">Th</code></p>
<ul>
<li>
<p><code class="codehilite">int2d(Th)(K*v*w) =</code> <span><span class="MathJax_Preview">\displaystyle\sum_{T\in\mathtt{Th}}\int_{T } K\,v\,w</span><script type="math/tex">\displaystyle\sum_{T\in\mathtt{Th}}\int_{T } K\,v\,w</script></span></p>
</li>
<li>
<p><code class="codehilite">int2d(Th, 1)(K*v*w) =</code> <span><span class="MathJax_Preview">\displaystyle\sum_{T\in\mathtt{Th},T\subset \Omega_{1}}\int_{T} K\,v\,w</span><script type="math/tex">\displaystyle\sum_{T\in\mathtt{Th},T\subset \Omega_{1}}\int_{T} K\,v\,w</script></span></p>
</li>
<li>
<p><code class="codehilite">int2d(Th, levelset=phi)(K*v*w) =</code> <span><span class="MathJax_Preview">\displaystyle\sum_{T\in\mathtt{Th}}\int_{T,\phi&lt;0} K\,v\,w</span><script type="math/tex">\displaystyle\sum_{T\in\mathtt{Th}}\int_{T,\phi<0} K\,v\,w</script></span></p>
</li>
<li>
<p><code class="codehilite">int2d(Th, l, levelset=phi)(K*v*w) =</code> <span><span class="MathJax_Preview">\displaystyle\sum_{T\in\mathtt{Th},T\subset \Omega_{l}}\int_{T,\phi&lt;0} K\,v\,w</span><script type="math/tex">\displaystyle\sum_{T\in\mathtt{Th},T\subset \Omega_{l}}\int_{T,\phi<0} K\,v\,w</script></span></p>
</li>
<li>
<p><code class="codehilite">int1d(Th, 2, 5)(K*v*w) =</code> <span><span class="MathJax_Preview">\displaystyle\sum_{T\in\mathtt{Th}}\int_{(\p T\cup\Gamma) \cap ( \Gamma_2 \cup \Gamma_{5})} K\,v\,w</span><script type="math/tex">\displaystyle\sum_{T\in\mathtt{Th}}\int_{(\p T\cup\Gamma) \cap ( \Gamma_2 \cup \Gamma_{5})} K\,v\,w</script></span></p>
</li>
<li>
<p><code class="codehilite">int1d(Th, 1)(K*v*w) =</code> <span><span class="MathJax_Preview">\displaystyle\sum_{T\in\mathtt{Th},T\subset \Omega_{1}}\int_{T} K\,v\,w</span><script type="math/tex">\displaystyle\sum_{T\in\mathtt{Th},T\subset \Omega_{1}}\int_{T} K\,v\,w</script></span></p>
</li>
<li>
<p><code class="codehilite">int1d(Th, 2, 5)(K*v*w) =</code> <span><span class="MathJax_Preview">\displaystyle\sum_{T\in\mathtt{Th}}\int_{(\p T\cup\Gamma) \cap ( \Gamma_2 \cup \Gamma_{5})} K\,v\,w</span><script type="math/tex">\displaystyle\sum_{T\in\mathtt{Th}}\int_{(\p T\cup\Gamma) \cap ( \Gamma_2 \cup \Gamma_{5})} K\,v\,w</script></span></p>
</li>
<li>
<p><code class="codehilite">int1d(Th, levelset=phi)(K*v*w) =</code> <span><span class="MathJax_Preview">\displaystyle\sum_{T\in\mathtt{Th}}\int_{T,\phi=0} K\,v\,w</span><script type="math/tex">\displaystyle\sum_{T\in\mathtt{Th}}\int_{T,\phi=0} K\,v\,w</script></span></p>
</li>
<li>
<p><code class="codehilite">int1d(Th, l, levelset=phi)(K*v*w) =</code> <span><span class="MathJax_Preview">\displaystyle\sum_{T\in\mathtt{Th},T\subset \Omega_{l}}\int_{T,\phi=0} K\,v\,w</span><script type="math/tex">\displaystyle\sum_{T\in\mathtt{Th},T\subset \Omega_{l}}\int_{T,\phi=0} K\,v\,w</script></span></p>
</li>
<li>
<p><code class="codehilite">intalledges(Th)(K*v*w) =</code> <span><span class="MathJax_Preview">\displaystyle\sum_{T\in\mathtt{Th}}\int_{\p T } K\,v\,w</span><script type="math/tex">\displaystyle\sum_{T\in\mathtt{Th}}\int_{\p T } K\,v\,w</script></span></p>
</li>
<li>
<p><code class="codehilite">intalledges(Th, 1)(K*v*w) =</code> <span><span class="MathJax_Preview">\displaystyle\sum_{{T\in\mathtt{Th},T\subset \Omega_{1}}}\int_{\p T } K\,v\,w</span><script type="math/tex">\displaystyle\sum_{{T\in\mathtt{Th},T\subset \Omega_{1}}}\int_{\p T } K\,v\,w</script></span></p>
</li>
<li>
<p>They contribute to the sparse matrix of type <code class="codehilite">matrix</code> which, whether declared explicitly or not, is constructed by FreeFem++.</p>
</li>
</ul>
</li>
<li>
<p>The right hand-side of the Partial Differential Equation in 3D, the terms of the linear form: for given functions <span><span class="MathJax_Preview">K,\, f</span><script type="math/tex">K,\, f</script></span>:</p>
<ul>
<li>
<p><code class="codehilite">int3d(Th)(K*w) =</code> <span><span class="MathJax_Preview">\displaystyle\sum_{T\in\mathtt{Th}}\int_{T} K\,w</span><script type="math/tex">\displaystyle\sum_{T\in\mathtt{Th}}\int_{T} K\,w</script></span></p>
</li>
<li>
<p><code class="codehilite">int3d(Th, l)(K*w) =</code> <span><span class="MathJax_Preview">\displaystyle\sum_{T\in\mathtt{Th},T\in\Omega_l}\int_{T} K\,w</span><script type="math/tex">\displaystyle\sum_{T\in\mathtt{Th},T\in\Omega_l}\int_{T} K\,w</script></span></p>
</li>
<li>
<p><code class="codehilite">int3d(Th, levelset=phi)(K*w) =</code> <span><span class="MathJax_Preview">\displaystyle\sum_{T\in\mathtt{Th}}\int_{T,\phi&lt;0} K\,w</span><script type="math/tex">\displaystyle\sum_{T\in\mathtt{Th}}\int_{T,\phi<0} K\,w</script></span></p>
</li>
<li>
<p><code class="codehilite">int3d(Th, l, levelset=phi)(K*w) =</code> <span><span class="MathJax_Preview">\displaystyle\sum_{T\in\mathtt{Th},T\subset\Omega_{l}}\int_{T,\phi&lt;0} K\,w</span><script type="math/tex">\displaystyle\sum_{T\in\mathtt{Th},T\subset\Omega_{l}}\int_{T,\phi<0} K\,w</script></span></p>
</li>
<li>
<p><code class="codehilite">int2d(Th, 2, 5)(K*w) =</code> <span><span class="MathJax_Preview">\displaystyle\sum_{T\in\mathtt{Th}}\int_{(\p T\cup\Gamma) \cap ( \Gamma_2 \cup \Gamma_{5}) } K \,w</span><script type="math/tex">\displaystyle\sum_{T\in\mathtt{Th}}\int_{(\p T\cup\Gamma) \cap ( \Gamma_2 \cup \Gamma_{5}) } K \,w</script></span></p>
</li>
<li>
<p><code class="codehilite">int2d(Th, levelset=phi)(K*w) =</code> <span><span class="MathJax_Preview">\displaystyle\sum_{T\in\mathtt{Th}}\int_{T,\phi=0} K\,w</span><script type="math/tex">\displaystyle\sum_{T\in\mathtt{Th}}\int_{T,\phi=0} K\,w</script></span></p>
</li>
<li>
<p><code class="codehilite">int2d(Th, l, levelset=phi)(K*w) =</code> <span><span class="MathJax_Preview">\displaystyle\sum_{T\in\mathtt{Th},T\subset \Omega_{l}}\int_{T,\phi=0} K\,w</span><script type="math/tex">\displaystyle\sum_{T\in\mathtt{Th},T\subset \Omega_{l}}\int_{T,\phi=0} K\,w</script></span></p>
</li>
<li>
<p><code class="codehilite">intallfaces(Th)(f*w) =</code> <span><span class="MathJax_Preview">\displaystyle\sum_{T\in\mathtt{Th}}\int_{\p T } f\,w</span><script type="math/tex">\displaystyle\sum_{T\in\mathtt{Th}}\int_{\p T } f\,w</script></span></p>
</li>
<li>
<p>A vector of type <code class="codehilite">real[int]</code></p>
</li>
</ul>
</li>
<li>
<p>The right hand-side of the Partial Differential Equation in 2D, the terms of the linear form: for given functions <span><span class="MathJax_Preview">K,\, f</span><script type="math/tex">K,\, f</script></span>:</p>
<ul>
<li>
<p><code class="codehilite">int2d(Th)(K*w) =</code> <span><span class="MathJax_Preview">\displaystyle\sum_{T\in\mathtt{Th}}\int_{T} K\,w</span><script type="math/tex">\displaystyle\sum_{T\in\mathtt{Th}}\int_{T} K\,w</script></span></p>
</li>
<li>
<p><code class="codehilite">int2d(Th, l)(K*w) =</code> <span><span class="MathJax_Preview">\displaystyle\sum_{T\in\mathtt{Th},T\in\Omega_l}\int_{T} K\,w</span><script type="math/tex">\displaystyle\sum_{T\in\mathtt{Th},T\in\Omega_l}\int_{T} K\,w</script></span></p>
</li>
<li>
<p><code class="codehilite">int2d(Th, levelset=phi)(K*w) =</code> <span><span class="MathJax_Preview">\displaystyle\sum_{T\in\mathtt{Th}}\int_{T,\phi&lt;0} K\,w</span><script type="math/tex">\displaystyle\sum_{T\in\mathtt{Th}}\int_{T,\phi<0} K\,w</script></span></p>
</li>
<li>
<p><code class="codehilite">int2d(Th, l, levelset=phi)(K*w) =</code> <span><span class="MathJax_Preview">\displaystyle\sum_{T\in\mathtt{Th},T\subset\Omega_{l}}\int_{T,\phi&lt;0} K\,w</span><script type="math/tex">\displaystyle\sum_{T\in\mathtt{Th},T\subset\Omega_{l}}\int_{T,\phi<0} K\,w</script></span></p>
</li>
<li>
<p><code class="codehilite">int1d(Th, 2, 5)(K*w) =</code> <span><span class="MathJax_Preview">\displaystyle\sum_{T\in\mathtt{Th}}\int_{(\p T\cup\Gamma) \cap ( \Gamma_2 \cup \Gamma_{5}) } K \,w</span><script type="math/tex">\displaystyle\sum_{T\in\mathtt{Th}}\int_{(\p T\cup\Gamma) \cap ( \Gamma_2 \cup \Gamma_{5}) } K \,w</script></span></p>
</li>
<li>
<p><code class="codehilite">int1d(Th, levelset=phi)(K*w) =</code> <span><span class="MathJax_Preview">\displaystyle\sum_{T\in\mathtt{Th}}\int_{T,\phi=0} K\,w</span><script type="math/tex">\displaystyle\sum_{T\in\mathtt{Th}}\int_{T,\phi=0} K\,w</script></span></p>
</li>
<li>
<p><code class="codehilite">int1d(Th, l, levelset=phi)(K*w) =</code> <span><span class="MathJax_Preview">\displaystyle\sum_{T\in\mathtt{Th},T\subset\Omega_{l}}\int_{T,\phi=0} K\,w</span><script type="math/tex">\displaystyle\sum_{T\in\mathtt{Th},T\subset\Omega_{l}}\int_{T,\phi=0} K\,w</script></span></p>
</li>
<li>
<p><code class="codehilite">intalledges(Th)(f*w) =</code> <span><span class="MathJax_Preview">\displaystyle\sum_{T\in\mathtt{Th}}\int_{\p T } f\,w</span><script type="math/tex">\displaystyle\sum_{T\in\mathtt{Th}}\int_{\p T } f\,w</script></span></p>
</li>
<li>
<p>a vector of type <code class="codehilite">real[int]</code></p>
</li>
</ul>
</li>
<li>
<p>The boundary condition terms:</p>
<ul>
<li>
<p>An "on" scalar form (for Dirichlet) : <code class="codehilite">on(1, u=g)</code></p>
<p>Used for all degrees of freedom <span><span class="MathJax_Preview">i</span><script type="math/tex">i</script></span> of the boundary referred by "1", the diagonal term of the matrix <span><span class="MathJax_Preview">a_{ii}= tgv</span><script type="math/tex">a_{ii}= tgv</script></span> with the <em>terrible giant value</em> <code class="codehilite">tgv</code> (=<span><span class="MathJax_Preview">10^{30}</span><script type="math/tex">10^{30}</script></span> by default), and the right hand side <span><span class="MathJax_Preview">b[i] = "(\Pi_h g)[i]" \times tgv</span><script type="math/tex">b[i] = "(\Pi_h g)[i]" \times tgv</script></span>, where the <span><span class="MathJax_Preview">"(\Pi_h g)g[i]"</span><script type="math/tex">"(\Pi_h g)g[i]"</script></span> is the boundary node value given by the interpolation of <span><span class="MathJax_Preview">g</span><script type="math/tex">g</script></span>. <span><span class="MathJax_Preview">\codered</span><script type="math/tex">\codered</script></span></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>if <span><span class="MathJax_Preview">\mathrm{tgv} &lt; 0</span><script type="math/tex">\mathrm{tgv} < 0</script></span> then we put to <span><span class="MathJax_Preview">0</span><script type="math/tex">0</script></span> all term of the line <span><span class="MathJax_Preview">i</span><script type="math/tex">i</script></span> in the matrix, except diagonal term <span><span class="MathJax_Preview">a_{ii}=1</span><script type="math/tex">a_{ii}=1</script></span>, and <span><span class="MathJax_Preview">b[i] = "(\Pi_h g)[i]"</span><script type="math/tex">b[i] = "(\Pi_h g)[i]"</script></span>.</p>
</div>
</li>
<li>
<p>An "on" vectorial form (for Dirichlet) : <code class="codehilite">on(1, u1=g1, u2=g2)</code></p>
<p>If you have vectorial finite element like <code class="codehilite">RT0</code>, the 2 components are coupled, and so you have : $b[i] = "(\Pi_h (g1,g2))[i]" \times tgv $, where <span><span class="MathJax_Preview">\Pi_h</span><script type="math/tex">\Pi_h</script></span> is the vectorial finite element interpolant.</p>
</li>
<li>
<p>A linear form on <span><span class="MathJax_Preview">\Gamma</span><script type="math/tex">\Gamma</script></span> (for Neumann in 2d) <code class="codehilite">-int1d(Th)(f*w)</code> or <code class="codehilite">-int1d(Th, 3)(f*w)</code></p>
</li>
<li>
<p>A bilinear form on <span><span class="MathJax_Preview">\Gamma</span><script type="math/tex">\Gamma</script></span> or <span><span class="MathJax_Preview">\Gamma_{2}</span><script type="math/tex">\Gamma_{2}</script></span> (for Robin in 2d) <code class="codehilite">int1d(Th)(K*v*w)</code> or <code class="codehilite">int1d(Th,2)(K*v*w)</code></p>
</li>
<li>
<p>A linear form on <span><span class="MathJax_Preview">\Gamma</span><script type="math/tex">\Gamma</script></span> (for Neumann in 3d) <code class="codehilite">-int2d(Th)(f*w)</code> or <code class="codehilite">-int2d(Th, 3)(f*w)</code></p>
</li>
<li>
<p>A bilinear form on <span><span class="MathJax_Preview">\Gamma</span><script type="math/tex">\Gamma</script></span> or <span><span class="MathJax_Preview">\Gamma_{2}</span><script type="math/tex">\Gamma_{2}</script></span> (for Robin in 3d) <code class="codehilite">int2d(Th)(K*v*w)</code> or <code class="codehilite">int2d(Th,2)(K*v*w)</code></p>
</li>
</ul>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul>
<li>If needed, the different kind of terms in the sum can appear more than once.</li>
<li>The integral mesh and the mesh associated to test functions or unknown functions can be different in the case of linear form.</li>
<li><code class="codehilite">N.x</code>, <code class="codehilite">N.y</code> and <code class="codehilite">N.z</code> are the normal's components.</li>
</ul>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>It is not possible to write in the same integral the linear part and the bilinear part such as in <code class="codehilite">int1d(Th)(K*v*w - f*w)</code>.</p>
</div>
<h2 id="numerical-integration">Numerical Integration<a class="headerlink" href="#numerical-integration" title="Permanent link">#</a></h2>
<p>Let <span><span class="MathJax_Preview">D</span><script type="math/tex">D</script></span> be a <span><span class="MathJax_Preview">N</span><script type="math/tex">N</script></span>-dimensional bounded domain.</p>
<p>For an arbitrary polynomial <span><span class="MathJax_Preview">f</span><script type="math/tex">f</script></span> of degree <span><span class="MathJax_Preview">r</span><script type="math/tex">r</script></span>, if we can find particular (quadrature) points <span><span class="MathJax_Preview">\mathbf{\xi}_j,\, j=1,\cdots,J</span><script type="math/tex">\mathbf{\xi}_j,\, j=1,\cdots,J</script></span> in <span><span class="MathJax_Preview">D</span><script type="math/tex">D</script></span> and (quadrature) constants <span><span class="MathJax_Preview">\omega_j</span><script type="math/tex">\omega_j</script></span> such that</p>
<div>
<div class="MathJax_Preview">\begin{equation}
\int_{D}f(\mathbf{x}) = \sum_{\ell =1}^L c_\ell f(\mathbf{\xi}_\ell)
\end{equation}</div>
<script type="math/tex; mode=display">\begin{equation}
\int_{D}f(\mathbf{x}) = \sum_{\ell =1}^L c_\ell f(\mathbf{\xi}_\ell)
\end{equation}</script>
</div>
<p>then we have an error estimate (see <a href="#CROUZEIX1984">CROUZEIX1984</a>), and then there exists a constant <span><span class="MathJax_Preview">C&gt;0</span><script type="math/tex">C>0</script></span> such that</p>
<div>
<div class="MathJax_Preview">\begin{equation}
\left|\int_{D}f(\mathbf{x}) - \sum_{\ell =1}^L \omega_\ell
f(\mathbf{\xi}_\ell )\right|
\le C|D|h^{r+1}
\end{equation}</div>
<script type="math/tex; mode=display">\begin{equation}
\left|\int_{D}f(\mathbf{x}) - \sum_{\ell =1}^L \omega_\ell
f(\mathbf{\xi}_\ell )\right|
\le C|D|h^{r+1}
\end{equation}</script>
</div>
<p>for any function <span><span class="MathJax_Preview">r + 1</span><script type="math/tex">r + 1</script></span> times continuously differentiable <span><span class="MathJax_Preview">f</span><script type="math/tex">f</script></span> in <span><span class="MathJax_Preview">D</span><script type="math/tex">D</script></span>, where <span><span class="MathJax_Preview">h</span><script type="math/tex">h</script></span> is the diameter of <span><span class="MathJax_Preview">D</span><script type="math/tex">D</script></span> and <span><span class="MathJax_Preview">|D|</span><script type="math/tex">|D|</script></span> its measure (a point in the segment <span><span class="MathJax_Preview">[q^iq^j]</span><script type="math/tex">[q^iq^j]</script></span> is given as</p>
<div>
<div class="MathJax_Preview">
\{(x,y)|\; x=(1-t)q^i_x+tq^j_x,\, y=(1-t)q^i_y+tq^j_y,\, 0\le t\le 1\}
).
</div>
<script type="math/tex; mode=display">
\{(x,y)|\; x=(1-t)q^i_x+tq^j_x,\, y=(1-t)q^i_y+tq^j_y,\, 0\le t\le 1\}
).
</script>
</div>
<p>For a domain <span><span class="MathJax_Preview">\Omega_h=\sum_{k=1}^{n_t}T_k,\, \mathcal{T}_h=\{T_k\}</span><script type="math/tex">\Omega_h=\sum_{k=1}^{n_t}T_k,\, \mathcal{T}_h=\{T_k\}</script></span>, we can calculate the integral over <span><span class="MathJax_Preview">\Gamma_h=\p\Omega_h</span><script type="math/tex">\Gamma_h=\p\Omega_h</script></span> by</p>
<p><span><span class="MathJax_Preview">\int_{\Gamma_h}f(\mathbf{x})ds</span><script type="math/tex">\int_{\Gamma_h}f(\mathbf{x})ds</script></span> =<code class="codehilite">int1d(Th)(f)</code></p>
<p>=<code class="codehilite">int1d(Th, qfe=*)(f)</code></p>
<p>=<code class="codehilite">int1d(Th, qforder=*)(f)</code></p>
<p>where * stands for the name of the quadrature formula or the precision (order) of the Gauss formula.</p>
<table>
<thead>
<tr>
<th align="center"></th>
<th align="center"></th>
<th align="center"></th>
<th align="center">Quadature formula on an edge</th>
<th align="center"></th>
<th align="center"></th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><span><span class="MathJax_Preview">L</span><script type="math/tex">L</script></span></td>
<td align="center">(<code class="codehilite">qfe=</code>)</td>
<td align="center"><code class="codehilite">qforder=</code></td>
<td align="center">Point in <span><span class="MathJax_Preview">[q^iq^j](=t)</span><script type="math/tex">[q^iq^j](=t)</script></span></td>
<td align="center"><span><span class="MathJax_Preview">\omega_\ell</span><script type="math/tex">\omega_\ell</script></span></td>
<td align="center">Exact on <span><span class="MathJax_Preview">P_k, k=</span><script type="math/tex">P_k, k=</script></span></td>
</tr>
<tr>
<td align="center">1</td>
<td align="center"><code class="codehilite">qf1pE</code></td>
<td align="center">2</td>
<td align="center"><span><span class="MathJax_Preview">1/2</span><script type="math/tex">1/2</script></span></td>
<td align="center"><span><span class="MathJax_Preview">\|q^iq^j\|</span><script type="math/tex">\|q^iq^j\|</script></span></td>
<td align="center">1</td>
</tr>
<tr>
<td align="center">2</td>
<td align="center"><code class="codehilite">qf2pE</code></td>
<td align="center">3</td>
<td align="center"><span><span class="MathJax_Preview">(1\pm\sqrt{1/3})/2</span><script type="math/tex">(1\pm\sqrt{1/3})/2</script></span></td>
<td align="center"><span><span class="MathJax_Preview">\|q^iq^j\|/2</span><script type="math/tex">\|q^iq^j\|/2</script></span></td>
<td align="center">3</td>
</tr>
<tr>
<td align="center">3</td>
<td align="center"><strong><code class="codehilite">qf3pE</code></strong></td>
<td align="center">6</td>
<td align="center"><span><span class="MathJax_Preview">(1\pm\sqrt{3/5})/2</span><script type="math/tex">(1\pm\sqrt{3/5})/2</script></span><br><span><span class="MathJax_Preview">1/2</span><script type="math/tex">1/2</script></span></td>
<td align="center"><span><span class="MathJax_Preview">(5/18)\|q^iq^j\|</span><script type="math/tex">(5/18)\|q^iq^j\|</script></span><br><span><span class="MathJax_Preview">(8/18)\|q^iq^j\|</span><script type="math/tex">(8/18)\|q^iq^j\|</script></span></td>
<td align="center">5</td>
</tr>
<tr>
<td align="center">4</td>
<td align="center"><code class="codehilite">qf4pE</code></td>
<td align="center">8</td>
<td align="center"><span><span class="MathJax_Preview">(1\pm\frac{\sqrt{525+70\sqrt{30}}}{35})/2</span><script type="math/tex">(1\pm\frac{\sqrt{525+70\sqrt{30}}}{35})/2</script></span><br><span><span class="MathJax_Preview">(1\pm\frac{\sqrt{525-70\sqrt{30}}}{35})/2</span><script type="math/tex">(1\pm\frac{\sqrt{525-70\sqrt{30}}}{35})/2</script></span></td>
<td align="center"><span><span class="MathJax_Preview">\frac{18-\sqrt{30}}{72}\|q^iq^j\|</span><script type="math/tex">\frac{18-\sqrt{30}}{72}\|q^iq^j\|</script></span><br><span><span class="MathJax_Preview">\frac{18+\sqrt{30}}{72}\|q^iq^j\|</span><script type="math/tex">\frac{18+\sqrt{30}}{72}\|q^iq^j\|</script></span></td>
<td align="center">7</td>
</tr>
<tr>
<td align="center">5</td>
<td align="center"><code class="codehilite">qf5pE</code></td>
<td align="center">10</td>
<td align="center"><span><span class="MathJax_Preview">(1\pm\frac{\sqrt{245+14\sqrt{70}}}{21})/2</span><script type="math/tex">(1\pm\frac{\sqrt{245+14\sqrt{70}}}{21})/2</script></span><br><span><span class="MathJax_Preview">1/2</span><script type="math/tex">1/2</script></span><br><span><span class="MathJax_Preview">(1\pm\frac{\sqrt{245-14\sqrt{70}}}{21})/2</span><script type="math/tex">(1\pm\frac{\sqrt{245-14\sqrt{70}}}{21})/2</script></span></td>
<td align="center"><span><span class="MathJax_Preview">\frac{322-13\sqrt{70}}{1800}\|q^iq^j\|</span><script type="math/tex">\frac{322-13\sqrt{70}}{1800}\|q^iq^j\|</script></span><br><span><span class="MathJax_Preview">\frac{64}{225}\|q^iq^j\|</span><script type="math/tex">\frac{64}{225}\|q^iq^j\|</script></span><br><span><span class="MathJax_Preview">\frac{322+13\sqrt{70}}{1800}\|q^iq^j\|</span><script type="math/tex">\frac{322+13\sqrt{70}}{1800}\|q^iq^j\|</script></span></td>
<td align="center">9</td>
</tr>
<tr>
<td align="center">2</td>
<td align="center"><code class="codehilite">qf1pElump</code></td>
<td align="center">2</td>
<td align="center"><span><span class="MathJax_Preview">0</span><script type="math/tex">0</script></span><br><span><span class="MathJax_Preview">+1</span><script type="math/tex">+1</script></span></td>
<td align="center"><span><span class="MathJax_Preview">\|q^iq^j\|/2</span><script type="math/tex">\|q^iq^j\|/2</script></span><br><span><span class="MathJax_Preview">\|q^iq^j\|/2</span><script type="math/tex">\|q^iq^j\|/2</script></span></td>
<td align="center">1</td>
</tr>
</tbody>
</table>
<p>where <span><span class="MathJax_Preview">|q^iq^j|</span><script type="math/tex">|q^iq^j|</script></span> is the length of segment <span><span class="MathJax_Preview">\overline{q^iq^j}</span><script type="math/tex">\overline{q^iq^j}</script></span>.</p>
<p>For a part <span><span class="MathJax_Preview">\Gamma_1</span><script type="math/tex">\Gamma_1</script></span> of <span><span class="MathJax_Preview">\Gamma_h</span><script type="math/tex">\Gamma_h</script></span> with the label "1", we can calculate the integral over <span><span class="MathJax_Preview">\Gamma_1</span><script type="math/tex">\Gamma_1</script></span> by</p>
<p><span><span class="MathJax_Preview">\int_{\Gamma_1}f(x,y)ds</span><script type="math/tex">\int_{\Gamma_1}f(x,y)ds</script></span> =<code class="codehilite">int1d(Th, 1)(f)</code></p>
<p>=<code class="codehilite">int1d(Th, 1, qfe=qf2pE)(f)</code></p>
<p>The integrals over <span><span class="MathJax_Preview">\Gamma_1,\, \Gamma_3</span><script type="math/tex">\Gamma_1,\, \Gamma_3</script></span> are given by</p>
<p><span><span class="MathJax_Preview">\int_{\Gamma_1\cup \Gamma_3}f(x,y)ds</span><script type="math/tex">\int_{\Gamma_1\cup \Gamma_3}f(x,y)ds</script></span> =<code class="codehilite">int1d(Th, 1, 3)(f)</code></p>
<p>For each triangle <span><span class="MathJax_Preview">T_k=[q^{k_1}q^{k_2}q^{k_3}]</span><script type="math/tex">T_k=[q^{k_1}q^{k_2}q^{k_3}]</script></span>, the point <span><span class="MathJax_Preview">P(x,y)</span><script type="math/tex">P(x,y)</script></span> in <span><span class="MathJax_Preview">T_k</span><script type="math/tex">T_k</script></span> is expressed by the <em>area coordinate</em> as <span><span class="MathJax_Preview">P(\xi,\eta)</span><script type="math/tex">P(\xi,\eta)</script></span>:</p>
<div>
<div class="MathJax_Preview">\begin{eqnarray*}
&amp;&amp;|T_k|=\frac12 \left|
\begin{array}{ccc}
1&amp;q^{k_1}_x&amp;q^{k_1}_y\\
1&amp;q^{k_2}_x&amp;q^{k_2}_y\\
1&amp;q^{k_3}_x&amp;q^{k_3}_y
\end{array}
\right|\quad
D_1=\left|
\begin{array}{ccc}
1&amp;x&amp;y\\
1&amp;q^{k_2}_x&amp;q^{k_2}_y\\
1&amp;q^{k_3}_x&amp;q^{k_3}_y
\end{array}
\right|
\quad
D_2=\left|
\begin{array}{ccc}
1&amp;q^{k_1}_x&amp;q^{k_1}_y\\
1&amp;x&amp;y\\
1&amp;q^{k_3}_x&amp;q^{k_3}_y
\end{array}
\right|
\quad
D_3=\left|
\begin{array}{ccc}
1&amp;q^{k_1}_x&amp;q^{k_1}_y\\
1&amp;q^{k_2}_x&amp;q^{k_2}_y\\
1&amp;x&amp;y
\end{array}
\right|\\
&amp;&amp;\xi=\frac12 D_1/|T_k|\qquad
\eta=\frac12 D_2/|T_k|\qquad \textrm{then }
1-\xi-\eta=\frac12 D_3/|T_k|
\end{eqnarray*}</div>
<script type="math/tex; mode=display">\begin{eqnarray*}
&&|T_k|=\frac12 \left|
\begin{array}{ccc}
1&q^{k_1}_x&q^{k_1}_y\\
1&q^{k_2}_x&q^{k_2}_y\\
1&q^{k_3}_x&q^{k_3}_y
\end{array}
\right|\quad
D_1=\left|
\begin{array}{ccc}
1&x&y\\
1&q^{k_2}_x&q^{k_2}_y\\
1&q^{k_3}_x&q^{k_3}_y
\end{array}
\right|
\quad
D_2=\left|
\begin{array}{ccc}
1&q^{k_1}_x&q^{k_1}_y\\
1&x&y\\
1&q^{k_3}_x&q^{k_3}_y
\end{array}
\right|
\quad
D_3=\left|
\begin{array}{ccc}
1&q^{k_1}_x&q^{k_1}_y\\
1&q^{k_2}_x&q^{k_2}_y\\
1&x&y
\end{array}
\right|\\
&&\xi=\frac12 D_1/|T_k|\qquad
\eta=\frac12 D_2/|T_k|\qquad \textrm{then }
1-\xi-\eta=\frac12 D_3/|T_k|
\end{eqnarray*}</script>
</div>
<p>For a two dimensional domain or a border of three dimensional domain <span><span class="MathJax_Preview">\Omega_h=\sum_{k=1}^{n_t}T_k,\, \mathcal{T}_h=\{T_k\}</span><script type="math/tex">\Omega_h=\sum_{k=1}^{n_t}T_k,\, \mathcal{T}_h=\{T_k\}</script></span>, we can calculate the integral over <span><span class="MathJax_Preview">\Omega_h</span><script type="math/tex">\Omega_h</script></span> by</p>
<p><span><span class="MathJax_Preview">\int_{\Omega_h}f(x,y)</span><script type="math/tex">\int_{\Omega_h}f(x,y)</script></span> =<code class="codehilite">int2d(Th)(f)</code></p>
<p>=<code class="codehilite">int2d(Th, qft=*)(f)</code></p>
<p>=<code class="codehilite">int2d(Th, qforder=*)(f)</code></p>
<p>where * stands for the name of quadrature formula or the order of the Gauss formula.</p>
<table>
<thead>
<tr>
<th align="center"></th>
<th align="center"></th>
<th align="center"></th>
<th align="center">Quadature formula on a triangle</th>
<th align="center"></th>
<th align="center"></th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><span><span class="MathJax_Preview">L</span><script type="math/tex">L</script></span></td>
<td align="center"><code class="codehilite">qft=</code></td>
<td align="center"><code class="codehilite">qforder=</code></td>
<td align="center">Point in <span><span class="MathJax_Preview">T_k</span><script type="math/tex">T_k</script></span></td>
<td align="center"><span><span class="MathJax_Preview">\omega_\ell</span><script type="math/tex">\omega_\ell</script></span></td>
<td align="center">Exact on <span><span class="MathJax_Preview">P_k, k=</span><script type="math/tex">P_k, k=</script></span></td>
</tr>
<tr>
<td align="center">1</td>
<td align="center"><code class="codehilite">qf1pT</code></td>
<td align="center">2</td>
<td align="center"><span><span class="MathJax_Preview">\left(\frac{1}{3},\frac{1}{3}\right)</span><script type="math/tex">\left(\frac{1}{3},\frac{1}{3}\right)</script></span></td>
<td align="center"><span><span class="MathJax_Preview">\|T_k\|</span><script type="math/tex">\|T_k\|</script></span></td>
<td align="center">1</td>
</tr>
<tr>
<td align="center">3</td>
<td align="center"><code class="codehilite">qf2pT</code></td>
<td align="center">3</td>
<td align="center"><span><span class="MathJax_Preview">\left(\frac{1}{2},\frac{1}{2}\right)</span><script type="math/tex">\left(\frac{1}{2},\frac{1}{2}\right)</script></span><br><span><span class="MathJax_Preview">\left(\frac{1}{2},0\right)</span><script type="math/tex">\left(\frac{1}{2},0\right)</script></span><br><span><span class="MathJax_Preview">\left(0,\frac{1}{2}\right)</span><script type="math/tex">\left(0,\frac{1}{2}\right)</script></span></td>
<td align="center"><span><span class="MathJax_Preview">\|T_k\|/3</span><script type="math/tex">\|T_k\|/3</script></span><br><span><span class="MathJax_Preview">\|T_k\|/3</span><script type="math/tex">\|T_k\|/3</script></span><br><span><span class="MathJax_Preview">\|T_k\|/3</span><script type="math/tex">\|T_k\|/3</script></span></td>
<td align="center">2</td>
</tr>
<tr>
<td align="center">7</td>
<td align="center"><strong><code class="codehilite">qf5pT</code></strong></td>
<td align="center">6</td>
<td align="center"><span><span class="MathJax_Preview">\left(\frac{1}{3},\frac{1}{3}\right)</span><script type="math/tex">\left(\frac{1}{3},\frac{1}{3}\right)</script></span><br><span><span class="MathJax_Preview">\left(\frac{6-\sqrt{15}}{21},\frac{6-\sqrt{15}}{21}\right)</span><script type="math/tex">\left(\frac{6-\sqrt{15}}{21},\frac{6-\sqrt{15}}{21}\right)</script></span><br><span><span class="MathJax_Preview">\left(\frac{6-\sqrt{15}}{21},\frac{9+2\sqrt{15}}{21}\right)</span><script type="math/tex">\left(\frac{6-\sqrt{15}}{21},\frac{9+2\sqrt{15}}{21}\right)</script></span><br><span><span class="MathJax_Preview">\left(\frac{9+2\sqrt{15}}{21},\frac{6-\sqrt{15}}{21}\right)</span><script type="math/tex">\left(\frac{9+2\sqrt{15}}{21},\frac{6-\sqrt{15}}{21}\right)</script></span><br><span><span class="MathJax_Preview">\left(\frac{6+\sqrt{15}}{21},\frac{6+\sqrt{15}}{21}\right)</span><script type="math/tex">\left(\frac{6+\sqrt{15}}{21},\frac{6+\sqrt{15}}{21}\right)</script></span><br><span><span class="MathJax_Preview">\left(\frac{6+\sqrt{15}}{21},\frac{9-2\sqrt{15}}{21}\right)</span><script type="math/tex">\left(\frac{6+\sqrt{15}}{21},\frac{9-2\sqrt{15}}{21}\right)</script></span><br><span><span class="MathJax_Preview">\left(\frac{9-2\sqrt{15}}{21},\frac{6+\sqrt{15}}{21}\right)</span><script type="math/tex">\left(\frac{9-2\sqrt{15}}{21},\frac{6+\sqrt{15}}{21}\right)</script></span></td>
<td align="center"><span><span class="MathJax_Preview">0.225\|T_k\|</span><script type="math/tex">0.225\|T_k\|</script></span><br><span><span class="MathJax_Preview">\frac{(155-\sqrt{15})\|T_k\|}{1200}</span><script type="math/tex">\frac{(155-\sqrt{15})\|T_k\|}{1200}</script></span><br><span><span class="MathJax_Preview">\frac{(155-\sqrt{15})\|T_k\|}{1200}</span><script type="math/tex">\frac{(155-\sqrt{15})\|T_k\|}{1200}</script></span><br><span><span class="MathJax_Preview">\frac{(155-\sqrt{15})\|T_k\|}{1200}</span><script type="math/tex">\frac{(155-\sqrt{15})\|T_k\|}{1200}</script></span><br><span><span class="MathJax_Preview">\frac{(155+\sqrt{15})\|T_k\|}{1200}</span><script type="math/tex">\frac{(155+\sqrt{15})\|T_k\|}{1200}</script></span><br><span><span class="MathJax_Preview">\frac{(155+\sqrt{15})\|T_k\|}{1200}</span><script type="math/tex">\frac{(155+\sqrt{15})\|T_k\|}{1200}</script></span><br><span><span class="MathJax_Preview">\frac{(155+\sqrt{15})\|T_k\|}{1200}</span><script type="math/tex">\frac{(155+\sqrt{15})\|T_k\|}{1200}</script></span></td>
<td align="center">5</td>
</tr>
<tr>
<td align="center">3</td>
<td align="center"><code class="codehilite">qf1pTlump</code></td>
<td align="center"></td>
<td align="center"><span><span class="MathJax_Preview">\left(0,0\right)</span><script type="math/tex">\left(0,0\right)</script></span><br><span><span class="MathJax_Preview">\left(1,0\right)</span><script type="math/tex">\left(1,0\right)</script></span><br><span><span class="MathJax_Preview">\left(0,1\right)</span><script type="math/tex">\left(0,1\right)</script></span></td>
<td align="center"><span><span class="MathJax_Preview">\|T_k\|/3</span><script type="math/tex">\|T_k\|/3</script></span><br><span><span class="MathJax_Preview">\|T_k\|/3</span><script type="math/tex">\|T_k\|/3</script></span><br><span><span class="MathJax_Preview">\|T_k\|/3</span><script type="math/tex">\|T_k\|/3</script></span></td>
<td align="center">1</td>
</tr>
<tr>
<td align="center">9</td>
<td align="center"><code class="codehilite">qf2pT4P1</code></td>
<td align="center"></td>
<td align="center"><span><span class="MathJax_Preview">\left(\frac{1}{4},\frac{3}{4}\right)</span><script type="math/tex">\left(\frac{1}{4},\frac{3}{4}\right)</script></span><br><span><span class="MathJax_Preview">\left(\frac{3}{4},\frac{1}{4}\right)</span><script type="math/tex">\left(\frac{3}{4},\frac{1}{4}\right)</script></span><br><span><span class="MathJax_Preview">\left(0,\frac{1}{4}\right)</span><script type="math/tex">\left(0,\frac{1}{4}\right)</script></span><br><span><span class="MathJax_Preview">\left(0,\frac{3}{4}\right)</span><script type="math/tex">\left(0,\frac{3}{4}\right)</script></span><br><span><span class="MathJax_Preview">\left(\frac{1}{4},0\right)</span><script type="math/tex">\left(\frac{1}{4},0\right)</script></span><br><span><span class="MathJax_Preview">\left(\frac{3}{4},0\right)</span><script type="math/tex">\left(\frac{3}{4},0\right)</script></span><br><span><span class="MathJax_Preview">\left(\frac{1}{4},\frac{1}{4}\right)</span><script type="math/tex">\left(\frac{1}{4},\frac{1}{4}\right)</script></span><br><span><span class="MathJax_Preview">\left(\frac{1}{4},\frac{1}{2}\right)</span><script type="math/tex">\left(\frac{1}{4},\frac{1}{2}\right)</script></span><br><span><span class="MathJax_Preview">\left(\frac{1}{2},\frac{1}{4}\right)</span><script type="math/tex">\left(\frac{1}{2},\frac{1}{4}\right)</script></span></td>
<td align="center"><span><span class="MathJax_Preview">\|T_k\|/12</span><script type="math/tex">\|T_k\|/12</script></span><br><span><span class="MathJax_Preview">\|T_k\|/12</span><script type="math/tex">\|T_k\|/12</script></span><br><span><span class="MathJax_Preview">\|T_k\|/12</span><script type="math/tex">\|T_k\|/12</script></span><br><span><span class="MathJax_Preview">\|T_k\|/12</span><script type="math/tex">\|T_k\|/12</script></span><br><span><span class="MathJax_Preview">\|T_k\|/12</span><script type="math/tex">\|T_k\|/12</script></span><br><span><span class="MathJax_Preview">\|T_k\|/12</span><script type="math/tex">\|T_k\|/12</script></span><br><span><span class="MathJax_Preview">\|T_k\|/6</span><script type="math/tex">\|T_k\|/6</script></span><br><span><span class="MathJax_Preview">\|T_k\|/6</span><script type="math/tex">\|T_k\|/6</script></span><br><span><span class="MathJax_Preview">\|T_k\|/6</span><script type="math/tex">\|T_k\|/6</script></span></td>
<td align="center">1</td>
</tr>
<tr>
<td align="center">15</td>
<td align="center"><code class="codehilite">qf7pT</code></td>
<td align="center">8</td>
<td align="center">See <a href="#TAYLOR2005">TAYLOR2005</a> for detail</td>
<td align="center"></td>
<td align="center">7</td>
</tr>
<tr>
<td align="center">21</td>
<td align="center"><code class="codehilite">qf9pT</code></td>
<td align="center">10</td>
<td align="center">See <a href="#TAYLOR2005">TAYLOR2005</a> for detail</td>
<td align="center"></td>
<td align="center">9</td>
</tr>
</tbody>
</table>
<p>For a three dimensional domain <span><span class="MathJax_Preview">\Omega_h=\sum_{k=1}^{n_t}T_k,\, \mathcal{T}_h=\{T_k\}</span><script type="math/tex">\Omega_h=\sum_{k=1}^{n_t}T_k,\, \mathcal{T}_h=\{T_k\}</script></span>,
we can calculate the integral over <span><span class="MathJax_Preview">\Omega_h</span><script type="math/tex">\Omega_h</script></span> by</p>
<p><span><span class="MathJax_Preview">\int_{\Omega_h}f(x,y)</span><script type="math/tex">\int_{\Omega_h}f(x,y)</script></span> =<code class="codehilite">int3d(Th)(f)</code></p>
<p>=<code class="codehilite">int3d(Th,qfV=*)(f)</code></p>
<p>=<code class="codehilite">int3D(Th,qforder=*)(f)</code></p>
<p>where * stands for the name of quadrature formula or the order of the Gauss formula.</p>
<table>
<thead>
<tr>
<th align="center"></th>
<th align="center"></th>
<th align="center"></th>
<th align="center">Quadature formula on a tetrahedron</th>
<th align="center"></th>
<th align="center"></th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><span><span class="MathJax_Preview">L</span><script type="math/tex">L</script></span></td>
<td align="center"><code class="codehilite">qfV=</code></td>
<td align="center"><code class="codehilite">qforder=</code></td>
<td align="center">Point in <span><span class="MathJax_Preview">T_k\in \R^3</span><script type="math/tex">T_k\in \R^3</script></span></td>
<td align="center"><span><span class="MathJax_Preview">\omega_\ell</span><script type="math/tex">\omega_\ell</script></span></td>
<td align="center">Exact on <span><span class="MathJax_Preview">P_k, k=</span><script type="math/tex">P_k, k=</script></span></td>
</tr>
<tr>
<td align="center">1</td>
<td align="center"><code class="codehilite">qfV1</code></td>
<td align="center">2</td>
<td align="center"><span><span class="MathJax_Preview">\left(\frac{1}{4},\frac{1}{4},\frac{1}{4}\right)</span><script type="math/tex">\left(\frac{1}{4},\frac{1}{4},\frac{1}{4}\right)</script></span></td>
<td align="center"><span><span class="MathJax_Preview">\|T_k\|</span><script type="math/tex">\|T_k\|</script></span></td>
<td align="center">1</td>
</tr>
<tr>
<td align="center">4</td>
<td align="center"><code class="codehilite">qfV2</code></td>
<td align="center">3</td>
<td align="center"><span><span class="MathJax_Preview">G4(0.58\ldots,0.13\ldots,0.13\ldots)</span><script type="math/tex">G4(0.58\ldots,0.13\ldots,0.13\ldots)</script></span></td>
<td align="center"><span><span class="MathJax_Preview">\|T_k\|/4</span><script type="math/tex">\|T_k\|/4</script></span></td>
<td align="center">2</td>
</tr>
<tr>
<td align="center">14</td>
<td align="center"><strong><code class="codehilite">qfV5</code></strong></td>
<td align="center">6</td>
<td align="center"><span><span class="MathJax_Preview">G4(0.72\ldots,0.092\ldots,0.092\ldots)</span><script type="math/tex">G4(0.72\ldots,0.092\ldots,0.092\ldots)</script></span><br><span><span class="MathJax_Preview">G4(0.067\ldots,0.31\ldots,0.31\ldots)</span><script type="math/tex">G4(0.067\ldots,0.31\ldots,0.31\ldots)</script></span><br><span><span class="MathJax_Preview">G6(0.45\ldots,0.045\ldots,0.45\ldots)</span><script type="math/tex">G6(0.45\ldots,0.045\ldots,0.45\ldots)</script></span></td>
<td align="center"><span><span class="MathJax_Preview">0.073\ldots\|T_k\|</span><script type="math/tex">0.073\ldots\|T_k\|</script></span><br><span><span class="MathJax_Preview">0.11\ldots\|T_k\|</span><script type="math/tex">0.11\ldots\|T_k\|</script></span><br><span><span class="MathJax_Preview">0.042\ldots\|T_k\|</span><script type="math/tex">0.042\ldots\|T_k\|</script></span></td>
<td align="center">5</td>
</tr>
<tr>
<td align="center">4</td>
<td align="center"><code class="codehilite">qfV1lump</code></td>
<td align="center"></td>
<td align="center"><span><span class="MathJax_Preview">G4(1,0,0)</span><script type="math/tex">G4(1,0,0)</script></span></td>
<td align="center"><span><span class="MathJax_Preview">\|T_k\|/4</span><script type="math/tex">\|T_k\|/4</script></span></td>
<td align="center">1</td>
</tr>
</tbody>
</table>
<p>Where <span><span class="MathJax_Preview">G4(a,b,b)</span><script type="math/tex">G4(a,b,b)</script></span> such that <span><span class="MathJax_Preview">a+3b=1</span><script type="math/tex">a+3b=1</script></span> is the set of the four point in barycentric coordinate
<script type="math/tex; mode=display">\begin{eqnarray}
\{(a,b,b,b),(b,a,b,b),(b,b,a,b),(b,b,b,a)\}
\end{eqnarray}</script>
and where <span><span class="MathJax_Preview">G6(a,b,b)</span><script type="math/tex">G6(a,b,b)</script></span> such that <span><span class="MathJax_Preview">2a+2b=1</span><script type="math/tex">2a+2b=1</script></span> is the set of the six points in barycentric coordinate
<script type="math/tex; mode=display">\begin{eqnarray}
\{(a,a,b,b),(a,b,a,b),(a,b,b,a),(b,b,a,a),(b,a,b,a),(b,a,a,b)\}
\end{eqnarray}</script>
</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>These tetrahedral quadrature formulae come from <a href="http://www.cs.kuleuven.be/~nines/research/ecf/mtables.html">http://www.cs.kuleuven.be/~nines/research/ecf/mtables.html</a></p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>By default, we use the formula which is exact for polynomials of degree <span><span class="MathJax_Preview">5</span><script type="math/tex">5</script></span> on triangles or edges (in bold in three tables).</p>
</div>
<p>This possible to add an own quadrature formulae with using plugin <code class="codehilite">qf11to25</code> on segment, triangle or Tetrahedron.</p>
<p>The quadrature formulae in <span><span class="MathJax_Preview">D</span><script type="math/tex">D</script></span> dimension is a bidimentional array of size <span><span class="MathJax_Preview">N_q\times (D+1)</span><script type="math/tex">N_q\times (D+1)</script></span> such that the <span><span class="MathJax_Preview">D+1</span><script type="math/tex">D+1</script></span> value of on row <span><span class="MathJax_Preview">i=0,...,N_p-1</span><script type="math/tex">i=0,...,N_p-1</script></span> are <span><span class="MathJax_Preview">w^i,\hat{x}^i_1,...,\hat{x}^i_D</span><script type="math/tex">w^i,\hat{x}^i_1,...,\hat{x}^i_D</script></span> where <span><span class="MathJax_Preview">w^i</span><script type="math/tex">w^i</script></span> is the weight of the quadrature point, and <span><span class="MathJax_Preview">1-\sum_{k=1}^D \hat{x}^i_k ,\hat{x}^i_1,...,\hat{x}^i_D</span><script type="math/tex">1-\sum_{k=1}^D \hat{x}^i_k ,\hat{x}^i_1,...,\hat{x}^i_D</script></span> is the barycentric coordinate the quadrature point.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>load &quot;qf11to25&quot;

// Quadrature on segment
real[int, int] qq1 = [
    [0.5, 0],
    [0.5, 1]
];

QF1 qf1(1, qq1); //def of quadrature formulae qf1 on segment
//remark:
//1 is the order of the quadrature exact for polynome of degree &lt; 1

//Quadrature on triangle
real[int, int] qq2 = [
    [1./3., 0, 0],
    [1./3., 1, 0],
    [1./3., 0, 1]
];

QF2 qf2(1, qq2); //def of quadrature formulae qf2 on triangle
//remark:
//1 is the order of the quadrature exact for polynome of degree &lt; 1
//so must have sum w^i = 1

// Quadrature on tetrahedron
real[int, int] qq3 = [
    [1./4., 0, 0, 0],
    [1./4., 1, 0, 0],
    [1./4., 0, 1, 0],
    [1./4., 0, 0, 1]
];

QF3 qf3(1, qq3); //def of quadrature formulae qf3 on get
//remark:
//1 is the order of the quadrature exact for polynome of degree &lt; 1)

// Verification in 1d and 2d
mesh Th = square(10, 10);

real I1 = int1d(Th, qfe=qf1)(x^2);
real I1l = int1d(Th, qfe=qf1pElump)(x^2);

real I2 = int2d(Th, qft=qf2)(x^2);
real I2l = int2d(Th, qft=qf1pTlump)(x^2);

cout &lt;&lt; I1 &lt;&lt; &quot; == &quot; &lt;&lt; I1l &lt;&lt; endl;
cout &lt;&lt; I2 &lt;&lt; &quot; == &quot; &lt;&lt; I2l &lt;&lt; endl;
assert( abs(I1-I1l) &lt; 1e-10 );
assert( abs(I2-I2l) &lt; 1e-10 );
</pre></div>
</td></tr></table>

<p>The output is</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>1.67 == 1.67
0.335 == 0.335
</pre></div>
</td></tr></table>

<h2 id="variational-form-sparse-matrix-pde-data-vector">Variational Form, Sparse Matrix, PDE Data Vector<a class="headerlink" href="#variational-form-sparse-matrix-pde-data-vector" title="Permanent link">#</a></h2>
<p>In FreeFem++ it is possible to define variational forms, and use them to build matrices and vectors, and store them to speed-up the script (4 times faster here).</p>
<p>For example let us solve the <a href="../tutorials/ThermalConduction/">Thermal Conduction problem</a>. The variational formulation is in <span><span class="MathJax_Preview">L^2(0,T;H^1(\Omega))</span><script type="math/tex">L^2(0,T;H^1(\Omega))</script></span>; we shall seek <span><span class="MathJax_Preview">u^n</span><script type="math/tex">u^n</script></span> satisfying</p>
<div>
<div class="MathJax_Preview">
\forall w \in V_{0}; \qquad \int_\Omega \frac{u^n-u^{n-1}}{\delta t} w + \kappa\n u^n\n w) +\int_\Gamma\alpha(u^n-u_{ue})w=0
</div>
<script type="math/tex; mode=display">
\forall w \in V_{0}; \qquad \int_\Omega \frac{u^n-u^{n-1}}{\delta t} w + \kappa\n u^n\n w) +\int_\Gamma\alpha(u^n-u_{ue})w=0
</script>
</div>
<p>where <span><span class="MathJax_Preview">V_0 = \{w\in H^1(\Omega)/ w_{|\Gamma_{24}}=0\}</span><script type="math/tex">V_0 = \{w\in H^1(\Omega)/ w_{|\Gamma_{24}}=0\}</script></span>.</p>
<p>So to code the method with the matrices <span><span class="MathJax_Preview">A=(A_{ij})</span><script type="math/tex">A=(A_{ij})</script></span>, <span><span class="MathJax_Preview">M=(M_{ij})</span><script type="math/tex">M=(M_{ij})</script></span>, and the vectors $ u^n, b^n, b',b", b_{cl}$ (notation if <span><span class="MathJax_Preview">w</span><script type="math/tex">w</script></span> is a vector then <span><span class="MathJax_Preview">w_i</span><script type="math/tex">w_i</script></span> is a component of the vector).</p>
<div>
<div class="MathJax_Preview">\begin{equation}
u^n = A^{-1} b^n, \quad
\quad b' = b_0 + M u^{n-1},
\quad b"= \frac{1}{\varepsilon} \; b_{cl},
\quad b^n_i = \left\{
\begin{array}{cl} b"_i &amp; \mbox{if }\ i \in \Gamma_{24} \\
b'_i &amp; \mbox{else if } \not\in \Gamma_{24} \end{array}\right.
\end{equation}</div>
<script type="math/tex; mode=display">\begin{equation}
u^n = A^{-1} b^n, \quad
\quad b' = b_0 + M u^{n-1},
\quad b"= \frac{1}{\varepsilon} \; b_{cl},
\quad b^n_i = \left\{
\begin{array}{cl} b"_i & \mbox{if }\ i \in \Gamma_{24} \\
b'_i & \mbox{else if } \not\in \Gamma_{24} \end{array}\right.
\end{equation}</script>
</div>
<p>Where with <span><span class="MathJax_Preview">\frac{1}{\varepsilon} = \mathtt{tgv} = 10^{30}</span><script type="math/tex">\frac{1}{\varepsilon} = \mathtt{tgv} = 10^{30}</script></span> :</p>
<div>
<div class="MathJax_Preview">\begin{eqnarray}
 A_{ij} &amp;=&amp; \left\{\begin{array}{cl} \frac{1}{\varepsilon} &amp; \mbox{if } i \in \Gamma_{24}, \mbox{and} j=i \\
\displaystyle
 \int_{\Omega} w_j w_i / dt + k (\nabla w_j. \nabla w_i ) + \int_{\Gamma_{13}} \alpha w_j w_i &amp; \mbox{else if } i \not\in \Gamma_{24}, \mbox{or} j\ne i
 \end{array}\right.\\
 M_{ij} &amp;=&amp; \left\{\begin{array}{cl} \frac{1}{\varepsilon} &amp; \mbox{if } i \in \Gamma_{24}, \mbox{and} j=i\\
\displaystyle
 \int_{\Omega} w_j w_i / dt
 &amp; \mbox{else if }i \not\in \Gamma_{24}, \mbox{or} j\ne i \end{array}\right. \\
 b_{0,i} &amp;=&amp; \int_{\Gamma_{13}} \alpha u_{ue} w_i \\
 b_{cl} &amp;=&amp; u^{0} \quad \mbox{the initial data}
\end{eqnarray}</div>
<script type="math/tex; mode=display">\begin{eqnarray}
 A_{ij} &=& \left\{\begin{array}{cl} \frac{1}{\varepsilon} & \mbox{if } i \in \Gamma_{24}, \mbox{and} j=i \\
\displaystyle
 \int_{\Omega} w_j w_i / dt + k (\nabla w_j. \nabla w_i ) + \int_{\Gamma_{13}} \alpha w_j w_i & \mbox{else if } i \not\in \Gamma_{24}, \mbox{or} j\ne i
 \end{array}\right.\\
 M_{ij} &=& \left\{\begin{array}{cl} \frac{1}{\varepsilon} & \mbox{if } i \in \Gamma_{24}, \mbox{and} j=i\\
\displaystyle
 \int_{\Omega} w_j w_i / dt
 & \mbox{else if }i \not\in \Gamma_{24}, \mbox{or} j\ne i \end{array}\right. \\
 b_{0,i} &=& \int_{\Gamma_{13}} \alpha u_{ue} w_i \\
 b_{cl} &=& u^{0} \quad \mbox{the initial data}
\end{eqnarray}</script>
</div>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>// Parameters
func fu0 = 10 + 90*x/6;
func k = 1.8*(y&lt;0.5) + 0.2;
real ue = 25.;
real alpha = 0.25;
real T = 5;
real dt = 0.1 ;

// Mesh
mesh Th = square(30, 5, [6*x, y]);

// Fespace
fespace Vh(Th, P1);
Vh u0 = fu0, u = u0;
</pre></div>
</td></tr></table>

<p>Create three variational formulation, and build the matrices <span><span class="MathJax_Preview">A</span><script type="math/tex">A</script></span>,<span><span class="MathJax_Preview">M</span><script type="math/tex">M</script></span>.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>// Problem
varf vthermic (u, v)
    = int2d(Th)(
          u*v/dt
        + k*(dx(u)*dx(v) + dy(u)*dy(v))
    )
    + int1d(Th, 1, 3)(
          alpha*u*v
    )
    + on(2, 4, u=1)
    ;

varf vthermic0 (u, v)
    = int1d(Th, 1, 3)(
          alpha*ue*v
    )
    ;

varf vMass (u, v)
    = int2d(Th)(
          u*v/dt
    )
    + on(2, 4, u=1)
    ;

real tgv = 1e30;
matrix A = vthermic(Vh, Vh, tgv=tgv, solver=CG);
matrix M = vMass(Vh, Vh);
</pre></div>
</td></tr></table>

<p>Now, to build the right hand size we need 4 vectors.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>real[int] b0 = vthermic0(0, Vh); //constant part of the RHS
real[int] bcn = vthermic(0, Vh); //tgv on Dirichlet boundary node ( !=0 )
//we have for the node i : i in Gamma_24 -&gt; bcn[i] != 0
real[int] bcl = tgv*u0[]; //the Dirichlet boundary condition part
</pre></div>
</td></tr></table>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The boundary condition is implemented by penalization and vector <code class="codehilite">bcn</code> contains the contribution of the boundary condition <span><span class="MathJax_Preview">u=1</span><script type="math/tex">u=1</script></span>, so to change the boundary condition, we have just to multiply the vector <code class="codehilite">bc[]</code> by the current value <code class="codehilite">f</code> of the new boundary condition term by term with the operator <code class="codehilite">.*</code>. <a href="../models/NavierStokesEquations/#uzawa-algorithm-and-conjugate-gradients">Uzawa model</a> gives a real example of using all this features.</p>
</div>
<p>And the new version of the algorithm is now:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>// Time loop
ofstream ff(&quot;thermic.dat&quot;);
for(real t = 0; t &lt; T; t += dt){
    // Update
    real[int] b = b0; //for the RHS
    b += M*u[]; //add the the time dependent part
    //lock boundary part:
    b = bcn ? bcl : b; //do forall i: b[i] = bcn[i] ? bcl[i] : b[i]

    // Solve
    u[] = A^-1*b;

    // Save
    ff &lt;&lt; t &lt;&lt; &quot; &quot; &lt;&lt; u(3, 0.5) &lt;&lt; endl;

    // Plot
    plot(u);
}

// Display
for(int i = 0; i &lt; 20; i++)
    cout &lt;&lt; dy(u)(6.0*i/20.0, 0.9) &lt;&lt; endl;

// Plot
plot(u, fill=true, wait=true);
</pre></div>
</td></tr></table>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The functions appearing in the variational form are formal and local to the <code class="codehilite">varf</code> definition, the only important thing is the order in the parameter list, like in</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>varf vb1([u1, u2], q) = int2d(Th)((dy(u1) + dy(u2))*q) + int2d(Th)(1*q);
varf vb2([v1, v2], p) = int2d(Th)((dy(v1) + dy(v2))*p) + int2d(Th)(1*p);
</pre></div>
</td></tr></table>

</div>
<p>To build matrix <span><span class="MathJax_Preview">A</span><script type="math/tex">A</script></span> from the bilinear part the variational form <span><span class="MathJax_Preview">a</span><script type="math/tex">a</script></span> of type <code class="codehilite">varf</code> simply write:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>A = a(Vh, Wh , []...]);
// where
//Vh is &quot;fespace&quot; for the unknown fields with a correct number of component
//Wh is &quot;fespace&quot; for the test fields with a correct number of component
</pre></div>
</td></tr></table>

<p>Possible named parameters in <code class="codehilite">, [...]</code> are</p>
<ul>
<li>
<p><code class="codehilite">solver=</code> <code class="codehilite">LU</code>, <code class="codehilite">CG</code>, <code class="codehilite">Crout</code>, <code class="codehilite">Cholesky</code>, <code class="codehilite">GMRES</code>, <code class="codehilite">sparsesolver</code>, <code class="codehilite">UMFPACK</code> ...</p>
<p>The default solver is <code class="codehilite">GMRES</code>.</p>
<p>The storage mode of the matrix of the underlying linear system depends on the type of solver chosen; for <code class="codehilite">LU</code> the matrix is sky-line non symmetric, for <code class="codehilite">Crout</code> the matrix is sky-line symmetric, for <code class="codehilite">Cholesky</code> the matrix is sky-line symmetric positive definite, for <code class="codehilite">CG</code> the matrix is sparse symmetric positive, and for <code class="codehilite">GMRES</code>, <code class="codehilite">sparsesolver</code> or <code class="codehilite">UMFPACK</code> the matrix is just sparse.</p>
</li>
<li>
<p><code class="codehilite">factorize =</code> If true then do the matrix factorization for
    <code class="codehilite">LU</code>, <code class="codehilite">Cholesky</code> or <code class="codehilite">Crout</code>, the default value is <code class="codehilite">false</code>.</p>
</li>
<li>
<p><code class="codehilite">eps=</code> A real expression. <span><span class="MathJax_Preview">\varepsilon</span><script type="math/tex">\varepsilon</script></span> sets the stopping test for the iterative methods like <code class="codehilite">CG</code>. Note that if <span><span class="MathJax_Preview">\varepsilon</span><script type="math/tex">\varepsilon</script></span> is negative then the stopping test is:
    <script type="math/tex; mode=display">
    || A x - b || < |\varepsilon|
    </script>
    if it is positive then the stopping test is
    <script type="math/tex; mode=display">
    || A x - b || < \frac{|\varepsilon|}{|| A x_{0} - b ||}
    </script>
</p>
</li>
<li>
<p><code class="codehilite">precon=</code> Name of a function (for example <code class="codehilite">P</code>) to set the preconditioner.</p>
<p>The prototype for the function <code class="codehilite">P</code> must be</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>func real[int] P(real[int] &amp; xx) ;
</pre></div>
</td></tr></table>

</li>
<li>
<p><code class="codehilite">tgv=</code> Huge value (<span><span class="MathJax_Preview">10^{30}</span><script type="math/tex">10^{30}</script></span>) used to implement Dirichlet boundary conditions.</p>
</li>
<li>
<p><code class="codehilite">tolpivot=</code> Set the tolerance of the pivot in <code class="codehilite">UMFPACK</code> (<span><span class="MathJax_Preview">10^-1</span><script type="math/tex">10^-1</script></span>) and, <code class="codehilite">LU</code>, <code class="codehilite">Crout</code>, <code class="codehilite">Cholesky</code> factorization (<span><span class="MathJax_Preview">10^{-20}</span><script type="math/tex">10^{-20}</script></span>).</p>
</li>
<li>
<p><code class="codehilite">tolpivotsym=</code> Set the tolerance of the pivot sym in <code class="codehilite">UMFPACK</code></p>
</li>
<li>
<p><code class="codehilite">strategy=</code> Set the integer UMFPACK strategy (<span><span class="MathJax_Preview">0</span><script type="math/tex">0</script></span> by default).</p>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The line of the matrix corresponding to the space <code class="codehilite">Wh</code> and the column of the matrix corresponding to the space <code class="codehilite">Vh</code>.</p>
</div>
<p>To build the dual vector <code class="codehilite">b</code> (of type <code class="codehilite">real[int]</code>) from the linear part of the variational form <code class="codehilite">a</code> do simply</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>real b(Vh.ndof);
b = a(0, Vh);
</pre></div>
</td></tr></table>

<p>A first example to compute the area of each triangle <span><span class="MathJax_Preview">K</span><script type="math/tex">K</script></span> of mesh <span><span class="MathJax_Preview">Th</span><script type="math/tex">Th</script></span>, just do:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>fespace Nh(Th, P0); //the space function constant / triangle
Nh areaK;
varf varea (unused, chiK) = int2d(Th)(chiK);
etaK[] = varea(0, Ph);
</pre></div>
</td></tr></table>

<p>Effectively, the basic functions of space <span><span class="MathJax_Preview">Nh</span><script type="math/tex">Nh</script></span>, are the characteristic function of the element of Th, and the numbering is the numeration of the element, so by construction:
<script type="math/tex; mode=display">
\mathtt{etaK}[i] = \int {1}_{|K_i} = \int_{K_i} 1;
</script>
</p>
<p>Now, we can use this to compute error indicators like in example <a href="../models/StaticProblems/#adaptation-using-residual-error-indicator">Adaptation using residual error indicator</a>.</p>
<p>First to compute a continuous approximation to the function <span><span class="MathJax_Preview">h</span><script type="math/tex">h</script></span> "density mesh size" of the mesh <span><span class="MathJax_Preview">Th</span><script type="math/tex">Th</script></span>.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>fespace Vh(Th, P1);
Vh h ;
real[int] count(Th.nv);
varf vmeshsizen (u, v) = intalledges(Th, qfnbpE=1)(v);
varf vedgecount (u, v) = intalledges(Th, qfnbpE=1)(v/lenEdge);

// Computation of the mesh size
count = vedgecount(0, Vh); //number of edge / vertex
h[] = vmeshsizen(0, Vh); //sum length edge / vertex
h[] = h[]./count; //mean length edge / vertex
</pre></div>
</td></tr></table>

<p>To compute error indicator for Poisson equation :
<script type="math/tex; mode=display">
{ \eta_K = \int_K h_K^2 |( f + \Delta u_h)|^2 + \int_{\partial K} h_e |[ \frac{\partial u_h}{\partial n} ]|^2 }
</script>
where $ h_K$ is size of the longest edge (<code class="codehilite">hTriangle</code>), <span><span class="MathJax_Preview">h_e</span><script type="math/tex">h_e</script></span> is the size of the current edge (<code class="codehilite">lenEdge</code>), <span><span class="MathJax_Preview">n</span><script type="math/tex">n</script></span> the
normal.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>fespace Nh(Th, P0); // the space function constant / triangle
Nh etak;
varf vetaK (unused, chiK)
    = intalledges(Th)(
          chiK*lenEdge*square(jump(N.x*dx(u) + N.y*dy(u)))
    )
    + int2d(Th)(
          chiK*square(hTriangle*(f + dxx(u) + dyy(u)))
    )
    ;

 etak[] = vetaK(0, Ph);
</pre></div>
</td></tr></table>

<p>We add automatic expression optimization by default, if this optimization creates problems, it can be removed with the keyword <code class="codehilite">optimize</code> as in the following example:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>varf a (u1, u2)
    = int2d(Th, optimize=0)(
          dx(u1)*dx(u2)
        + dy(u1)*dy(u2)
    )
    + on(1, 2, 4, u1=0)
    + on(3, u1=1)
    ;
</pre></div>
</td></tr></table>

<p>or you can also do optimization and remove the check by setting <code class="codehilite">optimize=2</code>.</p>
<p>Remark, it is all possible to build interpolation matrix, like in the following example:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>mesh TH = square(3, 4);
mesh th = square(2, 3);
mesh Th = square(4, 4);

fespace VH(TH, P1);
fespace Vh(th, P1);
fespace Wh(Th, P1);

matrix B = interpolate(VH, Vh); //build interpolation matrix Vh-&gt;VH
matrix BB = interpolate(Wh, Vh); //build interpolation matrix Vh-&gt;Wh
</pre></div>
</td></tr></table>

<p>and after some operations on sparse matrices are available for example:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>int N = 10;
real [int, int] A(N, N); //a full matrix
real [int] a(N), b(N);
A = 0;
for (int i = 0; i &lt; N; i++){
    A(i, i) = 1+i;
    if (i+1 &lt; N) A(i, i+1) = -i;
    a[i] = i;
}
b = A*b;
matrix sparseA = A;
cout &lt;&lt; sparseA &lt;&lt; endl;
sparseA = 2*sparseA + sparseA&#39;;
sparseA = 4*sparseA + sparseA*5;
matrix sparseB = sparseA + sparseA + sparseA; ;
cout &lt;&lt; &quot;sparseB = &quot; &lt;&lt; sparseB(0,0) &lt;&lt; endl;
</pre></div>
</td></tr></table>

<h2 id="interpolation-matrix">Interpolation matrix<a class="headerlink" href="#interpolation-matrix" title="Permanent link">#</a></h2>
<p>It is also possible to store the matrix of a linear interpolation operator from a finite element space <span><span class="MathJax_Preview">V_h</span><script type="math/tex">V_h</script></span> to another <span><span class="MathJax_Preview">W_h</span><script type="math/tex">W_h</script></span> to <code class="codehilite">interpolate</code>(<span><span class="MathJax_Preview">W_h</span><script type="math/tex">W_h</script></span>,<span><span class="MathJax_Preview">V_h</span><script type="math/tex">V_h</script></span>,...) a function.</p>
<p>Note that the continuous finite functions are extended by continuity outside of the domain.</p>
<p>The named parameters of function <code class="codehilite">interpolate</code> are:</p>
<ul>
<li><code class="codehilite">inside=</code> set true to create zero-extension.</li>
<li><code class="codehilite">t=</code> set true to get the transposed matrix</li>
<li>
<p><code class="codehilite">op=</code> set an integer written below</p>
<ul>
<li>0 the default value and interpolate of the function</li>
<li>1 interpolate the <span><span class="MathJax_Preview">\p_x</span><script type="math/tex">\p_x</script></span></li>
<li>2 interpolate the <span><span class="MathJax_Preview">\p_y</span><script type="math/tex">\p_y</script></span></li>
<li>3 interpolate the <span><span class="MathJax_Preview">\p_z</span><script type="math/tex">\p_z</script></span></li>
</ul>
</li>
<li>
<p><code class="codehilite">U2Vc=</code> set the which is the component of <span><span class="MathJax_Preview">W_h</span><script type="math/tex">W_h</script></span> come in <span><span class="MathJax_Preview">V_h</span><script type="math/tex">V_h</script></span> in interpolate process in a int array so the size of the array is number of component of <span><span class="MathJax_Preview">W_h</span><script type="math/tex">W_h</script></span>, if the put <span><span class="MathJax_Preview">-1</span><script type="math/tex">-1</script></span> then component is set to <span><span class="MathJax_Preview">0</span><script type="math/tex">0</script></span>, like in the following example:
(by default the component number is unchanged).</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>fespace V4h(Th4, [P1, P1, P1, P1]);
fespace V3h(Th, [P1, P1, P1]);
int[int] u2vc = [1, 3, -1]; //-1 -&gt; put zero on the component
matrix IV34 = interpolate(V3h, V4h, inside=0, U2Vc=u2vc); //V3h &lt;- V4h
V4h [a1, a2, a3, a4] = [1, 2, 3, 4];
V3h [b1, b2, b3] = [10, 20, 30];
b1[] = IV34*a1[];
</pre></div>
</td></tr></table>

<p>So here we have:
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>b1 == 2, b2 == 4, b3 == 0 ...
</pre></div>
</td></tr></table></p>
</li>
</ul>
<div class="admonition example">
<p class="admonition-title">Matrix interpolation</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>// Mesh
mesh Th = square(4, 4);
mesh Th4 = square(2, 2, [x*0.5, y*0.5]);
plot(Th, Th4, wait=true);

// Fespace
fespace Vh(Th, P1);
Vh v, vv;
fespace Vh4(Th4, P1);
Vh4 v4=x*y;

fespace Wh(Th, P0);
fespace Wh4(Th4, P0);

// Interpolation
matrix IV = interpolate(Vh, Vh4); //here the function is exended by continuity
cout &lt;&lt; &quot;IV Vh&lt;-Vh4 &quot; &lt;&lt; IV &lt;&lt; endl;

v=v4;
vv[]= IV*v4[]; //here v == vv

real[int] diff= vv[] - v[];
cout &lt;&lt; &quot;|| v - vv || = &quot; &lt;&lt; diff.linfty &lt;&lt; endl;
assert( diff.linfty&lt;= 1e-6);

matrix IV0 = interpolate(Vh, Vh4, inside=1); //here the function is exended by zero
cout &lt;&lt; &quot;IV Vh&lt;-Vh4 (inside=1) &quot; &lt;&lt; IV0 &lt;&lt; endl;

matrix IVt0 = interpolate(Vh, Vh4, inside=1, t=1);
cout &lt;&lt; &quot;IV Vh&lt;-Vh4^t (inside=1) &quot; &lt;&lt; IVt0 &lt;&lt; endl;

matrix IV4t0 = interpolate(Vh4, Vh);
cout &lt;&lt; &quot;IV Vh4&lt;-Vh^t &quot; &lt;&lt; IV4t0 &lt;&lt; endl;

matrix IW4 = interpolate(Wh4, Wh);
cout &lt;&lt; &quot;IV Wh4&lt;-Wh &quot; &lt;&lt; IW4 &lt;&lt; endl;

matrix IW4V = interpolate(Wh4, Vh);
cout &lt;&lt; &quot;IV Wh4&lt;-Vh &quot; &lt;&lt; IW4 &lt;&lt; endl;
</pre></div>
</td></tr></table>

<p>Build interpolation matrix <span><span class="MathJax_Preview">A</span><script type="math/tex">A</script></span> at a array of points <span><span class="MathJax_Preview">(xx[j],yy[j]), i = 0, 2</span><script type="math/tex">(xx[j],yy[j]), i = 0, 2</script></span> here
<script type="math/tex; mode=display">
a_ij = dop(w^i_c (xx[j],yy[j]))
</script>
where <span><span class="MathJax_Preview">w_i</span><script type="math/tex">w_i</script></span> is the basic finite element function, <span><span class="MathJax_Preview">c</span><script type="math/tex">c</script></span> the component number, <span><span class="MathJax_Preview">dop</span><script type="math/tex">dop</script></span> the type of diff operator like in op def.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>real[int] xx = [.3, .4], yy = [.1, .4];
int c = 0, dop = 0;
matrix Ixx = interpolate(Vh, xx, yy, op=dop, composante=c);
cout &lt;&lt; Ixx &lt;&lt; endl;
Vh ww;
real[int] dd = [1, 2];
ww[] = Ixx*dd;
</pre></div>
</td></tr></table>

</div>
<div class="admonition example">
<p class="admonition-title">Schwarz</p>
<p>The following shows how to implement with an interpolation matrix a domain decomposition algorithm based on Schwarz method with Robin conditions.</p>
<p>Given a non-overlapping partition <span><span class="MathJax_Preview">\bar\Omega=\bar\Omega_0\cup\bar\Omega_1</span><script type="math/tex">\bar\Omega=\bar\Omega_0\cup\bar\Omega_1</script></span> with <span><span class="MathJax_Preview">\Omega_0\cap\Omega_1=\emptyset</span><script type="math/tex">\Omega_0\cap\Omega_1=\emptyset</script></span>, <span><span class="MathJax_Preview">\Sigma:=\bar\Omega_0\cap\bar\Omega_1</span><script type="math/tex">\Sigma:=\bar\Omega_0\cap\bar\Omega_1</script></span> the algorithm is :</p>
<p>
<script type="math/tex; mode=display">\begin{eqnarray*}&&
-\Delta u_i= f \hbox{ in }\Omega_i,~i=0,1,~~\frac{\partial(u_1-u_0)}{\partial n} + \alpha (u_1-u_0)=0\hbox{ on }\Sigma.
%\cr&&
\end{eqnarray*}</script>
The same in variational form is:
<script type="math/tex; mode=display">\begin{eqnarray*}&
\int_{\Omega_i}\nabla u_i\cdot\nabla v &+ \int_\Sigma\alpha u_i v = \int_{\Omega_i}f v
\cr&&
- \int_{\Omega_j}(\nabla u_j\cdot\nabla v-f v) + \int_\Sigma\alpha u_j v,~~
\forall v\in H^1_0(\Omega), i,j=[0,1]\cup[1,0]
\end{eqnarray*}</script>
To discretized with the <span><span class="MathJax_Preview">P^1</span><script type="math/tex">P^1</script></span> triangular Lagrangian finite element space <span><span class="MathJax_Preview">V_h</span><script type="math/tex">V_h</script></span> simply replace <span><span class="MathJax_Preview">H^1_0(\Omega)</span><script type="math/tex">H^1_0(\Omega)</script></span> by <span><span class="MathJax_Preview">V_h(\Omega_0)\cup V_h(\Omega_1)</span><script type="math/tex">V_h(\Omega_0)\cup V_h(\Omega_1)</script></span>.</p>
<p>Then difficulty is to compute <span><span class="MathJax_Preview">\int_{\Omega_j} \nabla u_j\cdot\nabla v</span><script type="math/tex">\int_{\Omega_j} \nabla u_j\cdot\nabla v</script></span> when <span><span class="MathJax_Preview">v</span><script type="math/tex">v</script></span> is a basis function of <span><span class="MathJax_Preview">V_h(\Omega_i)</span><script type="math/tex">V_h(\Omega_i)</script></span>, <span><span class="MathJax_Preview">i\ne j</span><script type="math/tex">i\ne j</script></span>.</p>
<p>It is done as follows (with <span><span class="MathJax_Preview">\Gamma=\partial\Omega</span><script type="math/tex">\Gamma=\partial\Omega</script></span>) :</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>// Parameters
int n = 30;
int Gamma = 1;
int Sigma = 2;

func f = 1.;
real alpha = 1.;

int Niter = 50;

// Mesh
mesh[int] Th(2);
int[int] reg(2);

border a0(t=0, 1){x=t; y=0; label=Gamma;}
border a1(t=1, 2){x=t; y=0; label=Gamma;}
border b1(t=0, 1){x=2; y=t; label=Gamma;}
border c1(t=2, 1){x=t; y=1; label=Gamma;}
border c0(t=1, 0){x=t; y=1; label=Gamma;}
border b0(t=1, 0){x=0; y=t; label=Gamma;}
border d(t=0, 1){x=1; y=t; label=Sigma;}
plot(a0(n) + a1(n) + b1(n) + c1(n) + c0(n) + b0(n) + d(n));
mesh TH = buildmesh(a0(n) + a1(n) + b1(n) + c1(n) + c0(n) + b0(n) + d(n));

reg(0) = TH(0.5, 0.5).region;
reg(1) = TH(1.5, 0.5).region;

for(int i = 0; i &lt; 2; i++) Th[i] = trunc(TH, region==reg(i));

// Fespace
fespace Vh0(Th[0], P1);
Vh0 u0 = 0;

fespace Vh1(Th[1], P1);
Vh1 u1 = 0;

// Macro
macro grad(u) [dx(u), dy(u)] //

// Problem
int i;
varf a (u, v)
    = int2d(Th[i])(
          grad(u)&#39;*grad(v)
    )
    + int1d(Th[i], Sigma)(
          alpha*u*v
    )
    + on(Gamma, u=0)
    ;

varf b (u, v)
    = int2d(Th[i])(
          f*v
    )
    + on(Gamma, u=0)
    ;

varf du1dn (u, v)
    =-int2d(Th[1])(
          grad(u1)&#39;*grad(v)
        - f*v
    )
    + int1d(Th[1], Sigma)(
          alpha*u1*v
    )
    +on(Gamma, u=0)
    ;

varf du0dn (u, v)
    =-int2d(Th[0])(
          grad(u0)&#39;*grad(v)
        - f*v
    )
    + int1d(Th[0], Sigma)(
          alpha*u0*v
    )
    +on(Gamma, u=0)
    ;

matrix I01 = interpolate(Vh1, Vh0);
matrix I10 = interpolate(Vh0, Vh1);

matrix[int] A(2);
i = 0; A[i] = a(Vh0, Vh0);
i = 1; A[i] = a(Vh1, Vh1);

// Solving loop
for(int iter = 0; iter &lt; Niter; iter++){
    // Solve on Th[0]
    {
        i = 0;
        real[int] b0 = b(0, Vh0);
        real[int] Du1dn = du1dn(0, Vh1);
        real[int] Tdu1dn(Vh0.ndof); Tdu1dn = I01&#39;*Du1dn;
        b0 += Tdu1dn;
        u0[] = A[0]^-1*b0;
    }
    // Solve on Th[1]
    {
        i = 1;
        real[int] b1 = b(0, Vh1);
        real[int] Du0dn = du0dn(0, Vh0);
        real[int] Tdu0dn(Vh1.ndof); Tdu0dn = I10&#39;*Du0dn;
        b1 += Tdu0dn;
        u1[] = A[1]^-1*b1;
    }
    plot(u0, u1, cmm=&quot;iter=&quot;+iter);
}
</pre></div>
</td></tr></table>

</div>
<h2 id="finite-elements-connectivity">Finite elements connectivity<a class="headerlink" href="#finite-elements-connectivity" title="Permanent link">#</a></h2>
<p>Here, we show how to get  informations on a finite element space <span><span class="MathJax_Preview">W_h({\cal T}_n,*)</span><script type="math/tex">W_h({\cal T}_n,*)</script></span>, where "*" may be <code class="codehilite">P1, P2, P1nc</code>, etc.</p>
<ul>
<li><code class="codehilite">Wh.nt</code> gives the number of element of <span><span class="MathJax_Preview">W_h</span><script type="math/tex">W_h</script></span></li>
<li><code class="codehilite">Wh.ndof</code> gives the number of degrees of freedom or unknown</li>
<li><code class="codehilite">Wh.ndofK</code> gives the number of degrees of freedom on one element</li>
<li><code class="codehilite">Wh(k,i)</code> gives the number of <span><span class="MathJax_Preview">i</span><script type="math/tex">i</script></span>th  degrees of freedom of element <span><span class="MathJax_Preview">k</span><script type="math/tex">k</script></span>.</li>
</ul>
<p>See the following example:</p>
<div class="admonition example">
<p class="admonition-title">Finite element connectivity</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>// Mesh
mesh Th = square(5, 5);

// Fespace
fespace Wh(Th, P2);

cout &lt;&lt; &quot;Number of degree of freedom = &quot; &lt;&lt; Wh.ndof &lt;&lt; endl;
cout &lt;&lt; &quot;Number of degree of freedom / ELEMENT = &quot; &lt;&lt; Wh.ndofK &lt;&lt; endl;

int k = 2, kdf = Wh.ndofK; //element 2
cout &lt;&lt; &quot;Degree of freedom of element &quot; &lt;&lt; k &lt;&lt; &quot;:&quot; &lt;&lt; endl;
for (int i = 0; i &lt; kdf; i++)
    cout &lt;&lt; Wh(k,i) &lt;&lt; &quot; &quot;;
cout &lt;&lt; endl;
</pre></div>
</td></tr></table>

<p>The output is:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>Number of degree of freedom = 121
Number of degree of freedom / ELEMENT = 6
Degree of freedom of element 2:
78 95 83 87 79 92
</pre></div>
</td></tr></table>

</div>
<h2 id="references">References<a class="headerlink" href="#references" title="Permanent link">#</a></h2>
<p><a name"BERNADOU1980">[BERNADOU1980]</a> BERNADOU, Michel, BOISSERIE, Jean-Marie, et HASSAN, Kamal. Sur l'implémentation des éléments finis de Hsieh-Clough-Tocher complet et réduit. 1980. Thèse de doctorat. INRIA.</p>
<p><a name="BERNARDI1985">[BERNARDI1985]</a> BERNARDI, Christine et RAUGEL, Genevieve. Analysis of some finite elements for the Stokes problem. Mathematics of Computation, 1985, p. 71-79.</p>
<p><a name="THOMASSET2012">[THOMASSET2012]</a> THOMASSET, François. Implementation of finite element methods for Navier-Stokes equations. Springer Science &amp; Business Media, 2012.</p>
<p><a name="CROUZEIX1984">[CROUZEIX1984]</a> CROUZEIX, Michel et MIGNOT, Alain L. Analyse numérique des équations différentielles. Masson, 1984.</p>
<p><a name="TAYLOR2005"></a>[TAYLOR2005] TAYLOR, Mark A., WINGATE, Beth A., et BOS, Len P. Several new quadrature formulas for polynomial integration in the triangle. arXiv preprint math/0501496, 2005.</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../MeshGeneration/" title="Mesh Generation" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Mesh Generation
              </span>
            </div>
          </a>
        
        
          <a href="../Visualization/" title="Visualization" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Visualization
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../assets/fonts/font-awesome.css">
    
      <a href="https://github.com/FreeFem/FreeFem-doc" class="md-footer-social__link fa fa-github"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.9e1f3b71.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
        <script src="../../mathjax-config.js"></script>
      
    
    
      
    
  </body>
</html>