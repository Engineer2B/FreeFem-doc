



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="FreeFEM++ documentation">
      
      
        <link rel="canonical" href="https://doc.freefem.org/documentation/Developers/">
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.0.1">
    
    
      
        <title>Developers - FreeFem++ documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.982221ab.css">
      
      
    
    
      <script src="../../assets/javascripts/modernizr.1f0bcf2b.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#file-formats" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://doc.freefem.org" title="FreeFem++ documentation" class="md-header-nav__button md-logo">
          
            <img src="../../images/favicon.png" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              FreeFem++ documentation
            </span>
            <span class="md-header-nav__topic">
              Developers
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/FreeFem/FreeFem-doc/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    FreeFem++ on Github
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../.." title="Introduction" class="md-tabs__link">
          Introduction
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../" title="Documentation" class="md-tabs__link md-tabs__link--active">
          Documentation
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../reference/" title="Language References" class="md-tabs__link">
          Language References
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../tutorials/" title="Tutorials" class="md-tabs__link">
          Tutorials
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../examples/" title="Examples" class="md-tabs__link">
          Examples
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../models/" title="Models" class="md-tabs__link">
          Models
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://doc.freefem.org" title="FreeFem++ documentation" class="md-nav__button md-logo">
      
        <img src="../../images/favicon.png" width="48" height="48">
      
    </a>
    FreeFem++ documentation
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/FreeFem/FreeFem-doc/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    FreeFem++ on Github
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1">
    
    <label class="md-nav__link" for="nav-1">
      Introduction
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        Introduction
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../.." title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../introduction/download/" title="Download" class="md-nav__link">
      Download
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../introduction/installation/" title="Installation" class="md-nav__link">
      Installation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../introduction/contributing/" title="How to contribute?" class="md-nav__link">
      How to contribute?
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../introduction/citation/" title="Citation" class="md-nav__link">
      Citation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../introduction/authors/" title="Authors" class="md-nav__link">
      Authors
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../introduction/TODO/" title="TODO" class="md-nav__link">
      TODO
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      Documentation
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Documentation
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../" title="Home" class="md-nav__link">
      Home
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Notations/" title="Some Notations" class="md-nav__link">
      Some Notations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../MeshGeneration/" title="Mesh Generation" class="md-nav__link">
      Mesh Generation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../FiniteElement/" title="Finite Element" class="md-nav__link">
      Finite Element
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Visualization/" title="Visualization" class="md-nav__link">
      Visualization
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../AlgorithmsOptimization/" title="Algorithms & Optimization" class="md-nav__link">
      Algorithms & Optimization
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Parallelization/" title="Parallelization" class="md-nav__link">
      Parallelization
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-8" type="checkbox" id="nav-2-8">
    
    <label class="md-nav__link" for="nav-2-8">
      ffddm
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-8">
        ffddm
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../ffddm/ffddm/" title="What is ffddm ?" class="md-nav__link">
      What is ffddm ?
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ffddm/tutorial-slides.html" title="Tutorial slides" class="md-nav__link">
      Tutorial slides
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ffddm/introddm/" title="Introduction to DDM" class="md-nav__link">
      Introduction to DDM
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ffddm/documentation/" title="ffddm Documentation" class="md-nav__link">
      ffddm Documentation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ffddm/examples/" title="Examples" class="md-nav__link">
      Examples
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Plugins/" title="Plugins" class="md-nav__link">
      Plugins
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Developers
      </label>
    
    <a href="./" title="Developers" class="md-nav__link md-nav__link--active">
      Developers
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#file-formats" title="File formats" class="md-nav__link">
    File formats
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mesh-file-data-structure" title="Mesh file data structure" class="md-nav__link">
    Mesh file data structure
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bb-file-type-to-store-solutions" title="bb file type to Store Solutions" class="md-nav__link">
    bb file type to Store Solutions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bb-file-type-to-store-solutions_1" title="BB file type to store solutions" class="md-nav__link">
    BB file type to store solutions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metric-file" title="Metric file" class="md-nav__link">
    Metric file
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#list-of-am_fmt-amdba-meshes" title="List of AM_FMT, AMDBA Meshes" class="md-nav__link">
    List of AM_FMT, AMDBA Meshes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sol-and-solb-files" title="sol and solb files" class="md-nav__link">
    sol and solb files
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adding-a-new-finite-element" title="Adding a new finite element" class="md-nav__link">
    Adding a new finite element
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#some-notations" title="Some notations" class="md-nav__link">
    Some notations
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#which-class-to-add" title="Which class to add?" class="md-nav__link">
    Which class to add?
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dynamical-link" title="Dynamical link" class="md-nav__link">
    Dynamical link
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-first-example-myfunctioncpp" title="A first example myfunction.cpp" class="md-nav__link">
    A first example myfunction.cpp
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-discrete-fast-fourier-transform" title="Example: Discrete Fast Fourier Transform" class="md-nav__link">
    Example: Discrete Fast Fourier Transform
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#load-module-for-dervieux-p0-p1-finite-volume-method" title="Load Module for Dervieux' P0-P1 Finite Volume Method" class="md-nav__link">
    Load Module for Dervieux' P0-P1 Finite Volume Method
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#more-on-adding-a-new-finite-element" title="More on Adding a new finite element" class="md-nav__link">
    More on Adding a new finite element
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-bernardi-raugel-element" title="The Bernardi-Raugel Element" class="md-nav__link">
    The Bernardi-Raugel Element
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-morley-element" title="The Morley Element" class="md-nav__link">
    The Morley Element
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" title="References" class="md-nav__link">
    References
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../TODO/" title="TODO" class="md-nav__link">
      TODO
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Language References
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Language References
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/" title="Home" class="md-nav__link">
      Home
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/Types/" title="Types" class="md-nav__link">
      Types
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/GlobalVariables/" title="Global variables" class="md-nav__link">
      Global variables
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/QuadratureFormulae/" title="Quadrature formulae" class="md-nav__link">
      Quadrature formulae
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/Operators/" title="Operators" class="md-nav__link">
      Operators
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/Loops/" title="Loops" class="md-nav__link">
      Loops
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/IO/" title="I/O" class="md-nav__link">
      I/O
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/Functions/" title="Functions" class="md-nav__link">
      Functions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/ExternalLibraries/" title="External libraries" class="md-nav__link">
      External libraries
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/TODO/" title="TODO" class="md-nav__link">
      TODO
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Tutorials
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Tutorials
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/" title="Getting started" class="md-nav__link">
      Getting started
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/Poisson/" title="Poisson's equation" class="md-nav__link">
      Poisson's equation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/EquationsClassification/" title="Classification of the equations" class="md-nav__link">
      Classification of the equations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/Membrane/" title="Membrane" class="md-nav__link">
      Membrane
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/HeatExchanger/" title="Heat Exchanger" class="md-nav__link">
      Heat Exchanger
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/Acoustics/" title="Acoustics" class="md-nav__link">
      Acoustics
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/ThermalConduction/" title="Thermal Conduction" class="md-nav__link">
      Thermal Conduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/FanBlade/" title="Irrotational Fan Blade Flow and Thermal effects" class="md-nav__link">
      Irrotational Fan Blade Flow and Thermal effects
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/RotatingHill/" title="Pure convection, The rotating hill" class="md-nav__link">
      Pure convection, The rotating hill
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/Elasticity/" title="The system of elasticity" class="md-nav__link">
      The system of elasticity
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/Stokes/" title="The system of Stokes for fluids" class="md-nav__link">
      The system of Stokes for fluids
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/NavierStokesProjection/" title="A projection Algorithm for the Navier-Stokes equations" class="md-nav__link">
      A projection Algorithm for the Navier-Stokes equations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/NavierStokesNewton/" title="Newton method for the steady Navier-Stokes equations" class="md-nav__link">
      Newton method for the steady Navier-Stokes equations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/ALargeFluidProblem/" title="A large fluid problem" class="md-nav__link">
      A large fluid problem
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/ComplexNumbers/" title="An example with complex numbers" class="md-nav__link">
      An example with complex numbers
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/OptimalControl/" title="Optimal control" class="md-nav__link">
      Optimal control
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/FlowWithShocks/" title="A flow with shocks" class="md-nav__link">
      A flow with shocks
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/HeatEquationOptimization/" title="Time dependent schema optimization for heat equations" class="md-nav__link">
      Time dependent schema optimization for heat equations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/TimeDependentStokes/" title="A transient Stokes solver in matrix form" class="md-nav__link">
      A transient Stokes solver in matrix form
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/WifiPropagation/" title="Wifi Propagation" class="md-nav__link">
      Wifi Propagation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/MatlabOctavePlot/" title="Matlab / Octave Plots" class="md-nav__link">
      Matlab / Octave Plots
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/TODO/" title="TODO" class="md-nav__link">
      TODO
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Examples
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Examples
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../examples/" title="Home" class="md-nav__link">
      Home
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../examples/TODO/" title="TODO" class="md-nav__link">
      TODO
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Models
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Models
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../models/" title="Home" class="md-nav__link">
      Home
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../models/StaticProblems/" title="Static problems" class="md-nav__link">
      Static problems
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../models/Elasticity/" title="Elasticity" class="md-nav__link">
      Elasticity
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../models/NonLinearStaticProblems/" title="Non-linear static problems" class="md-nav__link">
      Non-linear static problems
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../models/EigenValueProblems/" title="Eigenvalue problems" class="md-nav__link">
      Eigenvalue problems
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../models/EvolutionProblems/" title="Evolution problems" class="md-nav__link">
      Evolution problems
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../models/NavierStokesEquations/" title="Navier-Stokes equations" class="md-nav__link">
      Navier-Stokes equations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../models/VariationalInequality/" title="Variational inequality" class="md-nav__link">
      Variational inequality
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../models/DomainDecomposition/" title="Domain decomposition" class="md-nav__link">
      Domain decomposition
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../models/FluidStructureCoupledProblem/" title="Fluid-Structure coupled problem" class="md-nav__link">
      Fluid-Structure coupled problem
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../models/TransmissionProblem/" title="Transmission problem" class="md-nav__link">
      Transmission problem
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../models/FreeBoundaryProblem/" title="Free boundary problem" class="md-nav__link">
      Free boundary problem
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../models/NonLinearElasticity/" title="Non-linear elasticity" class="md-nav__link">
      Non-linear elasticity
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../models/CompressibleNeoHookeanMaterials/" title="Compressible Neo-Hookean materials" class="md-nav__link">
      Compressible Neo-Hookean materials
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../models/WhisperingGalleryModes/" title="Whispering gallery modes" class="md-nav__link">
      Whispering gallery modes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../models/TODO/" title="TODO" class="md-nav__link">
      TODO
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#file-formats" title="File formats" class="md-nav__link">
    File formats
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mesh-file-data-structure" title="Mesh file data structure" class="md-nav__link">
    Mesh file data structure
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bb-file-type-to-store-solutions" title="bb file type to Store Solutions" class="md-nav__link">
    bb file type to Store Solutions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bb-file-type-to-store-solutions_1" title="BB file type to store solutions" class="md-nav__link">
    BB file type to store solutions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metric-file" title="Metric file" class="md-nav__link">
    Metric file
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#list-of-am_fmt-amdba-meshes" title="List of AM_FMT, AMDBA Meshes" class="md-nav__link">
    List of AM_FMT, AMDBA Meshes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sol-and-solb-files" title="sol and solb files" class="md-nav__link">
    sol and solb files
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adding-a-new-finite-element" title="Adding a new finite element" class="md-nav__link">
    Adding a new finite element
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#some-notations" title="Some notations" class="md-nav__link">
    Some notations
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#which-class-to-add" title="Which class to add?" class="md-nav__link">
    Which class to add?
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dynamical-link" title="Dynamical link" class="md-nav__link">
    Dynamical link
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-first-example-myfunctioncpp" title="A first example myfunction.cpp" class="md-nav__link">
    A first example myfunction.cpp
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-discrete-fast-fourier-transform" title="Example: Discrete Fast Fourier Transform" class="md-nav__link">
    Example: Discrete Fast Fourier Transform
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#load-module-for-dervieux-p0-p1-finite-volume-method" title="Load Module for Dervieux' P0-P1 Finite Volume Method" class="md-nav__link">
    Load Module for Dervieux' P0-P1 Finite Volume Method
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#more-on-adding-a-new-finite-element" title="More on Adding a new finite element" class="md-nav__link">
    More on Adding a new finite element
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-bernardi-raugel-element" title="The Bernardi-Raugel Element" class="md-nav__link">
    The Bernardi-Raugel Element
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-morley-element" title="The Morley Element" class="md-nav__link">
    The Morley Element
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" title="References" class="md-nav__link">
    References
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/FreeFem/FreeFem-doc/edit/master/docs/documentation/Developers.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                  <h1>Developers</h1>
                
                <h2 id="file-formats">File formats<a class="headerlink" href="#file-formats" title="Permanent link">#</a></h2>
<h3 id="mesh-file-data-structure">Mesh file data structure<a class="headerlink" href="#mesh-file-data-structure" title="Permanent link">#</a></h3>
<p>The mesh data structure, output of a mesh generation algorithm, refers to the geometric data structure and in some case to another
mesh data structure.</p>
<p>In this case, the fields are</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">MeshVersionFormatted</span> <span class="n">0</span>

<span class="n">Dimension</span> <span class="no">[DIM]</span><span class="p">(</span><span class="n">int</span><span class="p">)</span>

<span class="n">Vertices</span>
<span class="no">[Number of vertices]</span><span class="p">(</span><span class="n">int</span><span class="p">)</span>
<span class="n">X_1</span><span class="p">(</span><span class="n">double</span><span class="p">)</span> <span class="n">Y_1</span><span class="p">(</span><span class="n">double</span><span class="p">)</span> <span class="p">(</span><span class="n">Z_1</span><span class="p">(</span><span class="n">double</span><span class="p">))</span> <span class="n">Ref_1</span><span class="p">(</span><span class="n">int</span><span class="p">)</span>
<span class="p">...</span>
<span class="n">X_nv</span><span class="p">(</span><span class="n">double</span><span class="p">)</span> <span class="n">Y_nv</span><span class="p">(</span><span class="n">double</span><span class="p">)</span> <span class="p">(</span><span class="n">Z_nv</span><span class="p">(</span><span class="n">double</span><span class="p">))</span> <span class="n">Ref_nv</span><span class="p">(</span><span class="n">int</span><span class="p">)</span>

<span class="n">Edges</span>
<span class="no">[Number of edges]</span><span class="p">(</span><span class="n">int</span><span class="p">)</span>
<span class="n">Vertex1_1</span><span class="p">(</span><span class="n">int</span><span class="p">)</span> <span class="n">Vertex2_1</span><span class="p">(</span><span class="n">int</span><span class="p">)</span> <span class="n">Ref_1</span><span class="p">(</span><span class="n">int</span><span class="p">)</span>
<span class="p">...</span>
<span class="n">Vertex1_ne</span><span class="p">(</span><span class="n">int</span><span class="p">)</span> <span class="n">Vertex2_ne</span><span class="p">(</span><span class="n">int</span><span class="p">)</span> <span class="n">Ref_ne</span><span class="p">(</span><span class="n">int</span><span class="p">)</span>

<span class="n">Triangles</span>
<span class="no">[Number of triangles]</span><span class="p">(</span><span class="n">int</span><span class="p">)</span>
<span class="n">Vertex1_1</span><span class="p">(</span><span class="n">int</span><span class="p">)</span> <span class="n">Vertex2_1</span><span class="p">(</span><span class="n">int</span><span class="p">)</span> <span class="n">Vertex3_1</span><span class="p">(</span><span class="n">int</span><span class="p">)</span> <span class="n">Ref_1</span><span class="p">(</span><span class="n">int</span><span class="p">)</span>
<span class="p">...</span>
<span class="n">Vertex1_nt</span><span class="p">(</span><span class="n">int</span><span class="p">)</span> <span class="n">Vertex2_nt</span><span class="p">(</span><span class="n">int</span><span class="p">)</span> <span class="n">Vertex3_nt</span><span class="p">(</span><span class="n">int</span><span class="p">)</span> <span class="n">Ref_nt</span><span class="p">(</span><span class="n">int</span><span class="p">)</span>

<span class="n">Quadrilaterals</span>
<span class="no">[Number of Quadrilaterals]</span><span class="p">(</span><span class="n">int</span><span class="p">)</span>
<span class="n">Vertex1_1</span><span class="p">(</span><span class="n">int</span><span class="p">)</span> <span class="n">Vertex2_1</span><span class="p">(</span><span class="n">int</span><span class="p">)</span> <span class="n">Vertex3_1</span><span class="p">(</span><span class="n">int</span><span class="p">)</span> <span class="n">Vertex4_1</span><span class="p">(</span><span class="n">int</span><span class="p">)</span> <span class="n">Ref_1</span><span class="p">(</span><span class="n">int</span><span class="p">)</span>
<span class="p">...</span>
<span class="n">Vertex1_nq</span><span class="p">(</span><span class="n">int</span><span class="p">)</span> <span class="n">Vertex2_nq</span><span class="p">(</span><span class="n">int</span><span class="p">)</span> <span class="n">Vertex3_nq</span><span class="p">(</span><span class="n">int</span><span class="p">)</span> <span class="n">Vertex4_nq</span><span class="p">(</span><span class="n">int</span><span class="p">)</span> <span class="n">Ref_nq</span><span class="p">(</span><span class="n">int</span><span class="p">)</span>

<span class="n">Geometry</span>
<span class="no">[File name of geometric support]</span><span class="p">(</span><span class="n">char</span><span class="p">*)</span>

    <span class="n">VertexOnGeometricVertex</span>
    <span class="no">[Number of vertex on geometric vertex]</span><span class="p">(</span><span class="n">int</span><span class="p">)</span>
    <span class="n">Vertex_1</span><span class="p">(</span><span class="n">int</span><span class="p">)</span> <span class="n">VertexGeometry_1</span><span class="p">(</span><span class="n">int</span><span class="p">)</span>
    <span class="p">...</span>
    <span class="n">Vertex_nvg</span><span class="p">(</span><span class="n">int</span><span class="p">)</span> <span class="n">VertexGeometry_nvg</span><span class="p">(</span><span class="n">int</span><span class="p">)</span>

    <span class="n">EdgeOnGeometricEdge</span>
    <span class="no">[Number of geometric edge]</span><span class="p">(</span><span class="n">int</span><span class="p">)</span>
    <span class="n">Edge_1</span><span class="p">(</span><span class="n">int</span><span class="p">)</span> <span class="n">EdgeGeometry_1</span><span class="p">(</span><span class="n">int</span><span class="p">)</span>
    <span class="p">...</span>
    <span class="n">Edge_neg</span><span class="p">(</span><span class="n">int</span><span class="p">)</span> <span class="n">EdgeGeometry_neg</span><span class="p">(</span><span class="n">int</span><span class="p">)</span>

<span class="n">CrackedEdges</span>
<span class="no">[Number of cracked edges]</span><span class="p">(</span><span class="n">int</span><span class="p">)</span>
<span class="n">Edge1_1</span><span class="p">(</span><span class="n">int</span><span class="p">)</span> <span class="n">Edge2_1</span><span class="p">(</span><span class="n">int</span><span class="p">)</span>
<span class="p">...</span>
<span class="n">Edge1_nce</span><span class="p">(</span><span class="n">int</span><span class="p">)</span> <span class="n">Edge2_nce</span><span class="p">(</span><span class="n">int</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<p>When the current mesh refers to a previous mesh, we have in addition</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">MeshSupportOfVertices</span>
<span class="no">[File name of mesh support]</span><span class="p">(</span><span class="n">char</span><span class="p">*)</span>

    <span class="n">VertexOnSupportVertex</span>
    <span class="no">[Number of vertex on support vertex]</span><span class="p">(</span><span class="n">int</span><span class="p">)</span>
    <span class="n">Vertex_1</span><span class="p">(</span><span class="n">int</span><span class="p">)</span> <span class="n">VertexSupport_1</span><span class="p">(</span><span class="n">int</span><span class="p">)</span>
    <span class="p">...</span>
    <span class="n">Vertex_nvsv</span><span class="p">(</span><span class="n">int</span><span class="p">)</span> <span class="n">VertexSupport_nvsv</span><span class="p">(</span><span class="n">int</span><span class="p">)</span>

    <span class="n">VertexOnSupportEdge</span>
    <span class="no">[Number of vertex on support edge]</span><span class="p">(</span><span class="n">int</span><span class="p">)</span>
    <span class="n">Vertex_1</span><span class="p">(</span><span class="n">int</span><span class="p">)</span> <span class="n">EdgeSupport_1</span><span class="p">(</span><span class="n">int</span><span class="p">)</span> <span class="n">USupport_1</span><span class="p">(</span><span class="n">double</span><span class="p">)</span>
    <span class="p">...</span>
    <span class="n">Vertex_nvse</span><span class="p">(</span><span class="n">int</span><span class="p">)</span> <span class="n">EdgeSupport_nvse</span><span class="p">(</span><span class="n">int</span><span class="p">)</span> <span class="n">USupport_nvse</span><span class="p">(</span><span class="n">double</span><span class="p">)</span>

    <span class="n">VertexOnSupportTriangle</span>
    <span class="no">[Number of vertex on support triangle]</span><span class="p">(</span><span class="n">int</span><span class="p">)</span>
    <span class="n">Vertex_1</span><span class="p">(</span><span class="n">int</span><span class="p">)</span> <span class="n">TriangleSupport_1</span><span class="p">(</span><span class="n">int</span><span class="p">)</span> <span class="n">USupport_1</span><span class="p">(</span><span class="n">double</span><span class="p">)</span> <span class="n">VSupport_1</span><span class="p">(</span><span class="n">double</span><span class="p">)</span>
    <span class="p">...</span>
    <span class="n">Vertex_nvst</span><span class="p">(</span><span class="n">int</span><span class="p">)</span> <span class="n">TriangleSupport_nvst</span><span class="p">(</span><span class="n">int</span><span class="p">)</span> <span class="n">USupport_nvst</span><span class="p">(</span><span class="n">double</span><span class="p">)</span> <span class="n">VSupport_nvst</span><span class="p">(</span><span class="n">double</span><span class="p">)</span>

    <span class="n">VertexOnSupportQuadrilaterals</span>
    <span class="no">[Number of vertex on support quadrilaterals]</span>
    <span class="n">Vertex_1</span><span class="p">(</span><span class="n">int</span><span class="p">)</span> <span class="n">TriangleSupport_1</span><span class="p">(</span><span class="n">int</span><span class="p">)</span> <span class="n">USupport_1</span><span class="p">(</span><span class="n">double</span><span class="p">)</span> <span class="n">VSupport_1</span><span class="p">(</span><span class="n">double</span><span class="p">)</span>
    <span class="p">...</span>
    <span class="n">Vertex_nvsq</span><span class="p">(</span><span class="n">int</span><span class="p">)</span> <span class="n">TriangleSupport_nvsq</span><span class="p">(</span><span class="n">int</span><span class="p">)</span> <span class="n">USupport_nvsq</span><span class="p">(</span><span class="n">double</span><span class="p">)</span> <span class="n">VSupport_nvsq</span><span class="p">(</span><span class="n">double</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<ul>
<li><code>nv</code> means the number of vertices</li>
<li><code>ne</code> means the number of edges</li>
<li><code>nt</code> means the number of triangles</li>
<li><code>nq</code> means the number of quadrilaterals</li>
<li><code>nvg</code> means the number of vertex on geometric vertex</li>
<li><code>neg</code> means the number of edges on geometric edge</li>
<li><code>nce</code> means the number of cracked edges</li>
</ul>
<h3 id="bb-file-type-to-store-solutions"><code>bb</code> file type to Store Solutions<a class="headerlink" href="#bb-file-type-to-store-solutions" title="Permanent link">#</a></h3>
<p>The file is formatted such that:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">2</span> <span class="no">[Number of solutions]</span><span class="p">(</span><span class="n">int</span><span class="p">)</span> <span class="no">[Number of vertices]</span><span class="p">(</span><span class="n">int</span><span class="p">)</span> <span class="n">2</span>

<span class="n">U_1_1</span><span class="p">(</span><span class="n">double</span><span class="p">)</span> <span class="p">...</span> <span class="n">U_ns_1</span><span class="p">(</span><span class="n">double</span><span class="p">)</span>
<span class="p">...</span>
<span class="n">U_1_nv</span><span class="p">(</span><span class="n">double</span><span class="p">)</span> <span class="p">...</span> <span class="n">U_ns_nv</span><span class="p">(</span><span class="n">double</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<ul>
<li><code>ns</code> means the number of solutions</li>
<li><code>nv</code> means the number of vertices</li>
<li><code>U_i_j</code> is the solution component <code>i</code> at the vertex <code>j</code> on the associated mesh.</li>
</ul>
<h3 id="bb-file-type-to-store-solutions_1"><code>BB</code> file type to store solutions<a class="headerlink" href="#bb-file-type-to-store-solutions_1" title="Permanent link">#</a></h3>
<p>The file is formatted such that:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">2</span> <span class="no">[Number of solutions]</span><span class="p">(</span><span class="n">int</span><span class="p">)</span> <span class="no">[Type 1]</span><span class="p">(</span><span class="n">int</span><span class="p">)</span> <span class="p">...</span> <span class="no">[Type ns]</span><span class="p">(</span><span class="n">int</span><span class="p">)</span> <span class="no">[Number of vertices]</span><span class="p">(</span><span class="n">int</span><span class="p">)</span> <span class="n">2</span>

<span class="n">U_1_1_1</span><span class="p">(</span><span class="n">double</span><span class="p">)</span> <span class="p">...</span> <span class="n">U_</span><span class="p">(</span><span class="n">type_k</span><span class="p">)</span><span class="n">_1_1</span><span class="p">(</span><span class="n">double</span><span class="p">)</span>
<span class="p">...</span>
<span class="n">U_1_1_1</span><span class="p">(</span><span class="n">double</span><span class="p">)</span> <span class="p">...</span> <span class="n">U_</span><span class="p">(</span><span class="n">type_k</span><span class="p">)</span><span class="n">_nbv_1</span><span class="p">(</span><span class="n">double</span><span class="p">)</span>

<span class="p">...</span>

<span class="n">U_1_1_ns</span><span class="p">(</span><span class="n">double</span><span class="p">)</span> <span class="p">...</span> <span class="n">U_</span><span class="p">(</span><span class="n">type_k</span><span class="p">)</span><span class="n">_1_ns</span><span class="p">(</span><span class="n">double</span><span class="p">)</span>
<span class="p">...</span>
<span class="n">U_1_nbv_ns</span><span class="p">(</span><span class="n">double</span><span class="p">)</span> <span class="p">...</span> <span class="n">U_</span><span class="p">(</span><span class="n">type_k</span><span class="p">)</span><span class="n">_nbv_ns</span><span class="p">(</span><span class="n">double</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<ul>
<li><code>ns</code> means the number of solutions</li>
<li><code>type_k</code> mean the type of solution <code>k</code>:<ul>
<li>1: the solution is scalar (1 value per vertex)</li>
<li>2: the solution is vectorial (2 values per vertex)</li>
<li>3: the solution is a <span><span class="MathJax_Preview">2\times 2</span><script type="math/tex">2\times 2</script></span> symmetric matrix (3 values per vertex)</li>
<li>4: the solution is a <span><span class="MathJax_Preview">2\times 2</span><script type="math/tex">2\times 2</script></span> matrix (4 values per vertex)</li>
</ul>
</li>
<li><code>nbv</code> means the number of vertices</li>
<li><code>U_i_j_k</code> is the value of the component <code>i</code>of the solution <code>k</code> at vertex <code>j</code> on the associated mesh</li>
</ul>
<h3 id="metric-file">Metric file<a class="headerlink" href="#metric-file" title="Permanent link">#</a></h3>
<p>A metric file can be of two types, isotropic or anisotropic.</p>
<p>The isotropic file is such that</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="no">[Number of vertices]</span><span class="p">(</span><span class="n">int</span><span class="p">)</span> <span class="n">1</span>
<span class="n">h_0</span><span class="p">(</span><span class="n">double</span><span class="p">)</span>
<span class="p">...</span>
<span class="n">h_nv</span><span class="p">(</span><span class="n">double</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<ul>
<li><code>nv</code> is the number of vertices</li>
<li>
<p><code>h_i</code> is the wanted mesh size near the vertex <code>i</code> on associated mesh.</p>
<p>The metric is <span><span class="MathJax_Preview">\mathcal{M}_i = h_i^{-2}I</span><script type="math/tex">\mathcal{M}_i = h_i^{-2}I</script></span> where <span><span class="MathJax_Preview">I</span><script type="math/tex">I</script></span> is the identity matrix.</p>
</li>
</ul>
<p>The anisotropic file is such that</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="no">[Number of vertices]</span><span class="p">(</span><span class="n">int</span><span class="p">)</span> <span class="n">3</span>
<span class="n">a11_0</span><span class="p">(</span><span class="n">double</span><span class="p">)</span> <span class="n">a21_0</span><span class="p">(</span><span class="n">double</span><span class="p">)</span> <span class="n">a22_0</span><span class="p">(</span><span class="n">double</span><span class="p">)</span>
<span class="p">...</span>
<span class="n">a11_nv</span><span class="p">(</span><span class="n">double</span><span class="p">)</span> <span class="n">a21_nv</span><span class="p">(</span><span class="n">double</span><span class="p">)</span> <span class="n">a22_nv</span><span class="p">(</span><span class="n">double</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<ul>
<li><code>nv</code> is the number of vertices</li>
<li><code>a11_i</code>, <code>a21_i</code> and <code>a22_i</code> represent metric <span><span class="MathJax_Preview">\mathcal{M}_i = \left(\begin{array}{cc}a_{11,i} &amp; a_{12,i}\\a{12}_i &amp; a_{22,i}\end{array}\right)</span><script type="math/tex">\mathcal{M}_i = \left(\begin{array}{cc}a_{11,i} & a_{12,i}\\a{12}_i & a_{22,i}\end{array}\right)</script></span> which define the wanted size in a vicinity of the vertex <code>i</code> such that <span><span class="MathJax_Preview">h</span><script type="math/tex">h</script></span> in direction <span><span class="MathJax_Preview">u \in \R^2</span><script type="math/tex">u \in \R^2</script></span> is equal to <span><span class="MathJax_Preview">|u|/\sqrt{u\cdot\mathcal{M}_i\, u}</span><script type="math/tex">|u|/\sqrt{u\cdot\mathcal{M}_i\, u}</script></span>, where <span><span class="MathJax_Preview">\cdot</span><script type="math/tex">\cdot</script></span> is the dot product in <span><span class="MathJax_Preview">\R^2</span><script type="math/tex">\R^2</script></span>, and <span><span class="MathJax_Preview">|\cdot|</span><script type="math/tex">|\cdot|</script></span> is the classical norm.</li>
</ul>
<h3 id="list-of-am_fmt-amdba-meshes">List of AM_FMT, AMDBA Meshes<a class="headerlink" href="#list-of-am_fmt-amdba-meshes" title="Permanent link">#</a></h3>
<p>The mesh is only composed of triangles and can be defined with the help of the following two integers and four arrays:</p>
<ul>
<li><code>nbt</code> the number of triangles</li>
<li><code>nbv</code> the number of vertices</li>
<li><code>nu(1:3, 1:nbt)</code> an integer array giving the three vertex numbers counterclockwise for each triangle</li>
<li><code>c(1:2, 1:nbv)</code> a real array giving tje two coordinates of each vertex</li>
<li><code>refs(1:nbv)</code> an integer array giving the reference numbers of the vertices</li>
<li><code>reft(1:nbt)</code> an integer array giving the reference numbers of the triangles</li>
</ul>
<p><strong>AM_FMT Files</strong></p>
<p>In <code>Fortran</code> the <code>am_fmt</code> files are read as follows:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">open</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="k">file</span><span class="o">=</span><span class="s1">&#39;xxx.am_fmt&#39;</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="s1">&#39;formatted&#39;</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="s1">&#39;old&#39;</span><span class="p">)</span>
<span class="k">read</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="n">nbv</span><span class="p">,</span> <span class="n">nbt</span>
<span class="k">read</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="p">((</span><span class="n">nu</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">nbt</span><span class="p">)</span>
<span class="k">read</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="p">((</span><span class="n">c</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">nbv</span><span class="p">)</span>
<span class="k">read</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="p">(</span> <span class="n">reft</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">nbt</span><span class="p">)</span>
<span class="k">read</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="p">(</span> <span class="n">refs</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">nbv</span><span class="p">)</span>
<span class="k">close</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<p><strong>AM Files</strong></p>
<p>In <code>Fortran</code> the <code>am</code> files are read as follows:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">open</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="k">file</span><span class="o">=</span><span class="s1">&#39;xxx.am&#39;</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="s1">&#39;unformatted&#39;</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="s1">&#39;old&#39;</span><span class="p">)</span>
<span class="k">read</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="n">nbv</span><span class="p">,</span> <span class="n">nbt</span>
<span class="k">read</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">((</span><span class="n">nu</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">nbt</span><span class="p">),</span>
<span class="p">&amp;</span> <span class="p">((</span><span class="n">c</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">nbv</span><span class="p">),</span>
<span class="p">&amp;</span> <span class="p">(</span><span class="n">reft</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">nbt</span><span class="p">),</span>
<span class="p">&amp;</span> <span class="p">(</span><span class="n">refs</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">nbv</span><span class="p">)</span>
<span class="k">close</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<p><strong>AMDBA Files</strong></p>
<p>In <code>Fortran</code> the <code>amdba</code> files are read as follows:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">open</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="k">file</span><span class="o">=</span><span class="s1">&#39;xxx.amdba&#39;</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="s1">&#39;formatted&#39;</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="s1">&#39;old&#39;</span><span class="p">)</span>
<span class="k">read</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="n">nbv</span><span class="p">,</span> <span class="n">nbt</span>
<span class="k">read</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="p">(</span><span class="n">c</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">refs</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">nbv</span><span class="p">)</span>
<span class="k">read</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="p">(</span><span class="n">nu</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">reft</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">nbt</span><span class="p">)</span>
<span class="k">close</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<p><strong>msh Files</strong></p>
<p>First, we add the notions of boundary edges</p>
<ul>
<li><code>nbbe</code> the number of boundary edge</li>
<li><code>nube(1:2, 1:nbbe)</code> an integer array giving the two vertex numbers of boundary edges</li>
<li><code>refbe(1:nbbe)</code> an integer array giving the reference numbers of boundary edges</li>
</ul>
<p>In <code>Fortran</code> the <code>msh</code> files are read as follows:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">open</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="k">file</span><span class="o">=</span><span class="s1">&#39;xxx.msh&#39;</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="s1">&#39;formatted&#39;</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="s1">&#39;old&#39;</span><span class="p">)</span>
<span class="k">read</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="n">nbv</span><span class="p">,</span> <span class="n">nbt</span><span class="p">,</span> <span class="n">nbbe</span>
<span class="k">read</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="p">((</span><span class="n">c</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">refs</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">nbv</span><span class="p">)</span>
<span class="k">read</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="p">((</span><span class="n">nu</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">reft</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">nbt</span><span class="p">)</span>
<span class="k">read</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="p">((</span><span class="n">ne</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">refbe</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">nbbe</span><span class="p">)</span>
<span class="k">close</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<p><strong>ftq Files</strong></p>
<p>In <code>Fortran</code> the <code>ftq</code> files are read as follows:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">open</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="k">file</span><span class="o">=</span><span class="s1">&#39;xxx.ftq&#39;</span><span class="p">,</span><span class="n">form</span><span class="o">=</span><span class="s1">&#39;formatted&#39;</span><span class="p">,</span><span class="n">status</span><span class="o">=</span><span class="s1">&#39;old&#39;</span><span class="p">)</span>
<span class="k">read</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="n">nbv</span><span class="p">,</span><span class="n">nbe</span><span class="p">,</span><span class="n">nbt</span><span class="p">,</span><span class="n">nbq</span>
<span class="k">read</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="p">(</span><span class="n">k</span><span class="p">(</span><span class="n">j</span><span class="p">),(</span><span class="n">nu</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">),</span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">(</span><span class="n">j</span><span class="p">)),</span><span class="n">reft</span><span class="p">(</span><span class="n">j</span><span class="p">),</span><span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">nbe</span><span class="p">)</span>
<span class="k">read</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="p">((</span><span class="n">c</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">k</span><span class="p">),</span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="n">refs</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">nbv</span><span class="p">)</span>
<span class="k">close</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<p>where if <code>k(j) = 3</code> when the element <code>j</code> is a triangle and <code>k(j) = 4</code> when the the element <code>j</code> is a quadrilateral.</p>
<h3 id="sol-and-solb-files">sol and solb files<a class="headerlink" href="#sol-and-solb-files" title="Permanent link">#</a></h3>
<p>With the keyword <code class="codehilite"><span class="nf">savesol</span></code>, we can store a scalar functions, a scalar finite element functions, a vector fields, a vector finite element fields, a symmetric tensor and a symmetric finite element tensor.</p>
<p>Such format is used in <code class="codehilite"><span class="nf">medit</span></code>.</p>
<p><strong>Extension file <code class="codehilite"><span class="p">.</span><span class="n">sol</span></code></strong></p>
<p>The first two lines of the file are :</p>
<ul>
<li>
<p><code class="codehilite"><span class="n">MeshVersionFormatted</span> <span class="mi">0</span></code></p>
</li>
<li>
<p><code class="codehilite"><span class="n">Dimension</span> <span class="p">[</span><span class="n">DIM</span><span class="p">](</span><span class="kt">int</span><span class="p">)</span></code></p>
</li>
</ul>
<p>The following fields begin with one of the following keyword:
<code class="codehilite"><span class="n">SolAtVertices</span></code>, <code class="codehilite"><span class="n">SolAtEdges</span></code>, <code class="codehilite"><span class="n">SolAtTriangles</span></code>, <code class="codehilite"><span class="n">SolAtQuadrilaterals</span></code>,
<code class="codehilite"><span class="n">SolAtTetrahedra</span></code>, <code class="codehilite"><span class="n">SolAtPentahedra</span></code>, <code class="codehilite"><span class="n">SolAtHexahedra</span></code>.</p>
<p>In each field, we give then in the next line the number of elements in the solutions (<code class="codehilite"><span class="n">SolAtVertices</span></code>: number of vertices, <code class="codehilite"><span class="n">SolAtTriangles</span></code>: number of triangles, ...). In other lines, we give the number of solutions, the type of solution (1: scalar, 2: vector, 3: symmetric tensor). And finally, we give the values of the solutions on the elements.</p>
<p>The file must be ended with the keyword End.</p>
<p>The real element of symmetric tensor :</p>
<div>
<div class="MathJax_Preview">\begin{eqnarray}
    \label{savesol.def.symtensor}
    ST^{3d}=\left(
    \begin{array}{ccc}
        ST_{xx}^{3d} &amp; ST_{xy}^{3d} &amp; ST_{xz}^{3d}\\
        ST_{yx}^{3d} &amp; ST_{yy}^{3d} &amp; ST_{yz}^{3d} \\
        ST_{zx}^{3d} &amp; ST_{zy}^{3d} &amp; ST_{zz}^{3d}
    \end{array}
    \right)
    \qquad
    ST^{2d}= \left(
    \begin{array}{cc}
        ST_{xx}^{2d} &amp; ST_{xy}^{2d} \\
        ST_{yx}^{2d} &amp; ST_{yy}^{2d}
    \end{array}
    \right)
\end{eqnarray}</div>
<script type="math/tex; mode=display">\begin{eqnarray}
    \label{savesol.def.symtensor}
    ST^{3d}=\left(
    \begin{array}{ccc}
        ST_{xx}^{3d} & ST_{xy}^{3d} & ST_{xz}^{3d}\\
        ST_{yx}^{3d} & ST_{yy}^{3d} & ST_{yz}^{3d} \\
        ST_{zx}^{3d} & ST_{zy}^{3d} & ST_{zz}^{3d}
    \end{array}
    \right)
    \qquad
    ST^{2d}= \left(
    \begin{array}{cc}
        ST_{xx}^{2d} & ST_{xy}^{2d} \\
        ST_{yx}^{2d} & ST_{yy}^{2d}
    \end{array}
    \right)
\end{eqnarray}</script>
</div>
<p>stored in the extension <code class="codehilite"><span class="p">.</span><span class="n">sol</span></code> are respectively <span><span class="MathJax_Preview">ST_{xx}^{3d}, ST_{yx}^{3d}, ST_{yy}^{3d}, ST_{zx}^{3d}, ST_{zy}^{3d}, ST_{zz}^{3d}</span><script type="math/tex">ST_{xx}^{3d}, ST_{yx}^{3d}, ST_{yy}^{3d}, ST_{zx}^{3d}, ST_{zy}^{3d}, ST_{zz}^{3d}</script></span> and <span><span class="MathJax_Preview">ST_{xx}^{2d}, ST_{yx}^{2d}, ST_{yy}^{2d}</span><script type="math/tex">ST_{xx}^{2d}, ST_{yx}^{2d}, ST_{yy}^{2d}</script></span></p>
<p>An example of field with the keyword <code class="codehilite"><span class="n">SolAtTetrahedra</span></code>:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">SolAtTetrahedra</span>
<span class="no">[Number of tetrahedra]</span><span class="p">(</span><span class="n">int</span><span class="p">)</span>
<span class="no">[Number of solutions]</span><span class="p">(</span><span class="n">int</span><span class="p">)</span> <span class="no">[Type of solution 1]</span><span class="p">(</span><span class="n">int</span><span class="p">)</span> <span class="p">...</span> <span class="no">[Type of soution nt]</span><span class="p">(</span><span class="n">int</span><span class="p">)</span>

<span class="n">U_1_1_1</span><span class="p">(</span><span class="n">double</span><span class="p">)</span> <span class="p">...</span> <span class="n">U_nrs_1_1</span><span class="p">(</span><span class="n">double</span><span class="p">)</span>
<span class="p">...</span>
<span class="n">U_1_ns_1</span><span class="p">(</span><span class="n">double</span><span class="p">)</span> <span class="p">...</span> <span class="n">U_</span><span class="p">(</span><span class="n">nrs_k</span><span class="p">)</span><span class="n">_ns_1</span><span class="p">(</span><span class="n">double</span><span class="p">)</span>

<span class="p">...</span>

<span class="n">U_1_1_nt</span><span class="p">(</span><span class="n">double</span><span class="p">)</span> <span class="p">...</span> <span class="n">U_nrs_1_nt</span><span class="p">(</span><span class="n">double</span><span class="p">)</span>
<span class="p">...</span>
<span class="n">U_1_ns_nt</span><span class="p">(</span><span class="n">double</span><span class="p">)</span> <span class="p">...</span> <span class="n">U_</span><span class="p">(</span><span class="n">nrs_k</span><span class="p">)</span><span class="n">_ns_nt</span><span class="p">(</span><span class="n">double</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<ul>
<li><code>ns</code> is the number of solutions</li>
<li><code>typesol_k</code>, type of the solution number <code>k</code><ul>
<li><code>typesol_k = 1</code> the solution <code>k</code> is scalar</li>
<li><code>typesol_k = 2</code> the solution <code>k</code> is vectorial</li>
<li><code>typesol_k = 3</code> the solution <code>k</code> is a symmetric tensor or symmetric matrix</li>
</ul>
</li>
<li><code>nrs_k</code> is the number of real to describe solution <code>k</code><ul>
<li><code>nrs_k = 1</code> if the solution <code>k</code> is scalar</li>
<li><code>nrs_k = dim</code> if the solution <code>k</code> is vectorial (<code>dim</code> is the dimension of the solution)</li>
<li><code>nrs_k = dim*(dim+1)/2</code> if the solution k is a symmetric tensor or symmetric matrix</li>
</ul>
</li>
<li><code>U_i_j_^k</code> is a real equal to the value of the component <code>i</code> of the solution <code>k</code> at tetrahedron <code>j</code> on the associated mesh</li>
</ul>
<p>The format <code class="codehilite"><span class="p">.</span><span class="n">solb</span></code> is the same as format <code class="codehilite"><span class="p">.</span><span class="n">sol</span></code> but in binary (read/write is faster, storage is less).</p>
<p>A real scalar functions <span><span class="MathJax_Preview">f1</span><script type="math/tex">f1</script></span>, a vector fields <span><span class="MathJax_Preview">\mathbf{\Phi} = [\Phi1, \Phi2, \Phi3]</span><script type="math/tex">\mathbf{\Phi} = [\Phi1, \Phi2, \Phi3]</script></span> and a symmetric tensor <span><span class="MathJax_Preview">ST^{3d}</span><script type="math/tex">ST^{3d}</script></span> \eqref{savesol.def.symtensor} at the vertices of the three dimensional mesh <code class="codehilite"><span class="n">Th3</span></code> is stored in the file <code class="codehilite"><span class="n">f1PhiTh3</span><span class="p">.</span><span class="n">sol</span></code> using :</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nf">savesol</span><span class="p">(</span><span class="s">&quot;f1PhiST3dTh3.sol&quot;</span><span class="p">,</span> <span class="n">Th3</span><span class="p">,</span> <span class="err">$</span><span class="n">f1</span><span class="err">$</span><span class="p">,</span> <span class="p">[</span><span class="n">Phi</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">Phi</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">Phi</span><span class="p">(</span><span class="mi">3</span><span class="p">)],</span> <span class="n">VV3</span><span class="p">,</span> <span class="kp">order</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
</pre></div>
</td></tr></table>

<p>where <span><span class="MathJax_Preview">VV3 = [ST_{xx}^{3d}, ST_{yx}^{3d}, ST_{yy}^{3d}, ST_{zx}^{3d}, ST_{zy}^{3d}, ST_{zz}^{3d}]</span><script type="math/tex">VV3 = [ST_{xx}^{3d}, ST_{yx}^{3d}, ST_{yy}^{3d}, ST_{zx}^{3d}, ST_{zy}^{3d}, ST_{zz}^{3d}]</script></span>.</p>
<p>For a two dimensional mesh <code class="codehilite"><span class="n">Th</span></code>, A real scalar functions <span><span class="MathJax_Preview">f2</span><script type="math/tex">f2</script></span>, a vector fields <span><span class="MathJax_Preview">\mathbf{\Psi} = [\Psi1, \Psi2]</span><script type="math/tex">\mathbf{\Psi} = [\Psi1, \Psi2]</script></span> and a symmetric tensor <span><span class="MathJax_Preview">ST^{2d}</span><script type="math/tex">ST^{2d}</script></span> \eqref{savesol.def.symtensor} at triangles is stored in the file <code class="codehilite"><span class="n">f2PsiST2dTh3</span><span class="p">.</span><span class="n">solb</span></code> using :</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nf">savesol</span><span class="p">(</span><span class="s">&quot;f2PsiST2dTh3.solb&quot;</span><span class="p">,</span> <span class="n">Th</span><span class="p">,</span> <span class="n">f2</span><span class="p">,</span> <span class="p">[</span><span class="n">Psi</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">Psi</span><span class="p">(</span><span class="mi">2</span><span class="p">)],</span> <span class="n">VV2</span><span class="p">,</span> <span class="kp">order</span><span class="o">=</span><span class="mi">0</span><span class="p">);</span>
</pre></div>
</td></tr></table>

<p>where <span><span class="MathJax_Preview">VV2 = [ST_{xx}^{2d}, ST_{yx}^{2d}, ST_{yy}^{2d}]</span><script type="math/tex">VV2 = [ST_{xx}^{2d}, ST_{yx}^{2d}, ST_{yy}^{2d}]</script></span></p>
<p>The arguments of <code class="codehilite"><span class="nf">savesol</span></code> functions are the name of a file, a mesh and solutions. These arguments must be given in this order.</p>
<p>The parameters of this keyword are :</p>
<ul>
<li><code class="codehilite"><span class="kp">order</span> <span class="o">=</span></code> 0 is the solution is given at the center of gravity of elements. 1 is the solution is given at the vertices of elements.</li>
</ul>
<p>In the file, solutions are stored in this order : scalar solutions, vector solutions and finally symmetric tensor solutions.</p>
<h2 id="adding-a-new-finite-element">Adding a new finite element<a class="headerlink" href="#adding-a-new-finite-element" title="Permanent link">#</a></h2>
<h3 id="some-notations">Some notations<a class="headerlink" href="#some-notations" title="Permanent link">#</a></h3>
<p>For a function <span><span class="MathJax_Preview">\boldsymbol{f}</span><script type="math/tex">\boldsymbol{f}</script></span> taking value in <span><span class="MathJax_Preview">\R^{N},\, N=1,2,\cdots</span><script type="math/tex">\R^{N},\, N=1,2,\cdots</script></span>, we define the finite element approximation <span><span class="MathJax_Preview">\Pi_h\boldsymbol{f}</span><script type="math/tex">\Pi_h\boldsymbol{f}</script></span> of <span><span class="MathJax_Preview">\boldsymbol{f}</span><script type="math/tex">\boldsymbol{f}</script></span>.</p>
<p>Let us denote the number of the degrees of freedom of the finite element by <span><span class="MathJax_Preview">NbDoF</span><script type="math/tex">NbDoF</script></span>. Then the <span><span class="MathJax_Preview">i</span><script type="math/tex">i</script></span>-th base <span><span class="MathJax_Preview">\boldsymbol{\omega}^{K}_{i}</span><script type="math/tex">\boldsymbol{\omega}^{K}_{i}</script></span> (<span><span class="MathJax_Preview">i=0,\cdots,NbDoF-1</span><script type="math/tex">i=0,\cdots,NbDoF-1</script></span>) of the finite element space has the <span><span class="MathJax_Preview">j</span><script type="math/tex">j</script></span>-th component <span><span class="MathJax_Preview">\mathbf{\omega}^{K}_{ij}</span><script type="math/tex">\mathbf{\omega}^{K}_{ij}</script></span> for <span><span class="MathJax_Preview">j=0,\cdots,N-1</span><script type="math/tex">j=0,\cdots,N-1</script></span>.</p>
<p>The operator <span><span class="MathJax_Preview">\Pi_{h}</span><script type="math/tex">\Pi_{h}</script></span> is called the interpolator of the finite element.</p>
<p>We have the identity <span><span class="MathJax_Preview">\boldsymbol{\omega}^{K}_{i} = \Pi_{h} \boldsymbol{\omega}^{K}_{i}</span><script type="math/tex">\boldsymbol{\omega}^{K}_{i} = \Pi_{h} \boldsymbol{\omega}^{K}_{i}</script></span>.</p>
<p>Formally, the interpolator <span><span class="MathJax_Preview">\Pi_{h}</span><script type="math/tex">\Pi_{h}</script></span> is constructed by the following formula:
<script type="math/tex; mode=display">\begin{equation}
\label{eq-interpo}
\Pi_{h} \boldsymbol{f} = \sum_{k=0}^{\mathtt{kPi}-1} \alpha_k \boldsymbol{f}_{j_{k}}(P_{p_{k}}) \boldsymbol{\omega}^{K}_{i_{k}}
\end{equation}</script>
where <span><span class="MathJax_Preview">P_{p}</span><script type="math/tex">P_{p}</script></span> is a set of <span><span class="MathJax_Preview">npPi</span><script type="math/tex">npPi</script></span> points,</p>
<p>In the formula \eqref{eq-interpo}, the list <span><span class="MathJax_Preview">p_{k},\, j_{k},\, i_{k}</span><script type="math/tex">p_{k},\, j_{k},\, i_{k}</script></span> depend just on the type of finite element (not on the element), but the coefficient <span><span class="MathJax_Preview">\alpha_{k}</span><script type="math/tex">\alpha_{k}</script></span> can be depending on the element.</p>
<div class="admonition example">
<p class="admonition-title">Classical scalar Lagrange finite element</p>
<p>With the classical scalar Lagrange finite element, we have <span><span class="MathJax_Preview">\mathtt{kPi}=\mathtt{npPi}=\mathtt{NbOfNode}</span><script type="math/tex">\mathtt{kPi}=\mathtt{npPi}=\mathtt{NbOfNode}</script></span> and</p>
<ul>
<li><span><span class="MathJax_Preview">P_{p}</span><script type="math/tex">P_{p}</script></span> is the point of the nodal points</li>
<li>the <span><span class="MathJax_Preview">\alpha_k=1</span><script type="math/tex">\alpha_k=1</script></span>, because we take the value of the function at the point <span><span class="MathJax_Preview">P_{k}</span><script type="math/tex">P_{k}</script></span></li>
<li><span><span class="MathJax_Preview">p_{k}=k</span><script type="math/tex">p_{k}=k</script></span> , <span><span class="MathJax_Preview">j_{k}=k</span><script type="math/tex">j_{k}=k</script></span> because we have one node per function.</li>
<li><span><span class="MathJax_Preview">j_{k}=0</span><script type="math/tex">j_{k}=0</script></span> because <span><span class="MathJax_Preview">N=1</span><script type="math/tex">N=1</script></span></li>
</ul>
</div>
<div class="admonition example">
<p class="admonition-title">The Raviart-Thomas finite element</p>
<div>
<div class="MathJax_Preview">\begin{equation}
    RT0_{h} = \{ \mathbf{v} \in H(div) / \forall K \in
    \mathcal{T}_{h} \quad \mathbf{v}_{|K}(x,y) =
    \vecttwo{\alpha_{K}}{\beta_{K}} + \gamma_{K}\vecttwo{x}{y} \}
    \label{eq:RT0-fe}
\end{equation}</div>
<script type="math/tex; mode=display">\begin{equation}
    RT0_{h} = \{ \mathbf{v} \in H(div) / \forall K \in
    \mathcal{T}_{h} \quad \mathbf{v}_{|K}(x,y) =
    \vecttwo{\alpha_{K}}{\beta_{K}} + \gamma_{K}\vecttwo{x}{y} \}
    \label{eq:RT0-fe}
\end{equation}</script>
</div>
<p>The degrees of freedom are the flux through an edge <span><span class="MathJax_Preview">e</span><script type="math/tex">e</script></span> of the mesh, where the flux of the function <span><span class="MathJax_Preview">\mathbf{f} : \R^2 \longrightarrow \R^2</span><script type="math/tex">\mathbf{f} : \R^2 \longrightarrow \R^2</script></span> is <span><span class="MathJax_Preview">\int_{e} \mathbf{f}.n_{e}</span><script type="math/tex">\int_{e} \mathbf{f}.n_{e}</script></span>, <span><span class="MathJax_Preview">n_{e}</span><script type="math/tex">n_{e}</script></span> is the unit normal of edge <span><span class="MathJax_Preview">e</span><script type="math/tex">e</script></span> (this implies a orientation of all the edges of the mesh, for example we can use the global numbering of the edge vertices and we just go to small to large number).</p>
<p>To compute this flux, we use a quadrature formula with one point, the middle point of the edge. Consider a triangle <span><span class="MathJax_Preview">T</span><script type="math/tex">T</script></span> with three vertices <span><span class="MathJax_Preview">(\mathbf{a},\mathbf{b},\mathbf{c})</span><script type="math/tex">(\mathbf{a},\mathbf{b},\mathbf{c})</script></span>.</p>
<p>Let denote the vertices numbers by <span><span class="MathJax_Preview">i_{a},i_{b},i_{c}</span><script type="math/tex">i_{a},i_{b},i_{c}</script></span>, and define the three edge vectors <span><span class="MathJax_Preview">\mathbf{e}^{0},\mathbf{e}^{1},\mathbf{e}^{2}</span><script type="math/tex">\mathbf{e}^{0},\mathbf{e}^{1},\mathbf{e}^{2}</script></span> by <span><span class="MathJax_Preview">sgn(i_{b}-i_{c})(\mathbf{b}-\mathbf{c})</span><script type="math/tex">sgn(i_{b}-i_{c})(\mathbf{b}-\mathbf{c})</script></span>, <span><span class="MathJax_Preview">sgn(i_{c}-i_{a})(\mathbf{c}-\mathbf{a})</span><script type="math/tex">sgn(i_{c}-i_{a})(\mathbf{c}-\mathbf{a})</script></span>, <span><span class="MathJax_Preview">sgn(i_{a}-i_{b})(\mathbf{a}-\mathbf{b})</span><script type="math/tex">sgn(i_{a}-i_{b})(\mathbf{a}-\mathbf{b})</script></span>.</p>
<p>The three basis functions are:
<script type="math/tex; mode=display">\begin{equation}
\boldsymbol{\omega}^{K}_{0}= \frac{sgn(i_{b}-i_{c})}{2|T|}(x-a),\quad \boldsymbol{\omega}^{K}_{1}= \frac{sgn(i_{c}-i_{a})}{2|T|}(x-b),\quad \boldsymbol{\omega}^{K}_{2}= \frac{sgn(i_{a}-i_{b})}{2|T|}(x-c),
\end{equation}</script>
where <span><span class="MathJax_Preview">|T|</span><script type="math/tex">|T|</script></span> is the area of the triangle <span><span class="MathJax_Preview">T</span><script type="math/tex">T</script></span>.</p>
<p>So we have <span><span class="MathJax_Preview">N=2</span><script type="math/tex">N=2</script></span>, <span><span class="MathJax_Preview">\mathtt{kPi}=6; \mathtt{npPi}=3;</span><script type="math/tex">\mathtt{kPi}=6; \mathtt{npPi}=3;</script></span> and:</p>
<ul>
<li>
<p><span><span class="MathJax_Preview">P_{p} = \left\{\frac{\mathbf{b}+\mathbf{c}}{2}, \frac{\mathbf{a}+\mathbf{c}}{2}, \frac{\mathbf{b}+\mathbf{a}}{2} \right\}</span><script type="math/tex">P_{p} = \left\{\frac{\mathbf{b}+\mathbf{c}}{2}, \frac{\mathbf{a}+\mathbf{c}}{2}, \frac{\mathbf{b}+\mathbf{a}}{2} \right\}</script></span></p>
</li>
<li>
<p><span><span class="MathJax_Preview">\alpha_{0}= - \mathbf{e}^{0}_{2}, \alpha_{1}= \mathbf{e}^{0}_{1}</span><script type="math/tex">\alpha_{0}= - \mathbf{e}^{0}_{2}, \alpha_{1}= \mathbf{e}^{0}_{1}</script></span>,
    <span><span class="MathJax_Preview">\alpha_{2}= - \mathbf{e}^{1}_{2}, \alpha_{3}= \mathbf{e}^{1}_{1}</span><script type="math/tex">\alpha_{2}= - \mathbf{e}^{1}_{2}, \alpha_{3}= \mathbf{e}^{1}_{1}</script></span>,
    <span><span class="MathJax_Preview">\alpha_{4}= - \mathbf{e}^{2}_{2}, \alpha_{5}= \mathbf{e}^{2}_{1}</span><script type="math/tex">\alpha_{4}= - \mathbf{e}^{2}_{2}, \alpha_{5}= \mathbf{e}^{2}_{1}</script></span> (effectively, the vector
    <span><span class="MathJax_Preview">(-\mathbf{e}^{m}_{2}, \mathbf{e}^{m}_{1})</span><script type="math/tex">(-\mathbf{e}^{m}_{2}, \mathbf{e}^{m}_{1})</script></span> is orthogonal to the edge <span><span class="MathJax_Preview">\mathbf{e}^{m}= (e^m_{1},e^m_{2})</span><script type="math/tex">\mathbf{e}^{m}= (e^m_{1},e^m_{2})</script></span> with
    a length equal to the side of the edge or equal to <span><span class="MathJax_Preview">\int_{e^m} 1</span><script type="math/tex">\int_{e^m} 1</script></span>).</p>
</li>
<li><span><span class="MathJax_Preview">i_{k}=\{0,0,1,1,2,2\}</span><script type="math/tex">i_{k}=\{0,0,1,1,2,2\}</script></span>,</li>
<li><span><span class="MathJax_Preview">p_{k}=\{0,0,1,1,2,2\}</span><script type="math/tex">p_{k}=\{0,0,1,1,2,2\}</script></span> , <span><span class="MathJax_Preview">j_{k}=\{0,1,0,1,0,1,0,1\}</span><script type="math/tex">j_{k}=\{0,1,0,1,0,1,0,1\}</script></span>.</li>
</ul>
</div>
<h3 id="which-class-to-add">Which class to add?<a class="headerlink" href="#which-class-to-add" title="Permanent link">#</a></h3>
<p>Add file <code>FE_ADD.cpp</code> in directory <code>FreeFem-sources/src/femlib</code> for example first to initialize :</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c">#include &quot;error.hpp&quot;</span>
<span class="c">#include &quot;rgraph.hpp&quot;</span>
<span class="n">using</span> <span class="n">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="c">#include &quot;RNM.hpp&quot;</span>
<span class="c">#include &quot;fem.hpp&quot;</span>
<span class="c">#include &quot;FESpace.hpp&quot;</span>
<span class="c">#include &quot;AddNewFE.h&quot;</span>

<span class="n">namespace</span> <span class="n">Fem2D</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
</pre></div>
</td></tr></table>

<p>Then add a class which derive for <code>public TypeOfFE</code> like:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">class</span> <span class="n">TypeOfFE_RTortho</span> <span class="err">:</span> <span class="n">public</span> <span class="n">TypeOfFE</span> <span class="p">{</span> <span class="n">public</span><span class="err">:</span>
    <span class="n">static</span> <span class="n">int</span> <span class="n">Data</span><span class="p">[];</span> <span class="p">//</span><span class="n">some</span> <span class="n">numbers</span>
    <span class="n">TypeOfFE_RTortho</span><span class="p">()</span><span class="err">:</span>
    <span class="n">TypeOfFE</span><span class="p">(</span>
        <span class="n">0</span><span class="p">+</span><span class="n">3</span><span class="p">+</span><span class="n">0</span><span class="p">,</span>  <span class="p">//</span><span class="n">nb</span> <span class="n">degree</span> <span class="n">of</span> <span class="n">freedom</span> <span class="n">on</span> <span class="n">element</span>
        <span class="n">2</span><span class="p">,</span>      <span class="p">//</span><span class="n">dimension</span> <span class="n">N</span> <span class="n">of</span> <span class="n">vectorial</span> <span class="n">FE</span> <span class="p">(</span><span class="n">1</span> <span class="k">if</span> <span class="n">scalar</span> <span class="n">FE</span><span class="p">)</span>
        <span class="n">Data</span><span class="p">,</span>   <span class="p">//</span><span class="n">the</span> <span class="n">array</span> <span class="n">data</span>
        <span class="n">1</span><span class="p">,</span>      <span class="p">//</span><span class="n">nb</span> <span class="n">of</span> <span class="n">subdivision</span> <span class="k">for</span> <span class="n">plotting</span>
        <span class="n">1</span><span class="p">,</span>      <span class="p">//</span><span class="n">nb</span> <span class="n">of</span> <span class="n">sub</span> <span class="n">finite</span> <span class="n">element</span> <span class="p">(</span><span class="n">generaly</span> <span class="n">1</span><span class="p">)</span>
        <span class="n">6</span><span class="p">,</span>      <span class="p">//</span><span class="n">number</span> <span class="n">kPi</span> <span class="n">of</span> <span class="n">coef</span> <span class="n">to</span> <span class="n">build</span> <span class="n">the</span> <span class="n">interpolator</span>
        <span class="n">3</span><span class="p">,</span>      <span class="p">//</span><span class="n">number</span> <span class="n">npPi</span> <span class="n">of</span> <span class="n">integration</span> <span class="n">point</span> <span class="n">to</span> <span class="n">build</span> <span class="n">interpolator</span>
        <span class="n">0</span>       <span class="p">//</span><span class="n">an</span> <span class="n">array</span> <span class="n">to</span> <span class="n">store</span> <span class="n">the</span> <span class="n">coef</span> <span class="p">\</span><span class="n">alpha_k</span> <span class="n">to</span> <span class="n">build</span> <span class="n">interpolator</span>
        <span class="p">//</span><span class="n">here</span> <span class="n">this</span> <span class="n">array</span> <span class="n">is</span> <span class="n">no</span> <span class="n">constant</span> <span class="n">so</span> <span class="n">we</span> <span class="n">have</span>
        <span class="p">//</span><span class="n">to</span> <span class="n">rebuilt</span> <span class="k">for</span> <span class="n">each</span> <span class="n">element</span>
    <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">const</span> <span class="n">R2</span> <span class="n">Pt</span><span class="p">[]</span> <span class="p">=</span> <span class="p">{</span><span class="n">R2</span><span class="p">(</span><span class="n">0</span><span class="p">.</span><span class="n">5</span><span class="p">,</span> <span class="n">0</span><span class="p">.</span><span class="n">5</span><span class="p">),</span> <span class="n">R2</span><span class="p">(</span><span class="n">0</span><span class="p">.</span><span class="n">0</span><span class="p">,</span> <span class="n">0</span><span class="p">.</span><span class="n">5</span><span class="p">),</span> <span class="n">R2</span><span class="p">(</span><span class="n">0</span><span class="p">.</span><span class="n">5</span><span class="p">,</span> <span class="n">0</span><span class="p">.</span><span class="n">0</span><span class="p">)</span> <span class="p">};</span>
        <span class="p">//</span> <span class="n">the</span> <span class="nb">set </span><span class="n">of</span> <span class="n">Point</span> <span class="k">in</span> <span class="n">hat</span><span class="p">{</span><span class="n">K</span><span class="p">}</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">int</span> <span class="n">p</span> <span class="p">=</span> <span class="n">0</span><span class="p">,</span> <span class="n">kk</span> <span class="p">=</span> <span class="n">0</span><span class="p">;</span> <span class="n">p</span> <span class="p">&lt;</span> <span class="n">3</span><span class="p">;</span> <span class="n">p</span><span class="p">++){</span>
            <span class="n">P_Pi_h</span><span class="no">[p]</span> <span class="p">=</span> <span class="n">Pt</span><span class="no">[p]</span><span class="p">;</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">int</span> <span class="n">j</span> <span class="p">=</span> <span class="n">0</span><span class="p">;</span> <span class="n">j</span> <span class="p">&lt;</span> <span class="n">2</span><span class="p">;</span> <span class="n">j</span><span class="p">++)</span>
                <span class="n">pij_alpha</span><span class="p">[</span><span class="n">kk</span><span class="p">++]</span> <span class="p">=</span> <span class="n">IPJ</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">j</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="p">//</span><span class="n">definition</span> <span class="n">of</span> <span class="n">i_k</span><span class="p">,</span> <span class="n">p_k</span><span class="p">,</span> <span class="n">j_k</span> <span class="k">in</span> <span class="n">interpolator</span>

    <span class="n">void</span> <span class="n">FB</span><span class="p">(</span><span class="n">const</span> <span class="n">bool</span> <span class="p">*</span><span class="n">watdd</span><span class="p">,</span> <span class="n">const</span> <span class="n">Mesh</span> <span class="p">&amp;</span><span class="n">Th</span><span class="p">,</span> <span class="n">const</span> <span class="n">Triangle</span> <span class="p">&amp;</span><span class="n">K</span><span class="p">,</span>
        <span class="n">const</span> <span class="n">R2</span> <span class="p">&amp;</span><span class="n">PHat</span><span class="p">,</span> <span class="n">RNMK_</span> <span class="p">&amp;</span><span class="n">val</span><span class="p">)</span> <span class="n">const</span><span class="p">;</span>

    <span class="n">void</span> <span class="n">Pi_h_alpha</span><span class="p">(</span><span class="n">const</span> <span class="n">baseFElement</span> <span class="p">&amp;</span><span class="n">K</span><span class="p">,</span> <span class="n">KN_</span><span class="p">&lt;</span><span class="n">double</span><span class="p">&gt;</span> <span class="p">&amp;</span><span class="n">v</span><span class="p">)</span> <span class="n">const</span><span class="p">;</span>
<span class="p">}</span> <span class="p">;</span>
</pre></div>
</td></tr></table>

<p>where the array data is formed with the concatenation of five array of size <code>NbDoF</code> and one array of size <code>N</code>.</p>
<p>This array is:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">int</span> <span class="n">TypeOfFE_RTortho</span><span class="p">::</span><span class="n">Data</span><span class="p">[]</span> <span class="p">=</span> <span class="p">{</span>
    <span class="p">//</span><span class="k">for</span> <span class="n">each</span> <span class="n">df</span> <span class="n">0</span><span class="p">,</span> <span class="n">1</span><span class="p">,</span> <span class="n">3</span><span class="err">:</span>
    <span class="n">3</span><span class="p">,</span> <span class="n">4</span><span class="p">,</span> <span class="n">5</span><span class="p">,</span> <span class="p">//</span><span class="n">the</span> <span class="n">support</span> <span class="n">of</span> <span class="n">the</span> <span class="n">node</span> <span class="n">of</span> <span class="n">the</span> <span class="n">df</span>
    <span class="n">0</span><span class="p">,</span> <span class="n">0</span><span class="p">,</span> <span class="n">0</span><span class="p">,</span> <span class="p">//</span><span class="n">the</span> <span class="n">number</span> <span class="n">of</span> <span class="n">the</span> <span class="n">df</span> <span class="n">on</span> <span class="n">the</span> <span class="n">node</span>
    <span class="n">0</span><span class="p">,</span> <span class="n">1</span><span class="p">,</span> <span class="n">2</span><span class="p">,</span> <span class="p">//</span><span class="n">the</span> <span class="n">node</span> <span class="n">of</span> <span class="n">the</span> <span class="n">df</span>
    <span class="n">0</span><span class="p">,</span> <span class="n">0</span><span class="p">,</span> <span class="n">0</span><span class="p">,</span> <span class="p">//</span><span class="n">the</span> <span class="n">df</span> <span class="n">come</span> <span class="n">from</span> <span class="n">which</span> <span class="n">FE</span> <span class="p">(</span><span class="n">generally</span> <span class="n">0</span><span class="p">)</span>
    <span class="n">0</span><span class="p">,</span> <span class="n">1</span><span class="p">,</span> <span class="n">2</span><span class="p">,</span> <span class="p">//</span><span class="n">which</span> <span class="n">are</span> <span class="n">the</span> <span class="n">df</span> <span class="n">on</span> <span class="n">sub</span> <span class="n">FE</span>
    <span class="n">0</span><span class="p">,</span> <span class="n">0</span>
<span class="p">};</span> <span class="p">//</span><span class="k">for</span> <span class="n">each</span> <span class="n">component</span> <span class="n">j</span><span class="p">=</span><span class="n">0</span><span class="p">,</span> <span class="n">N</span><span class="p">-</span><span class="n">1</span> <span class="n">it</span> <span class="n">give</span> <span class="n">the</span> <span class="n">sub</span> <span class="n">FE</span> <span class="n">associated</span>
</pre></div>
</td></tr></table>

<p>where the support is a number <span><span class="MathJax_Preview">0,1,2</span><script type="math/tex">0,1,2</script></span> for vertex support, <span><span class="MathJax_Preview">3,4,5</span><script type="math/tex">3,4,5</script></span> for edge support, and finally <span><span class="MathJax_Preview">6</span><script type="math/tex">6</script></span> for element support.</p>
<p>The function to defined the function <span><span class="MathJax_Preview">\boldsymbol{\omega}^{K}_{i}</span><script type="math/tex">\boldsymbol{\omega}^{K}_{i}</script></span>, this function return the value of all the basics function or this derivatives in array <code>val</code>, computed at point <code>Phat</code> on the reference triangle corresponding to point <code>R2 P=K(Phat);</code> on the current triangle <code>K</code>.</p>
<p>The index <span><span class="MathJax_Preview">i,j,k</span><script type="math/tex">i,j,k</script></span> of the array <span><span class="MathJax_Preview">val(i,j,k)</span><script type="math/tex">val(i,j,k)</script></span> correspond to:</p>
<ul>
<li><span><span class="MathJax_Preview">i</span><script type="math/tex">i</script></span> is the basic function number on finite element <span><span class="MathJax_Preview">i \in [0,NoF[</span><script type="math/tex">i \in [0,NoF[</script></span></li>
<li><span><span class="MathJax_Preview">j</span><script type="math/tex">j</script></span> is the value of component <span><span class="MathJax_Preview">j \in [0,N[</span><script type="math/tex">j \in [0,N[</script></span></li>
<li>
<p><span><span class="MathJax_Preview">k</span><script type="math/tex">k</script></span> is the type of computed value <span><span class="MathJax_Preview">f(P),dx(f)(P), dy(f)(P), ...\ i \in [0,\mathtt{last\_operatortype}[</span><script type="math/tex">f(P),dx(f)(P), dy(f)(P), ...\ i \in [0,\mathtt{last\_operatortype}[</script></span>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For optimization, this value is computed only if <code>whatd[k]</code> is true, and the numbering is defined with</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">enum</span> <span class="n">operatortype</span> <span class="p">{</span>
    <span class="n">op_id</span> <span class="p">=</span> <span class="n">0</span><span class="p">,</span>
    <span class="n">op_dx</span> <span class="p">=</span> <span class="n">1</span><span class="p">,</span> <span class="n">op_dy</span> <span class="p">=</span> <span class="n">2</span><span class="p">,</span>
    <span class="n">op_dxx</span> <span class="p">=</span> <span class="n">3</span><span class="p">,</span><span class="n">op_dyy</span> <span class="p">=</span> <span class="n">4</span><span class="p">,</span>
    <span class="n">op_dyx</span> <span class="p">=</span> <span class="n">5</span><span class="p">,</span><span class="n">op_dxy</span> <span class="p">=</span> <span class="n">5</span><span class="p">,</span>
    <span class="n">op_dz</span> <span class="p">=</span> <span class="n">6</span><span class="p">,</span>
    <span class="n">op_dzz</span> <span class="p">=</span> <span class="n">7</span><span class="p">,</span>
    <span class="n">op_dzx</span> <span class="p">=</span> <span class="n">8</span><span class="p">,</span> <span class="n">op_dxz</span> <span class="p">=</span> <span class="n">8</span><span class="p">,</span>
    <span class="n">op_dzy</span> <span class="p">=</span> <span class="n">9</span><span class="p">,</span> <span class="n">op_dyz</span> <span class="p">=</span> <span class="n">9</span>
<span class="p">};</span>
<span class="n">const</span> <span class="n">int</span> <span class="n">last_operatortype</span> <span class="p">=</span> <span class="n">10</span><span class="p">;</span>
</pre></div>
</td></tr></table>

</div>
<p>The shape function :</p>
</li>
</ul>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">void</span> <span class="n">TypeOfFE_RTortho</span><span class="p">::</span><span class="n">FB</span><span class="p">(</span><span class="n">const</span> <span class="n">bool</span> <span class="p">*</span><span class="n">whatd</span><span class="p">,</span> <span class="n">const</span> <span class="n">Mesh</span> <span class="p">&amp;</span><span class="n">Th</span><span class="p">,</span> <span class="n">const</span> <span class="n">Triangle</span> <span class="p">&amp;</span> <span class="n">K</span><span class="p">,</span>
    <span class="n">const</span> <span class="n">R2</span> <span class="p">&amp;</span><span class="n">PHat</span><span class="p">,</span><span class="n">RNMK_</span> <span class="p">&amp;</span><span class="n">val</span><span class="p">)</span> <span class="n">const</span>
<span class="p">{</span>
    <span class="n">R2</span> <span class="n">P</span><span class="p">(</span><span class="n">K</span><span class="p">(</span><span class="n">PHat</span><span class="p">));</span>
    <span class="n">R2</span> <span class="n">A</span><span class="p">(</span><span class="n">K</span><span class="p">[</span><span class="n">0</span><span class="p">]),</span> <span class="n">B</span><span class="p">(</span><span class="n">K</span><span class="p">[</span><span class="n">1</span><span class="p">]),</span> <span class="n">C</span><span class="p">(</span><span class="n">K</span><span class="p">[</span><span class="n">2</span><span class="p">]);</span>
    <span class="nb">R </span><span class="n">l0</span> <span class="p">=</span> <span class="n">1</span> <span class="p">-</span> <span class="n">P</span><span class="p">.</span><span class="n">x-P</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
    <span class="nb">R </span><span class="n">l1</span> <span class="p">=</span> <span class="n">P</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">l2</span> <span class="p">=</span> <span class="n">P</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
    <span class="n">assert</span><span class="p">(</span><span class="n">val</span><span class="p">.</span><span class="n">N</span><span class="p">()</span> <span class="p">&gt;=</span> <span class="n">3</span><span class="p">);</span>
    <span class="n">assert</span><span class="p">(</span><span class="n">val</span><span class="p">.</span><span class="n">M</span><span class="p">()</span> <span class="p">==</span> <span class="n">2</span><span class="p">);</span>
    <span class="n">val</span> <span class="p">=</span> <span class="n">0</span><span class="p">;</span>
    <span class="nb">R </span><span class="n">a</span> <span class="p">=</span> <span class="n">1</span><span class="p">./(</span><span class="n">2</span><span class="p">*</span><span class="n">K</span><span class="p">.</span><span class="n">area</span><span class="p">);</span>
    <span class="nb">R </span><span class="n">a0</span> <span class="p">=</span> <span class="n">K</span><span class="p">.</span><span class="n">EdgeOrientation</span><span class="p">(</span><span class="n">0</span><span class="p">)</span> <span class="p">*</span> <span class="n">a</span><span class="p">;</span>
    <span class="nb">R </span><span class="n">a1</span> <span class="p">=</span> <span class="n">K</span><span class="p">.</span><span class="n">EdgeOrientation</span><span class="p">(</span><span class="n">1</span><span class="p">)</span> <span class="p">*</span> <span class="n">a</span><span class="p">;</span>
    <span class="nb">R </span><span class="n">a2</span> <span class="p">=</span> <span class="n">K</span><span class="p">.</span><span class="n">EdgeOrientation</span><span class="p">(</span><span class="n">2</span><span class="p">)</span> <span class="p">*</span> <span class="n">a</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">whatd</span><span class="no">[op_id]</span><span class="p">){</span> <span class="p">//</span><span class="n">value</span> <span class="n">of</span> <span class="n">the</span> <span class="k">function</span>
        <span class="n">assert</span><span class="p">(</span><span class="n">val</span><span class="p">.</span><span class="n">K</span><span class="p">()</span> <span class="p">&gt;</span> <span class="n">op_id</span><span class="p">);</span>
        <span class="n">RN_</span> <span class="n">f0</span><span class="p">(</span><span class="n">val</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">0</span><span class="p">,</span><span class="n">0</span><span class="p">));</span> <span class="p">//</span><span class="n">value</span> <span class="n">first</span> <span class="n">component</span>
        <span class="n">RN_</span> <span class="n">f1</span><span class="p">(</span><span class="n">val</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">1</span><span class="p">,</span><span class="n">0</span><span class="p">));</span> <span class="p">//</span><span class="n">value</span> <span class="n">second</span> <span class="n">component</span>
        <span class="n">f1</span><span class="p">[</span><span class="n">0</span><span class="p">]</span> <span class="p">=</span> <span class="p">(</span><span class="n">P</span><span class="p">.</span><span class="n">x</span> <span class="p">-</span> <span class="n">A</span><span class="p">.</span><span class="n">x</span><span class="p">)*</span><span class="n">a0</span><span class="p">;</span>
        <span class="n">f0</span><span class="p">[</span><span class="n">0</span><span class="p">]</span> <span class="p">=</span> <span class="p">-(</span><span class="n">P</span><span class="p">.</span><span class="n">y</span> <span class="p">-</span> <span class="n">A</span><span class="p">.</span><span class="n">y</span><span class="p">)*</span><span class="n">a0</span><span class="p">;</span>

        <span class="n">f1</span><span class="p">[</span><span class="n">1</span><span class="p">]</span> <span class="p">=</span> <span class="p">(</span><span class="n">P</span><span class="p">.</span><span class="n">x</span> <span class="p">-</span> <span class="n">B</span><span class="p">.</span><span class="n">x</span><span class="p">)*</span><span class="n">a1</span><span class="p">;</span>
        <span class="n">f0</span><span class="p">[</span><span class="n">1</span><span class="p">]</span> <span class="p">=</span> <span class="p">-(</span><span class="n">P</span><span class="p">.</span><span class="n">y</span> <span class="p">-</span> <span class="n">B</span><span class="p">.</span><span class="n">y</span><span class="p">)*</span><span class="n">a1</span><span class="p">;</span>

        <span class="n">f1</span><span class="p">[</span><span class="n">2</span><span class="p">]</span> <span class="p">=</span> <span class="p">(</span><span class="n">P</span><span class="p">.</span><span class="n">x</span> <span class="p">-</span> <span class="n">C</span><span class="p">.</span><span class="n">x</span><span class="p">)*</span><span class="n">a2</span><span class="p">;</span>
        <span class="n">f0</span><span class="p">[</span><span class="n">2</span><span class="p">]</span> <span class="p">=</span> <span class="p">-(</span><span class="n">P</span><span class="p">.</span><span class="n">y</span> <span class="p">-</span> <span class="n">C</span><span class="p">.</span><span class="n">y</span><span class="p">)*</span><span class="n">a2</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">whatd</span><span class="no">[op_dx]</span><span class="p">){</span> <span class="p">//</span><span class="n">value</span> <span class="n">of</span> <span class="n">the</span> <span class="n">dx</span> <span class="n">of</span> <span class="k">function</span>
        <span class="n">assert</span><span class="p">(</span><span class="n">val</span><span class="p">.</span><span class="n">K</span><span class="p">()</span> <span class="p">&gt;</span> <span class="n">op_dx</span><span class="p">);</span>
        <span class="n">val</span><span class="p">(</span><span class="n">0</span><span class="p">,</span><span class="n">1</span><span class="p">,</span><span class="n">op_dx</span><span class="p">)</span> <span class="p">=</span> <span class="n">a0</span><span class="p">;</span>
        <span class="n">val</span><span class="p">(</span><span class="n">1</span><span class="p">,</span><span class="n">1</span><span class="p">,</span><span class="n">op_dx</span><span class="p">)</span> <span class="p">=</span> <span class="n">a1</span><span class="p">;</span>
        <span class="n">val</span><span class="p">(</span><span class="n">2</span><span class="p">,</span><span class="n">1</span><span class="p">,</span><span class="n">op_dx</span><span class="p">)</span> <span class="p">=</span> <span class="n">a2</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">whatd</span><span class="no">[op_dy]</span><span class="p">){</span>
        <span class="n">assert</span><span class="p">(</span><span class="n">val</span><span class="p">.</span><span class="n">K</span><span class="p">()</span> <span class="p">&gt;</span> <span class="n">op_dy</span><span class="p">);</span>
        <span class="n">val</span><span class="p">(</span><span class="n">0</span><span class="p">,</span><span class="n">0</span><span class="p">,</span><span class="n">op_dy</span><span class="p">)</span> <span class="p">=</span> <span class="n">-a0</span><span class="p">;</span>
        <span class="n">val</span><span class="p">(</span><span class="n">1</span><span class="p">,</span><span class="n">0</span><span class="p">,</span><span class="n">op_dy</span><span class="p">)</span> <span class="p">=</span> <span class="n">-a1</span><span class="p">;</span>
        <span class="n">val</span><span class="p">(</span><span class="n">2</span><span class="p">,</span><span class="n">0</span><span class="p">,</span><span class="n">op_dy</span><span class="p">)</span> <span class="p">=</span> <span class="n">-a2</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">for</span> <span class="p">(</span><span class="n">int</span> <span class="n">i</span> <span class="p">=</span> <span class="n">op_dy</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">last_operatortype</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">whatd</span><span class="no">[op_dx]</span><span class="p">)</span>
            <span class="n">assert</span><span class="p">(</span><span class="n">op_dy</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<!--- ** --->

<p>The function to defined the coefficient <span><span class="MathJax_Preview">\alpha_{k}</span><script type="math/tex">\alpha_{k}</script></span>:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">void</span> <span class="n">TypeOfFE_RT</span><span class="p">::</span><span class="n">Pi_h_alpha</span><span class="p">(</span><span class="n">const</span> <span class="n">baseFElement</span> <span class="p">&amp;</span><span class="n">K</span><span class="p">,</span> <span class="n">KN_</span><span class="p">&lt;</span><span class="n">double</span><span class="p">&gt;</span> <span class="p">&amp;</span><span class="n">v</span><span class="p">)</span> <span class="n">const</span>
<span class="p">{</span>
    <span class="n">const</span> <span class="n">Triangle</span> <span class="p">&amp;</span><span class="n">T</span><span class="p">(</span><span class="n">K</span><span class="p">.</span><span class="n">T</span><span class="p">);</span>

    <span class="k">for</span> <span class="p">(</span><span class="n">int</span> <span class="n">i</span> <span class="p">=</span> <span class="n">0</span><span class="p">,</span> <span class="n">k</span> <span class="p">=</span> <span class="n">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">3</span><span class="p">;</span> <span class="n">i</span><span class="p">++){</span>
        <span class="n">R2</span> <span class="n">E</span><span class="p">(</span><span class="n">T</span><span class="p">.</span><span class="n">Edge</span><span class="p">(</span><span class="n">i</span><span class="p">));</span>
        <span class="nb">R </span><span class="n">signe</span> <span class="p">=</span> <span class="n">T</span><span class="p">.</span><span class="n">EdgeOrientation</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="p">;</span>
        <span class="n">v</span><span class="p">[</span><span class="n">k</span><span class="p">++]</span> <span class="p">=</span> <span class="n">signe</span><span class="p">*</span><span class="n">E</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
        <span class="n">v</span><span class="p">[</span><span class="n">k</span><span class="p">++]</span> <span class="p">=</span> <span class="n">-signe</span><span class="p">*</span><span class="n">E</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>Now , we just need to add a new key work in <strong><code>FreeFem++</code></strong>.</p>
<p>Two way, with static or dynamic link so at the end of the file, we add:</p>
<p><strong>With dynamic link</strong> it is very simple (see section <a href="#dynamical-link">Dynamical link</a>), just add before the end of <code class="codehilite"><span class="n">FEM2d</span> <span class="n">namespace</span></code>:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">static</span> <span class="n">TypeOfFE_RTortho</span> <span class="n">The_TypeOfFE_RTortho</span><span class="p">;</span>
    <span class="n">static</span> <span class="n">AddNewFE</span><span class="p">(</span><span class="s2">&quot;RT0Ortho&quot;</span><span class="p">,</span> <span class="n">The_TypeOfFE_RTortho</span><span class="p">);</span>
<span class="p">}</span> <span class="p">//</span><span class="n">FEM2d</span> <span class="n">namespace</span>
</pre></div>
</td></tr></table>

<p>Try with <code>./load.link</code> command in <a href="https://github.com/FreeFem/FreeFem-sources/tree/master/examples%2B%2B-load"><code>examples++-load/</code></a> and see <code>BernardiRaugel.cpp</code> or <code>Morley.cpp</code> new finite element examples.</p>
<p><strong>Otherwise with static link</strong> (for expert only), add</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="p">//</span><span class="n">let</span> <span class="n">the</span> <span class="n">2</span> <span class="n">globals</span> <span class="n">variables</span>
<span class="n">static</span> <span class="n">TypeOfFE_RTortho</span> <span class="n">The_TypeOfFE_RTortho</span><span class="p">;</span>
<span class="p">//</span><span class="n">the</span> <span class="n">name</span> <span class="k">in</span> <span class="n">freefem</span>
<span class="n">static</span> <span class="n">ListOfTFE</span> <span class="n">typefemRTOrtho</span><span class="p">(</span><span class="s2">&quot;RT0Ortho&quot;</span><span class="p">,</span> <span class="p">&amp;</span><span class="n">The_TypeOfFE_RTortho</span><span class="p">);</span>

<span class="p">//</span><span class="n">link</span> <span class="n">with</span> <span class="n">FreeFem</span><span class="p">++</span> <span class="k">do</span> <span class="n">not</span> <span class="n">work</span> <span class="n">with</span> <span class="n">static</span> <span class="n">library</span> <span class="p">.</span><span class="n">a</span>
<span class="p">//</span><span class="n">so</span> <span class="n">add</span> <span class="n">a</span> <span class="n">extern</span> <span class="n">name</span> <span class="n">to</span> <span class="n">call</span> <span class="k">in</span> <span class="n">init_static_FE</span>
<span class="p">//(</span><span class="n">see</span> <span class="k">end</span> <span class="n">of</span> <span class="n">FESpace</span><span class="p">.</span><span class="n">cpp</span><span class="p">)</span>
<span class="n">void</span> <span class="n">init_FE_ADD</span><span class="p">()</span> <span class="p">{</span> <span class="p">};</span>
<span class="p">//</span><span class="k">end</span>
<span class="p">}</span> <span class="p">//</span><span class="n">FEM2d</span> <span class="n">namespace</span>
</pre></div>
</td></tr></table>

<p>To inforce in loading of this new finite element, we have to add the two new lines close to the end of files <code>src/femlib/FESpace.cpp</code> like:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="p">//</span><span class="n">correct</span> <span class="n">problem</span> <span class="n">of</span> <span class="n">static</span> <span class="n">library</span> <span class="n">link</span> <span class="n">with</span> <span class="n">new</span> <span class="n">make</span> <span class="n">file</span>
<span class="n">void</span> <span class="n">init_static_FE</span><span class="p">()</span>
<span class="p">{</span> <span class="p">//</span><span class="n">list</span> <span class="n">of</span> <span class="n">other</span> <span class="n">FE</span> <span class="n">file</span><span class="p">.</span><span class="n">o</span>
    <span class="n">extern</span> <span class="n">void</span> <span class="n">init_FE_P2h</span><span class="p">()</span> <span class="p">;</span>
    <span class="n">init_FE_P2h</span><span class="p">()</span> <span class="p">;</span>
    <span class="n">extern</span> <span class="n">void</span> <span class="n">init_FE_ADD</span><span class="p">();</span> <span class="p">//</span><span class="n">new</span> <span class="n">line</span> <span class="n">1</span>
    <span class="n">init_FE_ADD</span><span class="p">();</span> <span class="p">//</span><span class="n">new</span> <span class="n">line</span> <span class="n">2</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>and now you have to change the makefile.</p>
<p>First, create a file <code>FE_ADD.cpp</code> contening all this code, like in file <code>src/femlib/Element_P2h.cpp</code>, after modify the <code>Makefile.am</code> by adding the name of your file to the variable <code>EXTRA_DIST</code> like:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c"># Makefile using Automake + Autoconf</span>
<span class="c"># ----------------------------------</span>
<span class="c"># Id</span>

<span class="c"># This is not compiled as a separate library because its</span>
<span class="c"># interconnections with other libraries have not been solved.</span>

<span class="n">EXTRA_DIST</span><span class="p">=</span><span class="n">BamgFreeFem</span><span class="p">.</span><span class="nb">cpp </span><span class="n">BamgFreeFem</span><span class="p">.</span><span class="n">hpp</span> <span class="n">CGNL</span><span class="p">.</span><span class="n">hpp</span> <span class="n">CheckPtr</span><span class="p">.</span><span class="nb">cpp </span>       <span class="p">\</span>
<span class="n">ConjuguedGradrientNL</span><span class="p">.</span><span class="nb">cpp </span><span class="n">DOperator</span><span class="p">.</span><span class="n">hpp</span> <span class="n">Drawing</span><span class="p">.</span><span class="nb">cpp </span><span class="n">Element_P2h</span><span class="p">.</span><span class="nb">cpp </span>     <span class="p">\</span>
<span class="n">Element_P3</span><span class="p">.</span><span class="nb">cpp </span><span class="n">Element_RT</span><span class="p">.</span><span class="nb">cpp </span><span class="n">fem3</span><span class="p">.</span><span class="n">hpp</span> <span class="n">fem</span><span class="p">.</span><span class="nb">cpp </span><span class="n">fem</span><span class="p">.</span><span class="n">hpp</span> <span class="n">FESpace</span><span class="p">.</span><span class="nb">cpp </span>     <span class="p">\</span>
<span class="n">FESpace</span><span class="p">.</span><span class="n">hpp</span> <span class="n">FESpace-v0</span><span class="p">.</span><span class="nb">cpp </span><span class="n">FQuadTree</span><span class="p">.</span><span class="nb">cpp </span><span class="n">FQuadTree</span><span class="p">.</span><span class="n">hpp</span> <span class="n">gibbs</span><span class="p">.</span><span class="nb">cpp </span>       <span class="p">\</span>
<span class="n">glutdraw</span><span class="p">.</span><span class="nb">cpp </span><span class="n">gmres</span><span class="p">.</span><span class="n">hpp</span> <span class="n">MatriceCreuse</span><span class="p">.</span><span class="n">hpp</span> <span class="n">MatriceCreuse_tpl</span><span class="p">.</span><span class="n">hpp</span>          <span class="p">\</span>
<span class="n">MeshPoint</span><span class="p">.</span><span class="n">hpp</span> <span class="n">mortar</span><span class="p">.</span><span class="nb">cpp </span><span class="n">mshptg</span><span class="p">.</span><span class="nb">cpp </span><span class="n">QuadratureFormular</span><span class="p">.</span><span class="nb">cpp </span>             <span class="p">\</span>
<span class="n">QuadratureFormular</span><span class="p">.</span><span class="n">hpp</span> <span class="n">RefCounter</span><span class="p">.</span><span class="n">hpp</span> <span class="n">RNM</span><span class="p">.</span><span class="n">hpp</span> <span class="n">RNM_opc</span><span class="p">.</span><span class="n">hpp</span> <span class="n">RNM_op</span><span class="p">.</span><span class="n">hpp</span>    <span class="p">\</span>
<span class="n">RNM_tpl</span><span class="p">.</span><span class="n">hpp</span>     <span class="n">FE_ADD</span><span class="p">.</span><span class="nb">cpp</span>
</pre></div>
</td></tr></table>

<p>and do in the <strong><code>FreeFem++</code></strong> root directory
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>autoreconf
./reconfigure
make
</pre></div>
</td></tr></table></p>
<p>For codewarrior compilation add the file in the project an remove the flag in panal PPC linker FreeFm++ Setting Dead-strip Static Initializition Code Flag.</p>
<h2 id="dynamical-link">Dynamical link<a class="headerlink" href="#dynamical-link" title="Permanent link">#</a></h2>
<p>Now, it's possible to add built-in functionnalites in <strong><code>FreeFem++</code></strong> under the three environnents Linux, Windows and MacOS X 10.3 or newer.</p>
<p>It is agood idea to first try the example <code>load.edp</code> in directory <a href="https://github.com/FreeFem/FreeFem-sources/tree/master/examples%2B%2B-load"><code>example++-load</code></a>.</p>
<p>You will need to install a <code>compiler</code> (generally <code>g++/gcc</code> compiler) to compile your function.</p>
<ul>
<li>Windows Install the <code>cygwin</code> environnent or the <code>mingw</code> one</li>
<li>MacOs Install the developer tools <code>Xcode</code> on the apple DVD</li>
<li>Linux/Unix Install the correct compiler (<code>gcc</code> for instance)</li>
</ul>
<p>Now, assume that you are in a shell window (a <code>cygwin</code> window under Windows) in the directory <a href="https://github.com/FreeFem/FreeFem-sources/tree/master/examples%2B%2B-load"><code>example++-load</code></a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In the sub directory <code>include</code>, they are all the <strong><code>FreeFem++</code></strong> include file to make the link with <strong><code>FreeFem++</code></strong>.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you try to load dynamically a file with command <code class="codehilite"><span class="cp">load</span> <span class="s">&quot;xxx&quot;</span></code>
 * Under Unix (Linux or MacOs), the file <code>xxx.so</code> will be loaded so it must be either in the search directory of routine <code>dlopen</code> (see the environment variable <code>$LD_LIBRARY_PATH.</code> or in the current directory, and the suffix <code>".so"</code> or the prefix <code>"./"</code> is automatically added.</p>
<ul>
<li>Under Windows, the file <code>xxx.dll</code> will be loaded so it must be in the <code>loadLibary</code> search directory which includes the directory of the application,</li>
</ul>
</div>
<p><strong>Compilation of your module:</strong></p>
<p>The script <code>ff-c++</code> compiles and makes the link with <strong><code>FreeFem++</code></strong>, but be careful, the script has no way to known if you try to compile for a pure Windows environment or for a cygwin environment so to build the load module under cygwin you must add the <code>-cygwin</code> parameter.</p>
<h3 id="a-first-example-myfunctioncpp">A first example <code>myfunction.cpp</code><a class="headerlink" href="#a-first-example-myfunctioncpp" title="Permanent link">#</a></h3>
<p>The following defines a new function call <code>myfunction</code> with no parameter, but using the <span><span class="MathJax_Preview">x,y</span><script type="math/tex">x,y</script></span> current value.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c">#include &lt;iostream&gt;</span>
<span class="c">#include &lt;cfloat&gt;</span>
<span class="n">using</span> <span class="n">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="c">#include &quot;error.hpp&quot;</span>
<span class="c">#include &quot;AFunction.hpp&quot;</span>
<span class="c">#include &quot;rgraph.hpp&quot;</span>
<span class="c">#include &quot;RNM.hpp&quot;</span>
<span class="c">#include &quot;fem.hpp&quot;</span>
<span class="c">#include &quot;FESpace.hpp&quot;</span>
<span class="c">#include &quot;MeshPoint.hpp&quot;</span>

<span class="n">using</span> <span class="n">namespace</span> <span class="n">Fem2D</span><span class="p">;</span>
<span class="n">double</span> <span class="n">myfunction</span><span class="p">(</span><span class="n">Stack</span> <span class="n">stack</span><span class="p">){</span>
    <span class="p">//</span><span class="n">to</span> <span class="n">get</span> <span class="n">FreeFem</span><span class="p">++</span> <span class="n">data</span>
    <span class="n">MeshPoint</span> <span class="p">&amp;</span><span class="nb">mp </span><span class="p">=</span> <span class="p">*</span><span class="n">MeshPointStack</span><span class="p">(</span><span class="n">stack</span><span class="p">);</span> <span class="p">//</span><span class="n">the</span> <span class="n">struct</span> <span class="n">to</span> <span class="n">get</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">normal</span><span class="p">,</span> <span class="n">value</span>
    <span class="n">double</span> <span class="n">x</span> <span class="p">=</span> <span class="n">mp</span><span class="p">.</span><span class="n">P</span><span class="p">.</span><span class="n">x</span><span class="p">;</span> <span class="p">//</span><span class="n">get</span> <span class="n">the</span> <span class="n">current</span> <span class="n">x</span> <span class="n">value</span>
    <span class="n">double</span> <span class="n">y</span> <span class="p">=</span> <span class="n">mp</span><span class="p">.</span><span class="n">P</span><span class="p">.</span><span class="n">y</span><span class="p">;</span> <span class="p">//</span><span class="n">get</span> <span class="n">the</span> <span class="n">current</span> <span class="n">y</span> <span class="n">value</span>
    <span class="p">//</span><span class="n">cout</span> <span class="p">&lt;&lt;</span> <span class="s2">&quot;x = &quot;</span> <span class="p">&lt;&lt;</span> <span class="n">x</span> <span class="p">&lt;&lt;</span> <span class="s2">&quot; y=&quot;</span> <span class="p">&lt;&lt;</span> <span class="n">y</span> <span class="p">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)*</span><span class="n">cos</span><span class="p">(</span><span class="n">y</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<!--- ** --->

<p>Now the Problem is to build the link with <strong><code>FreeFem++</code></strong>, to do that we need two classes, one to call the function <code>myfunction</code>.</p>
<p>All <strong><code>FreeFem++</code></strong> evaluable expression must be a <code>C++</code> <code>struct</code>/<code>class</code> which derivate from <code>E_F0</code>. By default this expression does not depend of the mesh position, but if they derivate from <code>E_F0mps</code> the expression depends of the mesh position, and for more details see <a href="#HECHT2002">HECHT2002</a>.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="p">//</span><span class="n">A</span> <span class="n">class</span> <span class="n">build</span> <span class="n">the</span> <span class="n">link</span> <span class="n">with</span> <span class="n">FreeFem</span><span class="p">++</span>
<span class="p">//</span><span class="n">generaly</span> <span class="n">this</span> <span class="n">class</span> <span class="n">are</span> <span class="n">already</span> <span class="k">in</span> <span class="n">AFunction</span><span class="p">.</span><span class="n">hpp</span>
<span class="p">//</span><span class="n">but</span> <span class="n">unfortunatly</span><span class="p">,</span> <span class="n">I</span> <span class="n">have</span> <span class="n">no</span> <span class="n">simple</span> <span class="k">function</span> <span class="n">with</span> <span class="n">no</span> <span class="k">parameter</span>
<span class="p">//</span><span class="k">in</span> <span class="n">FreeFem</span><span class="p">++</span> <span class="n">depending</span> <span class="n">of</span> <span class="n">the</span> <span class="n">mesh</span>
<span class="n">template</span><span class="p">&lt;</span><span class="n">class</span> <span class="n">R</span><span class="p">&gt;</span>
<span class="n">class</span> <span class="n">OneOperator0s</span> <span class="err">:</span> <span class="n">public</span> <span class="n">OneOperator</span> <span class="p">{</span>
    <span class="p">//</span><span class="n">the</span> <span class="n">class</span> <span class="n">to</span> <span class="n">define</span> <span class="n">and</span> <span class="n">evaluate</span> <span class="n">a</span> <span class="n">new</span> <span class="k">function</span>
    <span class="p">//</span><span class="n">It</span> <span class="n">must</span> <span class="n">devive</span> <span class="n">from</span> <span class="n">E_F0</span> <span class="k">if</span> <span class="n">it</span> <span class="n">is</span> <span class="n">mesh</span> <span class="n">independent</span>
    <span class="p">//</span><span class="n">or</span> <span class="n">from</span> <span class="n">E_F0mps</span> <span class="k">if</span> <span class="n">it</span> <span class="n">is</span> <span class="n">mesh</span> <span class="n">dependent</span>
    <span class="n">class</span> <span class="n">E_F0_F</span> <span class="err">:</span><span class="n">public</span> <span class="n">E_F0mps</span> <span class="p">{</span>
    <span class="n">public</span><span class="err">:</span>
        <span class="n">typedef</span> <span class="nb">R </span><span class="p">(*</span><span class="n">func</span><span class="p">)(</span><span class="n">Stack</span> <span class="n">stack</span><span class="p">);</span>
        <span class="n">func</span> <span class="n">f</span><span class="p">;</span> <span class="p">//</span><span class="n">the</span> <span class="n">pointeur</span> <span class="n">to</span> <span class="n">the</span> <span class="n">fnction</span> <span class="n">myfunction</span>
        <span class="n">E_F0_F</span><span class="p">(</span><span class="n">func</span> <span class="n">ff</span><span class="p">)</span> <span class="err">:</span> <span class="n">f</span><span class="p">(</span><span class="n">ff</span><span class="p">)</span> <span class="p">{}</span>
        <span class="p">//</span><span class="n">the</span> <span class="n">operator</span> <span class="n">evaluation</span> <span class="k">in</span> <span class="n">FreeFem</span><span class="p">++</span>
        <span class="n">AnyType</span> <span class="n">operator</span><span class="p">()(</span><span class="n">Stack</span> <span class="n">stack</span><span class="p">)</span> <span class="n">const</span> <span class="p">{</span><span class="k">return</span> <span class="n">SetAny</span><span class="p">&lt;</span><span class="n">R</span><span class="p">&gt;(</span><span class="n">f</span><span class="p">(</span><span class="n">stack</span><span class="p">));}</span>
    <span class="p">};</span>
    <span class="n">typedef</span> <span class="nb">R </span><span class="p">(*</span><span class="n">func</span><span class="p">)(</span><span class="n">Stack</span><span class="p">);</span>
    <span class="n">func</span> <span class="n">f</span><span class="p">;</span>
    <span class="n">public</span><span class="err">:</span>
        <span class="p">//</span><span class="n">the</span> <span class="k">function</span> <span class="n">which</span> <span class="n">build</span> <span class="n">the</span> <span class="n">FreeFem</span><span class="p">++</span> <span class="n">byte</span> <span class="n">code</span>
        <span class="n">E_F0</span> <span class="p">*</span><span class="n">code</span><span class="p">(</span><span class="n">const</span> <span class="n">basicAC_F0</span> <span class="p">&amp;)</span> <span class="n">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">new</span> <span class="n">E_F0_F</span><span class="p">(</span><span class="n">f</span><span class="p">);</span> <span class="p">}</span>
        <span class="p">//</span><span class="n">the</span> <span class="n">constructor</span> <span class="n">to</span> <span class="n">say</span> <span class="n">ff</span> <span class="n">is</span> <span class="n">a</span> <span class="k">function</span> <span class="n">without</span> <span class="k">parameter</span>
        <span class="p">//</span><span class="n">and</span> <span class="n">returning</span> <span class="n">a</span> <span class="nb">R</span>
        <span class="n">OneOperator0s</span><span class="p">(</span><span class="n">func</span> <span class="n">ff</span><span class="p">)</span> <span class="err">:</span> <span class="n">OneOperator</span><span class="p">(</span><span class="n">map_type</span><span class="p">[</span><span class="n">typeid</span><span class="p">(</span><span class="n">R</span><span class="p">).</span><span class="n">name</span><span class="p">()]),</span><span class="n">f</span><span class="p">(</span><span class="n">ff</span><span class="p">){}</span>
<span class="p">};</span>
</pre></div>
</td></tr></table>

<!--- ** --->

<p>To finish we must add this new function in <strong><code>FreeFem++</code></strong> table, to do that include :</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">void</span> <span class="n">init</span><span class="p">(){</span>
    <span class="n">Global</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="s2">&quot;myfunction&quot;</span><span class="p">,</span> <span class="s2">&quot;(&quot;</span><span class="p">,</span> <span class="n">new</span> <span class="n">OneOperator0s</span><span class="p">&lt;</span><span class="n">double</span><span class="p">&gt;(</span><span class="n">myfunction</span><span class="p">));</span>
<span class="p">}</span>
<span class="n">LOADFUNC</span><span class="p">(</span><span class="n">init</span><span class="p">);</span>
<span class="p">```</span><span class="nb">cpp</span>

<span class="n">It</span> <span class="n">will</span> <span class="n">be</span> <span class="n">called</span> <span class="n">automatically</span> <span class="n">at</span> <span class="n">load</span> <span class="n">module</span> <span class="n">time</span><span class="p">.</span>

<span class="n">To</span> <span class="n">compile</span> <span class="n">and</span> <span class="n">link</span><span class="p">,</span> <span class="n">use</span> <span class="n">the</span> <span class="p">`</span><span class="n">ff-c</span><span class="p">++`</span> <span class="n">script</span> <span class="err">:</span>

<span class="p">```</span><span class="nb">cpp</span>
<span class="n">ff-c</span><span class="p">++</span> <span class="n">myfunction</span><span class="p">.</span><span class="nb">cpp</span>
<span class="n">g</span><span class="p">++</span> <span class="n">-c</span> <span class="n">-g</span> <span class="n">-Iinclude</span> <span class="n">myfunction</span><span class="p">.</span><span class="nb">cpp</span>
<span class="n">g</span><span class="p">++</span> <span class="n">-bundle</span> <span class="n">-undefined</span> <span class="n">dynamic_lookup</span> <span class="n">-g</span> <span class="n">myfunction</span><span class="p">.</span><span class="n">o</span> <span class="n">-o</span> <span class="p">./</span><span class="n">myfunction</span><span class="p">.</span><span class="n">dylib</span>
</pre></div>
</td></tr></table>

<p>To try the simple example under Linux or MacOS, do <code>FreeFem++-nw load.edp</code></p>
<p>The output must be:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="p">--</span> <span class="n">FreeFem</span><span class="p">++</span> <span class="n">v</span>  <span class="p">*.******</span> <span class="p">(</span><span class="n">date</span> <span class="p">***</span> <span class="p">**</span> <span class="p">***</span> <span class="p">****,</span> <span class="p">**</span><span class="err">:</span><span class="p">**</span><span class="err">:</span><span class="p">**</span> <span class="p">(</span><span class="n">UTC</span><span class="p">+</span><span class="n">0</span><span class="p">*</span><span class="n">00</span><span class="p">))</span>
 <span class="n">Load</span><span class="err">:</span> <span class="n">lg_fem</span> <span class="n">lg_mesh</span> <span class="n">lg_mesh3</span> <span class="n">eigenvalue</span>
    <span class="n">1</span> <span class="err">:</span> <span class="p">//</span> <span class="n">Example</span> <span class="n">of</span> <span class="n">dynamic</span> <span class="k">function</span> <span class="n">load</span>
    <span class="n">2</span> <span class="err">:</span> <span class="p">//</span> <span class="p">--------------------------------</span>
    <span class="n">3</span> <span class="err">:</span> <span class="p">//</span> <span class="nv">$Id</span><span class="p">$</span>
    <span class="n">4</span> <span class="err">:</span>
    <span class="n">5</span> <span class="err">:</span>  <span class="n">load</span> <span class="s2">&quot;myfunction&quot;</span>
    <span class="n">6</span> <span class="err">:</span> <span class="p">//</span> <span class="n">dumptable</span><span class="p">(</span><span class="n">cout</span><span class="p">);</span>
    <span class="n">7</span> <span class="err">:</span>  <span class="n">mesh</span> <span class="n">Th</span><span class="p">=</span><span class="n">square</span><span class="p">(</span><span class="n">5</span><span class="p">,</span><span class="n">5</span><span class="p">);</span>
    <span class="n">8</span> <span class="err">:</span>  <span class="n">fespace</span> <span class="n">Vh</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span><span class="n">P1</span><span class="p">);</span>
    <span class="n">9</span> <span class="err">:</span>  <span class="n">Vh</span> <span class="n">uh</span><span class="p">=</span> <span class="n">myfunction</span><span class="p">();</span> <span class="p">//</span> <span class="n">warning</span> <span class="k">do</span> <span class="n">not</span> <span class="n">forget</span> <span class="p">()</span>
   <span class="n">10</span> <span class="err">:</span>  <span class="n">cout</span> <span class="p">&lt;&lt;</span> <span class="n">uh</span><span class="p">[].</span><span class="n">min</span> <span class="p">&lt;&lt;</span> <span class="s2">&quot; &quot;</span> <span class="p">&lt;&lt;</span> <span class="n">uh</span><span class="p">[].</span><span class="n">max</span> <span class="p">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
   <span class="n">11</span> <span class="err">:</span>  <span class="n">cout</span> <span class="p">&lt;&lt;</span> <span class="s2">&quot; test io ( &quot;</span> <span class="p">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
   <span class="n">12</span> <span class="err">:</span>  <span class="n">testio</span><span class="p">();</span>
   <span class="n">13</span> <span class="err">:</span>  <span class="n">cout</span> <span class="p">&lt;&lt;</span> <span class="s2">&quot; ) end test io .. &quot;</span> <span class="p">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span> <span class="n">sizestack</span> <span class="p">+</span> <span class="n">1024</span> <span class="p">=</span><span class="n">1416</span>  <span class="p">(</span> <span class="n">392</span> <span class="p">)</span>

  <span class="p">--</span> <span class="n">Square</span> <span class="n">mesh</span> <span class="err">:</span> <span class="n">nb</span> <span class="n">vertices</span>  <span class="p">=</span><span class="n">36</span> <span class="p">,</span>  <span class="n">nb</span> <span class="n">triangles</span> <span class="p">=</span> <span class="n">50</span> <span class="p">,</span>  <span class="n">nb</span> <span class="n">boundary</span> <span class="n">edges</span> <span class="n">20</span>
<span class="n">0</span> <span class="n">0</span><span class="p">.</span><span class="n">841471</span>
 <span class="n">test</span> <span class="n">io</span> <span class="p">(</span>
 <span class="n">test</span> <span class="n">cout</span> <span class="n">3</span><span class="p">.</span><span class="n">14159</span>
 <span class="n">test</span> <span class="n">cout</span> <span class="n">512</span>
 <span class="n">test</span> <span class="n">cerr</span> <span class="n">3</span><span class="p">.</span><span class="n">14159</span>
 <span class="n">test</span> <span class="n">cerr</span> <span class="n">512</span>
 <span class="p">)</span> <span class="k">end</span> <span class="n">test</span> <span class="n">io</span> <span class="p">..</span>
<span class="n">times</span><span class="err">:</span> <span class="n">compile</span> <span class="n">0</span><span class="p">.</span><span class="n">012854s</span><span class="p">,</span> <span class="n">execution</span> <span class="n">0</span><span class="p">.</span><span class="n">000313s</span><span class="p">,</span>  <span class="n">mpirank</span><span class="err">:</span><span class="n">0</span>
 <span class="n">CodeAlloc</span> <span class="err">:</span> <span class="n">nb</span> <span class="n">ptr</span>  <span class="n">2715</span><span class="p">,</span>  <span class="n">size</span> <span class="err">:</span><span class="n">371104</span> <span class="n">mpirank</span><span class="err">:</span> <span class="n">0</span>
<span class="n">Ok</span><span class="err">:</span> <span class="n">Normal</span> <span class="k">End</span>
</pre></div>
</td></tr></table>

<p>Under Windows, launch <strong><code>FreeFem++</code></strong> with the mouse (or ctrl O) on the example.</p>
<h3 id="example-discrete-fast-fourier-transform">Example: Discrete Fast Fourier Transform<a class="headerlink" href="#example-discrete-fast-fourier-transform" title="Permanent link">#</a></h3>
<p>This will add FFT to <strong><code>FreeFem++</code></strong>, taken from <a href="http://www.fftw.org/">FFTW</a>. To download and install under <code>download/include</code> just go in <code>download/fftw</code> and try <code>make</code>.</p>
<p>The 1D dfft (fast discret fourier transform) for a simple array <span><span class="MathJax_Preview">f</span><script type="math/tex">f</script></span> of size <span><span class="MathJax_Preview">n</span><script type="math/tex">n</script></span> is defined by the following formula
<script type="math/tex; mode=display">
\mathtt{dfft}(f,\varepsilon)_{k} = \sum_{j=0}^{n-1} f_i e^{\varepsilon 2\pi i kj/n}
</script>
</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The value <span><span class="MathJax_Preview">n</span><script type="math/tex">n</script></span> is given by <span><span class="MathJax_Preview">size(f)/m</span><script type="math/tex">size(f)/m</script></span>, and the numbering is row-major order.</p>
</div>
<p>So the classical discrete DFFT is <span><span class="MathJax_Preview">\hat{f}=\mathtt{dfft}(f,-1)/\sqrt{n}</span><script type="math/tex">\hat{f}=\mathtt{dfft}(f,-1)/\sqrt{n}</script></span> and the reverse dFFT <span><span class="MathJax_Preview">f=\mathtt{dfft}(\hat{f},1)/\sqrt{n}</span><script type="math/tex">f=\mathtt{dfft}(\hat{f},1)/\sqrt{n}</script></span></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The 2D Laplace operator is
<script type="math/tex; mode=display">
f(x,y) = 1/\sqrt{N} \sum_{j'=0}^{m-1} \sum_{j=0}^{n-1} \hat{f}_{i+nj} e^{\varepsilon 2\pi i (x j+ yj') }
</script>
and we have
<script type="math/tex; mode=display">
f_{k+nl} = f(k/n,l/m)
</script>
So
<script type="math/tex; mode=display">
\widehat{\Delta f_{kl}} = -( (2\pi)^2 ( (\tilde{k})^2+(\tilde{l})^2)) \widehat{ f_{kl}} \\
</script>
where <span><span class="MathJax_Preview">\tilde{k} = k</span><script type="math/tex">\tilde{k} = k</script></span> if <span><span class="MathJax_Preview">k \leq n/2</span><script type="math/tex">k \leq n/2</script></span> else <span><span class="MathJax_Preview">\tilde{k} = k-n</span><script type="math/tex">\tilde{k} = k-n</script></span> and <span><span class="MathJax_Preview">\tilde{l} = l</span><script type="math/tex">\tilde{l} = l</script></span> if <span><span class="MathJax_Preview">l \leq m/2</span><script type="math/tex">l \leq m/2</script></span> else <span><span class="MathJax_Preview">\tilde{l} = l-m</span><script type="math/tex">\tilde{l} = l-m</script></span>.</p>
<p>And to have a real function we need all modes to be symmetric around zero, so <span><span class="MathJax_Preview">n</span><script type="math/tex">n</script></span> and <span><span class="MathJax_Preview">m</span><script type="math/tex">m</script></span> must be odd.</p>
</div>
<p><strong>Compile to build a new library</strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>ff-c++ dfft.cpp ../download/install/lib/libfftw3.a -I../download/install/include
<span class="nb">export</span> <span class="nv">MACOSX_DEPLOYMENT_TARGET</span><span class="o">=</span><span class="m">10</span>.3
g++ -c -Iinclude -I../download/install/include dfft.cpp
g++ -bundle -undefined dynamic_lookup dfft.o -o ./dfft.dylib ../download/install/lib/libfftw3.a
</pre></div>
</td></tr></table>

<p>To test, try <a href="/examples/#fft">FFT example</a>.</p>
<h3 id="load-module-for-dervieux-p0-p1-finite-volume-method">Load Module for Dervieux' P0-P1 Finite Volume Method<a class="headerlink" href="#load-module-for-dervieux-p0-p1-finite-volume-method" title="Permanent link">#</a></h3>
<p>The associed edp file is <a href="https://github.com/FreeFem/FreeFem-sources/blob/master/examples%2B%2B-load/convect_dervieux.edp"><code>examples++-load/convect_dervieux.edp</code></a>.</p>
<p>See <a href="https://github.com/FreeFem/FreeFem-sources/blob/master/examples%2B%2B-load/mat_dervieux.cpp"><code>mat_dervieux.cpp</code></a>.</p>
<h3 id="more-on-adding-a-new-finite-element">More on Adding a new finite element<a class="headerlink" href="#more-on-adding-a-new-finite-element" title="Permanent link">#</a></h3>
<p>First read the <a href="#adding-a-new-finite-element">Adding a new finite element section</a>, we add two new finite elements examples in the directory <a href="https://github.com/FreeFem/FreeFem-sources/tree/master/examples%2B%2B-load"><code>examples++-load</code></a>.</p>
<h4 id="the-bernardi-raugel-element">The Bernardi-Raugel Element<a class="headerlink" href="#the-bernardi-raugel-element" title="Permanent link">#</a></h4>
<p>The Bernardi-Raugel finite element is meant to solve the Navier Stokes equations in <span><span class="MathJax_Preview">u,p</span><script type="math/tex">u,p</script></span> formulation; the velocity space <span><span class="MathJax_Preview">P^{br}_K</span><script type="math/tex">P^{br}_K</script></span> is minimal to prove the inf-sup condition with piecewise constant pressure by triangle.</p>
<p>The finite element space <span><span class="MathJax_Preview">V_h</span><script type="math/tex">V_h</script></span> is
<script type="math/tex; mode=display">
V_h= \{u\in H^1(\Omega)^2 ; \quad \forall K \in T_h, u_{|K} \in P^{br}_K \}
</script>
where
<script type="math/tex; mode=display">
P^{br}_K = span \{ \lambda^K_i e_k \}_{i=1,2,3, k= 1,2} \cup \{ \lambda^K_i\lambda^K_{i+1} n^K_{i+2}\}_{i=1,2,3}
</script>
with notation <span><span class="MathJax_Preview">4=1, 5=2</span><script type="math/tex">4=1, 5=2</script></span> and where <span><span class="MathJax_Preview">\lambda^K_i</span><script type="math/tex">\lambda^K_i</script></span> are the barycentric coordinates of the triangle <span><span class="MathJax_Preview">K</span><script type="math/tex">K</script></span>, <span><span class="MathJax_Preview">(e_k)_{k=1,2}</span><script type="math/tex">(e_k)_{k=1,2}</script></span> the canonical basis of <span><span class="MathJax_Preview">\R^2</span><script type="math/tex">\R^2</script></span> and <span><span class="MathJax_Preview">n^K_k</span><script type="math/tex">n^K_k</script></span> the outer normal of triangle <span><span class="MathJax_Preview">K</span><script type="math/tex">K</script></span> opposite to vertex <span><span class="MathJax_Preview">k</span><script type="math/tex">k</script></span>.</p>
<!--- __ --->

<p>See <a href="https://github.com/FreeFem/FreeFem-sources/blob/master/examples%2B%2B-load/BernardiRaugel.cpp"><code>BernardiRaugel.cpp</code></a>.</p>
<p>A way to check the finite element</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">load</span> <span class="s">&quot;BernardiRaugel&quot;</span>

<span class="c1">// Macro</span>
<span class="c1">//a macro the compute numerical derivative</span>
<span class="kt">macro</span> <span class="n">DD</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">hx</span><span class="p">,</span> <span class="n">hy</span><span class="p">)</span> <span class="p">(</span> <span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">x1</span><span class="o">+</span><span class="n">hx</span><span class="p">,</span> <span class="nf">y1</span><span class="o">+</span><span class="n">hy</span><span class="p">)</span> <span class="o">-</span> <span class="n">f</span><span class="p">(</span><span class="n">x1</span><span class="o">-</span><span class="n">hx</span><span class="p">,</span> <span class="nf">y1</span><span class="o">-</span><span class="n">hy</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">hx</span><span class="o">+</span><span class="n">hy</span><span class="p">))</span> <span class="p">)</span> <span class="c1">//</span>

<span class="c1">// Mesh</span>
<span class="kt">mesh</span> <span class="n">Th</span> <span class="o">=</span> <span class="nf">square</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">10</span><span class="o">*</span><span class="p">(</span><span class="kr">x</span><span class="o">+</span><span class="kr">y</span><span class="o">/</span><span class="mi">3</span><span class="p">),</span> <span class="mi">10</span><span class="o">*</span><span class="p">(</span><span class="kr">y</span><span class="o">-</span><span class="kr">x</span><span class="o">/</span><span class="mi">3</span><span class="p">)]);</span>

<span class="c1">// Parameters</span>
<span class="kt">real</span> <span class="n">x1</span> <span class="o">=</span> <span class="mf">0.7</span><span class="p">,</span> <span class="nf">y1</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="mf">1e-7</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">it1</span> <span class="o">=</span> <span class="n">Th</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="nf">y1</span><span class="p">).</span><span class="kr">nuTriangle</span><span class="p">;</span>

<span class="c1">// Fespace</span>
<span class="kt">fespace</span> <span class="nf">Vh</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="nc">P2BR</span><span class="p">);</span>
<span class="n">Vh</span> <span class="p">[</span><span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">],</span> <span class="p">[</span><span class="n">b1</span><span class="p">,</span> <span class="n">b2</span><span class="p">],</span> <span class="p">[</span><span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">];</span>


<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">Vh</span><span class="p">.</span><span class="kr">ndofK</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
    <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="n">i</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">Vh</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">i</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>

<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">Vh</span><span class="p">.</span><span class="kr">ndofK</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">a1</span><span class="p">[]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="n">Vh</span><span class="p">(</span><span class="n">it1</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
    <span class="n">a1</span><span class="p">[][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="nf">plot</span><span class="p">([</span><span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">],</span> <span class="kp">wait</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">[</span><span class="n">b1</span><span class="p">,</span> <span class="n">b2</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">];</span> <span class="c1">//do the interpolation</span>

    <span class="n">c1</span><span class="p">[]</span> <span class="o">=</span> <span class="n">a1</span><span class="p">[]</span> <span class="o">-</span> <span class="n">b1</span><span class="p">[];</span>
    <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; ---------&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">i</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">c1</span><span class="p">[].</span><span class="kr">max</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">c1</span><span class="p">[].</span><span class="kr">min</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
    <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; a = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">a1</span><span class="p">[]</span> <span class="o">&lt;&lt;</span><span class="kr">endl</span><span class="p">;</span>
    <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; b = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">b1</span><span class="p">[]</span> <span class="o">&lt;&lt;</span><span class="kr">endl</span><span class="p">;</span>
    <span class="nf">assert</span><span class="p">(</span><span class="n">c1</span><span class="p">[].</span><span class="kr">max</span> <span class="o">&lt;</span> <span class="mf">1e-9</span> <span class="o">&amp;&amp;</span> <span class="n">c1</span><span class="p">[].</span><span class="kr">min</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mf">1e-9</span><span class="p">);</span> <span class="c1">//check if the interpolation is correct</span>

    <span class="c1">// check the derivative and numerical derivative</span>
    <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; dx(a1)(x1, y1) = &quot;</span> <span class="o">&lt;&lt;</span> <span class="nf">dx</span><span class="p">(</span><span class="n">a1</span><span class="p">)(</span><span class="n">x1</span><span class="p">,</span> <span class="nf">y1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; == &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">DD</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
    <span class="nf">assert</span><span class="p">(</span> <span class="nf">abs</span><span class="p">(</span><span class="nf">dx</span><span class="p">(</span><span class="n">a1</span><span class="p">)(</span><span class="n">x1</span><span class="p">,</span> <span class="nf">y1</span><span class="p">)</span> <span class="o">-</span> <span class="n">DD</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-5</span><span class="p">);</span>
    <span class="nf">assert</span><span class="p">(</span> <span class="nf">abs</span><span class="p">(</span><span class="nf">dx</span><span class="p">(</span><span class="n">a2</span><span class="p">)(</span><span class="n">x1</span><span class="p">,</span> <span class="nf">y1</span><span class="p">)</span> <span class="o">-</span> <span class="n">DD</span><span class="p">(</span><span class="n">a2</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-5</span><span class="p">);</span>
    <span class="nf">assert</span><span class="p">(</span> <span class="nf">abs</span><span class="p">(</span><span class="nf">dy</span><span class="p">(</span><span class="n">a1</span><span class="p">)(</span><span class="n">x1</span><span class="p">,</span> <span class="nf">y1</span><span class="p">)</span> <span class="o">-</span> <span class="n">DD</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span> <span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-5</span><span class="p">);</span>
    <span class="nf">assert</span><span class="p">(</span> <span class="nf">abs</span><span class="p">(</span><span class="nf">dy</span><span class="p">(</span><span class="n">a2</span><span class="p">)(</span><span class="n">x1</span><span class="p">,</span> <span class="nf">y1</span><span class="p">)</span> <span class="o">-</span> <span class="n">DD</span><span class="p">(</span><span class="n">a2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span> <span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-5</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>A real example using this finite element, just a small modification of the Navier-Stokes P2-P1 example, just the begenning is change to</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">load</span> <span class="s">&quot;BernardiRaugel&quot;</span>

<span class="kt">real</span> <span class="n">s0</span> <span class="o">=</span> <span class="nf">clock</span><span class="p">();</span>
<span class="kt">mesh</span> <span class="n">Th</span> <span class="o">=</span> <span class="nf">square</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
<span class="kt">fespace</span> <span class="nf">Vh2</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="nc">P2BR</span><span class="p">);</span>
<span class="kt">fespace</span> <span class="nf">Vh</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="nc">P0</span><span class="p">);</span>
<span class="n">Vh2</span> <span class="p">[</span><span class="n">u1</span><span class="p">,</span> <span class="n">u2</span><span class="p">],</span> <span class="p">[</span><span class="n">up1</span><span class="p">,</span> <span class="n">up2</span><span class="p">];</span>
<span class="n">Vh2</span> <span class="p">[</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">];</span>
</pre></div>
</td></tr></table>

<p>And the plot instruction is also changed because the pressure is constant, and we cannot plot isovalues of peacewise constant functions.</p>
<h4 id="the-morley-element">The Morley Element<a class="headerlink" href="#the-morley-element" title="Permanent link">#</a></h4>
<p>See the example <a href="https://github.com/FreeFem/FreeFem-sources/blob/master/examples%2B%2B-load/bilapMorley.edp"><code>bilapMorley.edp</code></a>.</p>
<!---
### Add a new sparse solver

Warning the sparse solver interface as been completely rewritten in version 3.2, so the section is obsolete, the example in are correct/

Only a fast sketch of the code is given here; for details see the .cpp code from `SuperLU.cpp` or `NewSolve.cpp`.

First the include files:
wzxhzdk:32


A small template driver to unified the `:::cpp double` and `:::cpp complex` version.

wzxhzdk:33

To get Matrix value, we have just to remark that the Morse Matrice the storage, is the `SLU_NR` format is the compressed row storage, this is the transpose of the compressed column storage.

So if `AA` is a MatriceMorse you have with SuperLU notation.
wzxhzdk:34

To get vector infomation, to solver the linear solver $x = A^{-1} b$

wzxhzdk:35

The two `BuildSolverSuperLU` functions, to change the default sparse solver variable

`:::cpp DefSparseSolver<@double>::solver`

wzxhzdk:36

The link to __`FreeFem++`__

wzxhzdk:37

To set the 2 default sparse solver double and complex:

wzxhzdk:38

To reset to the default solver, call this function:

wzxhzdk:39

To set the default solver to superLU, call this function:

wzxhzdk:40

To add new function/name `:::freefem defaultsolver,defaulttoSuperLU` in __`FreeFem++`__, and set the default solver to the new solver, just do:

wzxhzdk:41

To compile `superlu.cpp`, just do:

 * download the SuperLu 3.0 package and do

    `curl http://crd.lbl.gov/~xiaoye/SuperLU/superlu_3.0.tar.gz -o superlu_3.0.tar.gz`

    `tar xvfz superlu_3.0.tar.gz`

go SuperLU_3.0 directory
wzxhzdk:42

 * In directoy include do to have a correct version of `SuperLu` header due to mistake in case of inclusion of `:::cpp double` and `:::cpp complex` version in the same file.
    wzxhzdk:43
    I will give a correct one to compile with freefm++.

To compile the __`FreeFem++`__ load file of SuperLu with freefem do:
some find like :
wzxhzdk:44

And to test the simple example:

A example:

wzxhzdk:45

To Test do for exemple:
wzxhzdk:46
--->

<h2 id="references">References<a class="headerlink" href="#references" title="Permanent link">#</a></h2>
<p><a name="HECHT2002">[HECHT2002]</a> HECHT, Frédéric. C++ Tools to construct our user-level language. ESAIM: Mathematical Modelling and Numerical Analysis, 2002, vol. 36, no 5, p. 809-836.</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../Plugins/" title="Plugins" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Plugins
              </span>
            </div>
          </a>
        
        
          <a href="../TODO/" title="TODO" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                TODO
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../assets/fonts/font-awesome.css">
    
      <a href="https://github.com/FreeFem/FreeFem-doc" class="md-footer-social__link fa fa-github"></a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.b806dc00.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_CHTML"></script>
      
        <script src="../../mathjax-config.js"></script>
      
    
  </body>
</html>