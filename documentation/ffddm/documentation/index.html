



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../../images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-3.1.0">
    
    
      
        <title>Documentation - FreeFem++</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/application.11e41852.css">
      
      
    
    
      <script src="../../../assets/javascripts/modernizr.20ef595d.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../../stylesheets/extra.css">
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#minimal-example" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../../.." title="FreeFem++" class="md-header-nav__button md-logo">
          
            <img src="../../../images/favicon.png" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                FreeFem++
              </span>
              <span class="md-header-nav__topic">
                Documentation
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/FreeFem/FreeFem-doc/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      FreeFem++ on Github
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

<nav class="md-tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../.." title="Introduction" class="md-tabs__link">
          Introduction
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../" title="Documentation" class="md-tabs__link">
          Documentation
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../reference/" title="Language References" class="md-tabs__link">
          Language References
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../tutorials/" title="Tutorials" class="md-tabs__link">
          Tutorials
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../examples/" title="Examples" class="md-tabs__link">
          Examples
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../models/" title="Models" class="md-tabs__link">
          Models
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../../.." title="FreeFem++" class="md-nav__button md-logo">
      
        <img src="../../../images/favicon.png" width="48" height="48">
      
    </a>
    FreeFem++
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/FreeFem/FreeFem-doc/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      FreeFem++ on Github
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1">
    
    <label class="md-nav__link" for="nav-1">
      Introduction
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        Introduction
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../.." title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../introduction/download/" title="Download" class="md-nav__link">
      Download
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../introduction/installation/" title="Installation" class="md-nav__link">
      Installation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../introduction/contributing/" title="How to contribute?" class="md-nav__link">
      How to contribute?
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../introduction/citation/" title="Citation" class="md-nav__link">
      Citation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../introduction/authors/" title="Authors" class="md-nav__link">
      Authors
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../introduction/TODO/" title="TODO" class="md-nav__link">
      TODO
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Documentation
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Documentation
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../" title="Home" class="md-nav__link">
      Home
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Notations/" title="Some Notations" class="md-nav__link">
      Some Notations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../MeshGeneration/" title="Mesh Generation" class="md-nav__link">
      Mesh Generation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../FiniteElement/" title="Finite Element" class="md-nav__link">
      Finite Element
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Visualization/" title="Visualization" class="md-nav__link">
      Visualization
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../AlgorithmsOptimization/" title="Algorithms & Optimization" class="md-nav__link">
      Algorithms & Optimization
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Parallelization/" title="Parallelization" class="md-nav__link">
      Parallelization
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Plugins/" title="Plugins" class="md-nav__link">
      Plugins
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Developers/" title="Developers" class="md-nav__link">
      Developers
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../TODO/" title="TODO" class="md-nav__link">
      TODO
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Language References
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Language References
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../reference/" title="Home" class="md-nav__link">
      Home
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../reference/Types/" title="Types" class="md-nav__link">
      Types
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../reference/GlobalVariables/" title="Global variables" class="md-nav__link">
      Global variables
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../reference/QuadratureFormulae/" title="Quadrature formulae" class="md-nav__link">
      Quadrature formulae
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../reference/Operators/" title="Operators" class="md-nav__link">
      Operators
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../reference/Loops/" title="Loops" class="md-nav__link">
      Loops
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../reference/IO/" title="I/O" class="md-nav__link">
      I/O
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../reference/Functions/" title="Functions" class="md-nav__link">
      Functions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../reference/ExternalLibraries/" title="External libraries" class="md-nav__link">
      External libraries
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../reference/TODO/" title="TODO" class="md-nav__link">
      TODO
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Tutorials
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Tutorials
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../tutorials/" title="Getting started" class="md-nav__link">
      Getting started
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../tutorials/Poisson/" title="Poisson's equation" class="md-nav__link">
      Poisson's equation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../tutorials/EquationsClassification/" title="Classification of the equations" class="md-nav__link">
      Classification of the equations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../tutorials/Membrane/" title="Membrane" class="md-nav__link">
      Membrane
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../tutorials/HeatExchanger/" title="Heat Exchanger" class="md-nav__link">
      Heat Exchanger
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../tutorials/Acoustics/" title="Acoustics" class="md-nav__link">
      Acoustics
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../tutorials/ThermalConduction/" title="Thermal Conduction" class="md-nav__link">
      Thermal Conduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../tutorials/FanBlade/" title="Irrotational Fan Blade Flow and Thermal effects" class="md-nav__link">
      Irrotational Fan Blade Flow and Thermal effects
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../tutorials/RotatingHill/" title="Pure convection, The rotating hill" class="md-nav__link">
      Pure convection, The rotating hill
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../tutorials/Elasticity/" title="The system of elasticity" class="md-nav__link">
      The system of elasticity
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../tutorials/Stokes/" title="The system of Stokes for fluids" class="md-nav__link">
      The system of Stokes for fluids
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../tutorials/NavierStokesProjection/" title="A projection Algorithm for the Navier-Stokes equations" class="md-nav__link">
      A projection Algorithm for the Navier-Stokes equations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../tutorials/NavierStokesNewton/" title="Newton method for the steady Navier-Stokes equations" class="md-nav__link">
      Newton method for the steady Navier-Stokes equations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../tutorials/ALargeFluidProblem/" title="A large fluid problem" class="md-nav__link">
      A large fluid problem
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../tutorials/ComplexNumbers/" title="An example with complex numbers" class="md-nav__link">
      An example with complex numbers
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../tutorials/OptimalControl/" title="Optimal control" class="md-nav__link">
      Optimal control
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../tutorials/FlowWithShocks/" title="A flow with shocks" class="md-nav__link">
      A flow with shocks
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../tutorials/HeatEquationOptimization/" title="Time dependent schema optimization for heat equations" class="md-nav__link">
      Time dependent schema optimization for heat equations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../tutorials/TimeDependentStokes/" title="A transient Stokes solver in matrix form" class="md-nav__link">
      A transient Stokes solver in matrix form
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../tutorials/WifiPropagation/" title="Wifi Propagation" class="md-nav__link">
      Wifi Propagation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../tutorials/MatlabOctavePlot/" title="Matlab / Octave Plots" class="md-nav__link">
      Matlab / Octave Plots
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../tutorials/TODO/" title="TODO" class="md-nav__link">
      TODO
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Examples
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Examples
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../examples/" title="Home" class="md-nav__link">
      Home
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../examples/TODO/" title="TODO" class="md-nav__link">
      TODO
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Models
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Models
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../models/" title="Home" class="md-nav__link">
      Home
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../models/StaticProblems/" title="Static problems" class="md-nav__link">
      Static problems
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../models/Elasticity/" title="Elasticity" class="md-nav__link">
      Elasticity
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../models/NonLinearStaticProblems/" title="Non-linear static problems" class="md-nav__link">
      Non-linear static problems
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../models/EigenValueProblems/" title="Eigenvalue problems" class="md-nav__link">
      Eigenvalue problems
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../models/EvolutionProblems/" title="Evolution problems" class="md-nav__link">
      Evolution problems
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../models/NavierStokesEquations/" title="Navier-Stokes equations" class="md-nav__link">
      Navier-Stokes equations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../models/VariationalInequality/" title="Variational inequality" class="md-nav__link">
      Variational inequality
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../models/DomainDecomposition/" title="Domain decomposition" class="md-nav__link">
      Domain decomposition
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../models/FluidStructureCoupledProblem/" title="Fluid-Structure coupled problem" class="md-nav__link">
      Fluid-Structure coupled problem
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../models/TransmissionProblem/" title="Transmission problem" class="md-nav__link">
      Transmission problem
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../models/FreeBoundaryProblem/" title="Free boundary problem" class="md-nav__link">
      Free boundary problem
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../models/NonLinearElasticity/" title="Non-linear elasticity" class="md-nav__link">
      Non-linear elasticity
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../models/CompressibleNeoHookeanMaterials/" title="Compressible Neo-Hookean materials" class="md-nav__link">
      Compressible Neo-Hookean materials
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../models/WhisperingGalleryModes/" title="Whispering gallery modes" class="md-nav__link">
      Whispering gallery modes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../models/TODO/" title="TODO" class="md-nav__link">
      TODO
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#minimal-example" title="Minimal example" class="md-nav__link">
    Minimal example
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#overlapping-mesh-decomposition" title="Overlapping mesh decomposition" class="md-nav__link">
    Overlapping mesh decomposition
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#local-finite-element-spaces" title="Local finite element spaces" class="md-nav__link">
    Local finite element spaces
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#define-the-problem-to-solve" title="Define the problem to solve" class="md-nav__link">
    Define the problem to solve
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#one-level-preconditioners" title="One level preconditioners" class="md-nav__link">
    One level preconditioners
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#two-level-preconditioners" title="Two level preconditioners" class="md-nav__link">
    Two level preconditioners
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#building-the-geneo-coarse-space" title="Building the GenEO coarse space" class="md-nav__link">
    Building the GenEO coarse space
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#building-the-coarse-space-from-a-coarse-mesh" title="Building the coarse space from a coarse mesh" class="md-nav__link">
    Building the coarse space from a coarse mesh
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#solving-the-linear-system" title="Solving the linear system" class="md-nav__link">
    Solving the linear system
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/FreeFem/FreeFem-doc/edit/master/docs/documentation/ffddm/documentation.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                  <h1>Documentation</h1>
                
                <h2 id="minimal-example">Minimal example<a class="headerlink" href="#minimal-example" title="Permanent link">#</a></h2>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">macro</span> <span class="n">dimension</span> <span class="mi">3</span><span class="c1">// EOM            // 2D or 3D</span>

<span class="cp">include</span> <span class="s">&quot;ffddm.idp&quot;</span>

<span class="kt">int</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">LL</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">];</span>
<span class="kt">mesh3</span> <span class="n">ThGlobal</span> <span class="o">=</span> <span class="nf">cube</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="p">[</span><span class="kr">x</span><span class="p">,</span> <span class="kr">y</span><span class="p">,</span> <span class="kr">z</span><span class="p">],</span> <span class="kr">label</span> <span class="o">=</span> <span class="n">LL</span><span class="p">);</span>      <span class="c1">// global mesh</span>

<span class="kt">macro</span> <span class="n">grad</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="p">[</span><span class="nf">dx</span><span class="p">(</span><span class="n">u</span><span class="p">),</span> <span class="nf">dy</span><span class="p">(</span><span class="n">u</span><span class="p">),</span> <span class="nf">dz</span><span class="p">(</span><span class="n">u</span><span class="p">)]</span><span class="c1">// EOM    // three-dimensional gradient</span>

<span class="kt">macro</span> <span class="n">Varf</span><span class="p">(</span><span class="n">varfName</span><span class="p">,</span> <span class="n">meshName</span><span class="p">,</span> <span class="n">VhName</span><span class="p">)</span>
    <span class="kt">varf</span> <span class="n">varfName</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">)</span> <span class="o">=</span> <span class="nf">int3d</span><span class="p">(</span><span class="n">meshName</span><span class="p">)(</span><span class="n">grad</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">&#39;&#39;*</span> <span class="n">grad</span><span class="p">(</span><span class="n">v</span><span class="p">))</span> <span class="o">+</span> <span class="nf">int3d</span><span class="p">(</span><span class="n">meshName</span><span class="p">)(</span><span class="n">v</span><span class="p">)</span> <span class="o">+</span> <span class="nf">on</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">u</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">);</span>
<span class="c1">// EOM</span>

<span class="c1">// Domain decomposition</span>
<span class="n">ffddmbuildDmesh</span><span class="p">(</span> <span class="n">Lap</span> <span class="p">,</span> <span class="n">ThGlobal</span> <span class="p">,</span> <span class="kr">mpiCommWorld</span> <span class="p">)</span>

<span class="kt">macro</span> <span class="n">def</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="n">i</span><span class="c1">// EOM                         // scalar field definition</span>
<span class="kt">macro</span> <span class="kp">init</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="n">i</span><span class="c1">// EOM                        // scalar field initialization</span>
<span class="n">ffddmbuildDfespace</span><span class="p">(</span> <span class="n">Lap</span> <span class="p">,</span> <span class="n">Lap</span> <span class="p">,</span> <span class="kt">real</span> <span class="p">,</span> <span class="n">def</span> <span class="p">,</span> <span class="kp">init</span> <span class="p">,</span> <span class="nc">P1</span> <span class="p">)</span>

<span class="n">ffddmsetupOperator</span><span class="p">(</span> <span class="n">Lap</span> <span class="p">,</span><span class="n">Lap</span> <span class="p">,</span> <span class="n">Varf</span> <span class="p">)</span>

<span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">rhsi</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="n">ffddmbuildrhs</span><span class="p">(</span> <span class="n">Lap</span> <span class="p">,</span> <span class="n">Varf</span> <span class="p">,</span> <span class="n">rhsi</span> <span class="p">)</span>

<span class="n">LapVhi</span> <span class="n">def</span><span class="p">(</span><span class="n">ui</span><span class="p">);</span>

<span class="c1">//Direct solve</span>
<span class="n">ui</span><span class="p">[]</span> <span class="o">=</span> <span class="n">Lapdirectsolve</span><span class="p">(</span><span class="n">rhsi</span><span class="p">);</span>

<span class="n">Lapwritesummary</span>

<span class="nf">ffddmplot</span><span class="p">(</span><span class="n">Lap</span><span class="p">,</span><span class="n">ui</span><span class="p">,</span><span class="s">&quot;u&quot;</span><span class="p">);</span>
</pre></div>
</td></tr></table>

<h2 id="overlapping-mesh-decomposition">Overlapping mesh decomposition<a class="headerlink" href="#overlapping-mesh-decomposition" title="Permanent link">#</a></h2>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">ffddmbuildDmesh</span><span class="p">(</span><span class="n">pr</span><span class="p">,</span><span class="n">Th</span><span class="p">,</span><span class="n">comm</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<p>decomposes the mesh <strong>Th</strong> into overlapping submeshes. The mesh will be distributed over the mpi ranks of communicator <strong>comm</strong>. This will create and expose variables whose names will be prefixed by <strong>pr</strong>, see below (# is the concatenation operator).
The way the initial mesh <strong>Th</strong> is partitioned depends on the value of <a href="../parameters/#global-parameters">ffddmpartitioner</a>.<br />
The size of the overlap between subdomains (its width in terms of number of mesh elements) is given by <a href="../parameters/#global-parameters">ffddmoverlap</a>.<br />
The level of refinement of the resulting submeshes with respect to the input mesh <strong>Th</strong> is given by <a href="../parameters/#global-parameters">ffddmsplit</a>.<br />
If <a href="../parameters/#global-parameters">ffddmexclude</a> <span><span class="MathJax_Preview">\neq 0</span><script type="math/tex">\neq 0</script></span>, the first <a href="../parameters/#global-parameters">ffddmpCS</a> mpi ranks of <strong>comm</strong> will be excluded from the spatial domain decomposition, in order to dedicate them later to the coarse problem (for two-level preconditioners).<br />
The label of the new border of the submeshes (the interface between the subdomains) is given by <a href="../parameters/#global-parameters">ffddminterfacelabel</a>.</p>
<p><strong><em>defines</em></strong>:</p>
<ul>
<li><code>int pr#npart</code> number of subdomains for this decomposition; should be equal to mpiSize(<strong>comm</strong>) - <a href="../parameters/#global-parameters">ffddmexclude</a> * <a href="../parameters/#global-parameters">ffddmpCS</a></li>
<li><code>meshN[int] pr#aTh</code> array (size <code>pr#npart</code>) of local meshes of the subdomains. In the standard parallel case, only the local mesh for this mpi rank <code>pr#aTh[mpiRank(pr#commddm)]</code> is defined (unless this mpi rank is excluded from the spatial domain decomposition, i. e. <code>prmesh#excluded</code> = 1, see below). In the sequential case, all local meshes are defined.</li>
<li><code>meshN pr#Thi</code> the local mesh of the subdomain for this mpi rank, i. e. <code>pr#aTh[mpiRank(pr#commddm)]</code> in the parallel case</li>
<li><code>int pr#numberIntersection</code> the number of neighbors for this mpi rank</li>
<li><code>int[int] pr#arrayIntersection</code> the list of neighbor ranks in <code>pr#commddm</code> for this mpi rank</li>
<li><code>int pr#pCS</code> equal to <a href="../parameters/#global-parameters">ffddmpCS</a></li>
<li><code>int pr#exclude</code> equal to <a href="../parameters/#global-parameters">ffddmexclude</a></li>
<li><code>int pr#excluded</code> <em>true</em> if <a href="../parameters/#global-parameters">ffddmexclude</a> is <em>true</em> (<span><span class="MathJax_Preview">\neq 0</span><script type="math/tex">\neq 0</script></span>) and mpiRank(<strong>comm</strong>) &lt; <code>pr#pCS</code>. In this case, this mpi rank will be excluded from the spatial domain decomposition and will only work on the coarse problem.</li>
<li><code>mpiComm pr#commddm</code> mpi communicator for ranks participating in the spatial domain decomposition (ranks 0 to <code>pr#npart</code>-1 in <strong>comm</strong> if <code>pr#exclude</code> is <em>false</em>, ranks <code>pr#pCS</code> to <code>pr#pCS</code>+<code>pr#npart</code>-1 otherwise)</li>
<li><code>mpiComm pr#commCS</code> mpi communicator for ranks participating in the assembly and resolution of the coarse problem for two-level preconditioners (ranks 0 to <code>pr#pCS</code> - 1 in <strong>comm</strong>)</li>
<li><code>mpiComm pr#commself</code> self mpi communicator (this mpi rank only), used for factorizing local matrices</li>
</ul>
<p><strong><em>For advanced users</em></strong>:</p>
<ul>
<li><code>int pr#binexactCS</code> </li>
<li><code>int pr#inexactCSsplit</code></li>
<li><code>int pr#isincomm</code></li>
<li><code>meshN[int] pr#aThborder</code></li>
</ul>
<p><strong><em>Remark for sequential use</em></strong> (see <a href="../parameters/#command-line-arguments"><code>-seqddm</code></a>):
- <code>meshN[int] pr#aTh</code> array (size <code>pr#npart</code>) of local meshes of the subdomains</p>
<p>!int pr#binexactgeneoCS</p>
<p>!fespace pr#VhiP1(pr#Thi,P1);</p>
<p>!pr#VhiP1[int] pr#partitionIntersectionbasei(0);</p>
<p>!meshN pr#Thglob = minimalMesh;</p>
<p>!matrix[int] pr#RihP1(pr#npart);
!pr#VhiP1[int] pr#DP1(pr#npart);</p>
<p>!NewMacro pr#mpicomm()comm EndMacro</p>
<p><strong><em>depends on</em></strong>:
- <a href="../parameters/#global-parameters">ffddmpartitioner</a>
- <a href="../parameters/#global-parameters">ffddmpCS</a>
- <a href="../parameters/#global-parameters">ffddmexclude</a>
- <a href="../parameters/#global-parameters">ffddmoverlap</a>
- <a href="../parameters/#global-parameters">ffddmsplit</a>
- <a href="../parameters/#global-parameters">ffddminterfacelabel</a></p>
<p><strong><em>see also</em></strong>:</p>
<h2 id="local-finite-element-spaces">Local finite element spaces<a class="headerlink" href="#local-finite-element-spaces" title="Permanent link">#</a></h2>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">ffddmbuildDfespace</span><span class="p">(</span><span class="n">pr</span><span class="p">,</span><span class="n">prmesh</span><span class="p">,</span><span class="n">scalar</span><span class="p">,</span><span class="n">def</span><span class="p">,</span><span class="kp">init</span><span class="p">,</span><span class="n">Pk</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<p>builds the local finite element spaces and associated distributed operators on top of the mesh decomposition <strong>prmesh</strong>. This will create and expose variables whose names will be prefixed by <strong>pr</strong>, see below. It is assumed that <strong><a href="#overlapping-mesh-decomposition"><code>ffddmbuildDmesh</code></a></strong> has already been called with prefix <strong>prmesh</strong> in order to build the mesh decomposition.<br />
The local finite element spaces of type <strong>Pk</strong> (where <strong>Pk</strong> is the type of finite element: P1, [P2,P2,P1], ...) are defined on the local meshes of the subdomains based on the mesh decomposition previously created with prefix <strong>prmesh</strong>.<br />
<strong>scalar</strong> determines the type of data for this finite element: <em>real</em> or <em>complex</em>.<br />
Two macros, <strong>def</strong> and <strong>init</strong>, are needed: <strong>def</strong> specifies how to define a finite element function in the finite element space <strong>Pk</strong>, and <strong>init</strong> specifies how to interpolate a scalar function onto the (possibly multiple) components of <strong>Pk</strong>. Two examples are given below:  </p>
<p>For scalar P2 finite elements and complex-valued problems:
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">macro</span> <span class="n">def</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="n">u</span><span class="c1">// EOM</span>
<span class="kt">macro</span> <span class="kp">init</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="n">u</span><span class="c1">// EOM</span>
<span class="n">ffddmbuildDfespace</span><span class="p">(</span><span class="n">myFEprefix</span><span class="p">,</span><span class="n">mymeshprefix</span><span class="p">,</span><span class="kt">complex</span><span class="p">,</span><span class="n">def</span><span class="p">,</span><span class="kp">init</span><span class="p">,</span><span class="nc">P2</span><span class="p">)</span>
</pre></div>
</td></tr></table></p>
<p>For vectorial [P2,P2,P1] finite elements and real-valued problems:
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">macro</span> <span class="n">def</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="p">[</span><span class="n">u</span><span class="p">,</span> <span class="n">u</span><span class="err">#</span><span class="kp">B</span><span class="p">,</span> <span class="n">u</span><span class="err">#</span><span class="n">C</span><span class="p">]</span><span class="c1">// EOM</span>
<span class="kt">macro</span> <span class="kp">init</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="p">[</span><span class="n">u</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">u</span><span class="p">]</span><span class="c1">// EOM</span>
<span class="n">ffddmbuildDfespace</span><span class="p">(</span><span class="n">myFEprefix</span><span class="p">,</span><span class="n">mymeshprefix</span><span class="p">,</span><span class="kt">real</span><span class="p">,</span><span class="n">def</span><span class="p">,</span><span class="kp">init</span><span class="p">,[</span><span class="nc">P2</span><span class="p">,</span><span class="nc">P2</span><span class="p">,</span><span class="nc">P1</span><span class="p">])</span>
</pre></div>
</td></tr></table></p>
<p>In practice, this builds the necessary distributed operators associated to the finite element space: the local partition of unity functions <span><span class="MathJax_Preview">(D_i)_{i=1,...,N}</span><script type="math/tex">(D_i)_{i=1,...,N}</script></span> (see <code>pr#Dk</code> and <code>pr#Dih</code> below) as well as the function <code>pr#update</code> (see below) which synchronizes local vectors <span><span class="MathJax_Preview">(u_i)_{i=1,...,N}</span><script type="math/tex">(u_i)_{i=1,...,N}</script></span> between neighboring subdomains, performing the equivalent of <span><span class="MathJax_Preview">u_i = R_i (\sum_{j=1}^N R_j^T u_j)</span><script type="math/tex">u_i = R_i (\sum_{j=1}^N R_j^T u_j)</script></span> or <span><span class="MathJax_Preview">u_i = R_i (\sum_{j=1}^N R_j^T D_j u_j)</span><script type="math/tex">u_i = R_i (\sum_{j=1}^N R_j^T D_j u_j)</script></span> in a distributed parallel environment.<br />
<code>pr#scalprod</code> (see below) performs the parallel scalar product for vectors defined on this finite element.</p>
<p><strong><em>defines</em></strong>:</p>
<ul>
<li><code>pr#prmesh</code> macro, saves the parent prefix <strong>prmesh</strong> of the mesh decomposition</li>
<li><code>pr#K</code> macro, saves the type of data <strong>scalar</strong> for this finite element space (<em>real</em> or <em>complex</em>)</li>
<li><code>func pr#fPk</code> saves the type of finite element <strong>Pk</strong>, e.g. <em>P1, [P2,P2,P1], ...</em></li>
<li><code>fespace pr#Vhi</code> the local finite element space for this mpi rank, defined on the local mesh <code>prmesh#Thi</code></li>
<li><code>int pr#Ndofglobal</code> the total number of degrees of freedom <span><span class="MathJax_Preview">n</span><script type="math/tex">n</script></span> for this finite element discretization</li>
<li><code>pr#mdef</code> macro, saves the macro <strong>def</strong> giving the definition of a finite element function in the finite element space <strong>Pk</strong></li>
<li><code>pr#minit</code> macro, saves the macro <strong>init</strong> specifying how to interpolate a scalar function onto the (possibly multiple) components of a finite element function of <strong>Pk</strong>. This is used to create the local partition of unity function in <code>pr#Vhi</code>, by interpolating the local P1 partition of unity function onto the components of <code>pr#Vhi</code>. For non Lagrange finite element spaces (e.g. <em>RT0</em>, <em>Edge03d</em>, ...), see <strong><a href="#local-finite-element-spaces"><code>ffddmbuildDfespaceEdge</code></a></strong>. </li>
<li><code>pr#K[int][int] pr#Dk</code> array (size <code>prmesh#npart</code>) of local partition of unity vectors in the subdomains, equivalent to <span><span class="MathJax_Preview">(D_i)_{i=1,...,N}</span><script type="math/tex">(D_i)_{i=1,...,N}</script></span>. In the standard parallel case, only the local partition of unity vector for this mpi rank <code>pr#Dk[mpiRank(prmesh#commddm)]</code> is defined (unless this mpi rank is excluded from the spatial domain decomposition, i. e. <code>prmesh#excluded</code> = 1). In the sequential case, all local partition of unity vectors are defined.</li>
<li><code>matrix&lt;pr#K&gt;[int] pr#Dih</code> array (size <code>prmesh#npart</code>) similar to <code>pr#Dk</code> but in <em>matrix</em> form, allowing for easier <em>matrix</em>-<em>matrix</em> multiplications. <code>pr#Dih[i]</code> is a diagonal matrix, with the diagonal equal to <code>pr#Dk[i]</code>.</li>
<li><code>fespace pr#Vhglob</code> the global finite element space defined on the global mesh <code>prmesh#Thglob</code>. Defined only if <a href="../parameters/#command-line-arguments"><code>-noGlob</code></a> is not used.</li>
<li><code>matrix&lt;pr#K&gt;[int] pr#Rih</code> array (size <code>prmesh#npart</code>) of restriction matrices from the global finite element space to the local finite element spaces on the local submeshes of the subdomains. In the standard parallel case, only the restriction matrix for this mpi rank <code>pr#Rih[mpiRank(prmesh#commddm)]</code> is defined (unless this mpi rank is excluded from the spatial domain decomposition, i. e. <code>prmesh#excluded</code> = 1). In the sequential case, all restriction matrices are defined. The restriction matrices <code>pr#Rih</code> are defined only if <a href="../parameters/#command-line-arguments"><code>-noGlob</code></a> is not used.</li>
<li><code>func int pr#update(scalar[int] ui, bool scale)</code> The function <code>pr#update</code> synchronizes the local vector <em>ui</em> between subdomains by exchanging the values of <em>ui</em> shared with neighboring subdomains (in the overlap region) using point-to-point MPI communications. If <em>scale</em> is <em>true</em>, <em>ui</em> is multiplied by the local partition of unity beforehand. This is equivalent to
<span><span class="MathJax_Preview">u_i = R_i (\sum_{j=1}^N R_j^T u_j)</span><script type="math/tex">u_i = R_i (\sum_{j=1}^N R_j^T u_j)</script></span> when <em>scale</em> is <em>false</em> and <span><span class="MathJax_Preview">u_i = R_i (\sum_{j=1}^N R_j^T D_j u_j)</span><script type="math/tex">u_i = R_i (\sum_{j=1}^N R_j^T D_j u_j)</script></span> when <em>scale</em> is <em>true</em>.</li>
<li><code>func scalar pr#scalprod(scalar[int] ai, scalar[int] bi)</code> The function <code>pr#scalprod</code> computes the global scalar product of two vectors whose local restriction to the subdomain of this mpi rank are <em>ai</em> and <em>bi</em>. The result is computed as <span><span class="MathJax_Preview">\sum_{j=1}^N (D_j a_j, b_j)</span><script type="math/tex">\sum_{j=1}^N (D_j a_j, b_j)</script></span>.</li>
</ul>
<p><strong><em>Remark:</em></strong></p>
<p><strong><em>For advanced users</em></strong>:</p>
<p>matrix<pr#K>[int] pr#restrictionIntersection(0);</p>
<p>NewMacro pr#mdefpart udefpart EndMacro</p>
<p>NewMacro pr#minitpart uinitpart EndMacro</p>
<p>func pr#fPkP0 = mPkP0;</p>
<p>pr#K[int][int] pr#rcv(0);
pr#K[int][int] pr#snd(0);</p>
<p><strong><em>depends on</em></strong>:</p>
<p><strong><em>see also</em></strong>:</p>
<ul>
<li><strong><a href="#local-finite-element-spaces"><code>ffddmbuildDfespaceEdge</code></a></strong></li>
</ul>
<h2 id="define-the-problem-to-solve">Define the problem to solve<a class="headerlink" href="#define-the-problem-to-solve" title="Permanent link">#</a></h2>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">ffddmsetupOperator</span><span class="p">(</span><span class="n">pr</span><span class="p">,</span><span class="n">prfe</span><span class="p">,</span><span class="n">Varf</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<p>builds the distributed operator associated to the variational problem given by <strong>Varf</strong>, on top of the distributed finite element space <strong>prfe</strong>. This will create and expose variables whose names will be prefixed by <strong>pr</strong>, see below. It is assumed that <strong><a href="#local-finite-element-spaces"><code>ffddmbuildDfespace</code></a></strong> has already been called with prefix <strong>prfe</strong> in order to define the distributed finite element space.<br />
In practice, this builds the so-called local 'Dirichlet' matrices <span><span class="MathJax_Preview">A_i = R_i A R_i^T</span><script type="math/tex">A_i = R_i A R_i^T</script></span>, the restrictions of the global operator <span><span class="MathJax_Preview">A</span><script type="math/tex">A</script></span> to the subdomains (see <code>pr#aRd</code>below). The matrices correspond to the discretization of the bilinear form given by the macro <strong>Varf</strong>, which represents the abstract variational form of the problem. These matrices are then used to implement the action of the global operator <span><span class="MathJax_Preview">A</span><script type="math/tex">A</script></span> on a local vector (the parallel matrix-vector product with <span><span class="MathJax_Preview">A</span><script type="math/tex">A</script></span>), see <code>pr#A</code> below.<br />
At this point, we already have the necessary data to be able to solve the problem with a parallel direct solver (<em>MUMPS</em>), which is the purpose of the function <code>pr#directsolve</code> (see below). See <strong><a href="#define-the-problem-to-solve"><code>ffddmbuildrhs</code></a></strong> for building the right-hand side.  </p>
<p>The macro <strong>Varf</strong> is required to have three parameters: the name of the variational form, the mesh, and the finite element space. The variational form given in this 'abstract' format will then be used by <em>ffddm</em> to assemble the discrete operators by setting the appropriate mesh and finite element space as parameters. An example is given below:</p>
<p><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">macro</span> <span class="nf">myVarf</span><span class="p">(</span><span class="n">varfName</span><span class="p">,</span> <span class="n">meshName</span><span class="p">,</span> <span class="n">VhName</span><span class="p">)</span>
    <span class="kt">varf</span> <span class="n">varfName</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">)</span> <span class="o">=</span> <span class="nf">int3d</span><span class="p">(</span><span class="n">meshName</span><span class="p">)(</span><span class="n">grad</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">&#39;&#39;*</span> <span class="n">grad</span><span class="p">(</span><span class="n">v</span><span class="p">))</span> <span class="o">+</span> <span class="nf">on</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">u</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">);</span>
<span class="c1">// EOM</span>

<span class="n">ffddmsetupOperator</span><span class="p">(</span><span class="n">myprefix</span><span class="p">,</span><span class="n">myFEprefix</span><span class="p">,</span><span class="n">myVarf</span><span class="p">)</span>
</pre></div>
</td></tr></table>
<strong><em>Remark</em></strong> In this simple example, the third parameter <em>VhName</em> is not used. However, for more complex cases such as non-linear or time dependent problems where the problem depends on a solution computed at a previous step, it is useful to know for which discrete finite element space the variational form is being used. See for example TODO  </p>
<p><strong><em>defines</em></strong>:</p>
<ul>
<li><code>pr#prfe</code> macro, saves the parent prefix <strong>prfe</strong> of the finite element space</li>
<li><code>int pr#verbosity</code> the level of verbosity for this problem, initialized with the value of <a href="../parameters/#global-parameters">ffddmverbosity</a></li>
<li><code>pr#writesummary</code> macro, prints a summary of timings for this problem, such as the time spent to assemble local matrices or solve the linear system.</li>
<li><code>matrix&lt;prfe#K&gt; pr#Aglobal</code> the global matrix <span><span class="MathJax_Preview">A</span><script type="math/tex">A</script></span> corresponding to the discretization of the variational form given by the macro <strong>Varf</strong> on the global finite element space <code>prfe#Vhglob</code>. Defined only in the sequential case.</li>
<li><code>matrix&lt;prfe#K&gt;[int] pr#aRd</code> array (size <code>prfe#prmesh#npart</code>) of so-called local 'Dirichlet' matrices in the subdomains; these are the restrictions of the global operator to the subdomains, equivalent to <span><span class="MathJax_Preview">A_i = R_i A R_i^T</span><script type="math/tex">A_i = R_i A R_i^T</script></span> with <span><span class="MathJax_Preview">A</span><script type="math/tex">A</script></span> the global matrix corresponding to the discretization of the variational form given by the macro <strong>Varf</strong> on the global finite element space. In the standard parallel case, only the local matrix for this mpi rank <code>pr#aRd[mpiRank(prmesh#commddm)]</code> is defined (unless this mpi rank is excluded from the spatial domain decomposition, i. e. <code>prmesh#excluded</code> = 1). In the sequential case, all local matrices are defined.</li>
<li><code>func prfe#K[int] pr#A(prfe#K[int] &amp;ui)</code> The function <code>pr#A</code> computes the parallel matrix-vector product, i.e. the action of the global operator <span><span class="MathJax_Preview">A</span><script type="math/tex">A</script></span> on the local vector <span><span class="MathJax_Preview">u_i</span><script type="math/tex">u_i</script></span>. The computation is equivalent to <span><span class="MathJax_Preview">R_i (\sum_{j=1}^N R_j^T D_j A_j u_j)</span><script type="math/tex">R_i (\sum_{j=1}^N R_j^T D_j A_j u_j)</script></span> and is performed in parallel using local matrices <code>pr#aRd</code> and the function <code>prfe#update</code>. In the sequential case, the global matrix <strong>pr#Aglobal</strong> is used instead.</li>
<li><code>func prfe#K[int] pr#directsolve(prfe#K[int]&amp; rhsi)</code> The function <code>pr#directsolve</code> allows to solve the linear system <span><span class="MathJax_Preview">A x = b</span><script type="math/tex">A x = b</script></span> in parallel using the parallel direct solver <em>MUMPS</em>. The matrix is given to <em>MUMPS</em> in distributed form through the local matrices <code>pr#aRd</code>. The input <em>rhsi</em> is given as a distributed vector (<em>rhsi</em> is the restriction of the global right-hand side <span><span class="MathJax_Preview">b</span><script type="math/tex">b</script></span> to the subdomain of this mpi rank, see <strong><a href="#define-the-problem-to-solve"><code>ffddmbuildrhs</code></a>)</strong> and the returned vector is local as well.</li>
</ul>
<p>NewMacro pr#plot(u,s)</p>
<p><strong><em>For advanced users</em></strong>:</p>
<p>NewMacro pr#fromVhi(ui,VhName,res)</p>
<p><strong><em>depends on</em></strong>:</p>
<ul>
<li><a href="../parameters/#global-parameters">ffddmverbosity</a></li>
</ul>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">ffddmbuildrhs</span><span class="p">(</span><span class="n">pr</span><span class="p">,</span><span class="n">Varfrhs</span><span class="p">,</span><span class="n">rhs</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<p>builds the right-hand side associated to the variational form given by <strong>Varfrhs</strong> for the problem corresponding to prefix <strong>pr</strong>.  The resulting right-hand side vector <strong>rhs</strong> corresponds to the discretization of the abstract linear form given by the macro <strong>Varfrhs</strong> (see <strong><a href="#define-the-problem-to-solve"><code>ffddmsetupOperator</code></a></strong> for more details on how to define the abstract variational form as a macro).<br />
The input vector <strong>rhs</strong> is resized and contains the resulting local right-hand side <span><span class="MathJax_Preview">R_i b</span><script type="math/tex">R_i b</script></span>, the restriction of the global right-hand side <span><span class="MathJax_Preview">b</span><script type="math/tex">b</script></span> to the subdomain of this mpi rank. In the sequential case, the global right-hand side vector <span><span class="MathJax_Preview">b</span><script type="math/tex">b</script></span> is assembled instead.<br />
An example is given below:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">macro</span> <span class="nf">myVarfrhs</span><span class="p">(</span><span class="n">varfName</span><span class="p">,</span> <span class="n">meshName</span><span class="p">,</span> <span class="n">VhName</span><span class="p">)</span>
    <span class="kt">varf</span> <span class="n">varfName</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">)</span> <span class="o">=</span> <span class="n">intN</span><span class="p">(</span><span class="n">meshName</span><span class="p">)(</span><span class="n">v</span><span class="p">)</span> <span class="o">+</span> <span class="nf">on</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">u</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">);</span>
<span class="c1">// EOM</span>

<span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">rhsi</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="n">ffddmbuildrhs</span><span class="p">(</span><span class="n">myprefix</span><span class="p">,</span><span class="n">myVarfrhs</span><span class="p">,</span><span class="n">rhsi</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<h2 id="one-level-preconditioners">One level preconditioners<a class="headerlink" href="#one-level-preconditioners" title="Permanent link">#</a></h2>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">ffddmsetupPrecond</span><span class="p">(</span><span class="n">pr</span><span class="p">,</span><span class="n">VarfPrec</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<p>builds the one level preconditioner for problem <strong>pr</strong>. This will create and expose variables whose names will be prefixed by <strong>pr</strong>, see below. It is assumed that <strong><a href="#define-the-problem-to-solve"><code>ffddmsetupOperator</code></a></strong> has already been called with prefix <strong>pr</strong> in order to define the problem to solve.<br />
In practice, this builds and performs the factorization of the local matrices used in the one level preconditioner. The local matrices depend on the choice of <a href="../parameters/#global-parameters">ffddmprecond</a> and <strong>VarfPrec</strong>, see <code>pr#aR</code>below.</p>
<p><strong><em>defines</em></strong>:</p>
<ul>
<li>
<p><code>string pr#prec</code> equal to <a href="../parameters/#global-parameters">ffddmprecond</a>. Sets the type of one level preconditioner <span><span class="MathJax_Preview">M^{-1}_1</span><script type="math/tex">M^{-1}_1</script></span> to be used: "asm" (<em>Additive Schwarz</em>), "ras" (<em>Restricted Additive Schwarz</em>), "oras" (<em>Optimized Restricted Additive Schwarz</em>), "soras" (<em>Symmetric Optimized Restricted Additive Schwarz</em>) or "none" (no preconditioner).</p>
</li>
<li>
<p><code>matrix&lt;pr#prfe#K&gt;[int] pr#aR</code> array (size <code>prfe#prmesh#npart</code>) of local matrices used for the one level preconditioner. Each mpi rank of the spatial domain decomposition performs the <span><span class="MathJax_Preview">LU</span><script type="math/tex">LU</script></span> (or <span><span class="MathJax_Preview">LDL^T</span><script type="math/tex">LDL^T</script></span>) factorization of the local matrix corresponding to its subdomain using the direct solver <em>MUMPS</em>.</p>
</li>
<li>
<p>If <strong>VarfPrec</strong> is not a previously defined macro (just put <em>null</em> for example), the matrices <code>pr#aR</code> are set to be equal to the so-called local 'Dirichlet' matrices <code>pr#aRd</code> (see <strong><a href="#define-the-problem-to-solve"><code>ffddmsetupOperator</code></a></strong>). This is for the classical ASM preconditioner <span><span class="MathJax_Preview">M^{-1}_1 = M^{-1}_{\text{ASM}} = \sum_{i=1}^N R_i^T A_i^{-1} R_i</span><script type="math/tex">M^{-1}_1 = M^{-1}_{\text{ASM}} = \sum_{i=1}^N R_i^T A_i^{-1} R_i</script></span> or classical RAS preconditioner <span><span class="MathJax_Preview">M^{-1}_1 = M^{-1}_{\text{RAS}} = \sum_{i=1}^N R_i^T D_i A_i^{-1} R_i</span><script type="math/tex">M^{-1}_1 = M^{-1}_{\text{RAS}} = \sum_{i=1}^N R_i^T D_i A_i^{-1} R_i</script></span> (it is assumed that <a href="../parameters/#global-parameters">ffddmprecond</a> is equal to "asm" or "ras").</p>
</li>
<li>If <strong>VarfPrec</strong> is a macro, it is assumed that <strong>VarfPrec</strong> defines an abstract bilinear form (see <strong><a href="#define-the-problem-to-solve"><code>ffddmsetupOperator</code></a></strong> for more details on how to define the abstract variational form as a macro).<ul>
<li>If <a href="../parameters/#global-parameters">ffddmprecond</a> is equal to "asm" or "ras", the matrices <code>pr#aR</code> will be assembled as local 'Dirichlet' matrices in the same manner as <code>pr#aRd</code>, but using the bilinear form defined by <strong>VarfPrec</strong> instead. This defines the ASM preconditioner as <span><span class="MathJax_Preview">M^{-1}_1 = M^{-1}_{\text{ASM}} = \sum_{i=1}^N R_i^T {(A_i^{\text{Prec}})}^{-1} R_i</span><script type="math/tex">M^{-1}_1 = M^{-1}_{\text{ASM}} = \sum_{i=1}^N R_i^T {(A_i^{\text{Prec}})}^{-1} R_i</script></span> and the RAS preconditioner as <span><span class="MathJax_Preview">M^{-1}_1 = M^{-1}_{\text{RAS}} = \sum_{i=1}^N R_i^T D_i {(A_i^{\text{Prec}})}^{-1} R_i</span><script type="math/tex">M^{-1}_1 = M^{-1}_{\text{RAS}} = \sum_{i=1}^N R_i^T D_i {(A_i^{\text{Prec}})}^{-1} R_i</script></span>, where <span><span class="MathJax_Preview">A_i^{\text{Prec}} = R_i A^{\text{Prec}} R_i^T</span><script type="math/tex">A_i^{\text{Prec}} = R_i A^{\text{Prec}} R_i^T</script></span>.</li>
<li>If <a href="../parameters/#global-parameters">ffddmprecond</a> is equal to "oras" or "soras", the matrices <code>pr#aR</code> will correspond to the discretization of the variational form <strong>VarfPrec</strong> in the subdomains <span><span class="MathJax_Preview">\Omega_i</span><script type="math/tex">\Omega_i</script></span>. In particular, various boundary conditions can be imposed at the interface between subdomains (corresponding to mesh boundary of label <a href="../parameters/#global-parameters">ffddminterfacelabel</a> set by the parent call to <strong><a href="#overlapping-mesh-decomposition"><code>ffddmbuildDmesh</code></a></strong>), such as Optimized Robin boundary conditions. We note the ORAS preconditioner as <span><span class="MathJax_Preview">M^{-1}_1 = M^{-1}_{\text{ORAS}} = \sum_{i=1}^N R_i^T D_i {(B_i^{\text{Prec}})}^{-1} R_i</span><script type="math/tex">M^{-1}_1 = M^{-1}_{\text{ORAS}} = \sum_{i=1}^N R_i^T D_i {(B_i^{\text{Prec}})}^{-1} R_i</script></span> and the SORAS preconditioner as <span><span class="MathJax_Preview">M^{-1}_1 = M^{-1}_{\text{SORAS}} = \sum_{i=1}^N R_i^T D_i {(B_i^{\text{Prec}})}^{-1} D_i R_i</span><script type="math/tex">M^{-1}_1 = M^{-1}_{\text{SORAS}} = \sum_{i=1}^N R_i^T D_i {(B_i^{\text{Prec}})}^{-1} D_i R_i</script></span>.</li>
</ul>
</li>
<li><code>func pr#prfe#K[int] pr#PREC1(pr#prfe#K[int] &amp;ui)</code> The function <code>pr#PREC1</code> computes the parallel application of the one level preconditioner <span><span class="MathJax_Preview">M^{-1}_1</span><script type="math/tex">M^{-1}_1</script></span>, i.e. the action of <span><span class="MathJax_Preview">M^{-1}_1</span><script type="math/tex">M^{-1}_1</script></span> on the local vector <span><span class="MathJax_Preview">u_i</span><script type="math/tex">u_i</script></span>. In the sequential case, it computes the action of <span><span class="MathJax_Preview">M^{-1}_1</span><script type="math/tex">M^{-1}_1</script></span> on a global vector. The action of the inverse of local matrices <code>pr#aRd</code> is computed by forward-backward substitution using their <span><span class="MathJax_Preview">LU</span><script type="math/tex">LU</script></span> (or <span><span class="MathJax_Preview">LDL^T</span><script type="math/tex">LDL^T</script></span>) decomposition.</li>
<li><code>func pr#prfe#K[int] pr#PREC(pr#prfe#K[int] &amp;ui)</code> The function <code>pr#PREC</code> corresponds to the action of the preconditioner <span><span class="MathJax_Preview">M^{-1}</span><script type="math/tex">M^{-1}</script></span> for problem <strong>pr</strong>. It coincides with the one level preconditioner <code>pr#PREC1</code> after the call to <strong><a href="#one-level-preconditioners"><code>ffddmsetupPrecond</code></a></strong>. If a second level is subsequently added (see the next section about <strong><a href="#two-level-preconditioners">Two level preconditioners</a></strong>), it will then coincide with the two level preconditioner <span><span class="MathJax_Preview">M^{-1}_2</span><script type="math/tex">M^{-1}_2</script></span> (see <code>pr#PREC2level</code>).</li>
<li><code>func pr#prfe#K[int] pr#fGMRES(pr#prfe#K[int]&amp; x0i, pr#prfe#K[int]&amp; bi, real eps, int nbiter, string sprec)</code> The function <code>pr#fGMRES</code> allows to solve the linear system <span><span class="MathJax_Preview">A x = b</span><script type="math/tex">A x = b</script></span> in parallel using the flexible GMRES method preconditioned by <span><span class="MathJax_Preview">M^{-1}</span><script type="math/tex">M^{-1}</script></span>. The action of the global operator <span><span class="MathJax_Preview">A</span><script type="math/tex">A</script></span> is given by <code>pr#A</code>, the action of the preconditioner <span><span class="MathJax_Preview">M^{-1}</span><script type="math/tex">M^{-1}</script></span> is given by <code>pr#PREC</code> and the scalar products are computed by <code>pr#scalprod</code>. More details are given in the section <strong><a href="#solving-the-linear-system">Solving the linear system</a></strong>.</li>
</ul>
<p><strong><em>For advanced users</em></strong>:</p>
<p>NewMacro pr#localmacroaug pr#prfe#prmesh#buildAug EndMacro<br />
IFMACRO(pr#localmacroaug,1)<br />
matrix<pr#prfe#K> pr#CSinterp;<br />
ENDIFMACRO </p>
<h2 id="two-level-preconditioners">Two level preconditioners<a class="headerlink" href="#two-level-preconditioners" title="Permanent link">#</a></h2>
<p>The main ingredient of a two level preconditioner is the so-called 'coarse space' matrix <span><span class="MathJax_Preview">Z</span><script type="math/tex">Z</script></span>.<br />
<span><span class="MathJax_Preview">Z</span><script type="math/tex">Z</script></span> is a rectangular matrix of size <span><span class="MathJax_Preview">n \times n_c</span><script type="math/tex">n \times n_c</script></span>, where usually <span><span class="MathJax_Preview">n_c \ll n</span><script type="math/tex">n_c \ll n</script></span>.<br />
<span><span class="MathJax_Preview">Z</span><script type="math/tex">Z</script></span> is used to build the 'coarse space operator' <span><span class="MathJax_Preview">E = Z^T A Z</span><script type="math/tex">E = Z^T A Z</script></span>, a square matrix of size <span><span class="MathJax_Preview">n_c \times n_c</span><script type="math/tex">n_c \times n_c</script></span>. We can then define the 'coarse space correction operator' <span><span class="MathJax_Preview">Q = Z E^{-1} Z^T = Z (Z^T A Z)^{-1} Z^T</span><script type="math/tex">Q = Z E^{-1} Z^T = Z (Z^T A Z)^{-1} Z^T</script></span>, which can then be used to enrich the one level preconditioner through a correction formula. The simplest one is the <em>additive</em> coarse correction: <span><span class="MathJax_Preview">M^{-1}_2 = M^{-1}_1 + Q</span><script type="math/tex">M^{-1}_2 = M^{-1}_1 + Q</script></span>. See <code>pr#corr</code> below for all other available correction formulas.</p>
<p>There are multiple ways to define a relevant coarse space <span><span class="MathJax_Preview">Z</span><script type="math/tex">Z</script></span> for different classes of problems. <strong><a href="#building-the-geneo-coarse-space"><code>ffddmgeneosetup</code></a></strong> defines a coarse space correction operator by building the GenEO coarse space, while <strong><a href="#building-the-coarse-space-from-a-coarse-mesh"><code>ffddmEuansetup</code></a></strong> builds the coarse space using a coarse mesh.<br />
After a call to either <strong><a href="#building-the-geneo-coarse-space"><code>ffddmgeneosetup</code></a></strong> or <strong><a href="#building-the-coarse-space-from-a-coarse-mesh"><code>ffddmEuansetup</code></a></strong>, the following variables and functions are set up:</p>
<ul>
<li><code>int pr#ncoarsespace</code> the size of the coarse space <span><span class="MathJax_Preview">n_c</span><script type="math/tex">n_c</script></span>.</li>
<li>
<p><code>string pr#corr</code> initialized with the value of <a href="../parameters/#global-parameters">ffddmcorrection</a>. Specifies the type of coarse correction formula to use for the two level preconditioner. The possible values are:<br />
<script type="math/tex; mode=display">
\begin{align*}
\nonumber
&&\text{"AD"}:&&\textit{Additive}, \quad &M^{-1} = M^{-1}_2 = \phantom{(I - Q A) }M^{-1}_1\phantom{ (I - A Q)} + Q\\
&&\text{"BNN"}:&&\textit{Balancing Neumann-Neumann}, \quad &M^{-1} = M^{-1}_2 = (I - Q A) M^{-1}_1 (I - A Q) + Q\\
&&\text{"ADEF1"}:&&\textit{Adapted Deflation Variant 1}, \quad &M^{-1} = M^{-1}_2 = \phantom{(I - Q A) }M^{-1}_1 (I - A Q) + Q\\
&&\text{"ADEF2"}:&&\textit{Adapted Deflation Variant 2}, \quad &M^{-1} = M^{-1}_2 = (I - Q A) M^{-1}_1\phantom{ (I - A Q)} + Q\\
&&\text{"RBNN1"}:&&\textit{Reduced Balancing Variant 1}, \quad &M^{-1} = M^{-1}_2 = (I - Q A) M^{-1}_1 (I - A Q)\\
&&\text{"RBNN2"}:&&\textit{Reduced Balancing Variant 2}, \quad &M^{-1} = M^{-1}_2 = (I - Q A) M^{-1}_1\phantom{ (I - A Q)}\\
&&\text{"none"}:&&\textit{no coarse correction}, \quad &M^{-1} = M^{-1}_2 = \phantom{(I - Q A) }M^{-1}_1\phantom{ (I - A Q)}\\
\end{align*}
</script>
Note that <em>AD</em>, <em>ADEF1</em> and <em>RBNN2</em> only require one application of <span><span class="MathJax_Preview">Q</span><script type="math/tex">Q</script></span>, while <em>BNN</em>, <em>ADEF2</em> and <em>RBNN1</em> require two. The default coarse correction is <em>ADEF1</em>, which is cheaper and generally as robust as <em>BNN</em> or <em>ADEF2</em>.</p>
</li>
<li>
<p><code>func pr#prfe#K[int] pr#Q(pr#prfe#K[int] &amp;ui)</code> The function <code>pr#Q</code> computes the parallel application of the coarse correction operator <span><span class="MathJax_Preview">Q</span><script type="math/tex">Q</script></span>, i.e. the action of <span><span class="MathJax_Preview">Q = Z E^{-1} Z^T</span><script type="math/tex">Q = Z E^{-1} Z^T</script></span> on the local vector <span><span class="MathJax_Preview">u_i</span><script type="math/tex">u_i</script></span>. In the sequential case, it computes the action of <span><span class="MathJax_Preview">Q</span><script type="math/tex">Q</script></span> on a global vector.<br />
The implementation differs depending on the method used to build the coarse space (with GenEO or using a coarse mesh), but the idea is the same: the action of the transpose of the distributed operator <span><span class="MathJax_Preview">Z</span><script type="math/tex">Z</script></span> on the distributed vector <span><span class="MathJax_Preview">u_i</span><script type="math/tex">u_i</script></span> is computed in parallel, with the contribution of all subdomains being gathered in a vector of size <span><span class="MathJax_Preview">n_c</span><script type="math/tex">n_c</script></span> in the mpi process of rank 0. The action of the inverse of the coarse space operator <span><span class="MathJax_Preview">E</span><script type="math/tex">E</script></span> is then computed by forward-backward substitution using its <span><span class="MathJax_Preview">LU</span><script type="math/tex">LU</script></span> (or <span><span class="MathJax_Preview">LDL^T</span><script type="math/tex">LDL^T</script></span>) decomposition previously computed by the first <code>pr#prfe#prmesh#pCS</code> ranks of the mpi communicator. The result is then sent back to all subdomains to perform the last application of <span><span class="MathJax_Preview">Z</span><script type="math/tex">Z</script></span> and obtain the resulting local vector in each subdomain.</p>
</li>
<li><code>func pr#prfe#K[int] pr#PREC2level(pr#prfe#K[int] &amp;ui)</code> The function <code>pr#PREC2level</code> computes the parallel application of the two level preconditioner <span><span class="MathJax_Preview">M^{-1}_2</span><script type="math/tex">M^{-1}_2</script></span>, i.e. the action of <span><span class="MathJax_Preview">M^{-1}_2</span><script type="math/tex">M^{-1}_2</script></span> on the local vector <span><span class="MathJax_Preview">u_i</span><script type="math/tex">u_i</script></span>. In the sequential case, it computes the action of <span><span class="MathJax_Preview">M^{-1}_2</span><script type="math/tex">M^{-1}_2</script></span> on a global vector. The two level preconditioner depends on the choice of the coarse correction formula which is determined by <code>pr#corr</code>, see above.</li>
</ul>
<p><strong><em>For advanced users</em></strong>:</p>
<p>int pr#bEuan = 0;</p>
<h3 id="building-the-geneo-coarse-space">Building the GenEO coarse space<a class="headerlink" href="#building-the-geneo-coarse-space" title="Permanent link">#</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">ffddmgeneosetup</span><span class="p">(</span><span class="n">pr</span><span class="p">,</span><span class="n">Varf</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<p>This builds the GenEO coarse space for problem <strong>pr</strong>. This will create and expose variables whose names will be prefixed by <strong>pr</strong>, see below. It is assumed that <strong><a href="#one-level-preconditioners"><code>ffddmsetupPrecond</code></a></strong> has already been called for prefix <strong>pr</strong> in order to define the one level preconditioner for problem <strong>pr</strong>. The GenEO coarse space is <span><span class="MathJax_Preview">Z = (R_i^T D_i V_{i,k})^{i=1,...,N}_{\lambda_{i,k} \ge \tau}</span><script type="math/tex">Z = (R_i^T D_i V_{i,k})^{i=1,...,N}_{\lambda_{i,k} \ge \tau}</script></span>, where <span><span class="MathJax_Preview">V_{i,k}</span><script type="math/tex">V_{i,k}</script></span> are eigenvectors corresponding to eigenvalues <span><span class="MathJax_Preview">\lambda_{i,k}</span><script type="math/tex">\lambda_{i,k}</script></span> of the following local generalized eigenvalue problem in subdomain <span><span class="MathJax_Preview">i</span><script type="math/tex">i</script></span>:</p>
<p><span><span class="MathJax_Preview">D_i A_i D_i V_{i,k} = \lambda_{i,k} A_i^{\text{Neu}} V_{i,k}</span><script type="math/tex">D_i A_i D_i V_{i,k} = \lambda_{i,k} A_i^{\text{Neu}} V_{i,k}</script></span>,  </p>
<p>where <span><span class="MathJax_Preview">A_i^{\text{Neu}}</span><script type="math/tex">A_i^{\text{Neu}}</script></span> is the local Neumann matrix of subdomain <span><span class="MathJax_Preview">i</span><script type="math/tex">i</script></span> (with Neumann boundary conditions at the subdomain interface).<br />
In practice, this builds and factorizes the local Neumann matrices <span><span class="MathJax_Preview">A_i^{\text{Neu}}</span><script type="math/tex">A_i^{\text{Neu}}</script></span> corresponding to the abstract bilinear form given by the macro <strong>Varf</strong> (see <strong><a href="#define-the-problem-to-solve"><code>ffddmsetupOperator</code></a></strong> for more details on how to define the abstract variational form as a macro). In the GenEO method, the abstract bilinear form <strong>Varf</strong> is assumed to be the same as the one used to define the problem <strong>pr</strong> through the previous call to <strong><a href="#define-the-problem-to-solve"><code>ffddmsetupOperator</code></a></strong>. The local generalized eigenvalue problem is then solved in each subdomain to find the eigenvectors <span><span class="MathJax_Preview">V_{i,k}</span><script type="math/tex">V_{i,k}</script></span> corresponding to the largest eigenvalues <span><span class="MathJax_Preview">\lambda_{i,k}</span><script type="math/tex">\lambda_{i,k}</script></span> (see <code>pr#Z</code> below). The number of computed eigenvectors <span><span class="MathJax_Preview">\nu</span><script type="math/tex">\nu</script></span> is given by <a href="../parameters/#global-parameters">ffddmnu</a>. The eigenvectors selected to enter <span><span class="MathJax_Preview">Z</span><script type="math/tex">Z</script></span> correspond to eigenvalues <span><span class="MathJax_Preview">\lambda_{i,k}</span><script type="math/tex">\lambda_{i,k}</script></span> larger than <span><span class="MathJax_Preview">\tau</span><script type="math/tex">\tau</script></span>, where the threshold parameter <span><span class="MathJax_Preview">\tau</span><script type="math/tex">\tau</script></span> is given by <a href="../parameters/#global-parameters">ffddmtau</a>. If <a href="../parameters/#global-parameters">ffddmtau</a> <span><span class="MathJax_Preview">= 0</span><script type="math/tex">= 0</script></span>, all <a href="../parameters/#global-parameters">ffddmnu</a> eigenvectors are selected.   Finally, the coarse space operator <span><span class="MathJax_Preview">E = Z^T A Z</span><script type="math/tex">E = Z^T A Z</script></span> is assembled and factorized (see <code>pr#E</code> below).</p>
<p><strong><em>defines</em></strong>:</p>
<ul>
<li>
<p><code>pr#prfe#K[int][int] pr#Z</code> array of local eigenvectors <span><span class="MathJax_Preview">Z_{i,k} = D_i V_{i,k}</span><script type="math/tex">Z_{i,k} = D_i V_{i,k}</script></span> obtained by solving the local generalized eigenvalue problem above in the subdomain of this mpi rank using <em>Arpack</em>. The number of computed eigenvectors <span><span class="MathJax_Preview">\nu</span><script type="math/tex">\nu</script></span> is given by <a href="../parameters/#global-parameters">ffddmnu</a>. The eigenvectors selected to enter <span><span class="MathJax_Preview">Z</span><script type="math/tex">Z</script></span> correspond to eigenvalues <span><span class="MathJax_Preview">\lambda_{i,k}</span><script type="math/tex">\lambda_{i,k}</script></span> larger than <span><span class="MathJax_Preview">\tau</span><script type="math/tex">\tau</script></span>, where the threshold parameter <span><span class="MathJax_Preview">\tau</span><script type="math/tex">\tau</script></span> is given by <a href="../parameters/#global-parameters">ffddmtau</a>. If <a href="../parameters/#global-parameters">ffddmtau</a> <span><span class="MathJax_Preview">= 0</span><script type="math/tex">= 0</script></span>, all <a href="../parameters/#global-parameters">ffddmnu</a> eigenvectors are selected.</p>
</li>
<li>
<p><code>matrix&lt;pr#prfe#K&gt; pr#E</code> the coarse space operator <span><span class="MathJax_Preview">E = Z^T A Z</span><script type="math/tex">E = Z^T A Z</script></span>. The matrix <code>pr#E</code> is assembled in parallel and is factorized by the parallel direct solver <em>MUMPS</em> using the first <code>pr#prfe#prmesh#pCS</code> ranks of the mpi communicator, with mpi rank 0 as the master process. The number of mpi processes dedicated to the coarse problem is set by the underlying mesh decomposition of problem <strong>pr</strong>, which also specifies if these mpi ranks are excluded from the spatial decomposition or not. These parameters are set by <a href="../parameters/#global-parameters">ffddmpCS</a> and <a href="../parameters/#global-parameters">ffddmexclude</a> when calling <strong><a href="#overlapping-mesh-decomposition"><code>ffddmbuildDmesh</code></a></strong> (see <strong><a href="#overlapping-mesh-decomposition"><code>ffddmbuildDmesh</code></a></strong> for more details).</p>
</li>
</ul>
<p><strong><em>For advanced users</em></strong>:</p>
<p>int pr#si;</p>
<p>pr#sizelg(pr#prfe#prmesh#npart), pr#offseti(pr#prfe#prmesh#npart);</p>
<p>int[int] pr#sizelgworld(mpiSize(pr#prfe#prmesh#mpicomm)), pr#offsetiworld(mpiSize(pr#prfe#prmesh#mpicomm));</p>
<p>matrix<pr#prfe#K> pr#matN;</p>
<h3 id="building-the-coarse-space-from-a-coarse-mesh">Building the coarse space from a coarse mesh<a class="headerlink" href="#building-the-coarse-space-from-a-coarse-mesh" title="Permanent link">#</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">ffddmEuansetup</span><span class="p">(</span><span class="n">pr</span><span class="p">,</span><span class="n">Thc</span><span class="p">,</span><span class="n">VarfEprec</span><span class="p">,</span><span class="n">VarfA</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<p>builds the coarse space for problem <strong>pr</strong> from a coarse problem which corresponds to the discretization of a variational form on a coarser mesh <strong>Thc</strong> of <span><span class="MathJax_Preview">\Omega</span><script type="math/tex">\Omega</script></span>. This will create and expose variables whose names will be prefixed by <strong>pr</strong>, see below. It is assumed that <strong><a href="#one-level-preconditioners"><code>ffddmsetupPrecond</code></a></strong> has already been called for prefix <strong>pr</strong> in order to define the one level preconditioner for problem <strong>pr</strong>. The abstract variational form for the coarse problem can differ from the original problem <strong>pr</strong> and is given by macro <strong>VarfEprec</strong> (see <strong><a href="#define-the-problem-to-solve"><code>ffddmsetupOperator</code></a></strong> for more details on how to define the abstract variational form as a macro).<br />
The coarse space <span><span class="MathJax_Preview">Z</span><script type="math/tex">Z</script></span> corresponds to the interpolation operator from the </p>
<p><strong><em>defines</em></strong>:</p>
<p>matrix<pr#prfe#K> pr#AglobEprec;</p>
<p>matrix<pr#prfe#K>[int] pr#aRdEprec(pr#prfe#prmesh#npart);</p>
<p>func pr#prfe#K[int] pr#AEprec(pr#prfe#K[int] &amp;x)</p>
<p>matrix<pr#prfe#K> pr#Zeuan</p>
<p>matrix<pr#prfe#K> pr#Zeuani</p>
<p>matrix<pr#prfe#K> pr#Eeuan;</p>
<h2 id="solving-the-linear-system">Solving the linear system<a class="headerlink" href="#solving-the-linear-system" title="Permanent link">#</a></h2>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">func</span> <span class="n">pr</span><span class="err">#</span><span class="n">prfe</span><span class="err">#</span><span class="n">K</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">pr</span><span class="err">#</span><span class="n">fGMRES</span><span class="p">(</span><span class="n">pr</span><span class="err">#</span><span class="n">prfe</span><span class="err">#</span><span class="n">K</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="o">&amp;</span> <span class="n">x0i</span><span class="p">,</span> <span class="n">pr</span><span class="err">#</span><span class="n">prfe</span><span class="err">#</span><span class="n">K</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="o">&amp;</span> <span class="n">bi</span><span class="p">,</span> <span class="kt">real</span> <span class="kp">eps</span><span class="p">,</span> <span class="kt">int</span> <span class="kp">nbiter</span><span class="p">,</span> <span class="kt">string</span> <span class="n">sprec</span><span class="p">)</span>
</pre></div>
</td></tr></table>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../../assets/fonts/font-awesome.css">
    
      <a href="https://github.com/FreeFem/FreeFem-doc" class="md-footer-social__link fa fa-github"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../assets/javascripts/application.9e1f3b71.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../../.."}})</script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AMS_CHTML"></script>
      
        <script src="../../../mathjax-config.js"></script>
      
    
    
      
    
  </body>
</html>