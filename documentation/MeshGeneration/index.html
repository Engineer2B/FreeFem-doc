



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-3.1.0">
    
    
      
        <title>Mesh Generation - FreeFem++</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.11e41852.css">
      
      
    
    
      <script src="../../assets/javascripts/modernizr.20ef595d.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#commands-for-mesh-generation" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="FreeFem++" class="md-header-nav__button md-logo">
          
            <img src="../../images/favicon.png" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                FreeFem++
              </span>
              <span class="md-header-nav__topic">
                Mesh Generation
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/FreeFem/FreeFem-doc/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      FreeFem++ on Github
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../.." title="Introduction" class="md-tabs__link">
          Introduction
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../" title="Documentation" class="md-tabs__link md-tabs__link--active">
          Documentation
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../reference/" title="Language References" class="md-tabs__link">
          Language References
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../tutorials/" title="Tutorials" class="md-tabs__link">
          Tutorials
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../examples/" title="Examples" class="md-tabs__link">
          Examples
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../models/" title="Models" class="md-tabs__link">
          Models
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../.." title="FreeFem++" class="md-nav__button md-logo">
      
        <img src="../../images/favicon.png" width="48" height="48">
      
    </a>
    FreeFem++
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/FreeFem/FreeFem-doc/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      FreeFem++ on Github
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1">
    
    <label class="md-nav__link" for="nav-1">
      Introduction
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        Introduction
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../.." title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../introduction/download/" title="Download" class="md-nav__link">
      Download
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../introduction/installation/" title="Installation" class="md-nav__link">
      Installation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../introduction/contributing/" title="How to contribute?" class="md-nav__link">
      How to contribute?
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../introduction/citation/" title="Citation" class="md-nav__link">
      Citation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../introduction/authors/" title="Authors" class="md-nav__link">
      Authors
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../introduction/TODO/" title="TODO" class="md-nav__link">
      TODO
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      Documentation
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Documentation
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../" title="Home" class="md-nav__link">
      Home
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Notations/" title="Some Notations" class="md-nav__link">
      Some Notations
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Mesh Generation
      </label>
    
    <a href="./" title="Mesh Generation" class="md-nav__link md-nav__link--active">
      Mesh Generation
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#commands-for-mesh-generation" title="Commands for Mesh Generation" class="md-nav__link">
    Commands for Mesh Generation
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#square" title="Square" class="md-nav__link">
    Square
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#border" title="Border" class="md-nav__link">
    Border
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multi-border" title="Multi-Border" class="md-nav__link">
    Multi-Border
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-structures-and-readwrite-statements-for-a-mesh" title="Data Structures and Read/Write Statements for a Mesh" class="md-nav__link">
    Data Structures and Read/Write Statements for a Mesh
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mesh-connectivity-and-data" title="Mesh Connectivity and data" class="md-nav__link">
    Mesh Connectivity and data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-keyword-triangulate" title="The keyword "triangulate"" class="md-nav__link">
    The keyword "triangulate"
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#boundary-fem-spaces-built-as-empty-meshes" title="Boundary FEM Spaces Built as Empty Meshes" class="md-nav__link">
    Boundary FEM Spaces Built as Empty Meshes
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#remeshing" title="Remeshing" class="md-nav__link">
    Remeshing
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#movemesh" title="Movemesh" class="md-nav__link">
    Movemesh
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#regular-triangulation-htriangle" title="Regular Triangulation: hTriangle" class="md-nav__link">
    Regular Triangulation: hTriangle
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adaptmesh" title="Adaptmesh" class="md-nav__link">
    Adaptmesh
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#trunc" title="Trunc" class="md-nav__link">
    Trunc
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#splitmesh" title="Splitmesh" class="md-nav__link">
    Splitmesh
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#meshing-examples" title="Meshing Examples" class="md-nav__link">
    Meshing Examples
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-change-the-label-of-elements-and-border-elements-of-a-mesh" title="How to change the label of elements and border elements of a mesh" class="md-nav__link">
    How to change the label of elements and border elements of a mesh
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mesh-in-three-dimensions" title="Mesh in three dimensions" class="md-nav__link">
    Mesh in three dimensions
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cube" title="Cube" class="md-nav__link">
    Cube
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#readwrite-statements-for-a-mesh-in-3d" title="Read/Write Statements for a Mesh in 3D" class="md-nav__link">
    Read/Write Statements for a Mesh in 3D
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tetgen-a-tetrahedral-mesh-generator" title="TetGen: A tetrahedral mesh generator" class="md-nav__link">
    TetGen: A tetrahedral mesh generator
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reconstructrefine-a-three-dimensional-mesh-with-tetgen" title="Reconstruct/Refine a three dimensional mesh with TetGen" class="md-nav__link">
    Reconstruct/Refine a three dimensional mesh with TetGen
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#moving-mesh-in-three-dimensions" title="Moving mesh in three dimensions" class="md-nav__link">
    Moving mesh in three dimensions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#layer-mesh" title="Layer mesh" class="md-nav__link">
    Layer mesh
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#meshing-examples_1" title="Meshing examples" class="md-nav__link">
    Meshing examples
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#build-a-3d-mesh-of-a-cube-with-a-balloon" title="Build a 3d mesh of a cube with a balloon" class="md-nav__link">
    Build a 3d mesh of a cube with a balloon
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#medit" title="Medit" class="md-nav__link">
    Medit
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mshmet" title="Mshmet" class="md-nav__link">
    Mshmet
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#freeyams" title="FreeYams" class="md-nav__link">
    FreeYams
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mmg3d" title="mmg3d" class="md-nav__link">
    mmg3d
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a-first-3d-isotrope-mesh-adaptation-process" title="A first 3d isotrope mesh adaptation process" class="md-nav__link">
    A first 3d isotrope mesh adaptation process
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build-a-2d-mesh-from-a-isoline" title="Build a 2d mesh from a isoline" class="md-nav__link">
    Build a 2d mesh from a isoline
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" title="References" class="md-nav__link">
    References
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../FiniteElement/" title="Finite Element" class="md-nav__link">
      Finite Element
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Visualization/" title="Visualization" class="md-nav__link">
      Visualization
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../AlgorithmsOptimization/" title="Algorithms & Optimization" class="md-nav__link">
      Algorithms & Optimization
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Parallelization/" title="Parallelization" class="md-nav__link">
      Parallelization
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-8" type="checkbox" id="nav-2-8">
    
    <label class="md-nav__link" for="nav-2-8">
      ffddm
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-8">
        ffddm
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../ffddm/ffddm/" title="What is ffddm ?" class="md-nav__link">
      What is ffddm ?
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ffddm/tutorial-slides.html" title="Tutorial slides" class="md-nav__link">
      Tutorial slides
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ffddm/introddm/" title="Introduction to DDM" class="md-nav__link">
      Introduction to DDM
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ffddm/documentation/" title="ffddm Documentation" class="md-nav__link">
      ffddm Documentation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ffddm/examples/" title="Examples" class="md-nav__link">
      Examples
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Plugins/" title="Plugins" class="md-nav__link">
      Plugins
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Developers/" title="Developers" class="md-nav__link">
      Developers
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../TODO/" title="TODO" class="md-nav__link">
      TODO
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Language References
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Language References
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/" title="Home" class="md-nav__link">
      Home
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/Types/" title="Types" class="md-nav__link">
      Types
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/GlobalVariables/" title="Global variables" class="md-nav__link">
      Global variables
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/QuadratureFormulae/" title="Quadrature formulae" class="md-nav__link">
      Quadrature formulae
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/Operators/" title="Operators" class="md-nav__link">
      Operators
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/Loops/" title="Loops" class="md-nav__link">
      Loops
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/IO/" title="I/O" class="md-nav__link">
      I/O
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/Functions/" title="Functions" class="md-nav__link">
      Functions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/ExternalLibraries/" title="External libraries" class="md-nav__link">
      External libraries
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/TODO/" title="TODO" class="md-nav__link">
      TODO
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Tutorials
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Tutorials
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/" title="Getting started" class="md-nav__link">
      Getting started
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/Poisson/" title="Poisson's equation" class="md-nav__link">
      Poisson's equation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/EquationsClassification/" title="Classification of the equations" class="md-nav__link">
      Classification of the equations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/Membrane/" title="Membrane" class="md-nav__link">
      Membrane
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/HeatExchanger/" title="Heat Exchanger" class="md-nav__link">
      Heat Exchanger
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/Acoustics/" title="Acoustics" class="md-nav__link">
      Acoustics
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/ThermalConduction/" title="Thermal Conduction" class="md-nav__link">
      Thermal Conduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/FanBlade/" title="Irrotational Fan Blade Flow and Thermal effects" class="md-nav__link">
      Irrotational Fan Blade Flow and Thermal effects
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/RotatingHill/" title="Pure convection, The rotating hill" class="md-nav__link">
      Pure convection, The rotating hill
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/Elasticity/" title="The system of elasticity" class="md-nav__link">
      The system of elasticity
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/Stokes/" title="The system of Stokes for fluids" class="md-nav__link">
      The system of Stokes for fluids
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/NavierStokesProjection/" title="A projection Algorithm for the Navier-Stokes equations" class="md-nav__link">
      A projection Algorithm for the Navier-Stokes equations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/NavierStokesNewton/" title="Newton method for the steady Navier-Stokes equations" class="md-nav__link">
      Newton method for the steady Navier-Stokes equations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/ALargeFluidProblem/" title="A large fluid problem" class="md-nav__link">
      A large fluid problem
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/ComplexNumbers/" title="An example with complex numbers" class="md-nav__link">
      An example with complex numbers
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/OptimalControl/" title="Optimal control" class="md-nav__link">
      Optimal control
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/FlowWithShocks/" title="A flow with shocks" class="md-nav__link">
      A flow with shocks
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/HeatEquationOptimization/" title="Time dependent schema optimization for heat equations" class="md-nav__link">
      Time dependent schema optimization for heat equations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/TimeDependentStokes/" title="A transient Stokes solver in matrix form" class="md-nav__link">
      A transient Stokes solver in matrix form
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/WifiPropagation/" title="Wifi Propagation" class="md-nav__link">
      Wifi Propagation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/MatlabOctavePlot/" title="Matlab / Octave Plots" class="md-nav__link">
      Matlab / Octave Plots
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/TODO/" title="TODO" class="md-nav__link">
      TODO
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Examples
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Examples
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../examples/" title="Home" class="md-nav__link">
      Home
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../examples/TODO/" title="TODO" class="md-nav__link">
      TODO
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Models
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Models
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../models/" title="Home" class="md-nav__link">
      Home
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../models/StaticProblems/" title="Static problems" class="md-nav__link">
      Static problems
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../models/Elasticity/" title="Elasticity" class="md-nav__link">
      Elasticity
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../models/NonLinearStaticProblems/" title="Non-linear static problems" class="md-nav__link">
      Non-linear static problems
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../models/EigenValueProblems/" title="Eigenvalue problems" class="md-nav__link">
      Eigenvalue problems
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../models/EvolutionProblems/" title="Evolution problems" class="md-nav__link">
      Evolution problems
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../models/NavierStokesEquations/" title="Navier-Stokes equations" class="md-nav__link">
      Navier-Stokes equations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../models/VariationalInequality/" title="Variational inequality" class="md-nav__link">
      Variational inequality
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../models/DomainDecomposition/" title="Domain decomposition" class="md-nav__link">
      Domain decomposition
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../models/FluidStructureCoupledProblem/" title="Fluid-Structure coupled problem" class="md-nav__link">
      Fluid-Structure coupled problem
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../models/TransmissionProblem/" title="Transmission problem" class="md-nav__link">
      Transmission problem
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../models/FreeBoundaryProblem/" title="Free boundary problem" class="md-nav__link">
      Free boundary problem
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../models/NonLinearElasticity/" title="Non-linear elasticity" class="md-nav__link">
      Non-linear elasticity
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../models/CompressibleNeoHookeanMaterials/" title="Compressible Neo-Hookean materials" class="md-nav__link">
      Compressible Neo-Hookean materials
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../models/WhisperingGalleryModes/" title="Whispering gallery modes" class="md-nav__link">
      Whispering gallery modes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../models/TODO/" title="TODO" class="md-nav__link">
      TODO
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#commands-for-mesh-generation" title="Commands for Mesh Generation" class="md-nav__link">
    Commands for Mesh Generation
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#square" title="Square" class="md-nav__link">
    Square
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#border" title="Border" class="md-nav__link">
    Border
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multi-border" title="Multi-Border" class="md-nav__link">
    Multi-Border
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-structures-and-readwrite-statements-for-a-mesh" title="Data Structures and Read/Write Statements for a Mesh" class="md-nav__link">
    Data Structures and Read/Write Statements for a Mesh
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mesh-connectivity-and-data" title="Mesh Connectivity and data" class="md-nav__link">
    Mesh Connectivity and data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-keyword-triangulate" title="The keyword "triangulate"" class="md-nav__link">
    The keyword "triangulate"
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#boundary-fem-spaces-built-as-empty-meshes" title="Boundary FEM Spaces Built as Empty Meshes" class="md-nav__link">
    Boundary FEM Spaces Built as Empty Meshes
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#remeshing" title="Remeshing" class="md-nav__link">
    Remeshing
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#movemesh" title="Movemesh" class="md-nav__link">
    Movemesh
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#regular-triangulation-htriangle" title="Regular Triangulation: hTriangle" class="md-nav__link">
    Regular Triangulation: hTriangle
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adaptmesh" title="Adaptmesh" class="md-nav__link">
    Adaptmesh
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#trunc" title="Trunc" class="md-nav__link">
    Trunc
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#splitmesh" title="Splitmesh" class="md-nav__link">
    Splitmesh
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#meshing-examples" title="Meshing Examples" class="md-nav__link">
    Meshing Examples
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-change-the-label-of-elements-and-border-elements-of-a-mesh" title="How to change the label of elements and border elements of a mesh" class="md-nav__link">
    How to change the label of elements and border elements of a mesh
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mesh-in-three-dimensions" title="Mesh in three dimensions" class="md-nav__link">
    Mesh in three dimensions
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cube" title="Cube" class="md-nav__link">
    Cube
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#readwrite-statements-for-a-mesh-in-3d" title="Read/Write Statements for a Mesh in 3D" class="md-nav__link">
    Read/Write Statements for a Mesh in 3D
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tetgen-a-tetrahedral-mesh-generator" title="TetGen: A tetrahedral mesh generator" class="md-nav__link">
    TetGen: A tetrahedral mesh generator
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reconstructrefine-a-three-dimensional-mesh-with-tetgen" title="Reconstruct/Refine a three dimensional mesh with TetGen" class="md-nav__link">
    Reconstruct/Refine a three dimensional mesh with TetGen
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#moving-mesh-in-three-dimensions" title="Moving mesh in three dimensions" class="md-nav__link">
    Moving mesh in three dimensions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#layer-mesh" title="Layer mesh" class="md-nav__link">
    Layer mesh
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#meshing-examples_1" title="Meshing examples" class="md-nav__link">
    Meshing examples
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#build-a-3d-mesh-of-a-cube-with-a-balloon" title="Build a 3d mesh of a cube with a balloon" class="md-nav__link">
    Build a 3d mesh of a cube with a balloon
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#medit" title="Medit" class="md-nav__link">
    Medit
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mshmet" title="Mshmet" class="md-nav__link">
    Mshmet
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#freeyams" title="FreeYams" class="md-nav__link">
    FreeYams
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mmg3d" title="mmg3d" class="md-nav__link">
    mmg3d
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a-first-3d-isotrope-mesh-adaptation-process" title="A first 3d isotrope mesh adaptation process" class="md-nav__link">
    A first 3d isotrope mesh adaptation process
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build-a-2d-mesh-from-a-isoline" title="Build a 2d mesh from a isoline" class="md-nav__link">
    Build a 2d mesh from a isoline
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" title="References" class="md-nav__link">
    References
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/FreeFem/FreeFem-doc/edit/master/docs/documentation/MeshGeneration.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                  <h1>Mesh Generation</h1>
                
                <h2 id="commands-for-mesh-generation">Commands for Mesh Generation<a class="headerlink" href="#commands-for-mesh-generation" title="Permanent link">#</a></h2>
<p>Let us begin with the two important keywords: <code class="codehilite"><span class="kt">border</span></code> and <code class="codehilite"><span class="nf">buildmesh</span></code>.</p>
<h3 id="square">Square<a class="headerlink" href="#square" title="Permanent link">#</a></h3>
<p>The command <code class="codehilite"><span class="nf">square</span></code> triangulates the unit square.</p>
<p>The following generates a <span><span class="MathJax_Preview">4 \times 5</span><script type="math/tex">4 \times 5</script></span> grid in the unit square <span><span class="MathJax_Preview">[0,1]^2</span><script type="math/tex">[0,1]^2</script></span>. The labels of the boundaries are shown in <a href="#Fig1">Fig. 1</a>.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">mesh</span> <span class="n">Th</span> <span class="o">=</span> <span class="nf">square</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
</pre></div>
</td></tr></table>

<p><center></p>
<table>
<thead>
<tr>
<th align="center"><a name="Fig1">Fig 1</a>: Boundary labels of the mesh by <code class="codehilite"><span class="nf">square</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span></code></th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="Square" src="../images/MeshGeneration_Square.png" /></td>
</tr>
</tbody>
</table>
<p></center></p>
<p>To construct a <span><span class="MathJax_Preview">n\times m</span><script type="math/tex">n\times m</script></span> grid in the rectangle <span><span class="MathJax_Preview">[x_0,x_1]\times [y_0,y_1]</span><script type="math/tex">[x_0,x_1]\times [y_0,y_1]</script></span>, proceed as follows:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">real</span> <span class="n">x0</span> <span class="o">=</span> <span class="mf">1.2</span><span class="p">;</span>
<span class="kt">real</span> <span class="n">x1</span> <span class="o">=</span> <span class="mf">1.8</span><span class="p">;</span>
<span class="kt">real</span> <span class="nf">y0</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kt">real</span> <span class="nf">y1</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="kt">int</span> <span class="kr">n</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
<span class="kt">real</span> <span class="kr">m</span> <span class="o">=</span> <span class="mi">20</span><span class="p">;</span>
<span class="kt">mesh</span> <span class="n">Th</span> <span class="o">=</span> <span class="nf">square</span><span class="p">(</span><span class="kr">n</span><span class="p">,</span> <span class="kr">m</span><span class="p">,</span> <span class="p">[</span><span class="n">x0</span><span class="o">+</span><span class="p">(</span><span class="n">x1</span><span class="o">-</span><span class="n">x0</span><span class="p">)</span><span class="o">*</span><span class="kr">x</span><span class="p">,</span> <span class="nf">y0</span><span class="o">+</span><span class="p">(</span><span class="nf">y1</span><span class="o">-</span><span class="nf">y0</span><span class="p">)</span><span class="o">*</span><span class="kr">y</span><span class="p">]);</span>
</pre></div>
</td></tr></table>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Adding the named parameter <code class="codehilite"><span class="kp">flags</span><span class="o">=</span><span class="n">icase</span></code> with icase:</p>
<p><ol start="0">
    <li>will produce a mesh where all quads are split with diagonal <span><span class="MathJax_Preview">x-y=constant</span><script type="math/tex">x-y=constant</script></span></li>
    <li>will produce <em>Union Jack flag</em> type of mesh</li>
    <li>will produce a mesh where all quads are split with diagonal <span><span class="MathJax_Preview">x+y=constant</span><script type="math/tex">x+y=constant</script></span></li>
    <li>same as in case 0, except two corners where the triangles are the same as case 2 to avoid having 3 vertices on the boundary</li>
    <li>same as in case 2, except two corners where the triangles are the same as case 0 to avoid having 3 vertices on the boundary</li>
</ol></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">mesh</span> <span class="n">Th</span> <span class="o">=</span> <span class="nf">square</span><span class="p">(</span><span class="kr">n</span><span class="p">,</span> <span class="kr">m</span><span class="p">,</span> <span class="p">[</span><span class="n">x0</span><span class="o">+</span><span class="p">(</span><span class="n">x1</span><span class="o">-</span><span class="n">x0</span><span class="p">)</span><span class="o">*</span><span class="kr">x</span><span class="p">,</span> <span class="nf">y0</span><span class="o">+</span><span class="p">(</span><span class="nf">y1</span><span class="o">-</span><span class="nf">y0</span><span class="p">)</span><span class="o">*</span><span class="kr">y</span><span class="p">],</span> <span class="kp">flags</span><span class="o">=</span><span class="n">icase</span><span class="p">);</span>
</pre></div>
</td></tr></table>

</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Adding the named parameter <code class="codehilite"><span class="kr">label</span><span class="o">=</span><span class="n">labs</span></code> will change the 4 default label numbers to <code class="codehilite"><span class="n">labs</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span></code>, for example <code class="codehilite"><span class="kt">int</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">labs</span><span class="o">=</span><span class="p">[</span><span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">14</span><span class="p">]</span></code>, and adding the named parameter <code class="codehilite"><span class="kr">region</span><span class="o">=</span><span class="mi">10</span></code> will change the region number to <span><span class="MathJax_Preview">10</span><script type="math/tex">10</script></span>, for instance (v 3.8).</p>
<p>To see all of these flags at work, check <a href="../scripts/MeshGeneration/SquareMesh.edp">SquareMesh.edp</a>:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">){</span>
    <span class="kt">int</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">labs</span> <span class="o">=</span> <span class="p">[</span><span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">14</span><span class="p">];</span>
    <span class="kt">mesh</span> <span class="n">Th</span> <span class="o">=</span> <span class="nf">square</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="kp">flags</span><span class="o">=</span><span class="n">i</span><span class="p">,</span> <span class="kr">label</span><span class="o">=</span><span class="n">labs</span><span class="p">,</span> <span class="kr">region</span><span class="o">=</span><span class="mi">10</span><span class="p">);</span>
    <span class="nf">plot</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="kp">wait</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="kp">cmm</span><span class="o">=</span><span class="s">&quot;square flags = &quot;</span><span class="o">+</span><span class="n">i</span> <span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

</div>
<h3 id="border">Border<a class="headerlink" href="#border" title="Permanent link">#</a></h3>
<p>Boundaries are defined piecewise by parametrized curves. The pieces can only intersect at their endpoints, but it is possible to join more than two endpoints. This can be used to structure the mesh if an area touches a border and create new regions by dividing larger ones:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">int</span> <span class="n">upper</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">others</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">inner</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>

<span class="kt">border</span> <span class="nf">C01</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="kr">y</span><span class="o">=-</span><span class="mi">1</span><span class="o">+</span><span class="kp">t</span><span class="p">;</span> <span class="kr">label</span><span class="o">=</span><span class="n">upper</span><span class="p">;}</span>
<span class="kt">border</span> <span class="nf">C02</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="mf">1.5</span><span class="o">-</span><span class="mf">1.5</span><span class="o">*</span><span class="kp">t</span><span class="p">;</span> <span class="kr">y</span><span class="o">=-</span><span class="mi">1</span><span class="p">;</span> <span class="kr">label</span><span class="o">=</span><span class="n">upper</span><span class="p">;}</span>
<span class="kt">border</span> <span class="nf">C03</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="mf">1.5</span><span class="p">;</span> <span class="kr">y</span><span class="o">=-</span><span class="kp">t</span><span class="p">;</span> <span class="kr">label</span><span class="o">=</span><span class="n">upper</span><span class="p">;}</span>
<span class="kt">border</span> <span class="nf">C04</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="mi">1</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="kp">t</span><span class="p">;</span> <span class="kr">y</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="kr">label</span><span class="o">=</span><span class="n">others</span><span class="p">;}</span>
<span class="kt">border</span> <span class="nf">C05</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="mf">0.5</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="kp">t</span><span class="p">;</span> <span class="kr">y</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="kr">label</span><span class="o">=</span><span class="n">others</span><span class="p">;}</span>
<span class="kt">border</span> <span class="nf">C06</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="mf">0.5</span><span class="o">*</span><span class="kp">t</span><span class="p">;</span> <span class="kr">y</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="kr">label</span><span class="o">=</span><span class="n">others</span><span class="p">;}</span>
<span class="kt">border</span> <span class="nf">C11</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="mf">0.5</span><span class="p">;</span> <span class="kr">y</span><span class="o">=-</span><span class="mf">0.5</span><span class="o">*</span><span class="kp">t</span><span class="p">;</span> <span class="kr">label</span><span class="o">=</span><span class="n">inner</span><span class="p">;}</span>
<span class="kt">border</span> <span class="nf">C12</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="mf">0.5</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="kp">t</span><span class="p">;</span> <span class="kr">y</span><span class="o">=-</span><span class="mf">0.5</span><span class="p">;</span> <span class="kr">label</span><span class="o">=</span><span class="n">inner</span><span class="p">;}</span>
<span class="kt">border</span> <span class="nf">C13</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="kr">y</span><span class="o">=-</span><span class="mf">0.5</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="kp">t</span><span class="p">;</span> <span class="kr">label</span><span class="o">=</span><span class="n">inner</span><span class="p">;}</span>

<span class="kt">int</span> <span class="kr">n</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">C01</span><span class="p">(</span><span class="o">-</span><span class="kr">n</span><span class="p">)</span> <span class="o">+</span> <span class="n">C02</span><span class="p">(</span><span class="o">-</span><span class="kr">n</span><span class="p">)</span> <span class="o">+</span> <span class="n">C03</span><span class="p">(</span><span class="o">-</span><span class="kr">n</span><span class="p">)</span> <span class="o">+</span> <span class="n">C04</span><span class="p">(</span><span class="o">-</span><span class="kr">n</span><span class="p">)</span> <span class="o">+</span> <span class="n">C05</span><span class="p">(</span><span class="o">-</span><span class="kr">n</span><span class="p">)</span>
    <span class="o">+</span> <span class="n">C06</span><span class="p">(</span><span class="o">-</span><span class="kr">n</span><span class="p">)</span> <span class="o">+</span> <span class="n">C11</span><span class="p">(</span><span class="kr">n</span><span class="p">)</span> <span class="o">+</span> <span class="n">C12</span><span class="p">(</span><span class="kr">n</span><span class="p">)</span> <span class="o">+</span> <span class="n">C13</span><span class="p">(</span><span class="kr">n</span><span class="p">),</span> <span class="kp">wait</span><span class="o">=</span><span class="kr">true</span><span class="p">);</span>

<span class="kt">mesh</span> <span class="n">Th</span> <span class="o">=</span> <span class="nf">buildmesh</span><span class="p">(</span><span class="n">C01</span><span class="p">(</span><span class="o">-</span><span class="kr">n</span><span class="p">)</span> <span class="o">+</span> <span class="n">C02</span><span class="p">(</span><span class="o">-</span><span class="kr">n</span><span class="p">)</span> <span class="o">+</span> <span class="n">C03</span><span class="p">(</span><span class="o">-</span><span class="kr">n</span><span class="p">)</span> <span class="o">+</span> <span class="n">C04</span><span class="p">(</span><span class="o">-</span><span class="kr">n</span><span class="p">)</span> <span class="o">+</span> <span class="n">C05</span><span class="p">(</span><span class="o">-</span><span class="kr">n</span><span class="p">)</span>
    <span class="o">+</span> <span class="n">C06</span><span class="p">(</span><span class="o">-</span><span class="kr">n</span><span class="p">)</span> <span class="o">+</span> <span class="n">C11</span><span class="p">(</span><span class="kr">n</span><span class="p">)</span> <span class="o">+</span> <span class="n">C12</span><span class="p">(</span><span class="kr">n</span><span class="p">)</span> <span class="o">+</span> <span class="n">C13</span><span class="p">(</span><span class="kr">n</span><span class="p">));</span>

<span class="nf">plot</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="kp">wait</span><span class="o">=</span><span class="kr">true</span><span class="p">);</span>

<span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Part 1 has region number &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">Th</span><span class="p">(</span><span class="mf">0.75</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.25</span><span class="p">).</span><span class="kr">region</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
<span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Part 2 has redion number &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">Th</span><span class="p">(</span><span class="mf">0.25</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.25</span><span class="p">).</span><span class="kr">region</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p>Borders and mesh are respectively shown in <a href="#Fig2">Fig. 2</a> and <a href="#Fig3">Fig. 3</a>.</p>
<table>
<thead>
<tr>
<th align="center"><a name="Fig2">Fig. 2</a>: Multiple border ends intersect</th>
<th align="center"><a name="Fig3">Fig. 3</a>: Generated mesh</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="Multiple border ends intersect" src="../images/MeshGeneration_Border1.png" /></td>
<td align="center"><img alt="Generated Mesh" src="../images/MeshGeneration_Border2.png" /></td>
</tr>
</tbody>
</table>
<p>Triangulation keywords assume that the domain is defined as being on the <em>left</em> (resp <em>right</em>) of its oriented parameterized boundary</p>
<div>
<div class="MathJax_Preview">
\Gamma_j = \{(x,y)\left|\; x=\varphi_x(t),\, y=\varphi_y(t),\, a_j\le t\le b_j\right.\}
</div>
<script type="math/tex; mode=display">
\Gamma_j = \{(x,y)\left|\; x=\varphi_x(t),\, y=\varphi_y(t),\, a_j\le t\le b_j\right.\}
</script>
</div>
<p>To check the orientation plot <span><span class="MathJax_Preview">t\mapsto (\varphi_x(t),\varphi_y(t)),\, t_0\le t\le t_1</span><script type="math/tex">t\mapsto (\varphi_x(t),\varphi_y(t)),\, t_0\le t\le t_1</script></span>. If it is as in <a href="#Fig4">Fig. 4</a>, then the domain lies on the shaded area, otherwise it lies on the opposite side.</p>
<table>
<thead>
<tr>
<th align="center"><a name="Fig4">Fig. 4</a>: Orientation of the boundary defined by <span><span class="MathJax_Preview">(\phi_x(t),\phi_y(t))</span><script type="math/tex">(\phi_x(t),\phi_y(t))</script></span></th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="Border" src="../images/MeshGeneration_Border3.png" /></td>
</tr>
</tbody>
</table>
<p>The general expression to define a triangulation with <code class="codehilite"><span class="nf">buildmesh</span></code> is</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">mesh</span> <span class="n">Mesh_Name</span> <span class="o">=</span> <span class="nf">buildmesh</span><span class="p">(</span><span class="n">Gamma1</span><span class="p">(</span><span class="n">m1</span><span class="p">)</span><span class="o">+</span><span class="p">...</span><span class="o">+</span><span class="n">GammaJ</span><span class="p">(</span><span class="n">mj</span><span class="p">),</span> <span class="n">OptionalParameter</span><span class="p">);</span>
</pre></div>
</td></tr></table>

<p>where <span><span class="MathJax_Preview">m_j</span><script type="math/tex">m_j</script></span> are positive or negative numbers to indicate how many vertices should be on <span><span class="MathJax_Preview">\Gamma_j,\, \Gamma=\cup_{j=1}^J \Gamma_J</span><script type="math/tex">\Gamma_j,\, \Gamma=\cup_{j=1}^J \Gamma_J</script></span>, and the optional parameter (see also <a href="/reference/Functions/#buildmesh">References</a>), separated with a comma, can be:</p>
<ul>
<li><code class="codehilite"><span class="kp">nbvx</span><span class="o">=</span> <span class="kt">int</span></code>, to set the maximum number of vertices in the mesh.</li>
<li><code class="codehilite"><span class="kp">fixedborder</span><span class="o">=</span> <span class="kt">bool</span></code>, to say if the mesh generator can change the boundary mesh or not (by default the boundary mesh can change; beware that with periodic boundary conditions (see. <a href="../FiniteElement">Finite Element</a>), it can be dangerous.</li>
</ul>
<p>The orientation of boundaries can be changed by changing the sign of <span><span class="MathJax_Preview">m_j</span><script type="math/tex">m_j</script></span>.</p>
<p>The following example shows how to change the orientation. The example generates the unit disk with a small circular hole, and assigns "1" to the unit disk ("2" to the circle inside). The boundary label <strong>must be non-zero</strong>, but it can also be omitted.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">border</span> <span class="nf">a</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="kr">pi</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="nf">cos</span><span class="p">(</span><span class="kp">t</span><span class="p">);</span> <span class="kr">y</span><span class="o">=</span><span class="nf">sin</span><span class="p">(</span><span class="kp">t</span><span class="p">);</span> <span class="kr">label</span><span class="o">=</span><span class="mi">1</span><span class="p">;}</span>
<span class="kt">border</span> <span class="nf">b</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="kr">pi</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="mf">0.3</span><span class="o">+</span><span class="mf">0.3</span><span class="o">*</span><span class="nf">cos</span><span class="p">(</span><span class="kp">t</span><span class="p">);</span> <span class="kr">y</span><span class="o">=</span><span class="mf">0.3</span><span class="o">*</span><span class="nf">sin</span><span class="p">(</span><span class="kp">t</span><span class="p">);</span> <span class="kr">label</span><span class="o">=</span><span class="mi">2</span><span class="p">;}</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">a</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="o">+</span> <span class="n">b</span><span class="p">(</span><span class="mi">30</span><span class="p">));</span> <span class="c1">//to see a plot of the border mesh</span>
<span class="kt">mesh</span> <span class="n">Thwithouthole</span> <span class="o">=</span> <span class="nf">buildmesh</span><span class="p">(</span><span class="n">a</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="o">+</span> <span class="n">b</span><span class="p">(</span><span class="mi">30</span><span class="p">));</span>
<span class="kt">mesh</span> <span class="n">Thwithhole</span> <span class="o">=</span> <span class="nf">buildmesh</span><span class="p">(</span><span class="n">a</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="o">+</span> <span class="n">b</span><span class="p">(</span><span class="o">-</span><span class="mi">30</span><span class="p">));</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">Thwithouthole</span><span class="p">,</span> <span class="kp">ps</span><span class="o">=</span><span class="s">&quot;Thwithouthole.eps&quot;</span><span class="p">);</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">Thwithhole</span><span class="p">,</span> <span class="kp">ps</span><span class="o">=</span><span class="s">&quot;Thwithhole.eps&quot;</span><span class="p">);</span>
</pre></div>
</td></tr></table>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Notice that the orientation is changed by <code class="codehilite"><span class="n">b</span><span class="p">(</span><span class="o">-</span><span class="mi">30</span><span class="p">)</span></code> in the 5th line. In the 7th line, <code class="codehilite"><span class="kp">ps</span><span class="o">=</span><span class="s">&quot;fileName&quot;</span></code> is used to generate a postscript file with identification shown on the figure.</p>
</div>
<table>
<thead>
<tr>
<th align="center"><a name="Fig5">Fig. 5</a>: Mesh without hole</th>
<th align="center"><a name="Fig6">Fig. 6</a>: Mesh with hole</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="Mesh without hole" src="../images/MeshGeneration_Border4.png" /></td>
<td align="center"><img alt="Mesh with hole" src="../images/MeshGeneration_Border5.png" /></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Borders are evaluated only at the time <code class="codehilite"><span class="nf">plot</span></code> or <code class="codehilite"><span class="nf">buildmesh</span></code> is called so the global variables are defined at this time. In this case, since <span><span class="MathJax_Preview">r</span><script type="math/tex">r</script></span> is changed between the two border calls, the following code will not work because the first border will be computed with r=0.3:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">real</span> <span class="n">r</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
<span class="kt">border</span> <span class="nf">a</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="kr">pi</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="n">r</span><span class="o">*</span><span class="nf">cos</span><span class="p">(</span><span class="kp">t</span><span class="p">);</span> <span class="kr">y</span><span class="o">=</span><span class="n">r</span><span class="o">*</span><span class="nf">sin</span><span class="p">(</span><span class="kp">t</span><span class="p">);</span> <span class="kr">label</span><span class="o">=</span><span class="mi">1</span><span class="p">;}</span>
<span class="n">r</span><span class="o">=</span><span class="mf">0.3</span><span class="p">;</span>
<span class="kt">border</span> <span class="nf">b</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="kr">pi</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="n">r</span><span class="o">*</span><span class="nf">cos</span><span class="p">(</span><span class="kp">t</span><span class="p">);</span> <span class="kr">y</span><span class="o">=</span><span class="n">r</span><span class="o">*</span><span class="nf">sin</span><span class="p">(</span><span class="kp">t</span><span class="p">);</span> <span class="kr">label</span><span class="o">=</span><span class="mi">1</span><span class="p">;}</span>
<span class="kt">mesh</span> <span class="n">Thwithhole</span> <span class="o">=</span> <span class="nf">buildmesh</span><span class="p">(</span><span class="n">a</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="o">+</span> <span class="n">b</span><span class="p">(</span><span class="o">-</span><span class="mi">30</span><span class="p">));</span> <span class="c1">// bug (a trap) because</span>
                                             <span class="c1">// the two circles have the same radius = $0.3$</span>
</pre></div>
</td></tr></table>

</div>
<h3 id="multi-border">Multi-Border<a class="headerlink" href="#multi-border" title="Permanent link">#</a></h3>
<p>Sometimes it can be useful to make an array of the border, but unfortunately it is incompatible with the FreeFem++ syntax. To bypass this problem, if the number of segments of the discretization <span><span class="MathJax_Preview">n</span><script type="math/tex">n</script></span> is an array, we make an implicit loop on all of the values of the array, and the index variable <span><span class="MathJax_Preview">i</span><script type="math/tex">i</script></span> of the loop is defined after the parameter definition, like in <code class="codehilite"><span class="kt">border</span> <span class="n">a</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="kr">pi</span><span class="p">;</span> <span class="n">i</span><span class="p">)</span></code> ...</p>
<p>A first very small example:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">border</span> <span class="n">a</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="kr">pi</span><span class="p">;</span> <span class="n">i</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="nf">cos</span><span class="p">(</span><span class="kp">t</span><span class="p">);</span> <span class="kr">y</span><span class="o">=</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="nf">sin</span><span class="p">(</span><span class="kp">t</span><span class="p">);</span> <span class="kr">label</span><span class="o">=</span><span class="mi">1</span><span class="p">;}</span>
<span class="kt">int</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">nn</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">];</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">a</span><span class="p">(</span><span class="n">nn</span><span class="p">));</span> <span class="c1">//plot 3 circles with 10, 20, 30 points</span>
</pre></div>
</td></tr></table>

<p>And a more complex example to define a square with small circles:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">xx</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
          <span class="n">yy</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">];</span>
<span class="c1">//radius, center of the 4 circles</span>
<span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">RC</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">],</span>
          <span class="n">XC</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">],</span>
          <span class="n">YC</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">];</span>
<span class="kt">int</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">NC</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="o">-</span><span class="mi">11</span><span class="p">,</span><span class="o">-</span><span class="mi">12</span><span class="p">,</span><span class="mi">13</span><span class="p">];</span> <span class="c1">//list number of $\pm$ segments of the 4 circles borders</span>

<span class="kt">border</span> <span class="kp">bb</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// i is the index variable of the multi border loop</span>
    <span class="kt">int</span> <span class="n">ii</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">4</span><span class="p">;</span>
    <span class="kt">real</span> <span class="n">t1</span> <span class="o">=</span> <span class="mi">1</span><span class="o">-</span><span class="kp">t</span><span class="p">;</span>
    <span class="kr">x</span> <span class="o">=</span> <span class="n">xx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">t1</span> <span class="o">+</span> <span class="n">xx</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">*</span><span class="kp">t</span><span class="p">;</span>
    <span class="kr">y</span> <span class="o">=</span> <span class="n">yy</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">t1</span> <span class="o">+</span> <span class="n">yy</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">*</span><span class="kp">t</span><span class="p">;</span>
    <span class="kr">label</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">border</span> <span class="n">cc</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="kr">pi</span><span class="p">;</span> <span class="n">i</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kr">x</span> <span class="o">=</span> <span class="n">RC</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="nf">cos</span><span class="p">(</span><span class="kp">t</span><span class="p">)</span> <span class="o">+</span> <span class="n">XC</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
    <span class="kr">y</span> <span class="o">=</span> <span class="n">RC</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="nf">sin</span><span class="p">(</span><span class="kp">t</span><span class="p">)</span> <span class="o">+</span> <span class="n">YC</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
    <span class="kr">label</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">int</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">nn</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">];</span> <span class="c1">//4 border, with 4, 4, 5, 7 segment respectively</span>
<span class="nf">plot</span><span class="p">(</span><span class="kp">bb</span><span class="p">(</span><span class="n">nn</span><span class="p">),</span> <span class="n">cc</span><span class="p">(</span><span class="n">NC</span><span class="p">),</span> <span class="kp">wait</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
<span class="kt">mesh</span> <span class="n">th</span> <span class="o">=</span> <span class="nf">buildmesh</span><span class="p">(</span><span class="kp">bb</span><span class="p">(</span><span class="n">nn</span><span class="p">)</span> <span class="o">+</span> <span class="n">cc</span><span class="p">(</span><span class="n">NC</span><span class="p">));</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">th</span><span class="p">,</span> <span class="kp">wait</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
</pre></div>
</td></tr></table>

<h3 id="data-structures-and-readwrite-statements-for-a-mesh">Data Structures and Read/Write Statements for a Mesh<a class="headerlink" href="#data-structures-and-readwrite-statements-for-a-mesh" title="Permanent link">#</a></h3>
<p>Users who want to read a triangulation made elsewhere should see the structure of the file generated below:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">border</span> <span class="nf">C</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="kr">pi</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="nf">cos</span><span class="p">(</span><span class="kp">t</span><span class="p">);</span> <span class="kr">y</span><span class="o">=</span><span class="nf">sin</span><span class="p">(</span><span class="kp">t</span><span class="p">);}</span>
<span class="kt">mesh</span> <span class="n">Th</span> <span class="o">=</span> <span class="nf">buildmesh</span><span class="p">(</span><span class="n">C</span><span class="p">(</span><span class="mi">10</span><span class="p">));</span>
<span class="nf">savemesh</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="s">&quot;mesh.msh&quot;</span><span class="p">);</span>
</pre></div>
</td></tr></table>

<p>The mesh is shown on <a href="#Fig7">Fig. 7</a>.</p>
<p>The information about <code class="codehilite"><span class="n">Th</span></code> are saved in the file <code class="codehilite"><span class="kt">mesh</span><span class="p">.</span><span class="n">msh</span></code> whose structure is shown on <a href="#Tab1">Tab. 1</a>.</p>
<p>There, <span><span class="MathJax_Preview">n_v</span><script type="math/tex">n_v</script></span> denotes the number of vertices, <span><span class="MathJax_Preview">n_t</span><script type="math/tex">n_t</script></span> the number of triangles and <span><span class="MathJax_Preview">n_s</span><script type="math/tex">n_s</script></span> the number of edges on boundary.</p>
<p>For each vertex <span><span class="MathJax_Preview">q^i,\, i=1,\cdots,n_v</span><script type="math/tex">q^i,\, i=1,\cdots,n_v</script></span>, denoted by <span><span class="MathJax_Preview">(q^i_x,q^i_y)</span><script type="math/tex">(q^i_x,q^i_y)</script></span> the <span><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span>-coordinate and <span><span class="MathJax_Preview">y</span><script type="math/tex">y</script></span>-coordinate.</p>
<p>Each triangle <span><span class="MathJax_Preview">T_k, k=1,\cdots,n_t</span><script type="math/tex">T_k, k=1,\cdots,n_t</script></span> has three vertices <span><span class="MathJax_Preview">q^{k_1},\, q^{k_2},\,q^{k_3}</span><script type="math/tex">q^{k_1},\, q^{k_2},\,q^{k_3}</script></span> that are oriented counter-clockwise.</p>
<p>The boundary consists of 10 lines <span><span class="MathJax_Preview">L_i,\, i=1,\cdots,10</span><script type="math/tex">L_i,\, i=1,\cdots,10</script></span> whose end points are <span><span class="MathJax_Preview">q^{i_1},\, q^{i_2}</span><script type="math/tex">q^{i_1},\, q^{i_2}</script></span>.</p>
<table>
<thead>
<tr>
<th align="left"><a name="Fig7">Fig. 7</a>: Mesh by <code class="codehilite"><span class="nf">buildmesh</span><span class="p">(</span><span class="n">C</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span></code></th>
<th align="left"></th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><img alt="Mesh Sample" src="../images/MeshGeneration_Data.png" /></td>
<td align="left">In the left figure, we have the following.<br><span><span class="MathJax_Preview">n_v=14, n_t=16, n_s=10</span><script type="math/tex">n_v=14, n_t=16, n_s=10</script></span><br><span><span class="MathJax_Preview">q^1=(-0.309016994375, 0.951056516295)</span><script type="math/tex">q^1=(-0.309016994375, 0.951056516295)</script></span><br><span><span class="MathJax_Preview">\vdots\qquad \vdots\qquad \vdots</span><script type="math/tex">\vdots\qquad \vdots\qquad \vdots</script></span><br><span><span class="MathJax_Preview">q^{14}=(-0.309016994375, -0.951056516295)</span><script type="math/tex">q^{14}=(-0.309016994375, -0.951056516295)</script></span><br>The vertices of <span><span class="MathJax_Preview">T_1</span><script type="math/tex">T_1</script></span> are <span><span class="MathJax_Preview">q^9, q^{12},\, q^{10}</span><script type="math/tex">q^9, q^{12},\, q^{10}</script></span>.<br><span><span class="MathJax_Preview">\vdots\qquad \vdots\qquad \vdots</span><script type="math/tex">\vdots\qquad \vdots\qquad \vdots</script></span><br>The vertices of <span><span class="MathJax_Preview">T_{16}</span><script type="math/tex">T_{16}</script></span> are <span><span class="MathJax_Preview">q^9, q^{10}, q^{6}</span><script type="math/tex">q^9, q^{10}, q^{6}</script></span>.<br>The edge of the 1st side <span><span class="MathJax_Preview">L_1</span><script type="math/tex">L_1</script></span> are <span><span class="MathJax_Preview">q^6, q^5</span><script type="math/tex">q^6, q^5</script></span>.<br><span><span class="MathJax_Preview">\vdots\qquad \vdots\qquad \vdots</span><script type="math/tex">\vdots\qquad \vdots\qquad \vdots</script></span><br>The edge of the 10th side <span><span class="MathJax_Preview">L_{10}</span><script type="math/tex">L_{10}</script></span> are <span><span class="MathJax_Preview">q^{10}, q^6</span><script type="math/tex">q^{10}, q^6</script></span>.</td>
</tr>
</tbody>
</table>
<p><center></p>
<table>
<thead>
<tr>
<th align="left"><a name="Tab1">Tab. 1</a>: The structure of <code class="codehilite"><span class="n">mesh_sample</span><span class="p">.</span><span class="n">msh</span></code></th>
<th align="left"></th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">Content of the file</td>
<td align="left">Explanation</td>
</tr>
<tr>
<td align="left">14 16 10<br>-0.309016994375 0.951056516295 1<br>0.309016994375 0.951056516295 1<br><span><span class="MathJax_Preview">\cdots</span><script type="math/tex">\cdots</script></span> <span><span class="MathJax_Preview">\cdots</span><script type="math/tex">\cdots</script></span> <span><span class="MathJax_Preview">\vdots</span><script type="math/tex">\vdots</script></span><br>-0.309016994375 -0.951056516295 1</td>
<td align="left"><span><span class="MathJax_Preview">n_v\qquad n_t\qquad n_e</span><script type="math/tex">n_v\qquad n_t\qquad n_e</script></span><br><span><span class="MathJax_Preview">q^1_x\qquad q^1_y\qquad</span><script type="math/tex">q^1_x\qquad q^1_y\qquad</script></span> boundary label=1<br><span><span class="MathJax_Preview">q^2_x\qquad q^2_y\qquad</span><script type="math/tex">q^2_x\qquad q^2_y\qquad</script></span> boundary label=1<br><br><span><span class="MathJax_Preview">q^{14}_x\qquad q^{14}_y\quad</span><script type="math/tex">q^{14}_x\qquad q^{14}_y\quad</script></span> boundary label=1</td>
</tr>
<tr>
<td align="left">9 12 10 0<br>5 9 6 0<br><span><span class="MathJax_Preview">\cdots</span><script type="math/tex">\cdots</script></span><br>9 10 6 0</td>
<td align="left"><span><span class="MathJax_Preview">1_1\qquad 1_2\qquad 1_3\qquad</span><script type="math/tex">1_1\qquad 1_2\qquad 1_3\qquad</script></span> region label=0<br><span><span class="MathJax_Preview">2_1\qquad 2_2\qquad 2_3\qquad</span><script type="math/tex">2_1\qquad 2_2\qquad 2_3\qquad</script></span> region label=0<br><br><span><span class="MathJax_Preview">16_1\quad 16_2\qquad 16_3\qquad</span><script type="math/tex">16_1\quad 16_2\qquad 16_3\qquad</script></span> region label=0</td>
</tr>
<tr>
<td align="left">6 5 1<br>5 2 1<br><span><span class="MathJax_Preview">\cdots</span><script type="math/tex">\cdots</script></span><br>10 6 1</td>
<td align="left"><span><span class="MathJax_Preview">1_1\qquad 1_2\qquad</span><script type="math/tex">1_1\qquad 1_2\qquad</script></span> boundary label=1<br><span><span class="MathJax_Preview">2_1\qquad 2_2\qquad</span><script type="math/tex">2_1\qquad 2_2\qquad</script></span> boundary label=1<br><br><span><span class="MathJax_Preview">10_1\quad 10_2\qquad</span><script type="math/tex">10_1\quad 10_2\qquad</script></span> boundary label=1</td>
</tr>
</tbody>
</table>
<p></center></p>
<p>In FreeFem++ there are many mesh file formats available for communication with other tools such as <code>emc2</code>, <code>modulef</code>, ... (see <a href="../Developers/#mesh-format">Mesh format chapter</a> <span><span class="MathJax_Preview">\codered</span><script type="math/tex">\codered</script></span>). The extension of a file implies its format. More details can be found on the file format .msh in the article by F. Hecht "bamg : a bidimensional anisotropic mesh generator" <a href="#refHecht19982">Hecht1998</a>.</p>
<p>A mesh file can be read into FreeFem++ except that the names of the borders are lost and only their reference numbers are kept. So these borders have to be referenced by the number which corresponds to their order of appearance in the program, unless this number is overwritten by the keyword <code class="codehilite"><span class="kr">label</span></code>. Here are some examples:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">border</span> <span class="nf">floor</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="kp">t</span><span class="p">;</span> <span class="kr">y</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="kr">label</span><span class="o">=</span><span class="mi">1</span><span class="p">;}</span>
<span class="kt">border</span> <span class="nf">right</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="kr">y</span><span class="o">=</span><span class="kp">t</span><span class="p">;</span> <span class="kr">label</span><span class="o">=</span><span class="mi">5</span><span class="p">;}</span>
<span class="kt">border</span> <span class="nf">ceiling</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="kp">t</span><span class="p">;</span> <span class="kr">y</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="kr">label</span><span class="o">=</span><span class="mi">5</span><span class="p">;}</span>
<span class="kt">border</span> <span class="nf">left</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="kr">y</span><span class="o">=</span><span class="kp">t</span><span class="p">;</span> <span class="kr">label</span><span class="o">=</span><span class="mi">5</span><span class="p">;}</span>

<span class="kt">int</span> <span class="kr">n</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
<span class="kt">mesh</span> <span class="n">th</span> <span class="o">=</span> <span class="nf">buildmesh</span><span class="p">(</span><span class="nf">floor</span><span class="p">(</span><span class="kr">n</span><span class="p">)</span> <span class="o">+</span> <span class="n">right</span><span class="p">(</span><span class="kr">n</span><span class="p">)</span> <span class="o">+</span> <span class="n">ceiling</span><span class="p">(</span><span class="kr">n</span><span class="p">)</span> <span class="o">+</span> <span class="n">left</span><span class="p">(</span><span class="kr">n</span><span class="p">));</span>
<span class="nf">savemesh</span><span class="p">(</span><span class="n">th</span><span class="p">,</span> <span class="s">&quot;toto.am_fmt&quot;</span><span class="p">);</span> <span class="c1">//&quot;formatted Marrocco&quot; format</span>
<span class="nf">savemesh</span><span class="p">(</span><span class="n">th</span><span class="p">,</span> <span class="s">&quot;toto.Th&quot;</span><span class="p">);</span> <span class="c1">//&quot;bamg&quot;-type mesh</span>
<span class="nf">savemesh</span><span class="p">(</span><span class="n">th</span><span class="p">,</span> <span class="s">&quot;toto.msh&quot;</span><span class="p">);</span> <span class="c1">//freefem format</span>
<span class="nf">savemesh</span><span class="p">(</span><span class="n">th</span><span class="p">,</span> <span class="s">&quot;toto.nopo&quot;</span><span class="p">);</span> <span class="c1">//modulef format</span>
<span class="kt">mesh</span> <span class="n">th2</span> <span class="o">=</span> <span class="nf">readmesh</span><span class="p">(</span><span class="s">&quot;toto.msh&quot;</span><span class="p">);</span> <span class="c1">//read the mesh</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1">// Parameters</span>
<span class="kt">int</span> <span class="kr">n</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>

<span class="c1">// Mesh</span>
<span class="kt">border</span> <span class="nf">floor</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="kp">t</span><span class="p">;</span> <span class="kr">y</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="kr">label</span><span class="o">=</span><span class="mi">1</span><span class="p">;};</span>
<span class="kt">border</span> <span class="nf">right</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="kr">y</span><span class="o">=</span><span class="kp">t</span><span class="p">;</span> <span class="kr">label</span><span class="o">=</span><span class="mi">5</span><span class="p">;};</span>
<span class="kt">border</span> <span class="nf">ceiling</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="kp">t</span><span class="p">;</span> <span class="kr">y</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="kr">label</span><span class="o">=</span><span class="mi">5</span><span class="p">;};</span>
<span class="kt">border</span> <span class="nf">left</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="kr">y</span><span class="o">=</span><span class="kp">t</span><span class="p">;</span> <span class="kr">label</span><span class="o">=</span><span class="mi">5</span><span class="p">;};</span>

<span class="kt">mesh</span> <span class="n">th</span> <span class="o">=</span> <span class="nf">buildmesh</span><span class="p">(</span><span class="nf">floor</span><span class="p">(</span><span class="kr">n</span><span class="p">)</span> <span class="o">+</span> <span class="n">right</span><span class="p">(</span><span class="kr">n</span><span class="p">)</span> <span class="o">+</span> <span class="n">ceiling</span><span class="p">(</span><span class="kr">n</span><span class="p">)</span> <span class="o">+</span> <span class="n">left</span><span class="p">(</span><span class="kr">n</span><span class="p">));</span>

<span class="c1">//save mesh in different formats</span>
<span class="nf">savemesh</span><span class="p">(</span><span class="n">th</span><span class="p">,</span> <span class="s">&quot;toto.am_fmt&quot;</span><span class="p">);</span> <span class="c1">// format &quot;formated Marrocco&quot;</span>
<span class="nf">savemesh</span><span class="p">(</span><span class="n">th</span><span class="p">,</span> <span class="s">&quot;toto.Th&quot;</span><span class="p">);</span> <span class="c1">// format database db mesh &quot;bamg&quot;</span>
<span class="nf">savemesh</span><span class="p">(</span><span class="n">th</span><span class="p">,</span> <span class="s">&quot;toto.msh&quot;</span><span class="p">);</span> <span class="c1">// format freefem</span>
<span class="nf">savemesh</span><span class="p">(</span><span class="n">th</span><span class="p">,</span> <span class="s">&quot;toto.nopo&quot;</span><span class="p">);</span> <span class="c1">// modulef format</span>

<span class="c1">// Fespace</span>
<span class="kt">fespace</span> <span class="nf">femp1</span><span class="p">(</span><span class="n">th</span><span class="p">,</span> <span class="nc">P1</span><span class="p">);</span>
<span class="n">femp1</span> <span class="n">f</span> <span class="o">=</span> <span class="nf">sin</span><span class="p">(</span><span class="kr">x</span><span class="p">)</span><span class="o">*</span><span class="nf">cos</span><span class="p">(</span><span class="kr">y</span><span class="p">);</span>
<span class="n">femp1</span> <span class="n">g</span><span class="p">;</span>

<span class="c1">//save the fespace function in a file</span>
<span class="p">{</span>
    <span class="kt">ofstream</span> <span class="kp">file</span><span class="p">(</span><span class="s">&quot;f.txt&quot;</span><span class="p">);</span>
    <span class="kp">file</span> <span class="o">&lt;&lt;</span> <span class="n">f</span><span class="p">[]</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
<span class="p">}</span> <span class="c1">//the file is automatically closed at the end of the block</span>
<span class="c1">//read a file and put it in a fespace function</span>
<span class="p">{</span>
    <span class="kt">ifstream</span> <span class="kp">file</span><span class="p">(</span><span class="s">&quot;f.txt&quot;</span><span class="p">);</span>
    <span class="kp">file</span> <span class="o">&gt;&gt;</span> <span class="n">g</span><span class="p">[]</span> <span class="p">;</span>
<span class="p">}</span><span class="c1">//the file is equally automatically closed</span>

<span class="c1">// Plot</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">g</span><span class="p">);</span>

<span class="c1">// Mesh 2</span>
<span class="c1">//read the mesh for freefem format saved mesh</span>
<span class="kt">mesh</span> <span class="n">th2</span> <span class="o">=</span> <span class="nf">readmesh</span><span class="p">(</span><span class="s">&quot;toto.msh&quot;</span><span class="p">);</span>

<span class="c1">// Fespace 2</span>
<span class="kt">fespace</span> <span class="nf">Vh2</span><span class="p">(</span><span class="n">th2</span><span class="p">,</span> <span class="nc">P1</span><span class="p">);</span>
<span class="n">Vh2</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">;</span>

<span class="c1">// Problem</span>
<span class="c1">//solve:</span>
<span class="c1">//  $u + \Delta u = g$ in $\Omega $</span>
<span class="c1">//  $u=0$ on $\Gamma_1$</span>
<span class="c1">//  $\frac{\p u }{\p n} = g$ on $\Gamma_2$</span>
<span class="kt">solve</span> <span class="nf">Problem</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
    <span class="o">=</span> <span class="nf">int2d</span><span class="p">(</span><span class="n">th2</span><span class="p">)(</span>
          <span class="n">u</span><span class="o">*</span><span class="n">v</span>
        <span class="o">-</span> <span class="nf">dx</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">*</span><span class="nf">dx</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="o">-</span> <span class="nf">dy</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">*</span><span class="nf">dy</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="o">+</span> <span class="nf">int2d</span><span class="p">(</span><span class="n">th2</span><span class="p">)(</span>
        <span class="o">-</span> <span class="n">g</span><span class="o">*</span><span class="n">v</span>
    <span class="p">)</span>
    <span class="o">+</span> <span class="nf">int1d</span><span class="p">(</span><span class="n">th2</span><span class="p">,</span> <span class="mi">5</span><span class="p">)(</span>
          <span class="n">g</span><span class="o">*</span><span class="n">v</span>
    <span class="p">)</span>
    <span class="o">+</span> <span class="nf">on</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">u</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="p">;</span>

<span class="c1">// Plot</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">th2</span><span class="p">,</span> <span class="n">u</span><span class="p">);</span>
</pre></div>
</td></tr></table>

<h3 id="mesh-connectivity-and-data">Mesh Connectivity and data<a class="headerlink" href="#mesh-connectivity-and-data" title="Permanent link">#</a></h3>
<p>The following example explains methods to obtain mesh information.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1">// Mesh</span>
<span class="kt">mesh</span> <span class="n">Th</span> <span class="o">=</span> <span class="nf">square</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>

<span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;// Get data of the mesh&quot;</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">NbTriangles</span> <span class="o">=</span> <span class="n">Th</span><span class="p">.</span><span class="kr">nt</span><span class="p">;</span>
    <span class="kt">real</span> <span class="n">MeshArea</span> <span class="o">=</span> <span class="n">Th</span><span class="p">.</span><span class="kr">measure</span><span class="p">;</span>
    <span class="kt">real</span> <span class="n">BorderLenght</span> <span class="o">=</span> <span class="n">Th</span><span class="p">.</span><span class="kr">bordermeasure</span><span class="p">;</span>

    <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Number of triangle(s) = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">NbTriangles</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
    <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Mesh area = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">MeshArea</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
    <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Border length = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">BorderLenght</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>

    <span class="c1">// Th(i) return the vextex i of Th</span>
    <span class="c1">// Th[k] return the triangle k of Th</span>
    <span class="c1">// Th[k][i] return the vertex i of the triangle k of Th</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">NbTriangles</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
            <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="n">i</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">j</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; - Th[i][j] = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">Th</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
                 <span class="o">&lt;&lt;</span> <span class="s">&quot;, x = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">Th</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">].</span><span class="kr">x</span>
                 <span class="o">&lt;&lt;</span> <span class="s">&quot;, y= &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">Th</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">].</span><span class="kr">y</span>
                 <span class="o">&lt;&lt;</span> <span class="s">&quot;, label=&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">Th</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">].</span><span class="kr">label</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
<span class="p">}</span>

<span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;// Hack to get vertex coordinates&quot;</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
<span class="p">{</span>
    <span class="kt">fespace</span> <span class="n">femp1</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="nc">P1</span><span class="p">);</span>
    <span class="n">femp1</span> <span class="n">Thx</span><span class="o">=</span><span class="kr">x</span><span class="p">,</span><span class="n">Thy</span><span class="o">=</span><span class="kr">y</span><span class="p">;</span>

    <span class="kt">int</span> <span class="n">NbVertices</span> <span class="o">=</span> <span class="n">Th</span><span class="p">.</span><span class="kr">nv</span><span class="p">;</span>
    <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Number of vertices = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">NbVertices</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">NbVertices</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Th(&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">i</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;) : &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">Th</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="kr">x</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">Th</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="kr">y</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">Th</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="kr">label</span>
             <span class="o">&lt;&lt;</span> <span class="kr">endl</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;</span><span class="se">\t</span><span class="s">old method: &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">Thx</span><span class="p">[][</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">Thy</span><span class="p">[][</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
<span class="p">}</span>

<span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;// Method to find information of point (0.55,0.6)&quot;</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">TNumber</span> <span class="o">=</span> <span class="n">Th</span><span class="p">(</span><span class="mf">0.55</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">).</span><span class="kr">nuTriangle</span><span class="p">;</span> <span class="c1">//the triangle number</span>
    <span class="kt">int</span> <span class="n">RLabel</span> <span class="o">=</span> <span class="n">Th</span><span class="p">(</span><span class="mf">0.55</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">).</span><span class="kr">region</span><span class="p">;</span> <span class="c1">//the region label</span>

    <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Triangle number in point (0.55, 0.6): &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">TNumber</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
    <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Region label in point (0.55, 0.6): &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">RLabel</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
<span class="p">}</span>

<span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;// Information of triangle&quot;</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">TNumber</span> <span class="o">=</span> <span class="n">Th</span><span class="p">(</span><span class="mf">0.55</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">).</span><span class="kr">nuTriangle</span><span class="p">;</span>
    <span class="kt">real</span> <span class="n">TArea</span> <span class="o">=</span> <span class="n">Th</span><span class="p">[</span><span class="n">TNumber</span><span class="p">].</span><span class="kr">area</span><span class="p">;</span> <span class="c1">//triangle area</span>
    <span class="kt">real</span> <span class="n">TRegion</span> <span class="o">=</span> <span class="n">Th</span><span class="p">[</span><span class="n">TNumber</span><span class="p">].</span><span class="kr">region</span><span class="p">;</span> <span class="c1">//triangle region</span>
    <span class="kt">real</span> <span class="n">TLabel</span> <span class="o">=</span> <span class="n">Th</span><span class="p">[</span><span class="n">TNumber</span><span class="p">].</span><span class="kr">label</span><span class="p">;</span> <span class="c1">//triangle label, same as region for triangles</span>

    <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Area of triangle &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">TNumber</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;: &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">TArea</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
    <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Region of triangle &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">TNumber</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;: &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">TRegion</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
    <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Label of triangle &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">TNumber</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;: &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">TLabel</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
<span class="p">}</span>

<span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;// Hack to get a triangle containing point x, y or region number (old method)&quot;</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
<span class="p">{</span>
    <span class="kt">fespace</span> <span class="n">femp0</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="nc">P0</span><span class="p">);</span>
    <span class="n">femp0</span> <span class="n">TNumbers</span><span class="p">;</span> <span class="c1">//a P0 function to get triangle numbering</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">Th</span><span class="p">.</span><span class="kr">nt</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="n">TNumbers</span><span class="p">[][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
    <span class="n">femp0</span> <span class="n">RNumbers</span> <span class="o">=</span> <span class="kr">region</span><span class="p">;</span> <span class="c1">//a P0 function to get the region number</span>

    <span class="kt">int</span> <span class="n">TNumber</span> <span class="o">=</span> <span class="n">TNumbers</span><span class="p">(</span><span class="mf">0.55</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">);</span> <span class="c1">// Number of the triangle containing (0.55, 0,6)</span>
    <span class="kt">int</span> <span class="n">RNumber</span> <span class="o">=</span> <span class="n">RNumbers</span><span class="p">(</span><span class="mf">0.55</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">);</span> <span class="c1">// Number of the region containing (0.55, 0,6)</span>

    <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Point (0.55,0,6) :&quot;</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
    <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;</span><span class="se">\t</span><span class="s">Triangle number = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">TNumber</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
    <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;</span><span class="se">\t</span><span class="s">Region number = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">RNumber</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
<span class="p">}</span>

<span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;// New method to get boundary information and mesh adjacent&quot;</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">l</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">e</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>

    <span class="c1">// Number of boundary elements</span>
    <span class="kt">int</span> <span class="n">NbBoundaryElements</span> <span class="o">=</span> <span class="n">Th</span><span class="p">.</span><span class="kr">nbe</span><span class="p">;</span>
    <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Number of boundary element = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">NbBoundaryElements</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
    <span class="c1">// Boundary element k in {0, ..., Th.nbe}</span>
    <span class="kt">int</span> <span class="n">BoundaryElement</span> <span class="o">=</span> <span class="n">Th</span><span class="p">.</span><span class="kr">be</span><span class="p">(</span><span class="n">k</span><span class="p">);</span>
    <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Boundary element &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">k</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">BoundaryElement</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
    <span class="c1">// Vertice l in {0, 1} of boundary element k</span>
    <span class="kt">int</span> <span class="n">Vertex</span> <span class="o">=</span> <span class="n">Th</span><span class="p">.</span><span class="kr">be</span><span class="p">(</span><span class="n">k</span><span class="p">)[</span><span class="n">l</span><span class="p">];</span>
    <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Vertex &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">l</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; of boundary element &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">k</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">Vertex</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
    <span class="c1">// Triangle containg the boundary element k</span>
    <span class="kt">int</span> <span class="n">Triangle</span> <span class="o">=</span> <span class="n">Th</span><span class="p">.</span><span class="kr">be</span><span class="p">(</span><span class="n">k</span><span class="p">).</span><span class="n">Element</span><span class="p">;</span>
    <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Triangle containing the boundary element &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">k</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">Triangle</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
    <span class="c1">// Triangle egde nubmer containing the boundary element k</span>
    <span class="kt">int</span> <span class="n">Edge</span> <span class="o">=</span> <span class="n">Th</span><span class="p">.</span><span class="kr">be</span><span class="p">(</span><span class="n">k</span><span class="p">).</span><span class="kr">whoinElement</span><span class="p">;</span>
    <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Triangle edge number containing the boundary element &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">k</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">Edge</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
    <span class="c1">// Adjacent triangle of the triangle k by edge e</span>
    <span class="kt">int</span> <span class="n">Adjacent</span> <span class="o">=</span> <span class="n">Th</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="kr">adj</span><span class="p">(</span><span class="n">e</span><span class="p">);</span> <span class="c1">//The value of e is changed to the corresponding edge in the adjacent triangle</span>
    <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Adjacent triangle of the triangle &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">k</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; by edge &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">e</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">Adjacent</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
    <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;</span><span class="se">\t</span><span class="s">Corresponding edge = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">e</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
    <span class="c1">// If there is no adjacent triangle by edge e, the same triangle is returned</span>
    <span class="c1">//Th[k] == Th[k].adj(e)</span>
    <span class="c1">// Else a different triangle is returned</span>
    <span class="c1">//Th[k] != Th[k].adj(e)</span>
<span class="p">}</span>

<span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;// Print mesh connectivity &quot;</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">NbTriangles</span> <span class="o">=</span> <span class="n">Th</span><span class="p">.</span><span class="kr">nt</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">NbTriangles</span><span class="p">;</span> <span class="n">k</span><span class="o">++</span><span class="p">)</span>
        <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="n">k</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; : &quot;</span> <span class="o">&lt;&lt;</span> <span class="kt">int</span><span class="p">(</span><span class="n">Th</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; &quot;</span> <span class="o">&lt;&lt;</span> <span class="kt">int</span><span class="p">(</span><span class="n">Th</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
             <span class="o">&lt;&lt;</span> <span class="s">&quot; &quot;</span> <span class="o">&lt;&lt;</span> <span class="kt">int</span><span class="p">(</span><span class="n">Th</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
             <span class="o">&lt;&lt;</span> <span class="s">&quot;, label &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">Th</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="kr">label</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">NbTriangles</span><span class="p">;</span> <span class="n">k</span><span class="o">++</span><span class="p">)</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">e</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ee</span><span class="p">;</span> <span class="n">e</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">;</span> <span class="n">e</span><span class="o">++</span><span class="p">)</span>
            <span class="c1">//set ee to e, and ee is change by method adj,</span>
            <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="n">k</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">e</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; &lt;=&gt; &quot;</span> <span class="o">&lt;&lt;</span> <span class="kt">int</span><span class="p">(</span><span class="n">Th</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="kr">adj</span><span class="p">((</span><span class="n">ee</span><span class="o">=</span><span class="n">e</span><span class="p">)))</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">ee</span>
                 <span class="o">&lt;&lt;</span> <span class="s">&quot;, adj: &quot;</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">Th</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="kr">adj</span><span class="p">((</span><span class="n">ee</span><span class="o">=</span><span class="n">e</span><span class="p">))</span> <span class="o">!=</span> <span class="n">Th</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>

    <span class="kt">int</span> <span class="n">NbBoundaryElements</span> <span class="o">=</span> <span class="n">Th</span><span class="p">.</span><span class="kr">nbe</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">NbBoundaryElements</span><span class="p">;</span> <span class="n">k</span><span class="o">++</span><span class="p">)</span>
        <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="n">k</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; : &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">Th</span><span class="p">.</span><span class="kr">be</span><span class="p">(</span><span class="n">k</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">Th</span><span class="p">.</span><span class="kr">be</span><span class="p">(</span><span class="n">k</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
             <span class="o">&lt;&lt;</span> <span class="s">&quot; , label &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">Th</span><span class="p">.</span><span class="kr">be</span><span class="p">(</span><span class="n">k</span><span class="p">).</span><span class="kr">label</span>
             <span class="o">&lt;&lt;</span> <span class="s">&quot;, triangle &quot;</span> <span class="o">&lt;&lt;</span> <span class="kt">int</span><span class="p">(</span><span class="n">Th</span><span class="p">.</span><span class="kr">be</span><span class="p">(</span><span class="n">k</span><span class="p">).</span><span class="n">Element</span><span class="p">)</span>
             <span class="o">&lt;&lt;</span> <span class="s">&quot; &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">Th</span><span class="p">.</span><span class="kr">be</span><span class="p">(</span><span class="n">k</span><span class="p">).</span><span class="kr">whoinElement</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>

    <span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="kp">bb</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
    <span class="n">boundingbox</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="kp">bb</span><span class="p">);</span>
    <span class="c1">// bb[0] = xmin, bb[1] = xmax, bb[2] = ymin, bb[3] =ymax</span>
    <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;boundingbox:&quot;</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
    <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;xmin = &quot;</span> <span class="o">&lt;&lt;</span> <span class="kp">bb</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot;, xmax = &quot;</span> <span class="o">&lt;&lt;</span> <span class="kp">bb</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot;, ymin = &quot;</span> <span class="o">&lt;&lt;</span> <span class="kp">bb</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot;, ymax = &quot;</span> <span class="o">&lt;&lt;</span> <span class="kp">bb</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>The output is:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>// Get data of the mesh
Number of <span class="nv">triangle</span> <span class="o">=</span> <span class="m">8</span>
Mesh <span class="nv">area</span> <span class="o">=</span> <span class="m">1</span>
Border <span class="nv">length</span> <span class="o">=</span> <span class="m">4</span>
<span class="m">0</span> <span class="m">0</span> - Th<span class="o">[</span>i<span class="o">][</span>j<span class="o">]</span> <span class="o">=</span> <span class="m">0</span>, <span class="nv">x</span> <span class="o">=</span> <span class="m">0</span>, <span class="nv">y</span><span class="o">=</span> <span class="m">0</span>, <span class="nv">label</span><span class="o">=</span><span class="m">4</span>
<span class="m">0</span> <span class="m">1</span> - Th<span class="o">[</span>i<span class="o">][</span>j<span class="o">]</span> <span class="o">=</span> <span class="m">1</span>, <span class="nv">x</span> <span class="o">=</span> <span class="m">0</span>.5, <span class="nv">y</span><span class="o">=</span> <span class="m">0</span>, <span class="nv">label</span><span class="o">=</span><span class="m">1</span>
<span class="m">0</span> <span class="m">2</span> - Th<span class="o">[</span>i<span class="o">][</span>j<span class="o">]</span> <span class="o">=</span> <span class="m">4</span>, <span class="nv">x</span> <span class="o">=</span> <span class="m">0</span>.5, <span class="nv">y</span><span class="o">=</span> <span class="m">0</span>.5, <span class="nv">label</span><span class="o">=</span><span class="m">0</span>
<span class="m">1</span> <span class="m">0</span> - Th<span class="o">[</span>i<span class="o">][</span>j<span class="o">]</span> <span class="o">=</span> <span class="m">0</span>, <span class="nv">x</span> <span class="o">=</span> <span class="m">0</span>, <span class="nv">y</span><span class="o">=</span> <span class="m">0</span>, <span class="nv">label</span><span class="o">=</span><span class="m">4</span>
<span class="m">1</span> <span class="m">1</span> - Th<span class="o">[</span>i<span class="o">][</span>j<span class="o">]</span> <span class="o">=</span> <span class="m">4</span>, <span class="nv">x</span> <span class="o">=</span> <span class="m">0</span>.5, <span class="nv">y</span><span class="o">=</span> <span class="m">0</span>.5, <span class="nv">label</span><span class="o">=</span><span class="m">0</span>
<span class="m">1</span> <span class="m">2</span> - Th<span class="o">[</span>i<span class="o">][</span>j<span class="o">]</span> <span class="o">=</span> <span class="m">3</span>, <span class="nv">x</span> <span class="o">=</span> <span class="m">0</span>, <span class="nv">y</span><span class="o">=</span> <span class="m">0</span>.5, <span class="nv">label</span><span class="o">=</span><span class="m">4</span>
<span class="m">2</span> <span class="m">0</span> - Th<span class="o">[</span>i<span class="o">][</span>j<span class="o">]</span> <span class="o">=</span> <span class="m">1</span>, <span class="nv">x</span> <span class="o">=</span> <span class="m">0</span>.5, <span class="nv">y</span><span class="o">=</span> <span class="m">0</span>, <span class="nv">label</span><span class="o">=</span><span class="m">1</span>
<span class="m">2</span> <span class="m">1</span> - Th<span class="o">[</span>i<span class="o">][</span>j<span class="o">]</span> <span class="o">=</span> <span class="m">2</span>, <span class="nv">x</span> <span class="o">=</span> <span class="m">1</span>, <span class="nv">y</span><span class="o">=</span> <span class="m">0</span>, <span class="nv">label</span><span class="o">=</span><span class="m">2</span>
<span class="m">2</span> <span class="m">2</span> - Th<span class="o">[</span>i<span class="o">][</span>j<span class="o">]</span> <span class="o">=</span> <span class="m">5</span>, <span class="nv">x</span> <span class="o">=</span> <span class="m">1</span>, <span class="nv">y</span><span class="o">=</span> <span class="m">0</span>.5, <span class="nv">label</span><span class="o">=</span><span class="m">2</span>
<span class="m">3</span> <span class="m">0</span> - Th<span class="o">[</span>i<span class="o">][</span>j<span class="o">]</span> <span class="o">=</span> <span class="m">1</span>, <span class="nv">x</span> <span class="o">=</span> <span class="m">0</span>.5, <span class="nv">y</span><span class="o">=</span> <span class="m">0</span>, <span class="nv">label</span><span class="o">=</span><span class="m">1</span>
<span class="m">3</span> <span class="m">1</span> - Th<span class="o">[</span>i<span class="o">][</span>j<span class="o">]</span> <span class="o">=</span> <span class="m">5</span>, <span class="nv">x</span> <span class="o">=</span> <span class="m">1</span>, <span class="nv">y</span><span class="o">=</span> <span class="m">0</span>.5, <span class="nv">label</span><span class="o">=</span><span class="m">2</span>
<span class="m">3</span> <span class="m">2</span> - Th<span class="o">[</span>i<span class="o">][</span>j<span class="o">]</span> <span class="o">=</span> <span class="m">4</span>, <span class="nv">x</span> <span class="o">=</span> <span class="m">0</span>.5, <span class="nv">y</span><span class="o">=</span> <span class="m">0</span>.5, <span class="nv">label</span><span class="o">=</span><span class="m">0</span>
<span class="m">4</span> <span class="m">0</span> - Th<span class="o">[</span>i<span class="o">][</span>j<span class="o">]</span> <span class="o">=</span> <span class="m">3</span>, <span class="nv">x</span> <span class="o">=</span> <span class="m">0</span>, <span class="nv">y</span><span class="o">=</span> <span class="m">0</span>.5, <span class="nv">label</span><span class="o">=</span><span class="m">4</span>
<span class="m">4</span> <span class="m">1</span> - Th<span class="o">[</span>i<span class="o">][</span>j<span class="o">]</span> <span class="o">=</span> <span class="m">4</span>, <span class="nv">x</span> <span class="o">=</span> <span class="m">0</span>.5, <span class="nv">y</span><span class="o">=</span> <span class="m">0</span>.5, <span class="nv">label</span><span class="o">=</span><span class="m">0</span>
<span class="m">4</span> <span class="m">2</span> - Th<span class="o">[</span>i<span class="o">][</span>j<span class="o">]</span> <span class="o">=</span> <span class="m">7</span>, <span class="nv">x</span> <span class="o">=</span> <span class="m">0</span>.5, <span class="nv">y</span><span class="o">=</span> <span class="m">1</span>, <span class="nv">label</span><span class="o">=</span><span class="m">3</span>
<span class="m">5</span> <span class="m">0</span> - Th<span class="o">[</span>i<span class="o">][</span>j<span class="o">]</span> <span class="o">=</span> <span class="m">3</span>, <span class="nv">x</span> <span class="o">=</span> <span class="m">0</span>, <span class="nv">y</span><span class="o">=</span> <span class="m">0</span>.5, <span class="nv">label</span><span class="o">=</span><span class="m">4</span>
<span class="m">5</span> <span class="m">1</span> - Th<span class="o">[</span>i<span class="o">][</span>j<span class="o">]</span> <span class="o">=</span> <span class="m">7</span>, <span class="nv">x</span> <span class="o">=</span> <span class="m">0</span>.5, <span class="nv">y</span><span class="o">=</span> <span class="m">1</span>, <span class="nv">label</span><span class="o">=</span><span class="m">3</span>
<span class="m">5</span> <span class="m">2</span> - Th<span class="o">[</span>i<span class="o">][</span>j<span class="o">]</span> <span class="o">=</span> <span class="m">6</span>, <span class="nv">x</span> <span class="o">=</span> <span class="m">0</span>, <span class="nv">y</span><span class="o">=</span> <span class="m">1</span>, <span class="nv">label</span><span class="o">=</span><span class="m">4</span>
<span class="m">6</span> <span class="m">0</span> - Th<span class="o">[</span>i<span class="o">][</span>j<span class="o">]</span> <span class="o">=</span> <span class="m">4</span>, <span class="nv">x</span> <span class="o">=</span> <span class="m">0</span>.5, <span class="nv">y</span><span class="o">=</span> <span class="m">0</span>.5, <span class="nv">label</span><span class="o">=</span><span class="m">0</span>
<span class="m">6</span> <span class="m">1</span> - Th<span class="o">[</span>i<span class="o">][</span>j<span class="o">]</span> <span class="o">=</span> <span class="m">5</span>, <span class="nv">x</span> <span class="o">=</span> <span class="m">1</span>, <span class="nv">y</span><span class="o">=</span> <span class="m">0</span>.5, <span class="nv">label</span><span class="o">=</span><span class="m">2</span>
<span class="m">6</span> <span class="m">2</span> - Th<span class="o">[</span>i<span class="o">][</span>j<span class="o">]</span> <span class="o">=</span> <span class="m">8</span>, <span class="nv">x</span> <span class="o">=</span> <span class="m">1</span>, <span class="nv">y</span><span class="o">=</span> <span class="m">1</span>, <span class="nv">label</span><span class="o">=</span><span class="m">3</span>
<span class="m">7</span> <span class="m">0</span> - Th<span class="o">[</span>i<span class="o">][</span>j<span class="o">]</span> <span class="o">=</span> <span class="m">4</span>, <span class="nv">x</span> <span class="o">=</span> <span class="m">0</span>.5, <span class="nv">y</span><span class="o">=</span> <span class="m">0</span>.5, <span class="nv">label</span><span class="o">=</span><span class="m">0</span>
<span class="m">7</span> <span class="m">1</span> - Th<span class="o">[</span>i<span class="o">][</span>j<span class="o">]</span> <span class="o">=</span> <span class="m">8</span>, <span class="nv">x</span> <span class="o">=</span> <span class="m">1</span>, <span class="nv">y</span><span class="o">=</span> <span class="m">1</span>, <span class="nv">label</span><span class="o">=</span><span class="m">3</span>
<span class="m">7</span> <span class="m">2</span> - Th<span class="o">[</span>i<span class="o">][</span>j<span class="o">]</span> <span class="o">=</span> <span class="m">7</span>, <span class="nv">x</span> <span class="o">=</span> <span class="m">0</span>.5, <span class="nv">y</span><span class="o">=</span> <span class="m">1</span>, <span class="nv">label</span><span class="o">=</span><span class="m">3</span>
// Hack to get vertex coordinates
Number of <span class="nv">vertices</span> <span class="o">=</span> <span class="m">9</span>
Th<span class="o">(</span><span class="m">0</span><span class="o">)</span> : <span class="m">0</span> <span class="m">0</span> <span class="m">4</span>
   old method: <span class="m">0</span> <span class="m">0</span>
Th<span class="o">(</span><span class="m">1</span><span class="o">)</span> : <span class="m">0</span>.5 <span class="m">0</span> <span class="m">1</span>
   old method: <span class="m">0</span>.5 <span class="m">0</span>
Th<span class="o">(</span><span class="m">2</span><span class="o">)</span> : <span class="m">1</span> <span class="m">0</span> <span class="m">2</span>
   old method: <span class="m">1</span> <span class="m">0</span>
Th<span class="o">(</span><span class="m">3</span><span class="o">)</span> : <span class="m">0</span> <span class="m">0</span>.5 <span class="m">4</span>
   old method: <span class="m">0</span> <span class="m">0</span>.5
Th<span class="o">(</span><span class="m">4</span><span class="o">)</span> : <span class="m">0</span>.5 <span class="m">0</span>.5 <span class="m">0</span>
   old method: <span class="m">0</span>.5 <span class="m">0</span>.5
Th<span class="o">(</span><span class="m">5</span><span class="o">)</span> : <span class="m">1</span> <span class="m">0</span>.5 <span class="m">2</span>
   old method: <span class="m">1</span> <span class="m">0</span>.5
Th<span class="o">(</span><span class="m">6</span><span class="o">)</span> : <span class="m">0</span> <span class="m">1</span> <span class="m">4</span>
   old method: <span class="m">0</span> <span class="m">1</span>
Th<span class="o">(</span><span class="m">7</span><span class="o">)</span> : <span class="m">0</span>.5 <span class="m">1</span> <span class="m">3</span>
   old method: <span class="m">0</span>.5 <span class="m">1</span>
Th<span class="o">(</span><span class="m">8</span><span class="o">)</span> : <span class="m">1</span> <span class="m">1</span> <span class="m">3</span>
   old method: <span class="m">1</span> <span class="m">1</span>
// Method to find the information of point <span class="o">(</span><span class="m">0</span>.55,0.6<span class="o">)</span>
Triangle number in point <span class="o">(</span><span class="m">0</span>.55, <span class="m">0</span>.6<span class="o">)</span>: <span class="m">7</span>
Region label in point <span class="o">(</span><span class="m">0</span>.55, <span class="m">0</span>.6<span class="o">)</span>: <span class="m">0</span>
// Information of a triangle
Area of triangle <span class="m">7</span>: <span class="m">0</span>.125
Region of triangle <span class="m">7</span>: <span class="m">0</span>
Label of triangle <span class="m">7</span>: <span class="m">0</span>
// Hack to get a triangle containing point x, y or region number <span class="o">(</span>old method<span class="o">)</span>
Point <span class="o">(</span><span class="m">0</span>.55,0,6<span class="o">)</span> :
   Triangle <span class="nv">number</span> <span class="o">=</span> <span class="m">7</span>
   Region <span class="nv">number</span> <span class="o">=</span> <span class="m">0</span>
// New method to get boundary information and mesh adjacent
Number of boundary <span class="nv">element</span> <span class="o">=</span> <span class="m">8</span>
Boundary element <span class="nv">0</span> <span class="o">=</span> <span class="m">0</span>
Vertex <span class="m">1</span> of boundary element <span class="nv">0</span> <span class="o">=</span> <span class="m">1</span>
Triangle containing the boundary element <span class="nv">0</span> <span class="o">=</span> <span class="m">0</span>
Triangle edge number containing the boundary element <span class="nv">0</span> <span class="o">=</span> <span class="m">2</span>
Adjacent triangle of the triangle <span class="m">0</span> by edge <span class="nv">1</span> <span class="o">=</span> <span class="m">1</span>
   Corresponding <span class="nv">edge</span> <span class="o">=</span> <span class="m">2</span>
// Print mesh connectivity
<span class="m">0</span> : <span class="m">0</span> <span class="m">1</span> <span class="m">4</span>, label <span class="m">0</span>
<span class="m">1</span> : <span class="m">0</span> <span class="m">4</span> <span class="m">3</span>, label <span class="m">0</span>
<span class="m">2</span> : <span class="m">1</span> <span class="m">2</span> <span class="m">5</span>, label <span class="m">0</span>
<span class="m">3</span> : <span class="m">1</span> <span class="m">5</span> <span class="m">4</span>, label <span class="m">0</span>
<span class="m">4</span> : <span class="m">3</span> <span class="m">4</span> <span class="m">7</span>, label <span class="m">0</span>
<span class="m">5</span> : <span class="m">3</span> <span class="m">7</span> <span class="m">6</span>, label <span class="m">0</span>
<span class="m">6</span> : <span class="m">4</span> <span class="m">5</span> <span class="m">8</span>, label <span class="m">0</span>
<span class="m">7</span> : <span class="m">4</span> <span class="m">8</span> <span class="m">7</span>, label <span class="m">0</span>
<span class="m">0</span> <span class="m">0</span> &lt;<span class="o">=</span>&gt; <span class="m">3</span> <span class="m">1</span>, adj: <span class="m">1</span>
<span class="m">0</span> <span class="m">1</span> &lt;<span class="o">=</span>&gt; <span class="m">1</span> <span class="m">2</span>, adj: <span class="m">1</span>
<span class="m">0</span> <span class="m">2</span> &lt;<span class="o">=</span>&gt; <span class="m">0</span> <span class="m">2</span>, adj: <span class="m">0</span>
<span class="m">1</span> <span class="m">0</span> &lt;<span class="o">=</span>&gt; <span class="m">4</span> <span class="m">2</span>, adj: <span class="m">1</span>
<span class="m">1</span> <span class="m">1</span> &lt;<span class="o">=</span>&gt; <span class="m">1</span> <span class="m">1</span>, adj: <span class="m">0</span>
<span class="m">1</span> <span class="m">2</span> &lt;<span class="o">=</span>&gt; <span class="m">0</span> <span class="m">1</span>, adj: <span class="m">1</span>
<span class="m">2</span> <span class="m">0</span> &lt;<span class="o">=</span>&gt; <span class="m">2</span> <span class="m">0</span>, adj: <span class="m">0</span>
<span class="m">2</span> <span class="m">1</span> &lt;<span class="o">=</span>&gt; <span class="m">3</span> <span class="m">2</span>, adj: <span class="m">1</span>
<span class="m">2</span> <span class="m">2</span> &lt;<span class="o">=</span>&gt; <span class="m">2</span> <span class="m">2</span>, adj: <span class="m">0</span>
<span class="m">3</span> <span class="m">0</span> &lt;<span class="o">=</span>&gt; <span class="m">6</span> <span class="m">2</span>, adj: <span class="m">1</span>
<span class="m">3</span> <span class="m">1</span> &lt;<span class="o">=</span>&gt; <span class="m">0</span> <span class="m">0</span>, adj: <span class="m">1</span>
<span class="m">3</span> <span class="m">2</span> &lt;<span class="o">=</span>&gt; <span class="m">2</span> <span class="m">1</span>, adj: <span class="m">1</span>
<span class="m">4</span> <span class="m">0</span> &lt;<span class="o">=</span>&gt; <span class="m">7</span> <span class="m">1</span>, adj: <span class="m">1</span>
<span class="m">4</span> <span class="m">1</span> &lt;<span class="o">=</span>&gt; <span class="m">5</span> <span class="m">2</span>, adj: <span class="m">1</span>
<span class="m">4</span> <span class="m">2</span> &lt;<span class="o">=</span>&gt; <span class="m">1</span> <span class="m">0</span>, adj: <span class="m">1</span>
<span class="m">5</span> <span class="m">0</span> &lt;<span class="o">=</span>&gt; <span class="m">5</span> <span class="m">0</span>, adj: <span class="m">0</span>
<span class="m">5</span> <span class="m">1</span> &lt;<span class="o">=</span>&gt; <span class="m">5</span> <span class="m">1</span>, adj: <span class="m">0</span>
<span class="m">5</span> <span class="m">2</span> &lt;<span class="o">=</span>&gt; <span class="m">4</span> <span class="m">1</span>, adj: <span class="m">1</span>
<span class="m">6</span> <span class="m">0</span> &lt;<span class="o">=</span>&gt; <span class="m">6</span> <span class="m">0</span>, adj: <span class="m">0</span>
<span class="m">6</span> <span class="m">1</span> &lt;<span class="o">=</span>&gt; <span class="m">7</span> <span class="m">2</span>, adj: <span class="m">1</span>
<span class="m">6</span> <span class="m">2</span> &lt;<span class="o">=</span>&gt; <span class="m">3</span> <span class="m">0</span>, adj: <span class="m">1</span>
<span class="m">7</span> <span class="m">0</span> &lt;<span class="o">=</span>&gt; <span class="m">7</span> <span class="m">0</span>, adj: <span class="m">0</span>
<span class="m">7</span> <span class="m">1</span> &lt;<span class="o">=</span>&gt; <span class="m">4</span> <span class="m">0</span>, adj: <span class="m">1</span>
<span class="m">7</span> <span class="m">2</span> &lt;<span class="o">=</span>&gt; <span class="m">6</span> <span class="m">1</span>, adj: <span class="m">1</span>
<span class="m">0</span> : <span class="m">0</span> <span class="m">1</span> , label <span class="m">1</span>, triangle <span class="m">0</span> <span class="m">2</span>
<span class="m">1</span> : <span class="m">1</span> <span class="m">2</span> , label <span class="m">1</span>, triangle <span class="m">2</span> <span class="m">2</span>
<span class="m">2</span> : <span class="m">2</span> <span class="m">5</span> , label <span class="m">2</span>, triangle <span class="m">2</span> <span class="m">0</span>
<span class="m">3</span> : <span class="m">5</span> <span class="m">8</span> , label <span class="m">2</span>, triangle <span class="m">6</span> <span class="m">0</span>
<span class="m">4</span> : <span class="m">6</span> <span class="m">7</span> , label <span class="m">3</span>, triangle <span class="m">5</span> <span class="m">0</span>
<span class="m">5</span> : <span class="m">7</span> <span class="m">8</span> , label <span class="m">3</span>, triangle <span class="m">7</span> <span class="m">0</span>
<span class="m">6</span> : <span class="m">0</span> <span class="m">3</span> , label <span class="m">4</span>, triangle <span class="m">1</span> <span class="m">1</span>
<span class="m">7</span> : <span class="m">3</span> <span class="m">6</span> , label <span class="m">4</span>, triangle <span class="m">5</span> <span class="m">1</span>
boundingbox:
<span class="nv">xmin</span> <span class="o">=</span> <span class="m">0</span>, <span class="nv">xmax</span> <span class="o">=</span> <span class="m">1</span>, <span class="nv">ymin</span> <span class="o">=</span> <span class="m">0</span>, <span class="nv">ymax</span> <span class="o">=</span> <span class="m">1</span>
</pre></div>
</td></tr></table>

<p>The real characteristic function of a mesh <code class="codehilite"><span class="n">Th</span></code> is <code class="codehilite"><span class="nf">chi</span><span class="p">(</span><span class="n">Th</span><span class="p">)</span></code> in 2D and 3D where:</p>
<p><code class="codehilite"><span class="nf">chi</span><span class="p">(</span><span class="n">Th</span><span class="p">)(</span><span class="kr">P</span><span class="p">)</span><span class="o">=</span><span class="mi">1</span></code> if <span><span class="MathJax_Preview">P\in Th</span><script type="math/tex">P\in Th</script></span></p>
<p><code class="codehilite"><span class="nf">chi</span><span class="p">(</span><span class="n">Th</span><span class="p">)(</span><span class="kr">P</span><span class="p">)</span><span class="o">=</span><span class="mi">0</span></code> if <span><span class="MathJax_Preview">P\not\in Th</span><script type="math/tex">P\not\in Th</script></span></p>
<h3 id="the-keyword-triangulate">The keyword "triangulate"<a class="headerlink" href="#the-keyword-triangulate" title="Permanent link">#</a></h3>
<p>FreeFem++ is able to build a triangulation from a set of points. This triangulation is a Delaunay mesh of the convex hull of the set of points. It can be useful to build a mesh from a table function.</p>
<p>The coordinates of the points and the value of the table function are defined separately with rows of the form: <code class="codehilite"><span class="kr">x</span> <span class="kr">y</span> <span class="n">f</span><span class="p">(</span><span class="kr">x</span><span class="p">,</span><span class="kr">y</span><span class="p">)</span></code> in a file such as:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="mf">0.51387</span> <span class="mf">0.175741</span> <span class="mf">0.636237</span>
<span class="mf">0.308652</span> <span class="mf">0.534534</span> <span class="mf">0.746765</span>
<span class="mf">0.947628</span> <span class="mf">0.171736</span> <span class="mf">0.899823</span>
<span class="mf">0.702231</span> <span class="mf">0.226431</span> <span class="mf">0.800819</span>
<span class="mf">0.494773</span> <span class="mf">0.12472</span> <span class="mf">0.580623</span>
<span class="mf">0.0838988</span> <span class="mf">0.389647</span> <span class="mf">0.456045</span>
<span class="p">...............</span>
</pre></div>
</td></tr></table>

<table>
<thead>
<tr>
<th align="center"><a name="Fig8">Fig. 8</a>: Delaunay mesh of the convex hull of point set in file xy</th>
<th align="center"><a name="Fig9">Fig. 9</a>: Isovalue of table function</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="Th xy" src="../images/MeshGeneration_Triangulate1.png" /></td>
<td align="center"><img alt="xyf" src="../images/MeshGeneration_Triangulate2.png" /></td>
</tr>
</tbody>
</table>
<p>The third column of each line is left untouched by the <code class="codehilite"><span class="nf">triangulate</span></code> command. But you can use this third value to define a table function with rows of the form: <code class="codehilite"><span class="kr">x</span> <span class="kr">y</span> <span class="n">f</span><span class="p">(</span><span class="kr">x</span><span class="p">,</span><span class="kr">y</span><span class="p">)</span></code>.</p>
<p>The following example shows how to make a mesh from the file <code>xyf</code> with the format stated just above. The command <code class="codehilite"><span class="nf">triangulate</span></code> only uses the 1st and 2nd columns.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1">// Build the Delaunay mesh of the convex hull</span>
<span class="kt">mesh</span> <span class="n">Thxy</span><span class="o">=</span><span class="nf">triangulate</span><span class="p">(</span><span class="s">&quot;xyf&quot;</span><span class="p">);</span> <span class="c1">//points are defined by the first 2 columns of file `xyf`</span>

<span class="c1">// Plot the created mesh</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">Thxy</span><span class="p">);</span>

<span class="c1">// Fespace</span>
<span class="kt">fespace</span> <span class="nf">Vhxy</span><span class="p">(</span><span class="n">Thxy</span><span class="p">,</span> <span class="nc">P1</span><span class="p">);</span>
<span class="n">Vhxy</span> <span class="n">fxy</span><span class="p">;</span>

<span class="c1">// Reading the 3rd column to define the function fxy</span>
<span class="p">{</span>
    <span class="kt">ifstream</span> <span class="kp">file</span><span class="p">(</span><span class="s">&quot;xyf&quot;</span><span class="p">);</span>
    <span class="kt">real</span> <span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">fxy</span><span class="p">.</span><span class="kr">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="kp">file</span> <span class="o">&gt;&gt;</span> <span class="n">xx</span> <span class="o">&gt;&gt;</span> <span class="n">yy</span> <span class="o">&gt;&gt;</span> <span class="n">fxy</span><span class="p">[][</span><span class="n">i</span><span class="p">];</span> <span class="c1">//to read third row only.</span>
                                      <span class="c1">//xx and yy are just skipped</span>
<span class="p">}</span>

<span class="c1">// Plot</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">fxy</span><span class="p">);</span>
</pre></div>
</td></tr></table>

<p>One new way to build a mesh is to have two arrays: one for the <span><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span> values and the other for the <span><span class="MathJax_Preview">y</span><script type="math/tex">y</script></span> values.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1">//set two arrays for the x&#39;s and y&#39;s</span>
<span class="n">Vhxy</span> <span class="n">xx</span><span class="o">=</span><span class="kr">x</span><span class="p">,</span> <span class="n">yy</span><span class="o">=</span><span class="kr">y</span><span class="p">;</span>
<span class="c1">//build the mesh</span>
<span class="kt">mesh</span> <span class="n">Th</span> <span class="o">=</span> <span class="nf">triangulate</span><span class="p">(</span><span class="n">xx</span><span class="p">[],</span> <span class="n">yy</span><span class="p">[]);</span>
</pre></div>
</td></tr></table>

<h2 id="boundary-fem-spaces-built-as-empty-meshes">Boundary FEM Spaces Built as Empty Meshes<a class="headerlink" href="#boundary-fem-spaces-built-as-empty-meshes" title="Permanent link">#</a></h2>
<p>To define a Finite Element space on a boundary, we came up with the idea of a mesh with no internal points (called empty mesh). It can be useful to handle Lagrange multipliers in mixed and mortar methods.</p>
<p>So the function <code class="codehilite"><span class="nf">emptymesh</span></code> removes all the internal points of a mesh except points on internal boundaries.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="p">{</span>
    <span class="kt">border</span> <span class="n">a</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="kr">pi</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="nf">cos</span><span class="p">(</span><span class="kp">t</span><span class="p">);</span> <span class="kr">y</span><span class="o">=</span><span class="nf">sin</span><span class="p">(</span><span class="kp">t</span><span class="p">);</span> <span class="kr">label</span><span class="o">=</span><span class="mi">1</span><span class="p">;}</span>
    <span class="kt">mesh</span> <span class="n">Th</span> <span class="o">=</span> <span class="nf">buildmesh</span><span class="p">(</span><span class="n">a</span><span class="p">(</span><span class="mi">20</span><span class="p">));</span>
    <span class="n">Th</span> <span class="o">=</span> <span class="nf">emptymesh</span><span class="p">(</span><span class="n">Th</span><span class="p">);</span>
    <span class="nf">plot</span><span class="p">(</span><span class="n">Th</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>It is also possible to build an empty mesh of a pseudo subregion with <code class="codehilite"><span class="nf">emptymesh</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="n">ssd</span><span class="p">)</span></code> using the set of edges from the mesh <code class="codehilite"><span class="n">Th</span></code>; an edge <span><span class="MathJax_Preview">e</span><script type="math/tex">e</script></span> is in this set when, with the two adjacent triangles <span><span class="MathJax_Preview">e =t1\cap t2</span><script type="math/tex">e =t1\cap t2</script></span> and <span><span class="MathJax_Preview">ssd[T1] \neq ssd[T2]</span><script type="math/tex">ssd[T1] \neq ssd[T2]</script></span> where <span><span class="MathJax_Preview">ssd</span><script type="math/tex">ssd</script></span> refers to the pseudo region numbering of triangles, they are stored in the <code class="codehilite"><span class="kt">int</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span></code> array of size "the number of triangles".</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="p">{</span>
    <span class="kt">mesh</span> <span class="n">Th</span> <span class="o">=</span> <span class="nf">square</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
    <span class="kt">int</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">ssd</span><span class="p">(</span><span class="n">Th</span><span class="p">.</span><span class="kr">nt</span><span class="p">);</span>
    <span class="c1">//build the pseudo region numbering</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ssd</span><span class="p">.</span><span class="kr">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="kt">int</span> <span class="n">iq</span> <span class="o">=</span> <span class="n">i</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span> <span class="c1">//because 2 triangles per quad</span>
        <span class="kt">int</span> <span class="n">ix</span> <span class="o">=</span> <span class="n">iq</span><span class="o">%</span><span class="mi">10</span><span class="p">;</span>
        <span class="kt">int</span> <span class="n">iy</span> <span class="o">=</span> <span class="n">iq</span><span class="o">/</span><span class="mi">10</span><span class="p">;</span>
        <span class="n">ssd</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">ix</span><span class="o">&gt;=</span><span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">iy</span><span class="o">&gt;=</span><span class="mi">5</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">//build emtpy with all edges $e=T1 \cap T2$ and $ssd[T1] \neq ssd[T2]$</span>
    <span class="n">Th</span> <span class="o">=</span> <span class="nf">emptymesh</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="n">ssd</span><span class="p">);</span>
    <span class="c1">//plot</span>
    <span class="nf">plot</span><span class="p">(</span><span class="n">Th</span><span class="p">);</span>
    <span class="nf">savemesh</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="s">&quot;emptymesh.msh&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<table>
<thead>
<tr>
<th align="center"><a name="Fig10">Fig. 10</a>: The empty mesh with boundary</th>
<th align="center"><a name="Fig11">Fig. 11</a>: An empty mesh defined from a pseudo region numbering of triangle</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="Empty mesh 1" src="../images/MeshGeneration_EmptyMesh1.png" /></td>
<td align="center"><img alt="Empty mesh 2" src="../images/MeshGeneration_EmptyMesh2.png" /></td>
</tr>
</tbody>
</table>
<h2 id="remeshing">Remeshing<a class="headerlink" href="#remeshing" title="Permanent link">#</a></h2>
<h3 id="movemesh">Movemesh<a class="headerlink" href="#movemesh" title="Permanent link">#</a></h3>
<p>Meshes can be translated, rotated, and deformed by <code class="codehilite"><span class="nf">movemesh</span></code>; this is useful for elasticity to watch the deformation due to the displacement <span><span class="MathJax_Preview">\mathbf{\Phi}(x,y)=(\Phi_1(x,y),\Phi_2(x,y))</span><script type="math/tex">\mathbf{\Phi}(x,y)=(\Phi_1(x,y),\Phi_2(x,y))</script></span> of shape.</p>
<p>It is also useful to handle free boundary problems or optimal shape problems.</p>
<p>If <span><span class="MathJax_Preview">\Omega</span><script type="math/tex">\Omega</script></span> is triangulated as <span><span class="MathJax_Preview">T_h(\Omega)</span><script type="math/tex">T_h(\Omega)</script></span>, and <span><span class="MathJax_Preview">\mathbf{\Phi}</span><script type="math/tex">\mathbf{\Phi}</script></span> is a displacement vector then <span><span class="MathJax_Preview">\mathbf{\Phi}(T_h)</span><script type="math/tex">\mathbf{\Phi}(T_h)</script></span> is obtained by</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">mesh</span> <span class="n">Th</span> <span class="o">=</span> <span class="nf">movemesh</span><span class="p">(</span><span class="n">Th</span><span class="p">,[</span><span class="n">Phi1</span><span class="p">,</span> <span class="n">Phi2</span><span class="p">]);</span>
</pre></div>
</td></tr></table>

<p>Sometimes the transformed mesh is invalid because some triangles have flipped over (meaning it now has a negative area). To spot such problems, one may check the minimum triangle area in the transformed mesh with <code class="codehilite"><span class="nf">checkmovemesh</span></code> before any real transformation.</p>
<p>For example:
<script type="math/tex; mode=display">\begin{eqnarray}
    \Phi_1(x,y) &=& x+k*\sin(y*\pi)/10)\\
    \Phi_2(x,y) &=& y+k*\cos(y\pi)/10)
\end{eqnarray}</script>
for a big number <span><span class="MathJax_Preview">k&gt;1</span><script type="math/tex">k>1</script></span>.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kr">verbosity</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>

<span class="c1">// Parameters</span>
<span class="kt">real</span> <span class="kp">coef</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

<span class="c1">// Mesh</span>
<span class="kt">border</span> <span class="nf">a</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="kp">t</span><span class="p">;</span> <span class="kr">y</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="kr">label</span><span class="o">=</span><span class="mi">1</span><span class="p">;};</span>
<span class="kt">border</span> <span class="nf">b</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="kr">y</span><span class="o">=</span><span class="kp">t</span><span class="p">;</span> <span class="kr">label</span><span class="o">=</span><span class="mi">1</span><span class="p">;};</span>
<span class="kt">border</span> <span class="nf">c</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="mi">1</span><span class="o">-</span><span class="kp">t</span><span class="p">;</span> <span class="kr">y</span><span class="o">=</span><span class="mf">0.5</span><span class="p">;</span> <span class="kr">label</span><span class="o">=</span><span class="mi">1</span><span class="p">;};</span>
<span class="kt">border</span> <span class="nf">d</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="mf">0.5</span><span class="p">;</span> <span class="kr">y</span><span class="o">=</span><span class="kp">t</span><span class="p">;</span> <span class="kr">label</span><span class="o">=</span><span class="mi">1</span><span class="p">;};</span>
<span class="kt">border</span> <span class="nf">e</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="mi">1</span><span class="o">-</span><span class="kp">t</span><span class="p">;</span> <span class="kr">y</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="kr">label</span><span class="o">=</span><span class="mi">1</span><span class="p">;};</span>
<span class="kt">border</span> <span class="nf">f</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="kr">y</span><span class="o">=</span><span class="mi">1</span><span class="o">-</span><span class="kp">t</span><span class="p">;</span> <span class="kr">label</span><span class="o">=</span><span class="mi">1</span><span class="p">;};</span>
<span class="kt">mesh</span> <span class="n">Th</span> <span class="o">=</span> <span class="nf">buildmesh</span><span class="p">(</span><span class="n">a</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="o">+</span> <span class="n">b</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">c</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="nf">d</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">e</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">f</span><span class="p">(</span><span class="mi">6</span><span class="p">));</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="kp">wait</span><span class="o">=</span><span class="kr">true</span><span class="p">,</span> <span class="kp">fill</span><span class="o">=</span><span class="kr">true</span><span class="p">,</span> <span class="kp">ps</span><span class="o">=</span><span class="s">&quot;Lshape.eps&quot;</span><span class="p">);</span>

<span class="c1">// Function</span>
<span class="kt">func</span> <span class="n">uu</span> <span class="o">=</span> <span class="nf">sin</span><span class="p">(</span><span class="kr">y</span><span class="o">*</span><span class="kr">pi</span><span class="p">)</span><span class="o">/</span><span class="mi">10</span><span class="p">;</span>
<span class="kt">func</span> <span class="n">vv</span> <span class="o">=</span> <span class="nf">cos</span><span class="p">(</span><span class="kr">x</span><span class="o">*</span><span class="kr">pi</span><span class="p">)</span><span class="o">/</span><span class="mi">10</span><span class="p">;</span>

<span class="c1">// Checkmovemesh</span>
<span class="kt">real</span> <span class="n">minT0</span> <span class="o">=</span> <span class="nf">checkmovemesh</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="p">[</span><span class="kr">x</span><span class="p">,</span> <span class="kr">y</span><span class="p">]);</span> <span class="c1">//return the min triangle area</span>
<span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">){</span> <span class="c1">// find a correct move mesh</span>
    <span class="kt">real</span> <span class="n">minT</span> <span class="o">=</span> <span class="nf">checkmovemesh</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="p">[</span><span class="kr">x</span><span class="o">+</span><span class="kp">coef</span><span class="o">*</span><span class="n">uu</span><span class="p">,</span> <span class="kr">y</span><span class="o">+</span><span class="kp">coef</span><span class="o">*</span><span class="n">vv</span><span class="p">]);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">minT</span> <span class="o">&gt;</span> <span class="n">minT0</span><span class="o">/</span><span class="mi">5</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span> <span class="c1">//if big enough</span>
    <span class="kp">coef</span> <span class="o">/=</span> <span class="mf">1.5</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Movemesh</span>
<span class="n">Th</span> <span class="o">=</span> <span class="nf">movemesh</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="p">[</span><span class="kr">x</span><span class="o">+</span><span class="kp">coef</span><span class="o">*</span><span class="n">uu</span><span class="p">,</span> <span class="kr">y</span><span class="o">+</span><span class="kp">coef</span><span class="o">*</span><span class="n">vv</span><span class="p">]);</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="kp">wait</span><span class="o">=</span><span class="kr">true</span><span class="p">,</span> <span class="kp">fill</span><span class="o">=</span><span class="kr">true</span><span class="p">,</span> <span class="kp">ps</span><span class="o">=</span><span class="s">&quot;MovedMesh.eps&quot;</span><span class="p">);</span>
</pre></div>
</td></tr></table>

<table>
<thead>
<tr>
<th align="center"><a name="Fig12">Fig. 12</a>: L-shape</th>
<th align="center"><a name=Fig13">Fig. 13</a>: moved L-shape</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="L-shape" src="../images/MeshGeneration_MoveMesh1.png" /></td>
<td align="center"><img alt="moved L shaped" src="../images/MeshGeneration_MoveMesh2.png" /></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Consider a function <span><span class="MathJax_Preview">u</span><script type="math/tex">u</script></span> defined on a mesh <code class="codehilite"><span class="n">Th</span></code>. A statement like <code class="codehilite"><span class="n">Th</span><span class="o">=</span><span class="nf">movemesh</span><span class="p">(</span><span class="n">Th</span><span class="p">...)</span></code> does not change <span><span class="MathJax_Preview">u</span><script type="math/tex">u</script></span> and so the old mesh still exists. It will be destroyed when no function uses it. A statement like <span><span class="MathJax_Preview">u=u</span><script type="math/tex">u=u</script></span> redefines <span><span class="MathJax_Preview">u</span><script type="math/tex">u</script></span> on the new mesh <code class="codehilite"><span class="n">Th</span></code> with interpolation and therefore destroys the old <code class="codehilite"><span class="n">Th</span></code>, if <span><span class="MathJax_Preview">u</span><script type="math/tex">u</script></span> was the only function using it.</p>
</div>
<p>Now, we give an example of moving a mesh with a Lagrangian function <span><span class="MathJax_Preview">u</span><script type="math/tex">u</script></span> defined on the moving mesh.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1">// Parameters</span>
<span class="kt">int</span> <span class="n">nn</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
<span class="kt">real</span> <span class="n">dt</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">;</span>

<span class="c1">// Mesh</span>
<span class="kt">mesh</span> <span class="n">Th</span> <span class="o">=</span> <span class="nf">square</span><span class="p">(</span><span class="n">nn</span><span class="p">,</span> <span class="n">nn</span><span class="p">);</span>

<span class="c1">// Fespace</span>
<span class="kt">fespace</span> <span class="nf">Vh</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="nc">P1</span><span class="p">);</span>
<span class="n">Vh</span> <span class="n">u</span><span class="o">=</span><span class="kr">y</span><span class="p">;</span>

<span class="c1">// Loop</span>
<span class="kt">real</span> <span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">){</span>
    <span class="kp">t</span> <span class="o">=</span> <span class="n">i</span><span class="o">*</span><span class="n">dt</span><span class="p">;</span>
    <span class="n">Vh</span> <span class="n">f</span><span class="o">=</span><span class="kr">x</span><span class="o">*</span><span class="kp">t</span><span class="p">;</span>
    <span class="kt">real</span> <span class="n">minarea</span> <span class="o">=</span> <span class="nf">checkmovemesh</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="p">[</span><span class="kr">x</span><span class="p">,</span> <span class="kr">y</span><span class="o">+</span><span class="n">f</span><span class="p">]);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">minarea</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="c1">//movemesh will be ok</span>
    <span class="n">Th</span> <span class="o">=</span> <span class="nf">movemesh</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="p">[</span><span class="kr">x</span><span class="p">,</span> <span class="kr">y</span><span class="o">+</span><span class="n">f</span><span class="p">]);</span>

    <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; Min area = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">minarea</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>

    <span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">tmp</span><span class="p">(</span><span class="n">u</span><span class="p">[].</span><span class="kr">n</span><span class="p">);</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="n">u</span><span class="p">[];</span> <span class="c1">//save the value</span>
    <span class="n">u</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span><span class="c1">//to change the FEspace and mesh associated with u</span>
    <span class="n">u</span><span class="p">[]</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">;</span><span class="c1">//set the value of u without any mesh update</span>
    <span class="nf">plot</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="kp">wait</span><span class="o">=</span><span class="kr">true</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// In this program, since u is only defined on the last mesh, all the</span>
<span class="c1">// previous meshes are deleted from memory.</span>
</pre></div>
</td></tr></table>

<h2 id="regular-triangulation-htriangle">Regular Triangulation: <code class="codehilite"><span class="kr">hTriangle</span></code><a class="headerlink" href="#regular-triangulation-htriangle" title="Permanent link">#</a></h2>
<p>For a set <span><span class="MathJax_Preview">S</span><script type="math/tex">S</script></span>, we define the diameter of <span><span class="MathJax_Preview">S</span><script type="math/tex">S</script></span> by</p>
<div>
<div class="MathJax_Preview">
\textrm{diam}(S)=\sup\{|\mathbf{x}-\mathbf{y}|; \; \mathbf{x},\, \mathbf{y}\in S\}
</div>
<script type="math/tex; mode=display">
\textrm{diam}(S)=\sup\{|\mathbf{x}-\mathbf{y}|; \; \mathbf{x},\, \mathbf{y}\in S\}
</script>
</div>
<p>The sequence <span><span class="MathJax_Preview">\{\mathcal{T}_h\}_{h\rightarrow 0}</span><script type="math/tex">\{\mathcal{T}_h\}_{h\rightarrow 0}</script></span> of <span><span class="MathJax_Preview">\Omega</span><script type="math/tex">\Omega</script></span> is called <em>regular</em> if they satisfy the following:</p>
<ol>
<li>
<p><span><span class="MathJax_Preview">\lim_{h\rightarrow 0}\max\{\textrm{diam}(T_k)|\; T_k\in \mathcal{T}_h\}=0</span><script type="math/tex">\lim_{h\rightarrow 0}\max\{\textrm{diam}(T_k)|\; T_k\in \mathcal{T}_h\}=0</script></span></p>
</li>
<li>
<p>There is a number <span><span class="MathJax_Preview">\sigma&gt;0</span><script type="math/tex">\sigma>0</script></span> independent of <span><span class="MathJax_Preview">h</span><script type="math/tex">h</script></span> such that
    <span><span class="MathJax_Preview">\frac{\rho(T_k)}{\textrm{diam}(T_k)}\ge \sigma\qquad \textrm{for all }T_k\in \mathcal{T}_h</span><script type="math/tex">\frac{\rho(T_k)}{\textrm{diam}(T_k)}\ge \sigma\qquad \textrm{for all }T_k\in \mathcal{T}_h</script></span>
    where <span><span class="MathJax_Preview">\rho(T_k)</span><script type="math/tex">\rho(T_k)</script></span> are the diameter of the inscribed circle of <span><span class="MathJax_Preview">T_k</span><script type="math/tex">T_k</script></span>.</p>
</li>
</ol>
<p>We put <span><span class="MathJax_Preview">h(\mathcal{T}_h)=\max\{\textrm{diam}(T_k)|\; T_k\in \mathcal{T}_h\}</span><script type="math/tex">h(\mathcal{T}_h)=\max\{\textrm{diam}(T_k)|\; T_k\in \mathcal{T}_h\}</script></span>,
which is obtained by</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">mesh</span> <span class="n">Th</span> <span class="o">=</span> <span class="p">......;</span>
<span class="kt">fespace</span> <span class="nf">Ph</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="nc">P0</span><span class="p">);</span>
<span class="n">Ph</span> <span class="n">h</span> <span class="o">=</span> <span class="kr">hTriangle</span><span class="p">;</span>
<span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;size of mesh = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">h</span><span class="p">[].</span><span class="kr">max</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<h2 id="adaptmesh">Adaptmesh<a class="headerlink" href="#adaptmesh" title="Permanent link">#</a></h2>
<p>The function
<script type="math/tex; mode=display">
f(x,y) = 10.0x^3+y^3+\tan^{-1}[\varepsilon/(\sin(5.0y)-2.0x)],\ \varepsilon = 0.0001
</script>
sharply varies in value and the initial mesh given by one of the commands in the <a href="##commands-for-mesh-generation">Mesh Generation section</a> cannot reflect its sharp variations.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1">// Parameters</span>
<span class="kt">real</span> <span class="kp">eps</span> <span class="o">=</span> <span class="mf">0.0001</span><span class="p">;</span>
<span class="kt">real</span> <span class="n">h</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="kt">real</span> <span class="kp">hmin</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">;</span>
<span class="kt">func</span> <span class="n">f</span> <span class="o">=</span> <span class="mf">10.0</span><span class="o">*</span><span class="kr">x</span><span class="o">^</span><span class="mi">3</span> <span class="o">+</span> <span class="kr">y</span><span class="o">^</span><span class="mi">3</span> <span class="o">+</span> <span class="n">h</span><span class="o">*</span><span class="nf">atan2</span><span class="p">(</span><span class="kp">eps</span><span class="p">,</span> <span class="nf">sin</span><span class="p">(</span><span class="mf">5.0</span><span class="o">*</span><span class="kr">y</span><span class="p">)</span><span class="o">-</span><span class="mf">2.0</span><span class="o">*</span><span class="kr">x</span><span class="p">);</span>

<span class="c1">// Mesh</span>
<span class="kt">mesh</span> <span class="n">Th</span> <span class="o">=</span> <span class="nf">square</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="kr">x</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="kr">y</span><span class="p">]);</span>

<span class="c1">// Fespace</span>
<span class="kt">fespace</span> <span class="nf">Vh</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span><span class="nc">P1</span><span class="p">);</span>
<span class="n">Vh</span> <span class="n">fh</span> <span class="o">=</span> <span class="n">f</span><span class="p">;</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">fh</span><span class="p">);</span>

<span class="c1">// Adaptmesh</span>
<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">){</span>
    <span class="n">Th</span> <span class="o">=</span> <span class="nf">adaptmesh</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="n">fh</span><span class="p">);</span>
    <span class="n">fh</span> <span class="o">=</span> <span class="n">f</span><span class="p">;</span> <span class="c1">//old mesh is deleted</span>
    <span class="nf">plot</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="n">fh</span><span class="p">,</span> <span class="kp">wait</span><span class="o">=</span><span class="kr">true</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<table>
<thead>
<tr>
<th align="left"><a name="Fig14">Fig. 14</a>: 3D graphs for the initial mesh and 1st and 2nd mesh adaptations</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><img alt="Mesh adaptation" src="../images/MeshGeneration_AdaptMesh1.png" /></td>
</tr>
</tbody>
</table>
<p>FreeFem++ uses a variable metric/Delaunay automatic meshing algorithm.</p>
<p>The command:</p>
<p><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">mesh</span> <span class="n">ATh</span> <span class="o">=</span> <span class="nf">adaptmesh</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="n">f</span><span class="p">);</span>
</pre></div>
</td></tr></table>
create the new mesh <code class="codehilite"><span class="n">ATh</span></code> adapted to the Hessian</p>
<div>
<div class="MathJax_Preview">
D^2f=(\p^2 f/\p x^2,\, \p^2 f/\p x\p y, \p^2 f/\p y^2)
</div>
<script type="math/tex; mode=display">
D^2f=(\p^2 f/\p x^2,\, \p^2 f/\p x\p y, \p^2 f/\p y^2)
</script>
</div>
<p>of a function (formula or FE-function).</p>
<p>Mesh adaptation is a very powerful tool when the solution of a problem varies locally and sharply.</p>
<p>Here we solve the <a href="/tutorials/">Poisson's problem</a>, when <span><span class="MathJax_Preview">f=1</span><script type="math/tex">f=1</script></span> and <span><span class="MathJax_Preview">\Omega</span><script type="math/tex">\Omega</script></span> is a L-shape domain.</p>
<table>
<thead>
<tr>
<th align="left"><a name="Fig15">Fig. 15</a>: L-shape domain and its boundary name</th>
<th align="left"><a name="Fig16">Fig. 16</a>: Final solution after 4-times adaptation</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><img alt="L-shape2" src="../images/MeshGeneration_AdaptMesh2.png" /></td>
<td align="left"><img alt="L Shape solution" src="../images/MeshGeneration_AdaptMesh3.png" /></td>
</tr>
</tbody>
</table>
<div class="admonition example">
<p class="admonition-title">Example</p>
<p>The solution has the singularity <span><span class="MathJax_Preview">r^{3/2},\, r=|x-\gamma|</span><script type="math/tex">r^{3/2},\, r=|x-\gamma|</script></span> at the point <span><span class="MathJax_Preview">\gamma</span><script type="math/tex">\gamma</script></span> of the intersection of two lines <span><span class="MathJax_Preview">bc</span><script type="math/tex">bc</script></span> and <span><span class="MathJax_Preview">bd</span><script type="math/tex">bd</script></span> (see <a href="#Fig15">Fig. 15</a>).</p>
</div>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1">// Parameters</span>
<span class="kt">real</span> <span class="n">error</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">;</span>

<span class="c1">// Mesh</span>
<span class="kt">border</span> <span class="nf">ba</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="kp">t</span><span class="p">;</span> <span class="kr">y</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="kr">label</span><span class="o">=</span><span class="mi">1</span><span class="p">;}</span>
<span class="kt">border</span> <span class="kp">bb</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="kr">y</span><span class="o">=</span><span class="kp">t</span><span class="p">;</span> <span class="kr">label</span><span class="o">=</span><span class="mi">1</span><span class="p">;}</span>
<span class="kt">border</span> <span class="nf">bc</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="mi">1</span><span class="o">-</span><span class="kp">t</span><span class="p">;</span> <span class="kr">y</span><span class="o">=</span><span class="mf">0.5</span><span class="p">;</span> <span class="kr">label</span><span class="o">=</span><span class="mi">1</span><span class="p">;}</span>
<span class="kt">border</span> <span class="nf">bd</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="mf">0.5</span><span class="p">;</span> <span class="kr">y</span><span class="o">=</span><span class="kp">t</span><span class="p">;</span> <span class="kr">label</span><span class="o">=</span><span class="mi">1</span><span class="p">;}</span>
<span class="kt">border</span> <span class="kr">be</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="mi">1</span><span class="o">-</span><span class="kp">t</span><span class="p">;</span> <span class="kr">y</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="kr">label</span><span class="o">=</span><span class="mi">1</span><span class="p">;}</span>
<span class="kt">border</span> <span class="nf">bf</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="kr">y</span><span class="o">=</span><span class="mi">1</span><span class="o">-</span><span class="kp">t</span><span class="p">;</span> <span class="kr">label</span><span class="o">=</span><span class="mi">1</span><span class="p">;}</span>
<span class="kt">mesh</span> <span class="n">Th</span> <span class="o">=</span> <span class="nf">buildmesh</span><span class="p">(</span><span class="n">ba</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="o">+</span> <span class="kp">bb</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">bc</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">bd</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="kr">be</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">bf</span><span class="p">(</span><span class="mi">6</span><span class="p">));</span>

<span class="c1">// Fespace</span>
<span class="kt">fespace</span> <span class="nf">Vh</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="nc">P1</span><span class="p">);</span>
<span class="n">Vh</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">;</span>

<span class="c1">// Function</span>
<span class="kt">func</span> <span class="n">f</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

<span class="c1">// Problem</span>
<span class="kt">problem</span> <span class="nf">Poisson</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="kp">solver</span><span class="o">=</span><span class="kr">CG</span><span class="p">,</span> <span class="kp">eps</span><span class="o">=</span><span class="mf">1.e-6</span><span class="p">)</span>
    <span class="o">=</span> <span class="nf">int2d</span><span class="p">(</span><span class="n">Th</span><span class="p">)(</span>
          <span class="nf">dx</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">*</span><span class="nf">dx</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="o">+</span> <span class="nf">dy</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">*</span><span class="nf">dy</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="o">-</span> <span class="nf">int2d</span><span class="p">(</span><span class="n">Th</span><span class="p">)(</span>
          <span class="n">f</span><span class="o">*</span><span class="n">v</span>
    <span class="p">)</span>
    <span class="o">+</span> <span class="nf">on</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">u</span><span class="o">=</span><span class="mi">0</span><span class="p">);</span>

<span class="c1">// Adaptmesh loop</span>
<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">){</span>
    <span class="n">Poisson</span><span class="p">;</span>
    <span class="n">Th</span> <span class="o">=</span> <span class="nf">adaptmesh</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="kp">err</span><span class="o">=</span><span class="n">error</span><span class="p">);</span>
    <span class="n">error</span> <span class="o">=</span> <span class="n">error</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Plot</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">u</span><span class="p">);</span>
</pre></div>
</td></tr></table>

<p>To speed up the adaptation, the default parameter <code class="codehilite"><span class="kp">err</span></code> of <code class="codehilite"><span class="nf">adaptmesh</span></code> is changed by hand; it specifies the required precision, so as to make the new mesh finer or coarser.</p>
<p>The problem is coercive and symmetric, so the linear system can be solved with the conjugate gradient method (parameter <code class="codehilite"><span class="kp">solver</span><span class="o">=</span><span class="kr">CG</span></code>) with the stopping criteria on the residual, here <code class="codehilite"><span class="kp">eps</span><span class="o">=</span><span class="mf">1.e-6</span></code>).</p>
<p>By <code class="codehilite"><span class="nf">adaptmesh</span></code>, the slope of the final solution is correctly computed near
the point of intersection of <span><span class="MathJax_Preview">bc</span><script type="math/tex">bc</script></span> and <span><span class="MathJax_Preview">bd</span><script type="math/tex">bd</script></span> as in <a href="#Fig16">Fig. 16</a>.</p>
<p>This method is described in detail in <a href="#refHecht1998">Hecht1998</a>. It has a number of default parameters which can be modified.</p>
<p>If <code class="codehilite"><span class="n">f1</span><span class="p">,</span><span class="n">f2</span></code> are functions and <code class="codehilite"><span class="n">thold</span><span class="p">,</span> <span class="n">Thnew</span></code> are meshes:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">Thnew</span> <span class="o">=</span> <span class="nf">adaptmesh</span><span class="p">(</span><span class="n">Thold</span><span class="p">,</span> <span class="n">f1</span> <span class="p">...</span> <span class="p">);</span>
    <span class="n">Thnew</span> <span class="o">=</span> <span class="nf">adaptmesh</span><span class="p">(</span><span class="n">Thold</span><span class="p">,</span> <span class="n">f1</span><span class="p">,</span><span class="n">f2</span> <span class="p">...</span> <span class="p">]);</span>
    <span class="n">Thnew</span> <span class="o">=</span> <span class="nf">adaptmesh</span><span class="p">(</span><span class="n">Thold</span><span class="p">,</span> <span class="p">[</span><span class="n">f1</span><span class="p">,</span><span class="n">f2</span><span class="p">]</span> <span class="p">...</span> <span class="p">);</span>
</pre></div>
</td></tr></table>

<p>The additional parameters of <code class="codehilite"><span class="nf">adaptmesh</span></code> are:</p>
<p>See <a href="/reference/Functions/#adaptmesh">Reference part</a> for more inforamtions</p>
<ul>
<li>
<p><code class="codehilite"><span class="kp">hmin</span><span class="o">=</span></code> Minimum edge size. Its default is related to the size of the domain to be meshed and the precision of the mesh generator.</p>
</li>
<li>
<p><code class="codehilite"><span class="kp">hmax</span><span class="o">=</span></code> Maximum edge size. It defaults to the diameter of the domain to be meshed.</p>
</li>
<li>
<p><code class="codehilite"><span class="kp">err</span><span class="o">=</span></code> <span><span class="MathJax_Preview">P_1</span><script type="math/tex">P_1</script></span> interpolation error level (0.01 is the default).</p>
</li>
<li>
<p><code class="codehilite"><span class="kp">errg</span><span class="o">=</span></code> Relative geometrical error. By default this error is 0.01, and in any case it must be lower than <span><span class="MathJax_Preview">1/\sqrt{2}</span><script type="math/tex">1/\sqrt{2}</script></span>. Meshes created with this option may have some edges smaller than the <code class="codehilite"><span class="o">-</span><span class="kp">hmin</span></code> due to geometrical constraints.</p>
</li>
<li>
<p><code class="codehilite"><span class="kp">nbvx</span><span class="o">=</span></code> Maximum number of vertices generated by the mesh generator (9000 is the default).</p>
</li>
<li>
<p><code class="codehilite"><span class="kp">nbsmooth</span><span class="o">=</span></code> number of iterations of the smoothing procedure (5 is the default).</p>
</li>
<li>
<p><code class="codehilite"><span class="kp">nbjacoby</span><span class="o">=</span></code> number of iterations in a smoothing procedure during the metric construction, 0 means no smoothing, 6 is the default.</p>
</li>
<li>
<p><code class="codehilite"><span class="kp">ratio</span><span class="o">=</span></code> ratio for a prescribed smoothing on the metric. If the value is 0 or less than 1.1 no smoothing is done on the metric. 1.8 is the default.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Note: As <code class="codehilite"><span class="kp">ratio</span></code> gets closer to 1, the number of generated vertices increases. This may be useful to control the thickness of refined regions near shocks or boundary layers.</p>
</div>
</li>
<li>
<p><code class="codehilite"><span class="kp">omega</span><span class="o">=</span></code> relaxation parameter for the smoothing procedure. 1.0 is the default.</p>
</li>
<li>
<p><code class="codehilite"><span class="kp">iso</span><span class="o">=</span></code> If true, forces the metric to be isotropic. <code class="codehilite"><span class="kr">false</span></code> is the default.</p>
</li>
<li>
<p><code class="codehilite"><span class="kp">abserror</span><span class="o">=</span></code> If false, the metric is evaluated using the criteria of equi-repartion of relative error. <code class="codehilite"><span class="kr">false</span></code> is the default. In this case the metric is defined by
    <script type="math/tex; mode=display">\begin{equation}
        \mathcal{M} = \left({1\over\mathtt{err}\,\, \mathtt{coef}^2} \quad {
        |\mathcal{H}| \over max(\mathtt{CutOff},|\eta|)}\right)^p
        \label{eq err rel}
    \end{equation}</script>
    Otherwise, the metric is evaluated using the criteria of equi-distribution of errors. In this case the metric is defined by
    <script type="math/tex; mode=display">\begin{equation}
        \mathcal{M} = \left({1\over \mathtt{err}\,\,\mathtt{coef}^2} \quad
        {|{\mathcal{H}|} \over
        {\sup(\eta)-\inf(\eta)}}\right)^p.\label{eq err abs}
    \end{equation}</script>
</p>
</li>
<li>
<p><code class="codehilite"><span class="kp">cutoff</span><span class="o">=</span></code> lower limit for the relative error evaluation. 1.0e-6 is the default.</p>
</li>
<li>
<p><code class="codehilite"><span class="kr">verbosity</span><span class="o">=</span></code> informational messages level (can be chosen between 0 and <span><span class="MathJax_Preview">\infty</span><script type="math/tex">\infty</script></span>). Also changes the value of the global variable verbosity (obsolete).</p>
</li>
<li>
<p><code class="codehilite"><span class="kp">inquire</span><span class="o">=</span></code> To inquire graphically about the mesh. <code class="codehilite"><span class="kr">false</span></code> is the default.</p>
</li>
<li>
<p><code class="codehilite"><span class="kp">splitpbedge</span><span class="o">=</span></code> If true, splits all internal edges in half with two boundary vertices. <code class="codehilite"><span class="kr">true</span></code> is the
default.</p>
</li>
<li>
<p><code class="codehilite"><span class="kp">maxsubdiv</span><span class="o">=</span></code> Changes the metric such that the maximum subdivision of a background edge is bound by <code class="codehilite"><span class="n">val</span></code>. Always limited by 10, and 10 is also the default.</p>
</li>
<li>
<p><code class="codehilite"><span class="kp">rescaling</span><span class="o">=</span></code> if true, the function, with respect to which the mesh is adapted, is rescaled to be between 0 and 1. <code class="codehilite"><span class="kr">true</span></code> is the default.</p>
</li>
<li>
<p><code class="codehilite"><span class="kp">keepbackvertices</span><span class="o">=</span></code> if true, tries to keep as many vertices from the original mesh as possible. <code class="codehilite"><span class="kr">true</span></code> is the default.</p>
</li>
<li>
<p><code class="codehilite"><span class="kp">IsMetric</span><span class="o">=</span></code> if true, the metric is defined explicitly. <code class="codehilite"><span class="kr">false</span></code> is the default. If the 3 functions <span><span class="MathJax_Preview">m_{11}, m_{12}, m_{22}</span><script type="math/tex">m_{11}, m_{12}, m_{22}</script></span> are given, they directly define a symmetric matrix field whose Hessian is computed to define a metric. If only one function is given, then it represents the isotropic mesh size at every point.</p>
<p>For example, if the partial derivatives <code class="codehilite"><span class="n">fxx</span></code> (<span><span class="MathJax_Preview">=\p^2 f/\p x^2</span><script type="math/tex">=\p^2 f/\p x^2</script></span>), <code class="codehilite"><span class="n">fxy</span></code> (<span><span class="MathJax_Preview">=\p^2 f/\p x\p y</span><script type="math/tex">=\p^2 f/\p x\p y</script></span>), <code class="codehilite"><span class="n">fyy</span></code> (<span><span class="MathJax_Preview">=\p^2 f/\p y^2</span><script type="math/tex">=\p^2 f/\p y^2</script></span>) are given, we can set <code class="codehilite"><span class="n">Th</span> <span class="o">=</span> <span class="nf">adaptmesh</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="n">fxx</span><span class="p">,</span> <span class="n">fxy</span><span class="p">,</span> <span class="n">fyy</span><span class="p">,</span> <span class="kp">IsMetric</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="kp">nbvx</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="kp">hmin</span><span class="o">=</span><span class="kp">hmin</span><span class="p">);</span></code></p>
</li>
<li>
<p><code class="codehilite"><span class="kp">power</span><span class="o">=</span></code> exponent power of the Hessian used to compute the metric. 1 is the default.</p>
</li>
<li>
<p><code class="codehilite"><span class="kp">thetamax</span><span class="o">=</span></code> minimum corner angle in degrees. Default is <span><span class="MathJax_Preview">10^\circ</span><script type="math/tex">10^\circ</script></span> where the corner is <span><span class="MathJax_Preview">ABC</span><script type="math/tex">ABC</script></span> and the angle is the angle of the two vectors <span><span class="MathJax_Preview">{AB}, {BC}</span><script type="math/tex">{AB}, {BC}</script></span>, (<span><span class="MathJax_Preview">0</span><script type="math/tex">0</script></span> imply no corner, <span><span class="MathJax_Preview">90</span><script type="math/tex">90</script></span> imply perpendicular corner, ...).</p>
</li>
<li>
<p><code class="codehilite"><span class="kp">splitin2</span><span class="o">=</span></code> boolean value. If true, splits all triangles of the final mesh into 4 sub-triangles.</p>
</li>
<li>
<p><code class="codehilite"><span class="kp">metric</span><span class="o">=</span></code> an array of 3 real arrays to set or get metric data information. The size of these three arrays must be the number of vertices. So if <code class="codehilite"><span class="n">m11</span><span class="p">,</span><span class="n">m12</span><span class="p">,</span><span class="n">m22</span></code> are three P1 finite elements related to the mesh to adapt, you can write: <code class="codehilite"><span class="kp">metric</span><span class="o">=</span><span class="p">[</span><span class="n">m11</span><span class="p">[],</span><span class="n">m12</span><span class="p">[],</span><span class="n">m22</span><span class="p">[]]</span></code> (see file <code class="codehilite"><span class="nf">convect</span><span class="o">-</span><span class="n">apt</span><span class="p">.</span><span class="n">edp</span></code> for a full example)</p>
</li>
<li>
<p><code class="codehilite"><span class="kp">nomeshgeneration</span><span class="o">=</span></code> If true, no adapted mesh is generated (useful to compute only a metric).</p>
</li>
<li>
<p><code class="codehilite"><span class="kp">periodic</span><span class="o">=</span></code> Writing <code class="codehilite"><span class="kp">periodic</span><span class="o">=</span><span class="p">[[</span><span class="mi">4</span><span class="p">,</span><span class="kr">y</span><span class="p">],[</span><span class="mi">2</span><span class="p">,</span><span class="kr">y</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="kr">x</span><span class="p">],[</span><span class="mi">3</span><span class="p">,</span><span class="kr">x</span><span class="p">]];</span></code> builds an adapted periodic mesh. The sample builds a biperiodic mesh of a square. (see <a href="../FiniteElement">periodic finite element spaces</a>, and see <a href="/examples/#sphere">the Sphere example</a> for a full example)</p>
</li>
</ul>
<p>We can use the command <code class="codehilite"><span class="nf">adaptmesh</span></code> to build a uniform mesh with a constant mesh size. To build a mesh with a constant mesh size equal to <span><span class="MathJax_Preview">\frac{1}{30}</span><script type="math/tex">\frac{1}{30}</script></span> try:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">mesh</span> <span class="n">Th</span><span class="o">=</span><span class="nf">square</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span> <span class="c1">//the initial mesh</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="kp">wait</span><span class="o">=</span><span class="kr">true</span><span class="p">,</span> <span class="kp">ps</span><span class="o">=</span><span class="s">&quot;square-0.eps&quot;</span><span class="p">);</span>

<span class="n">Th</span> <span class="o">=</span> <span class="nf">adaptmesh</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="mf">1.</span><span class="o">/</span><span class="mf">30.</span><span class="p">,</span> <span class="kp">IsMetric</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="kp">nbvx</span><span class="o">=</span><span class="mi">10000</span><span class="p">);</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="kp">wait</span><span class="o">=</span><span class="kr">true</span><span class="p">,</span> <span class="kp">ps</span><span class="o">=</span><span class="s">&quot;square-1.eps&quot;</span><span class="p">);</span>

<span class="n">Th</span> <span class="o">=</span> <span class="nf">adaptmesh</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="mf">1.</span><span class="o">/</span><span class="mf">30.</span><span class="p">,</span> <span class="kp">IsMetric</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="kp">nbvx</span><span class="o">=</span><span class="mi">10000</span><span class="p">);</span> <span class="c1">//More the one time du to</span>
<span class="n">Th</span> <span class="o">=</span> <span class="nf">adaptmesh</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="mf">1.</span><span class="o">/</span><span class="mf">30.</span><span class="p">,</span> <span class="kp">IsMetric</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="kp">nbvx</span><span class="o">=</span><span class="mi">10000</span><span class="p">);</span> <span class="c1">//Adaptation bound `maxsubdiv=`</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="kp">wait</span><span class="o">=</span><span class="kr">true</span><span class="p">,</span> <span class="kp">ps</span><span class="o">=</span><span class="s">&quot;square-2.eps&quot;</span><span class="p">);</span>
</pre></div>
</td></tr></table>

<table>
<thead>
<tr>
<th align="left"><a name="Fig17">Fig. 17</a>: Initial mesh</th>
<th align="left"><a name="Fig18">Fig. 18</a>: First iteration</th>
<th align="left"><a name="Fig19">Fig. 19</a>: Last iteration</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><img alt="Initial mesh" src="../images/MeshGeneration_AdaptMesh4.png" /></td>
<td align="left"><img alt="First iteration" src="../images/MeshGeneration_AdaptMesh5.png" /></td>
<td align="left"><img alt="Last iteration" src="../images/MeshGeneration_AdaptMesh6.png" /></td>
</tr>
</tbody>
</table>
<h2 id="trunc">Trunc<a class="headerlink" href="#trunc" title="Permanent link">#</a></h2>
<p>Two operators have been introduced to remove triangles from a mesh or to divide them. Operator <code class="codehilite"><span class="nf">trunc</span></code> has two parameters:</p>
<ul>
<li><code class="codehilite"><span class="kr">label</span><span class="o">=</span></code> sets the label number of new boundary item, one by default.</li>
<li><code class="codehilite"><span class="kp">split</span><span class="o">=</span></code> sets the level <span><span class="MathJax_Preview">n</span><script type="math/tex">n</script></span> of triangle splitting. Each triangle is split in <span><span class="MathJax_Preview">n\times n</span><script type="math/tex">n\times n</script></span>, one by default.</li>
</ul>
<p>To create the mesh <code class="codehilite"><span class="n">Th3</span></code> where all triangles of a mesh <code class="codehilite"><span class="n">Th</span></code> are split in <span><span class="MathJax_Preview">3{\times}3</span><script type="math/tex">3{\times}3</script></span>, just write:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">mesh</span> <span class="n">Th3</span> <span class="o">=</span> <span class="nf">trunc</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="kp">split</span><span class="o">=</span><span class="mi">3</span><span class="p">);</span>
</pre></div>
</td></tr></table>

<p>The following example construct all "trunced" meshes to the support of the basic function of the space <code class="codehilite"><span class="n">Vh</span></code> (cf. <code class="codehilite"><span class="nf">abs</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span></code>), split all the triangles in <span><span class="MathJax_Preview">5{\times} 5</span><script type="math/tex">5{\times} 5</script></span>, and put a label number to <span><span class="MathJax_Preview">2</span><script type="math/tex">2</script></span> on a new boundary.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1">// Mesh</span>
<span class="kt">mesh</span> <span class="n">Th</span> <span class="o">=</span> <span class="nf">square</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>

<span class="c1">// Fespace</span>
<span class="kt">fespace</span> <span class="nf">Vh</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="nc">P1</span><span class="p">);</span>
<span class="n">Vh</span> <span class="n">u</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>

<span class="c1">// Loop on all degrees of freedom</span>
<span class="kt">int</span> <span class="kr">n</span><span class="o">=</span><span class="n">u</span><span class="p">.</span><span class="kr">n</span><span class="p">;</span>
<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="kr">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">){</span>
    <span class="n">u</span><span class="p">[][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// The basis function i</span>
    <span class="nf">plot</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="kp">wait</span><span class="o">=</span><span class="kr">true</span><span class="p">);</span>
    <span class="kt">mesh</span> <span class="n">Sh1</span> <span class="o">=</span> <span class="nf">trunc</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="nf">abs</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">&gt;</span><span class="mf">1.e-10</span><span class="p">,</span> <span class="kp">split</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="kr">label</span><span class="o">=</span><span class="mi">2</span><span class="p">);</span>
    <span class="nf">plot</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="n">Sh1</span><span class="p">,</span> <span class="kp">wait</span><span class="o">=</span><span class="kr">true</span><span class="p">,</span> <span class="kp">ps</span><span class="o">=</span><span class="s">&quot;</span><span class="nf">trunc</span><span class="s">&quot;</span><span class="o">+</span><span class="n">i</span><span class="o">+</span><span class="s">&quot;.eps&quot;</span><span class="p">);</span>
    <span class="n">u</span><span class="p">[][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// reset</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<table>
<thead>
<tr>
<th align="left"><a name="Fig20">Fig. 20</a>: mesh of support the function P1 number 0, split in <span><span class="MathJax_Preview">5{\times}5</span><script type="math/tex">5{\times}5</script></span></th>
<th align="left"><a name="Fig21">Fig. 21</a>: Mesh of support the function P1 number 6, split in <span><span class="MathJax_Preview">5{\times}5</span><script type="math/tex">5{\times}5</script></span></th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><img alt="Trunc0" src="../images/MeshGeneration_Trunc1.png" /></td>
<td align="left"><img alt="Trunc6" src="../images/MeshGeneration_Trunc2.png" /></td>
</tr>
</tbody>
</table>
<h2 id="splitmesh">Splitmesh<a class="headerlink" href="#splitmesh" title="Permanent link">#</a></h2>
<p>Another way to split mesh triangles is to use <code class="codehilite"><span class="nf">splitmesh</span></code>, for example:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1">// Mesh</span>
<span class="kt">border</span> <span class="nf">a</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="kr">pi</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="nf">cos</span><span class="p">(</span><span class="kp">t</span><span class="p">);</span> <span class="kr">y</span><span class="o">=</span><span class="nf">sin</span><span class="p">(</span><span class="kp">t</span><span class="p">);</span> <span class="kr">label</span><span class="o">=</span><span class="mi">1</span><span class="p">;}</span>
<span class="kt">mesh</span> <span class="n">Th</span> <span class="o">=</span> <span class="nf">buildmesh</span><span class="p">(</span><span class="n">a</span><span class="p">(</span><span class="mi">20</span><span class="p">));</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="kp">wait</span><span class="o">=</span><span class="kr">true</span><span class="p">,</span> <span class="kp">ps</span><span class="o">=</span><span class="s">&quot;NotSplittedMesh.eps&quot;</span><span class="p">);</span>

<span class="c1">// Splitmesh</span>
<span class="n">Th</span> <span class="o">=</span> <span class="nf">splitmesh</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="mi">1</span> <span class="o">+</span> <span class="mi">5</span><span class="o">*</span><span class="p">(</span><span class="nf">square</span><span class="p">(</span><span class="kr">x</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span> <span class="o">+</span> <span class="kr">y</span><span class="o">*</span><span class="kr">y</span><span class="p">));</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="kp">wait</span><span class="o">=</span><span class="kr">true</span><span class="p">,</span> <span class="kp">ps</span><span class="o">=</span><span class="s">&quot;SplittedMesh.eps&quot;</span><span class="p">);</span>
</pre></div>
</td></tr></table>

<table>
<thead>
<tr>
<th align="center"><a name="Fig22">Fig. 22</a>: Initial mesh</th>
<th align="center"><a name="Fig23">Fig. 23</a>: all left mesh triangle is split conformaly in <code class="codehilite"><span class="kt">int</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="mi">5</span><span class="o">*</span><span class="p">(</span><span class="nf">square</span><span class="p">(</span><span class="kr">x</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span><span class="o">+</span><span class="kr">y</span><span class="o">*</span><span class="kr">y</span><span class="p">)</span><span class="err">\</span><span class="o">^</span><span class="mi">2</span></code> triangles</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="No split mesh" src="../images/MeshGeneration_SplitMesh1.png" /></td>
<td align="center"><img alt="split mesh" src="../images/MeshGeneration_SplitMesh2.png" /></td>
</tr>
</tbody>
</table>
<h2 id="meshing-examples">Meshing Examples<a class="headerlink" href="#meshing-examples" title="Permanent link">#</a></h2>
<div class="admonition example">
<p class="admonition-title">Two rectangles touching by a side</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">border</span> <span class="nf">a</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="kp">t</span><span class="p">;</span> <span class="kr">y</span><span class="o">=</span><span class="mi">0</span><span class="p">;};</span>
<span class="kt">border</span> <span class="nf">b</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="kr">y</span><span class="o">=</span><span class="kp">t</span><span class="p">;};</span>
<span class="kt">border</span> <span class="nf">c</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="kp">t</span><span class="p">;</span> <span class="kr">y</span><span class="o">=</span><span class="mi">1</span><span class="p">;};</span>
<span class="kt">border</span> <span class="nf">d</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="kr">y</span><span class="o">=</span><span class="kp">t</span><span class="p">;};</span>
<span class="kt">border</span> <span class="nf">c1</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="kp">t</span><span class="p">;</span> <span class="kr">y</span><span class="o">=</span><span class="mi">1</span><span class="p">;};</span>
<span class="kt">border</span> <span class="nf">e</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="kr">y</span><span class="o">=</span><span class="mi">1</span><span class="o">+</span><span class="kp">t</span><span class="p">;};</span>
<span class="kt">border</span> <span class="nf">f</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="kp">t</span><span class="p">;</span> <span class="kr">y</span><span class="o">=</span><span class="mf">1.2</span><span class="p">;};</span>
<span class="kt">border</span> <span class="nf">g</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="mi">0</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="kr">y</span><span class="o">=</span><span class="mi">1</span><span class="o">+</span><span class="kp">t</span><span class="p">;};</span>
<span class="kt">int</span> <span class="kr">n</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
<span class="kt">mesh</span> <span class="n">th</span> <span class="o">=</span> <span class="nf">buildmesh</span><span class="p">(</span><span class="n">a</span><span class="p">(</span><span class="mi">10</span><span class="o">*</span><span class="kr">n</span><span class="p">)</span> <span class="o">+</span> <span class="n">b</span><span class="p">(</span><span class="mi">10</span><span class="o">*</span><span class="kr">n</span><span class="p">)</span> <span class="o">+</span> <span class="n">c</span><span class="p">(</span><span class="mi">10</span><span class="o">*</span><span class="kr">n</span><span class="p">)</span> <span class="o">+</span> <span class="nf">d</span><span class="p">(</span><span class="mi">10</span><span class="o">*</span><span class="kr">n</span><span class="p">));</span>
<span class="kt">mesh</span> <span class="n">TH</span> <span class="o">=</span> <span class="nf">buildmesh</span><span class="p">(</span><span class="n">c1</span><span class="p">(</span><span class="mi">10</span><span class="o">*</span><span class="kr">n</span><span class="p">)</span> <span class="o">+</span> <span class="n">e</span><span class="p">(</span><span class="mi">5</span><span class="o">*</span><span class="kr">n</span><span class="p">)</span> <span class="o">+</span> <span class="n">f</span><span class="p">(</span><span class="mi">10</span><span class="o">*</span><span class="kr">n</span><span class="p">)</span> <span class="o">+</span> <span class="n">g</span><span class="p">(</span><span class="mi">5</span><span class="o">*</span><span class="kr">n</span><span class="p">));</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">th</span><span class="p">,</span> <span class="n">TH</span><span class="p">,</span> <span class="kp">ps</span><span class="o">=</span><span class="s">&quot;TouchSide.esp&quot;</span><span class="p">);</span>
</pre></div>
</td></tr></table>

<p><center>
<!-- Review -->
|<a name="Fig24">Fig. 24</a>: Two rectangles touching by a side|
|:----:|
|<img alt="Rectangles touching by a side" src="../images/MeshGeneration_Example_NACA0012_1.png" />|</p>
<p></center></p>
</div>
<div class="admonition example">
<p class="admonition-title">NACA0012 Airfoil</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">border</span> <span class="nf">upper</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">){</span>
    <span class="kr">x</span><span class="o">=</span><span class="kp">t</span><span class="p">;</span>
    <span class="kr">y</span><span class="o">=</span><span class="mf">0.17735</span><span class="o">*</span><span class="nf">sqrt</span><span class="p">(</span><span class="kp">t</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.075597</span><span class="o">*</span><span class="kp">t</span> <span class="o">-</span> <span class="mf">0.212836</span><span class="o">*</span><span class="p">(</span><span class="kp">t</span><span class="o">^</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.17363</span><span class="o">*</span><span class="p">(</span><span class="kp">t</span><span class="o">^</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.06254</span><span class="o">*</span><span class="p">(</span><span class="kp">t</span><span class="o">^</span><span class="mi">4</span><span class="p">);</span>
<span class="p">}</span>
<span class="kt">border</span> <span class="nf">lower</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">){</span>
    <span class="kr">x</span> <span class="o">=</span> <span class="kp">t</span><span class="p">;</span>
    <span class="kr">y</span><span class="o">=-</span><span class="p">(</span><span class="mf">0.17735</span><span class="o">*</span><span class="nf">sqrt</span><span class="p">(</span><span class="kp">t</span><span class="p">)</span> <span class="o">-</span><span class="mf">0.075597</span><span class="o">*</span><span class="kp">t</span> <span class="o">-</span> <span class="mf">0.212836</span><span class="o">*</span><span class="p">(</span><span class="kp">t</span><span class="o">^</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.17363</span><span class="o">*</span><span class="p">(</span><span class="kp">t</span><span class="o">^</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.06254</span><span class="o">*</span><span class="p">(</span><span class="kp">t</span><span class="o">^</span><span class="mi">4</span><span class="p">));</span>
<span class="p">}</span>
<span class="kt">border</span> <span class="nf">c</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="kr">pi</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="mf">0.8</span><span class="o">*</span><span class="nf">cos</span><span class="p">(</span><span class="kp">t</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">;</span> <span class="kr">y</span><span class="o">=</span><span class="mf">0.8</span><span class="o">*</span><span class="nf">sin</span><span class="p">(</span><span class="kp">t</span><span class="p">);}</span>
<span class="kt">mesh</span> <span class="n">Th</span> <span class="o">=</span> <span class="nf">buildmesh</span><span class="p">(</span><span class="n">c</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span> <span class="o">+</span> <span class="n">upper</span><span class="p">(</span><span class="mi">35</span><span class="p">)</span> <span class="o">+</span> <span class="n">lower</span><span class="p">(</span><span class="mi">35</span><span class="p">));</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="kp">ps</span><span class="o">=</span><span class="s">&quot;NACA0012.eps&quot;</span><span class="p">,</span> <span class="kp">bw</span><span class="o">=</span><span class="kr">true</span><span class="p">);</span>
</pre></div>
</td></tr></table>

<p><center></p>
<table>
<thead>
<tr>
<th align="center"><a name="Fig25">Fig. 25</a>: NACA0012 Airfoil</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="NACA0012 Airfoil" src="../images/MeshGeneration_Example_NACA0012_2.png" /></td>
</tr>
</tbody>
</table>
<p></center></p>
</div>
<div class="admonition example">
<p class="admonition-title">Cardioid</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">real</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="n">b</span><span class="p">;</span>

<span class="kt">border</span> <span class="nf">C</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="kr">pi</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="p">)</span><span class="o">*</span><span class="nf">cos</span><span class="p">(</span><span class="kp">t</span><span class="p">)</span><span class="o">-</span><span class="n">b</span><span class="o">*</span><span class="nf">cos</span><span class="p">((</span><span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="p">)</span><span class="o">*</span><span class="kp">t</span><span class="o">/</span><span class="n">b</span><span class="p">);</span> <span class="kr">y</span><span class="o">=</span><span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="p">)</span><span class="o">*</span><span class="nf">sin</span><span class="p">(</span><span class="kp">t</span><span class="p">)</span><span class="o">-</span><span class="n">b</span><span class="o">*</span><span class="nf">sin</span><span class="p">((</span><span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="p">)</span><span class="o">*</span><span class="kp">t</span><span class="o">/</span><span class="n">b</span><span class="p">);}</span>
<span class="kt">mesh</span> <span class="n">Th</span> <span class="o">=</span> <span class="nf">buildmesh</span><span class="p">(</span><span class="n">C</span><span class="p">(</span><span class="mi">50</span><span class="p">));</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="kp">ps</span><span class="o">=</span><span class="s">&quot;Cardioid.eps&quot;</span><span class="p">,</span> <span class="kp">bw</span><span class="o">=</span><span class="kr">true</span><span class="p">);</span>
</pre></div>
</td></tr></table>

<p><center></p>
<table>
<thead>
<tr>
<th align="center"><a name="Fig26">Fig. 26</a>: Domain with Cardioid curve boundary</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="Cardiod" src="../images/MeshGeneration_Example_Cardioid1.png" /></td>
</tr>
</tbody>
</table>
<p></center></p>
</div>
<div class="admonition example">
<p class="admonition-title">Cassini Egg</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">border</span> <span class="nf">C</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="kr">pi</span><span class="p">)</span> <span class="p">{</span><span class="kr">x</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="nf">cos</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="kp">t</span><span class="p">)</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="nf">cos</span><span class="p">(</span><span class="kp">t</span><span class="p">);</span> <span class="kr">y</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="nf">cos</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="kp">t</span><span class="p">)</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="nf">sin</span><span class="p">(</span><span class="kp">t</span><span class="p">);}</span>
<span class="kt">mesh</span> <span class="n">Th</span> <span class="o">=</span> <span class="nf">buildmesh</span><span class="p">(</span><span class="n">C</span><span class="p">(</span><span class="mi">50</span><span class="p">));</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="kp">ps</span><span class="o">=</span><span class="s">&quot;Cassini.eps&quot;</span><span class="p">,</span> <span class="kp">bw</span><span class="o">=</span><span class="kr">true</span><span class="p">);</span>
</pre></div>
</td></tr></table>

<p><center></p>
<table>
<thead>
<tr>
<th align="center"><a name="Fig27">Fig. 27</a>: Domain with Cassini Egg curve boundary</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="Cassini" src="../images/MeshGeneration_Example_Cardioid2.png" /></td>
</tr>
</tbody>
</table>
<p></center></p>
</div>
<div class="admonition example">
<p class="admonition-title">By cubic Bezier curve</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1">// A cubic Bezier curve connecting two points with two control points</span>
<span class="kt">func</span> <span class="kt">real</span> <span class="nf">bzi</span><span class="p">(</span><span class="kt">real</span> <span class="n">p0</span><span class="p">,</span> <span class="kt">real</span> <span class="n">p1</span><span class="p">,</span> <span class="kt">real</span> <span class="n">q1</span><span class="p">,</span> <span class="kt">real</span> <span class="n">q2</span><span class="p">,</span> <span class="kt">real</span> <span class="kp">t</span><span class="p">){</span>
    <span class="k">return</span> <span class="n">p0</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="kp">t</span><span class="p">)</span><span class="o">^</span><span class="mi">3</span> <span class="o">+</span> <span class="n">q1</span><span class="o">*</span><span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="kp">t</span><span class="p">)</span><span class="o">^</span><span class="mi">2</span><span class="o">*</span><span class="kp">t</span> <span class="o">+</span> <span class="n">q2</span><span class="o">*</span><span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="kp">t</span><span class="p">)</span><span class="o">*</span><span class="kp">t</span><span class="o">^</span><span class="mi">2</span> <span class="o">+</span> <span class="n">p1</span><span class="o">*</span><span class="kp">t</span><span class="o">^</span><span class="mi">3</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">p00</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">p01</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">q00</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">],</span> <span class="n">q01</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">];</span>
<span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">p11</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mf">0.9</span><span class="p">],</span> <span class="n">q10</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.95</span><span class="p">],</span> <span class="n">q11</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">];</span>
<span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">p21</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">],</span> <span class="n">q20</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.4</span><span class="p">],</span> <span class="n">q21</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">];</span>
<span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">q30</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">],</span> <span class="n">q31</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">];</span>
<span class="kt">border</span> <span class="nf">G1</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">){</span>
    <span class="kr">x</span><span class="o">=</span><span class="n">bzi</span><span class="p">(</span><span class="n">p00</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p01</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">q00</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">q01</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="kp">t</span><span class="p">);</span>
    <span class="kr">y</span><span class="o">=</span><span class="n">bzi</span><span class="p">(</span><span class="n">p00</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p01</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">q00</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">q01</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="kp">t</span><span class="p">);</span>
<span class="p">}</span>
<span class="kt">border</span> <span class="nf">G2</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">){</span>
    <span class="kr">x</span><span class="o">=</span><span class="n">bzi</span><span class="p">(</span><span class="n">p01</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p11</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">q10</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">q11</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="kp">t</span><span class="p">);</span>
    <span class="kr">y</span><span class="o">=</span><span class="n">bzi</span><span class="p">(</span><span class="n">p01</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p11</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">q10</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">q11</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="kp">t</span><span class="p">);</span>
<span class="p">}</span>
<span class="kt">border</span> <span class="nf">G3</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">){</span>
    <span class="kr">x</span><span class="o">=</span><span class="n">bzi</span><span class="p">(</span><span class="n">p11</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p21</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">q20</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">q21</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="kp">t</span><span class="p">);</span>
    <span class="kr">y</span><span class="o">=</span><span class="n">bzi</span><span class="p">(</span><span class="n">p11</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p21</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">q20</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">q21</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="kp">t</span><span class="p">);</span>
<span class="p">}</span>
<span class="kt">border</span> <span class="nf">G4</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">){</span>
    <span class="kr">x</span><span class="o">=</span><span class="n">bzi</span><span class="p">(</span><span class="n">p21</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p00</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">q30</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">q31</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="kp">t</span><span class="p">);</span>
    <span class="kr">y</span><span class="o">=</span><span class="n">bzi</span><span class="p">(</span><span class="n">p21</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p00</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">q30</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">q31</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="kp">t</span><span class="p">);</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="kr">m</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
<span class="kt">mesh</span> <span class="n">Th</span> <span class="o">=</span> <span class="nf">buildmesh</span><span class="p">(</span><span class="n">G1</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="kr">m</span><span class="p">)</span> <span class="o">+</span> <span class="n">G2</span><span class="p">(</span><span class="kr">m</span><span class="p">)</span> <span class="o">+</span> <span class="n">G3</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="kr">m</span><span class="p">)</span> <span class="o">+</span> <span class="n">G4</span><span class="p">(</span><span class="kr">m</span><span class="p">));</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="kp">ps</span><span class="o">=</span><span class="s">&quot;Bezier.eps&quot;</span><span class="p">,</span> <span class="kp">bw</span><span class="o">=</span><span class="kr">true</span><span class="p">);</span>
</pre></div>
</td></tr></table>

<p><center></p>
<table>
<thead>
<tr>
<th align="center"><a name="Fig28">Fig. 28</a>: Boundary drawn by Bezier curves</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="Bezier" src="../images/MeshGeneration_Example_Bezier.png" /></td>
</tr>
</tbody>
</table>
<p></center></p>
</div>
<div class="admonition example">
<p class="admonition-title">Section of Engine</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">real</span> <span class="n">a</span> <span class="o">=</span> <span class="mf">6.</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="mf">1.</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">;</span>

<span class="kt">border</span> <span class="nf">L1</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">){</span><span class="kr">x</span><span class="o">=-</span><span class="n">a</span><span class="p">;</span> <span class="kr">y</span><span class="o">=</span><span class="mi">1</span><span class="o">+</span><span class="n">b</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">b</span><span class="p">)</span><span class="o">*</span><span class="kp">t</span><span class="p">;}</span>
<span class="kt">border</span> <span class="nf">L2</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">){</span><span class="kr">x</span><span class="o">=-</span><span class="n">a</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">a</span><span class="o">*</span><span class="kp">t</span><span class="p">;</span> <span class="kr">y</span><span class="o">=-</span><span class="mi">1</span><span class="o">-</span><span class="n">b</span><span class="o">*</span><span class="p">(</span><span class="kr">x</span><span class="o">/</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="kr">x</span><span class="o">/</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">3</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="nf">abs</span><span class="p">(</span><span class="kr">x</span><span class="p">)</span><span class="o">/</span><span class="n">a</span> <span class="p">);}</span>
<span class="kt">border</span> <span class="nf">L3</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="n">a</span><span class="p">;</span> <span class="kr">y</span><span class="o">=-</span><span class="mi">1</span><span class="o">-</span><span class="n">b</span><span class="o">+</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">b</span><span class="p">)</span><span class="o">*</span><span class="kp">t</span><span class="p">;</span> <span class="p">}</span>
<span class="kt">border</span> <span class="nf">L4</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="n">a</span><span class="o">-</span><span class="n">a</span><span class="o">*</span><span class="kp">t</span><span class="p">;</span> <span class="kr">y</span><span class="o">=</span><span class="mi">0</span><span class="p">;}</span>
<span class="kt">border</span> <span class="nf">L5</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="kr">pi</span><span class="p">){</span><span class="kr">x</span><span class="o">=-</span><span class="n">c</span><span class="o">*</span><span class="nf">sin</span><span class="p">(</span><span class="kp">t</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span> <span class="kr">y</span><span class="o">=</span><span class="n">c</span><span class="o">/</span><span class="mi">2</span><span class="o">-</span><span class="n">c</span><span class="o">*</span><span class="nf">cos</span><span class="p">(</span><span class="kp">t</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">;}</span>
<span class="kt">border</span> <span class="nf">L6</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="n">a</span><span class="o">*</span><span class="kp">t</span><span class="p">;</span> <span class="kr">y</span><span class="o">=</span><span class="n">c</span><span class="p">;}</span>
<span class="kt">border</span> <span class="nf">L7</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="n">a</span><span class="p">;</span> <span class="kr">y</span><span class="o">=</span><span class="n">c</span><span class="o">+</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">b</span><span class="o">-</span><span class="n">c</span><span class="p">)</span><span class="o">*</span><span class="kp">t</span><span class="p">;}</span>
<span class="kt">border</span> <span class="nf">L8</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="n">a</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">a</span><span class="o">*</span><span class="kp">t</span><span class="p">;</span> <span class="kr">y</span><span class="o">=</span><span class="mi">1</span><span class="o">+</span><span class="n">b</span><span class="o">*</span><span class="p">(</span><span class="kr">x</span><span class="o">/</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="kr">x</span><span class="o">/</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">3</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="nf">abs</span><span class="p">(</span><span class="kr">x</span><span class="p">)</span><span class="o">/</span><span class="n">a</span><span class="p">);}</span>
<span class="kt">mesh</span> <span class="n">Th</span> <span class="o">=</span> <span class="nf">buildmesh</span><span class="p">(</span><span class="n">L1</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="o">+</span> <span class="n">L2</span><span class="p">(</span><span class="mi">26</span><span class="p">)</span> <span class="o">+</span> <span class="n">L3</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="o">+</span> <span class="n">L4</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="o">+</span> <span class="n">L5</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="o">+</span> <span class="n">L6</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span> <span class="o">+</span> <span class="n">L7</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="o">+</span> <span class="n">L8</span><span class="p">(</span><span class="mi">30</span><span class="p">));</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="kp">ps</span><span class="o">=</span><span class="s">&quot;Engine.eps&quot;</span><span class="p">,</span> <span class="kp">bw</span><span class="o">=</span><span class="kr">true</span><span class="p">);</span>
</pre></div>
</td></tr></table>

<p><center></p>
<table>
<thead>
<tr>
<th align="left"><a name="Fig29">Fig. 29</a>: Section of Engine</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><img alt="Engine" src="../images/MeshGeneration_Example_Engine.png" /></td>
</tr>
</tbody>
</table>
<p></center></p>
</div>
<div class="admonition example">
<p class="admonition-title">Domain with U-shape channel</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">real</span> <span class="nf">d</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">;</span> <span class="c1">//width of U-shape</span>
<span class="kt">border</span> <span class="nf">L1</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="nf">d</span><span class="p">){</span><span class="kr">x</span><span class="o">=-</span><span class="mi">1</span><span class="p">;</span> <span class="kr">y</span><span class="o">=-</span><span class="nf">d</span><span class="o">-</span><span class="kp">t</span><span class="p">;}</span>
<span class="kt">border</span> <span class="nf">L2</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="nf">d</span><span class="p">){</span><span class="kr">x</span><span class="o">=-</span><span class="mi">1</span><span class="p">;</span> <span class="kr">y</span><span class="o">=</span><span class="mi">1</span><span class="o">-</span><span class="kp">t</span><span class="p">;}</span>
<span class="kt">border</span> <span class="kp">B</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">){</span><span class="kr">x</span><span class="o">=-</span><span class="mi">1</span><span class="o">+</span><span class="kp">t</span><span class="p">;</span> <span class="kr">y</span><span class="o">=-</span><span class="mi">1</span><span class="p">;}</span>
<span class="kt">border</span> <span class="nf">C1</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="kp">t</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span> <span class="kr">y</span><span class="o">=</span><span class="nf">d</span><span class="p">;}</span>
<span class="kt">border</span> <span class="nf">C2</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="nf">d</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="kr">y</span><span class="o">=</span><span class="nf">d</span><span class="o">-</span><span class="kp">t</span><span class="p">;}</span>
<span class="kt">border</span> <span class="nf">C3</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">){</span><span class="kr">x</span><span class="o">=-</span><span class="kp">t</span><span class="p">;</span> <span class="kr">y</span><span class="o">=-</span><span class="nf">d</span><span class="p">;}</span>
<span class="kt">border</span> <span class="nf">R</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="kr">y</span><span class="o">=-</span><span class="mi">1</span><span class="o">+</span><span class="kp">t</span><span class="p">;}</span>
<span class="kt">border</span> <span class="nf">T</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="mi">1</span><span class="o">-</span><span class="kp">t</span><span class="p">;</span> <span class="kr">y</span><span class="o">=</span><span class="mi">1</span><span class="p">;}</span>
<span class="kt">int</span> <span class="kr">n</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
<span class="kt">mesh</span> <span class="n">Th</span> <span class="o">=</span> <span class="nf">buildmesh</span><span class="p">(</span><span class="n">L1</span><span class="p">(</span><span class="kr">n</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">L2</span><span class="p">(</span><span class="kr">n</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="kp">B</span><span class="p">(</span><span class="kr">n</span><span class="p">)</span> <span class="o">+</span> <span class="n">C1</span><span class="p">(</span><span class="kr">n</span><span class="p">)</span> <span class="o">+</span> <span class="n">C2</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="n">C3</span><span class="p">(</span><span class="kr">n</span><span class="p">)</span> <span class="o">+</span> <span class="n">R</span><span class="p">(</span><span class="kr">n</span><span class="p">)</span> <span class="o">+</span> <span class="n">T</span><span class="p">(</span><span class="kr">n</span><span class="p">));</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="kp">ps</span><span class="o">=</span><span class="s">&quot;U-shape.eps&quot;</span><span class="p">,</span> <span class="kp">bw</span><span class="o">=</span><span class="kr">true</span><span class="p">);</span>
</pre></div>
</td></tr></table>

<p><center></p>
<table>
<thead>
<tr>
<th align="left"><a name="Fig30">Fig. 30</a>: Domain with U-shape channel changed by <code class="codehilite"><span class="nf">d</span></code></th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><img alt="U-Shape" src="../images/MeshGeneration_Example_UShape.png" /></td>
</tr>
</tbody>
</table>
<p></center></p>
</div>
<div class="admonition example">
<p class="admonition-title">Domain with V-shape cut</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">real</span> <span class="n">dAg</span> <span class="o">=</span> <span class="mf">0.02</span><span class="p">;</span> <span class="c1">//angle of V-shape</span>
<span class="kt">border</span> <span class="nf">C</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="n">dAg</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="kr">pi</span><span class="o">-</span><span class="n">dAg</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="nf">cos</span><span class="p">(</span><span class="kp">t</span><span class="p">);</span> <span class="kr">y</span><span class="o">=</span><span class="nf">sin</span><span class="p">(</span><span class="kp">t</span><span class="p">);};</span>
<span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">pa</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">pb</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">pc</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<span class="n">pa</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nf">cos</span><span class="p">(</span><span class="n">dAg</span><span class="p">);</span>
<span class="n">pa</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nf">sin</span><span class="p">(</span><span class="n">dAg</span><span class="p">);</span>
<span class="n">pb</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nf">cos</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="kr">pi</span><span class="o">-</span><span class="n">dAg</span><span class="p">);</span>
<span class="n">pb</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nf">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="kr">pi</span><span class="o">-</span><span class="n">dAg</span><span class="p">);</span>
<span class="n">pc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">pc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kt">border</span> <span class="nf">seg1</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="kp">t</span><span class="p">)</span><span class="o">*</span><span class="n">pb</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="kp">t</span><span class="o">*</span><span class="n">pc</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span> <span class="kr">y</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="kp">t</span><span class="p">)</span><span class="o">*</span><span class="n">pb</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="kp">t</span><span class="o">*</span><span class="n">pc</span><span class="p">[</span><span class="mi">1</span><span class="p">];};</span>
<span class="kt">border</span> <span class="nf">seg2</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="kp">t</span><span class="p">)</span><span class="o">*</span><span class="n">pc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="kp">t</span><span class="o">*</span><span class="n">pa</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span> <span class="kr">y</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="kp">t</span><span class="p">)</span><span class="o">*</span><span class="n">pc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="kp">t</span><span class="o">*</span><span class="n">pa</span><span class="p">[</span><span class="mi">1</span><span class="p">];};</span>
<span class="kt">mesh</span> <span class="n">Th</span> <span class="o">=</span> <span class="nf">buildmesh</span><span class="p">(</span><span class="n">seg1</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="o">+</span> <span class="n">C</span><span class="p">(</span><span class="mi">40</span><span class="p">)</span> <span class="o">+</span> <span class="n">seg2</span><span class="p">(</span><span class="mi">20</span><span class="p">));</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="kp">ps</span><span class="o">=</span><span class="s">&quot;V-shape.eps&quot;</span><span class="p">,</span> <span class="kp">bw</span><span class="o">=</span><span class="kr">true</span><span class="p">);</span>
</pre></div>
</td></tr></table>

<p><center></p>
<table>
<thead>
<tr>
<th align="left"><a name="Fig31">Fig. 31</a>: Domain with V-shape cut changed by <code class="codehilite"><span class="n">dAg</span></code></th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><img alt="V-Shape" src="../images/MeshGeneration_Example_VShape.png" /></td>
</tr>
</tbody>
</table>
<p></center></p>
</div>
<div class="admonition example">
<p class="admonition-title">Smiling face</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">real</span> <span class="nf">d</span><span class="o">=</span><span class="mf">0.1</span><span class="p">;</span>
<span class="kt">int</span> <span class="kr">m</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
<span class="kt">real</span> <span class="n">a</span> <span class="o">=</span> <span class="mf">1.5</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="mf">0.7</span><span class="p">,</span> <span class="n">e</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">;</span>

<span class="kt">border</span> <span class="nf">F</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="kr">pi</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="n">a</span><span class="o">*</span><span class="nf">cos</span><span class="p">(</span><span class="kp">t</span><span class="p">);</span> <span class="kr">y</span><span class="o">=</span><span class="n">b</span><span class="o">*</span><span class="nf">sin</span><span class="p">(</span><span class="kp">t</span><span class="p">);}</span>
<span class="kt">border</span> <span class="nf">E1</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="kr">pi</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="mf">0.2</span><span class="o">*</span><span class="nf">cos</span><span class="p">(</span><span class="kp">t</span><span class="p">)</span><span class="o">-</span><span class="mf">0.5</span><span class="p">;</span> <span class="kr">y</span><span class="o">=</span><span class="mf">0.2</span><span class="o">*</span><span class="nf">sin</span><span class="p">(</span><span class="kp">t</span><span class="p">)</span><span class="o">+</span><span class="mf">0.5</span><span class="p">;}</span>
<span class="kt">border</span> <span class="nf">E2</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="kr">pi</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="mf">0.2</span><span class="o">*</span><span class="nf">cos</span><span class="p">(</span><span class="kp">t</span><span class="p">)</span><span class="o">+</span><span class="mf">0.5</span><span class="p">;</span> <span class="kr">y</span><span class="o">=</span><span class="mf">0.2</span><span class="o">*</span><span class="nf">sin</span><span class="p">(</span><span class="kp">t</span><span class="p">)</span><span class="o">+</span><span class="mf">0.5</span><span class="p">;}</span>
<span class="kt">func</span> <span class="kt">real</span> <span class="nf">st</span><span class="p">(</span><span class="kt">real</span> <span class="kp">t</span><span class="p">){</span>
    <span class="k">return</span> <span class="nf">sin</span><span class="p">(</span><span class="kr">pi</span><span class="o">*</span><span class="kp">t</span><span class="p">)</span> <span class="o">-</span> <span class="kr">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">border</span> <span class="nf">C1</span><span class="p">(</span><span class="kp">t</span><span class="o">=-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="nf">d</span><span class="p">)</span><span class="o">*</span><span class="n">c</span><span class="o">*</span><span class="nf">cos</span><span class="p">(</span><span class="n">st</span><span class="p">(</span><span class="kp">t</span><span class="p">));</span> <span class="kr">y</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="nf">d</span><span class="p">)</span><span class="o">*</span><span class="n">c</span><span class="o">*</span><span class="nf">sin</span><span class="p">(</span><span class="n">st</span><span class="p">(</span><span class="kp">t</span><span class="p">));}</span>
<span class="kt">border</span> <span class="nf">C2</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="nf">d</span><span class="p">)</span><span class="o">+</span><span class="nf">d</span><span class="o">*</span><span class="kp">t</span><span class="p">)</span><span class="o">*</span><span class="n">c</span><span class="o">*</span><span class="nf">cos</span><span class="p">(</span><span class="n">st</span><span class="p">(</span><span class="mf">0.5</span><span class="p">));</span> <span class="kr">y</span><span class="o">=</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="nf">d</span><span class="p">)</span><span class="o">+</span><span class="nf">d</span><span class="o">*</span><span class="kp">t</span><span class="p">)</span><span class="o">*</span><span class="n">c</span><span class="o">*</span><span class="nf">sin</span><span class="p">(</span><span class="n">st</span><span class="p">(</span><span class="mf">0.5</span><span class="p">));}</span>
<span class="kt">border</span> <span class="nf">C3</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="n">c</span><span class="o">*</span><span class="nf">cos</span><span class="p">(</span><span class="n">st</span><span class="p">(</span><span class="kp">t</span><span class="p">));</span> <span class="kr">y</span><span class="o">=</span><span class="n">c</span><span class="o">*</span><span class="nf">sin</span><span class="p">(</span><span class="n">st</span><span class="p">(</span><span class="kp">t</span><span class="p">));}</span>
<span class="kt">border</span> <span class="nf">C4</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="nf">d</span><span class="o">*</span><span class="kp">t</span><span class="p">)</span><span class="o">*</span><span class="n">c</span><span class="o">*</span><span class="nf">cos</span><span class="p">(</span><span class="n">st</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">));</span> <span class="kr">y</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="nf">d</span><span class="o">*</span><span class="kp">t</span><span class="p">)</span><span class="o">*</span><span class="n">c</span><span class="o">*</span><span class="nf">sin</span><span class="p">(</span><span class="n">st</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">));}</span>
<span class="kt">border</span> <span class="nf">C0</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="kr">pi</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="mf">0.1</span><span class="o">*</span><span class="nf">cos</span><span class="p">(</span><span class="kp">t</span><span class="p">);</span> <span class="kr">y</span><span class="o">=</span><span class="mf">0.1</span><span class="o">*</span><span class="nf">sin</span><span class="p">(</span><span class="kp">t</span><span class="p">);}</span>

<span class="kt">mesh</span> <span class="n">Th</span><span class="o">=</span><span class="nf">buildmesh</span><span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="mi">10</span><span class="o">*</span><span class="kr">m</span><span class="p">)</span> <span class="o">+</span> <span class="n">C1</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="kr">m</span><span class="p">)</span> <span class="o">+</span> <span class="n">C2</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="n">C3</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="kr">m</span><span class="p">)</span> <span class="o">+</span> <span class="n">C4</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="o">+</span> <span class="n">C0</span><span class="p">(</span><span class="kr">m</span><span class="p">)</span> <span class="o">+</span> <span class="n">E1</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="kr">m</span><span class="p">)</span> <span class="o">+</span> <span class="n">E2</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="kr">m</span><span class="p">));</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="kp">ps</span><span class="o">=</span><span class="s">&quot;SmileFace.eps&quot;</span><span class="p">,</span> <span class="kp">bw</span><span class="o">=</span><span class="kr">true</span><span class="p">);</span>
</pre></div>
</td></tr></table>

<p><center></p>
<table>
<thead>
<tr>
<th align="center"><a name="Fig32">Fig. 32</a>: Smiling face (Mouth is changeable)</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="Smiling Face" src="../images/MeshGeneration_Example_SmilingFace.png" /></td>
</tr>
</tbody>
</table>
<p></center></p>
</div>
<div class="admonition example">
<p class="admonition-title">3 points bending</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1">// Square for Three-Point Bend Specimens fixed on Fix1, Fix2</span>
<span class="c1">// It will be loaded on Load.</span>
<span class="kt">real</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">;</span>
<span class="kt">int</span> <span class="kr">n</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="kr">m</span> <span class="o">=</span> <span class="n">b</span><span class="o">*</span><span class="kr">n</span><span class="p">;</span>
<span class="kt">border</span> <span class="nf">Left</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">a</span><span class="p">){</span><span class="kr">x</span><span class="o">=-</span><span class="n">b</span><span class="p">;</span> <span class="kr">y</span><span class="o">=</span><span class="n">a</span><span class="o">-</span><span class="kp">t</span><span class="p">;}</span>
<span class="kt">border</span> <span class="nf">Bot1</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">b</span><span class="o">/</span><span class="mi">2</span><span class="o">-</span><span class="n">c</span><span class="p">){</span><span class="kr">x</span><span class="o">=-</span><span class="n">b</span><span class="o">+</span><span class="kp">t</span><span class="p">;</span> <span class="kr">y</span><span class="o">=-</span><span class="n">a</span><span class="p">;}</span>
<span class="kt">border</span> <span class="nf">Fix1</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">c</span><span class="p">){</span><span class="kr">x</span><span class="o">=-</span><span class="n">b</span><span class="o">/</span><span class="mi">2</span><span class="o">-</span><span class="n">c</span><span class="o">+</span><span class="kp">t</span><span class="p">;</span> <span class="kr">y</span><span class="o">=-</span><span class="n">a</span><span class="p">;}</span>
<span class="kt">border</span> <span class="nf">Bot2</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">b</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">c</span><span class="p">){</span><span class="kr">x</span><span class="o">=-</span><span class="n">b</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="n">c</span><span class="o">+</span><span class="kp">t</span><span class="p">;</span> <span class="kr">y</span><span class="o">=-</span><span class="n">a</span><span class="p">;}</span>
<span class="kt">border</span> <span class="nf">Fix2</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">c</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="n">b</span><span class="o">/</span><span class="mi">2</span><span class="o">-</span><span class="n">c</span><span class="o">+</span><span class="kp">t</span><span class="p">;</span> <span class="kr">y</span><span class="o">=-</span><span class="n">a</span><span class="p">;}</span>
<span class="kt">border</span> <span class="nf">Bot3</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">b</span><span class="o">/</span><span class="mi">2</span><span class="o">-</span><span class="n">c</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="n">b</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="n">c</span><span class="o">+</span><span class="kp">t</span><span class="p">;</span> <span class="kr">y</span><span class="o">=-</span><span class="n">a</span><span class="p">;}</span>
<span class="kt">border</span> <span class="nf">Right</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">a</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="n">b</span><span class="p">;</span> <span class="kr">y</span><span class="o">=-</span><span class="n">a</span><span class="o">+</span><span class="kp">t</span><span class="p">;}</span>
<span class="kt">border</span> <span class="nf">Top1</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">b</span><span class="o">-</span><span class="n">c</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="n">b</span><span class="o">-</span><span class="kp">t</span><span class="p">;</span> <span class="kr">y</span><span class="o">=</span><span class="n">a</span><span class="p">;}</span>
<span class="kt">border</span> <span class="nf">Load</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">c</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="n">c</span><span class="o">-</span><span class="kp">t</span><span class="p">;</span> <span class="kr">y</span><span class="o">=</span><span class="n">a</span><span class="p">;}</span>
<span class="kt">border</span> <span class="nf">Top2</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">b</span><span class="o">-</span><span class="n">c</span><span class="p">){</span><span class="kr">x</span><span class="o">=-</span><span class="n">c</span><span class="o">-</span><span class="kp">t</span><span class="p">;</span> <span class="kr">y</span><span class="o">=</span><span class="n">a</span><span class="p">;}</span>

<span class="kt">mesh</span> <span class="n">Th</span> <span class="o">=</span> <span class="nf">buildmesh</span><span class="p">(</span><span class="n">Left</span><span class="p">(</span><span class="kr">n</span><span class="p">)</span> <span class="o">+</span> <span class="n">Bot1</span><span class="p">(</span><span class="kr">m</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">Fix1</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="n">Bot2</span><span class="p">(</span><span class="kr">m</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
    <span class="o">+</span> <span class="n">Fix2</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="n">Bot3</span><span class="p">(</span><span class="kr">m</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">Right</span><span class="p">(</span><span class="kr">n</span><span class="p">)</span> <span class="o">+</span> <span class="n">Top1</span><span class="p">(</span><span class="kr">m</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">Load</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">+</span> <span class="n">Top2</span><span class="p">(</span><span class="kr">m</span><span class="o">/</span><span class="mi">2</span><span class="p">));</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="kp">ps</span><span class="o">=</span><span class="s">&quot;ThreePoint.eps&quot;</span><span class="p">,</span> <span class="kp">bw</span><span class="o">=</span><span class="kr">true</span><span class="p">);</span>
</pre></div>
</td></tr></table>

<p><center></p>
<table>
<thead>
<tr>
<th align="left"><a name="Fig33">Fig. 33</a>: Domain for three-point bending test</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><img alt="Three-point bending test" src="../images/MeshGeneration_Example_ThreePoints.png" /></td>
</tr>
</tbody>
</table>
<p></center></p>
</div>
<h2 id="how-to-change-the-label-of-elements-and-border-elements-of-a-mesh">How to change the label of elements and border elements of a mesh<a class="headerlink" href="#how-to-change-the-label-of-elements-and-border-elements-of-a-mesh" title="Permanent link">#</a></h2>
<p>Changing the label of elements and border elements will be done using the keyword <code class="codehilite"><span class="nf">change</span></code>. The parameters for this command line are for two dimensional and three dimensional cases:</p>
<ul>
<li>
<p><code class="codehilite"><span class="kr">label</span> <span class="o">=</span></code> is a vector of integer that contains successive pairs of the old label number to the new label number.</p>
</li>
<li>
<p><code class="codehilite"><span class="kr">region</span> <span class="o">=</span></code> is a vector of integer that contains successive pairs of the old region number to new region number.</p>
</li>
<li>
<p><code class="codehilite"><span class="kp">flabel</span> <span class="o">=</span></code> is an integer function given the new value of the label.</p>
</li>
<li>
<p><code class="codehilite"><span class="kp">fregion</span><span class="o">=</span></code> is an integer function given the new value of the region.</p>
</li>
</ul>
<p>These vectors are composed of <span><span class="MathJax_Preview">n_{l}</span><script type="math/tex">n_{l}</script></span> successive pairs of numbers <span><span class="MathJax_Preview">O,N</span><script type="math/tex">O,N</script></span> where <span><span class="MathJax_Preview">n_{l}</span><script type="math/tex">n_{l}</script></span> is the number (label or region) that we want to change. For example, we have :</p>
<div>
<div class="MathJax_Preview">\begin{eqnarray}
\label{eq.org.vector.change.label}
\mathtt{label} &amp;= &amp;[ O_{1}, N_{1}, ..., O_{n_{l}},N_{n_{l}} ] \\
\mathtt{region} &amp; =&amp; [ O_{1}, N_{1}, ..., O_{n_{l}},N_{n_{l}} ]
\end{eqnarray}</div>
<script type="math/tex; mode=display">\begin{eqnarray}
\label{eq.org.vector.change.label}
\mathtt{label} &= &[ O_{1}, N_{1}, ..., O_{n_{l}},N_{n_{l}} ] \\
\mathtt{region} & =& [ O_{1}, N_{1}, ..., O_{n_{l}},N_{n_{l}} ]
\end{eqnarray}</script>
</div>
<p>An example of using this function is given here:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kr">verbosity</span><span class="o">=</span><span class="mi">3</span><span class="p">;</span>

<span class="c1">// Mesh</span>
<span class="kt">mesh</span> <span class="n">Th1</span> <span class="o">=</span> <span class="nf">square</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
<span class="kt">mesh</span> <span class="n">Th2</span> <span class="o">=</span> <span class="nf">square</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="p">[</span><span class="kr">x</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="kr">y</span><span class="p">]);</span>

<span class="kt">int</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">r1</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">];</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">Th1</span><span class="p">,</span> <span class="kp">wait</span><span class="o">=</span><span class="kr">true</span><span class="p">);</span>

<span class="n">Th1</span> <span class="o">=</span> <span class="nf">change</span><span class="p">(</span><span class="n">Th1</span><span class="p">,</span> <span class="kr">label</span><span class="o">=</span><span class="n">r1</span><span class="p">);</span> <span class="c1">//change the label of Edges 2 in 0.</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">Th1</span><span class="p">,</span> <span class="kp">wait</span><span class="o">=</span><span class="kr">true</span><span class="p">);</span>

<span class="kt">int</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">r2</span><span class="o">=</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">0</span><span class="p">];</span>
<span class="n">Th2</span> <span class="o">=</span> <span class="nf">change</span><span class="p">(</span><span class="n">Th2</span><span class="p">,</span> <span class="kr">label</span><span class="o">=</span><span class="n">r2</span><span class="p">);</span> <span class="c1">//change the label of Edges 4 in 0.</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">Th2</span><span class="p">,</span> <span class="kp">wait</span><span class="o">=</span><span class="kr">true</span><span class="p">);</span>

<span class="kt">mesh</span> <span class="n">Th</span> <span class="o">=</span> <span class="n">Th1</span> <span class="o">+</span> <span class="n">Th2</span><span class="p">;</span> <span class="c1">//&#39;gluing together&#39; of meshes Th1 and Th2</span>
<span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;nb lab = &quot;</span> <span class="o">&lt;&lt;</span> <span class="nf">int1d</span><span class="p">(</span><span class="n">Th1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">)(</span><span class="mf">1.</span><span class="o">/</span><span class="kr">lenEdge</span><span class="p">)</span><span class="o">+</span><span class="nf">int1d</span><span class="p">(</span><span class="n">Th2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)(</span><span class="mf">1.</span><span class="o">/</span><span class="kr">lenEdge</span><span class="p">)</span>
     <span class="o">&lt;&lt;</span> <span class="s">&quot; == &quot;</span> <span class="o">&lt;&lt;</span> <span class="nf">int1d</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">)(</span><span class="mf">1.</span><span class="o">/</span><span class="kr">lenEdge</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; == &quot;</span> <span class="o">&lt;&lt;</span> <span class="p">((</span><span class="mi">10</span><span class="o">+</span><span class="mi">20</span><span class="p">)</span><span class="o">+</span><span class="mi">10</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="kp">wait</span><span class="o">=</span><span class="kr">true</span><span class="p">);</span>

<span class="kt">fespace</span> <span class="nf">Vh</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="nc">P1</span><span class="p">);</span>
<span class="n">Vh</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">;</span>

<span class="kt">macro</span> <span class="nf">Grad</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="p">[</span><span class="nf">dx</span><span class="p">(</span><span class="n">u</span><span class="p">),</span><span class="nf">dy</span><span class="p">(</span><span class="n">u</span><span class="p">)]</span> <span class="c1">// Definition of a macro</span>

<span class="kt">solve</span> <span class="kr">P</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
    <span class="o">=</span> <span class="nf">int2d</span><span class="p">(</span><span class="n">Th</span><span class="p">)(</span>
          <span class="n">Grad</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">&#39;*</span><span class="n">Grad</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="o">-</span><span class="nf">int2d</span><span class="p">(</span><span class="n">Th</span><span class="p">)(</span>
          <span class="n">v</span>
    <span class="p">)</span>
    <span class="o">+</span> <span class="nf">on</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">u</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="p">;</span>

<span class="nf">plot</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="kp">wait</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
</pre></div>
</td></tr></table>

<p><strong>"gluing" different mesh</strong>
In line 17 of the previous file, the method to "gluing" different meshes of the same dimension in FreeFem++ is using. This function is the operator "+" between meshes. The method implemented needs the point in adjacent meshes to be the same.</p>
<h2 id="mesh-in-three-dimensions">Mesh in three dimensions<a class="headerlink" href="#mesh-in-three-dimensions" title="Permanent link">#</a></h2>
<h3 id="cube">Cube<a class="headerlink" href="#cube" title="Permanent link">#</a></h3>
<p>A new function <code class="codehilite"><span class="nf">cube</span></code> like the function <code class="codehilite"><span class="nf">square</span></code> in 2d is the simple way to a build cubic object, in plugin <code class="codehilite"><span class="n">msh3</span></code> (need <code class="codehilite"><span class="cp">load</span> <span class="s">&quot;msh3&quot;</span></code>).</p>
<p>The following code generates a <span><span class="MathJax_Preview">3\times 4 \times 5</span><script type="math/tex">3\times 4 \times 5</script></span> grid in the unit cube <span><span class="MathJax_Preview">[0, 1]^3</span><script type="math/tex">[0, 1]^3</script></span>.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">mesh3</span> <span class="n">Th</span> <span class="o">=</span> <span class="nf">cube</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
</pre></div>
</td></tr></table>

<p>By default the labels are :</p>
<ol>
<li>face <span><span class="MathJax_Preview">y=0</span><script type="math/tex">y=0</script></span>,</li>
<li>face <span><span class="MathJax_Preview">x=1</span><script type="math/tex">x=1</script></span>,</li>
<li>face <span><span class="MathJax_Preview">y=1</span><script type="math/tex">y=1</script></span>,</li>
<li>face <span><span class="MathJax_Preview">x=0</span><script type="math/tex">x=0</script></span>,</li>
<li>face <span><span class="MathJax_Preview">z=0</span><script type="math/tex">z=0</script></span>,</li>
<li>face <span><span class="MathJax_Preview">z=1</span><script type="math/tex">z=1</script></span></li>
</ol>
<p>and the region number is <span><span class="MathJax_Preview">0</span><script type="math/tex">0</script></span>.</p>
<p>A full example of this function to build a mesh of cube <span><span class="MathJax_Preview">]-1,1[^3</span><script type="math/tex">]-1,1[^3</script></span> with face label given by <span><span class="MathJax_Preview">(ix + 4*(iy+1) + 16*(iz+1))</span><script type="math/tex">(ix + 4*(iy+1) + 16*(iz+1))</script></span> where <span><span class="MathJax_Preview">(ix, iy, iz)</span><script type="math/tex">(ix, iy, iz)</script></span> are the coordinates of the barycenter of the current face, is given below.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">load</span> <span class="s">&quot;msh3&quot;</span>

<span class="kt">int</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">l6</span> <span class="o">=</span> <span class="p">[</span><span class="mi">37</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">57</span><span class="p">];</span>
<span class="kt">int</span> <span class="n">r11</span> <span class="o">=</span> <span class="mi">11</span><span class="p">;</span>
<span class="kt">mesh3</span> <span class="n">Th</span> <span class="o">=</span> <span class="nf">cube</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="p">[</span><span class="kr">x</span><span class="o">*</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="kr">y</span><span class="o">*</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="kr">z</span><span class="o">*</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="kr">label</span><span class="o">=</span><span class="n">l6</span><span class="p">,</span> <span class="kp">flags</span> <span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="kr">region</span><span class="o">=</span><span class="n">r11</span><span class="p">);</span>

<span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Volume = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">Th</span><span class="p">.</span><span class="kr">measure</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;, border area = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">Th</span><span class="p">.</span><span class="kr">bordermeasure</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>

<span class="kt">int</span> <span class="kp">err</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">){</span>
    <span class="kt">real</span> <span class="n">s</span> <span class="o">=</span> <span class="nf">int2d</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span><span class="n">i</span><span class="p">)(</span><span class="mf">1.</span><span class="p">);</span>
    <span class="kt">real</span> <span class="n">sx</span> <span class="o">=</span> <span class="nf">int2d</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span><span class="n">i</span><span class="p">)(</span><span class="kr">x</span><span class="p">);</span>
    <span class="kt">real</span> <span class="n">sy</span> <span class="o">=</span> <span class="nf">int2d</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span><span class="n">i</span><span class="p">)(</span><span class="kr">y</span><span class="p">);</span>
    <span class="kt">real</span> <span class="n">sz</span> <span class="o">=</span> <span class="nf">int2d</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span><span class="n">i</span><span class="p">)(</span><span class="kr">z</span><span class="p">);</span>

    <span class="k">if</span><span class="p">(</span><span class="n">s</span><span class="p">){</span>
        <span class="kt">int</span> <span class="n">ix</span> <span class="o">=</span> <span class="p">(</span><span class="n">sx</span><span class="o">/</span><span class="n">s</span><span class="o">+</span><span class="mf">1.5</span><span class="p">);</span>
        <span class="kt">int</span> <span class="n">iy</span> <span class="o">=</span> <span class="p">(</span><span class="n">sy</span><span class="o">/</span><span class="n">s</span><span class="o">+</span><span class="mf">1.5</span><span class="p">);</span>
        <span class="kt">int</span> <span class="n">iz</span> <span class="o">=</span> <span class="p">(</span><span class="n">sz</span><span class="o">/</span><span class="n">s</span><span class="o">+</span><span class="mf">1.5</span><span class="p">);</span>
        <span class="kt">int</span> <span class="n">ii</span> <span class="o">=</span> <span class="p">(</span><span class="n">ix</span> <span class="o">+</span> <span class="mi">4</span><span class="o">*</span><span class="p">(</span><span class="n">iy</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">16</span><span class="o">*</span><span class="p">(</span><span class="n">iz</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="p">);</span>
        <span class="c1">//value of ix,iy,iz =&gt; face min 0, face max 2, no face 1</span>
        <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Label = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">i</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;, s = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">s</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">ix</span> <span class="o">&lt;&lt;</span> <span class="n">iy</span> <span class="o">&lt;&lt;</span> <span class="n">iz</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; : &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">ii</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">ii</span> <span class="p">)</span> <span class="kp">err</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="kt">real</span> <span class="n">volr11</span> <span class="o">=</span> <span class="nf">int3d</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span><span class="n">r11</span><span class="p">)(</span><span class="mf">1.</span><span class="p">);</span>
<span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Volume region = &quot;</span> <span class="o">&lt;&lt;</span> <span class="mi">11</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;: &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">volr11</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
<span class="k">if</span><span class="p">((</span><span class="n">volr11</span> <span class="o">-</span> <span class="n">Th</span><span class="p">.</span><span class="kr">measure</span> <span class="p">)</span><span class="o">&gt;</span><span class="mf">1e-8</span><span class="p">)</span> <span class="kp">err</span><span class="o">++</span><span class="p">;</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="kp">fill</span><span class="o">=</span><span class="kr">false</span><span class="p">);</span>
<span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Nb err = &quot;</span> <span class="o">&lt;&lt;</span> <span class="kp">err</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
<span class="nf">assert</span><span class="p">(</span><span class="kp">err</span><span class="o">==</span><span class="mi">0</span><span class="p">);</span>
</pre></div>
</td></tr></table>

<p>The output of this script is:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nl">Enter</span><span class="o">:</span> <span class="nl">BuildCube</span><span class="o">:</span> <span class="mi">3</span>
  <span class="n">kind</span> <span class="o">=</span> <span class="mi">3</span> <span class="kr">n</span> <span class="n">tet</span> <span class="n">Cube</span> <span class="o">=</span> <span class="mi">6</span> <span class="o">/</span> <span class="kr">n</span> <span class="n">slip</span> <span class="mi">6</span> <span class="mi">19</span>
<span class="n">Cube</span>  <span class="kr">nv</span><span class="o">=</span><span class="mi">210</span> <span class="kr">nt</span><span class="o">=</span><span class="mi">720</span> <span class="kr">nbe</span><span class="o">=</span><span class="mi">296</span>
<span class="nl">Out</span><span class="o">:</span>  <span class="n">BuildCube</span>
<span class="n">Volume</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span> <span class="kt">border</span> <span class="kr">area</span> <span class="o">=</span> <span class="mi">24</span>
<span class="n">Label</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">4</span> <span class="mi">110</span> <span class="o">:</span> <span class="mi">25</span>
<span class="n">Label</span> <span class="o">=</span> <span class="mi">37</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">4</span> <span class="mi">101</span> <span class="o">:</span> <span class="mi">37</span>
<span class="n">Label</span> <span class="o">=</span> <span class="mi">40</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">4</span> <span class="mo">011</span> <span class="o">:</span> <span class="mi">40</span>
<span class="n">Label</span> <span class="o">=</span> <span class="mi">42</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">4</span> <span class="mi">211</span> <span class="o">:</span> <span class="mi">42</span>
<span class="n">Label</span> <span class="o">=</span> <span class="mi">45</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">4</span> <span class="mi">121</span> <span class="o">:</span> <span class="mi">45</span>
<span class="n">Label</span> <span class="o">=</span> <span class="mi">57</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">4</span> <span class="mi">112</span> <span class="o">:</span> <span class="mi">57</span>
<span class="n">Volume</span> <span class="kr">region</span> <span class="o">=</span> <span class="mi">11</span><span class="o">:</span> <span class="mi">8</span>
<span class="n">Nb</span> <span class="kp">err</span> <span class="o">=</span> <span class="mi">0</span>
</pre></div>
</td></tr></table>

<p><center></p>
<table>
<thead>
<tr>
<th align="left"><a name="Fig34">Fig. 34</a>: The mesh 3d of function <code class="codehilite"><span class="nf">cube</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="kp">flags</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span></code></th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><img alt="Function cube mesh" src="../images/MeshGeneration_Cube.jpg" /></td>
</tr>
</tbody>
</table>
<p></center></p>
<h3 id="readwrite-statements-for-a-mesh-in-3d">Read/Write Statements for a Mesh in 3D<a class="headerlink" href="#readwrite-statements-for-a-mesh-in-3d" title="Permanent link">#</a></h3>
<p>In three dimensions, the file mesh format supported for input and output files by FreeFem++ are the extension .msh and .mesh. These formats are described in the <a href="../Developers/#mesh-format">Mesh Format section</a> <span><span class="MathJax_Preview">\codered</span><script type="math/tex">\codered</script></span>.</p>
<p><strong>Extension file .msh</strong>
The structure of the files with extension .msh in 3D is given in <a href="#Tab2">Table 2.</a>.</p>
<p>In this structure, <span><span class="MathJax_Preview">n_v</span><script type="math/tex">n_v</script></span> denotes the number of vertices, <span><span class="MathJax_Preview">n_{tet}</span><script type="math/tex">n_{tet}</script></span> the number of tetrahedra and <span><span class="MathJax_Preview">n_{tri}</span><script type="math/tex">n_{tri}</script></span> the number of triangles.</p>
<p>For each vertex <span><span class="MathJax_Preview">q^i,\, i=1,\cdots,n_v</span><script type="math/tex">q^i,\, i=1,\cdots,n_v</script></span>, we denote by <span><span class="MathJax_Preview">(q^i_x,q^i_y,q^i_z)</span><script type="math/tex">(q^i_x,q^i_y,q^i_z)</script></span> the <span><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span>-coordinate, the <span><span class="MathJax_Preview">y</span><script type="math/tex">y</script></span>-coordinate and the <span><span class="MathJax_Preview">z</span><script type="math/tex">z</script></span>-coordinate.</p>
<p>Each tetrahedra <span><span class="MathJax_Preview">T_k, k=1,\cdots,n_{tet}</span><script type="math/tex">T_k, k=1,\cdots,n_{tet}</script></span> has four vertices <span><span class="MathJax_Preview">q^{k_1},\, q^{k_2},\,q^{k_3}, \,q^{k_4}</span><script type="math/tex">q^{k_1},\, q^{k_2},\,q^{k_3}, \,q^{k_4}</script></span>.</p>
<p>The boundary consists of a union of triangles. Each triangle <span><span class="MathJax_Preview">be_j, j=1,\cdots,n_{tri}</span><script type="math/tex">be_j, j=1,\cdots,n_{tri}</script></span> has three vertices <span><span class="MathJax_Preview">q^{j_1},\, q^{j_2},\,q^{j_3}</span><script type="math/tex">q^{j_1},\, q^{j_2},\,q^{j_3}</script></span>.</p>
<p><center></p>
<table>
<thead>
<tr>
<th align="center"><a name="Tab2">Table 2</a>: The structure of a mesh file format <code class="codehilite"><span class="p">.</span><span class="n">msh</span></code> in three dimensions.</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">
<script type="math/tex; mode=display">\begin{array}{htbp}n_v& n_{tet}& n_{tri} & &\\q^1_x& q^1_y& q^1_z & Vertex label &\\ q^2_x& q^2_y& q^2_z & Vertex label &\\ \vdots &\vdots &\vdots &\vdots &\\ q^{n_v}_x&q^{n_v}_y& q^{n_v}_z & Vertex label&\\ 1_1& 1_2& 1_3& 1_4 & region label \\ 2_1& 2_2& 2_3& 2_4 & region label \\ \vdots &\vdots &\vdots &\vdots &\vdots \\ (n_{tet})_1& (n_{tet})_2& (n_{tet})_3 & (n_{tet})_4 & region label \\ 1_1 & 1_2& 1_3& boundary label & \\ 2_1 & 2_2& 2_3& boundary label & \\ \vdots& \vdots &\vdots &\vdots &\\ (n_tri)_{1} & (n_{tri})_2& (n_{tri})_3 & boundary label &\\ \end{array}</script>
</td>
</tr>
</tbody>
</table>
<p></center></p>
<p><strong>extension file .mesh</strong>
The data structure for a three dimensional mesh is composed of the data structure presented in <a href="../Developers/#mesh-format">Mesh Format section</a> <span><span class="MathJax_Preview">\codered</span><script type="math/tex">\codered</script></span> and a data structure for the tetrahedra. The tetrahedra of a three dimensional mesh are referred using the following field:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>Tetrahedra
NbTetrahedra
Vertex1 Vertex2 Vertex3 Vertex4 Label
...
Vertex1 Vertex2 Vertex3 Vertex4 Label
</pre></div>
</td></tr></table>

<p>This field is express with the notation of <a href="../Developers/#mesh-format">Mesh Format section</a> <span><span class="MathJax_Preview">\codered</span><script type="math/tex">\codered</script></span>.</p>
<h3 id="tetgen-a-tetrahedral-mesh-generator">TetGen: A tetrahedral mesh generator<a class="headerlink" href="#tetgen-a-tetrahedral-mesh-generator" title="Permanent link">#</a></h3>
<p><strong>TetGen</strong></p>
<p>TetGen is a software developed by Dr. Hang Si of Weierstrass Institute for Applied Analysis and Stochastics in Berlin, Germany <a href="#refHang2006">Hang2006</a>. TetGen is free for research and non-commercial use. For any commercial license utilization, a commercial license is available upon request to Hang Si.</p>
<p>This software is a tetrahedral mesh generator of a three dimensional domain defined by its boundary. The input domain takes into account a polyhedral or a piecewise linear complex. This tetrahedralization is a constrained Delaunay tetrahedralization.</p>
<p>The method used in TetGen to control the quality of the mesh is a Delaunay refinement due to Shewchuk <a href="#refShewchuk1998">Shewchuk1998</a>. The quality measure of this algorithm is the Radius-Edge Ratio (see Section 1.3.1 <a href="#refHang2006">Hang2006</a> for more details). A theoretical bound of this ratio of the Shewchuk algorithm is obtained for a given complex of vertices, constrained segments and facets of surface mesh, with no input angle less than 90 degrees. This theoretical bound is 2.0.</p>
<p>The launch of TetGen is done with the keyword <code class="codehilite"><span class="nf">tetg</span></code>. The parameters of this command line is:</p>
<ul>
<li>
<p><code class="codehilite"><span class="kp">reftet</span><span class="o">=</span></code> sets the label of tetrahedra.</p>
</li>
<li>
<p><code class="codehilite"><span class="kr">label</span><span class="o">=</span></code> is a vector of integers that contains the old labels number at index <span><span class="MathJax_Preview">2i</span><script type="math/tex">2i</script></span> and the new labels number at index <span><span class="MathJax_Preview">2i+1</span><script type="math/tex">2i+1</script></span> of Triangles. This parameter is initialized as a label for the keyword <a href="#how-to-change-the-label-of-elements-and-border-elements-of-a-mesh">change</a>.</p>
</li>
<li>
<p><code class="codehilite"><span class="kp">switch</span><span class="o">=</span></code> A string expression. This string corresponds to the command line switch of TetGen see Section 3.2 of <a href="#refHang2006">Hang2006</a>.</p>
</li>
<li>
<p><code class="codehilite"><span class="kp">nbofholes</span><span class="o">=</span></code> Number of holes (default value: "size of <code class="codehilite"><span class="kp">holelist</span></code> / 3").</p>
</li>
<li>
<p><code class="codehilite"><span class="kp">holelist</span><span class="o">=</span></code> This array corresponds to <code class="codehilite"><span class="kp">holelist</span></code> of TetGenio data structure <a href="#refHang2006">Hang2006</a>. A real vector of size <code class="codehilite"><span class="mi">3</span> <span class="o">*</span> <span class="kp">nbofholes</span></code>. In TetGen, each hole is associated with a point inside this domain. This vector is <span><span class="MathJax_Preview">x_{1}^{h}, y_{1}^{h}, z_{1}^{h}, x_{2}^{h}, y_{2}^{h}, z_{2}^{h}, \cdots,</span><script type="math/tex">x_{1}^{h}, y_{1}^{h}, z_{1}^{h}, x_{2}^{h}, y_{2}^{h}, z_{2}^{h}, \cdots,</script></span> where <span><span class="MathJax_Preview">x_{i}^{h},y_{i}^{h},z_{i}^{h}</span><script type="math/tex">x_{i}^{h},y_{i}^{h},z_{i}^{h}</script></span> is the associated point with the <span><span class="MathJax_Preview">i^{\mathrm{th}}</span><script type="math/tex">i^{\mathrm{th}}</script></span> hole.</p>
</li>
<li>
<p><code class="codehilite"><span class="kp">nbofregions</span><span class="o">=</span></code> Number of regions (default value: "size of <code class="codehilite"><span class="kp">regionlist</span></code> / 5").</p>
</li>
<li>
<p><code class="codehilite"><span class="kp">regionlist</span><span class="o">=</span></code> This array corresponds to <code class="codehilite"><span class="kp">regionlist</span></code> of TetGenio data structure <a href="#refHang2006">Hang2006</a>.</p>
<p>The attribute and the volume constraint of region are given in this real vector of size <code class="codehilite"><span class="mi">5</span> <span class="o">*</span> <span class="kp">nbofregions</span></code>. The <span><span class="MathJax_Preview">i^{\mathrm{th}}</span><script type="math/tex">i^{\mathrm{th}}</script></span> region is described by five elements: <span><span class="MathJax_Preview">x-</span><script type="math/tex">x-</script></span>coordinate, <span><span class="MathJax_Preview">y-</span><script type="math/tex">y-</script></span>coordinate and <span><span class="MathJax_Preview">z-</span><script type="math/tex">z-</script></span>coordinate of a point inside this domain (<span><span class="MathJax_Preview">x_{i},y_{i},z_{i}</span><script type="math/tex">x_{i},y_{i},z_{i}</script></span>); the attribute (<span><span class="MathJax_Preview">at_{i}</span><script type="math/tex">at_{i}</script></span>) and the maximum volume for tetrahedra (<span><span class="MathJax_Preview">mvol_{i}</span><script type="math/tex">mvol_{i}</script></span>) for this region.</p>
<p>The <code class="codehilite"><span class="kp">regionlist</span></code> vector is: <span><span class="MathJax_Preview">x_{1}, y_{1}, z_{1}, at_{1}, mvol_{1}, x_{2}, y_{2}, z_{2}, at_{2}, mvol_{2}, \cdots</span><script type="math/tex">x_{1}, y_{1}, z_{1}, at_{1}, mvol_{1}, x_{2}, y_{2}, z_{2}, at_{2}, mvol_{2}, \cdots</script></span>.</p>
</li>
<li>
<p><code class="codehilite"><span class="kp">nboffacetcl</span><span class="o">=</span></code> Number of facets constraints "size of <code class="codehilite"><span class="kp">facetcl</span></code> / 2").</p>
</li>
<li>
<p><code class="codehilite"><span class="kp">facetcl</span><span class="o">=</span></code> This array corresponds to <code class="codehilite"><span class="n">facetconstraintlist</span></code> of TetGenio data structure <a href="#refHang2006">Hang2006</a>.</p>
<p>The <span><span class="MathJax_Preview">i^{th}</span><script type="math/tex">i^{th}</script></span> facet constraint is defined by the facet marker <span><span class="MathJax_Preview">Ref_{i}^{fc}</span><script type="math/tex">Ref_{i}^{fc}</script></span> and the maximum area for faces <span><span class="MathJax_Preview">marea_{i}^{fc}</span><script type="math/tex">marea_{i}^{fc}</script></span>. The <code class="codehilite"><span class="kp">facetcl</span></code> array is: <span><span class="MathJax_Preview">Ref_{1}^{fc}, marea_{1}^{fc}, Ref_{2}^{fc}, marea_{2}^{fc}, \cdots</span><script type="math/tex">Ref_{1}^{fc}, marea_{1}^{fc}, Ref_{2}^{fc}, marea_{2}^{fc}, \cdots</script></span>.</p>
<p>This parameters has no effect if switch <code class="codehilite"><span class="n">q</span></code> is not selected.</p>
</li>
</ul>
<p>Principal switch parameters in TetGen:</p>
<ul>
<li>
<p><code class="codehilite"><span class="n">p</span></code> Tetrahedralization of boundary.</p>
</li>
<li>
<p><code class="codehilite"><span class="n">q</span></code> Quality mesh generation. The bound of Radius-Edge Ratio will be given after the option <code class="codehilite"><span class="n">q</span></code>. By default, this value is 2.0.</p>
</li>
<li>
<p><code class="codehilite"><span class="n">a</span></code> Constructs with the volume constraints on tetrahedra. These volumes constraints are defined with the bound of the previous
switch <code class="codehilite"><span class="n">q</span></code> or in the parameter <code class="codehilite"><span class="kp">regionlist</span></code>.</p>
</li>
<li>
<p><code class="codehilite"><span class="kp">A</span></code> Attributes reference to region given in the <code class="codehilite"><span class="kp">regionlist</span></code>. The other regions have label 0.</p>
<p>The option <code>AA</code> gives a different label at each region. This switch works with the option <code class="codehilite"><span class="n">p</span></code>. If option <code class="codehilite"><span class="n">r</span></code> is used, this switch has no effect.</p>
</li>
<li>
<p><code class="codehilite"><span class="n">r</span></code> Reconstructs and Refines a previously generated mesh. This character is only used with the command line <code class="codehilite"><span class="nf">tetgreconstruction</span></code>.</p>
</li>
<li>
<p><code class="codehilite"><span class="n">Y</span></code> This switch preserves the mesh on the exterior boundary.</p>
<p>This switch must be used to ensure a conformal mesh between two adjacent meshes.</p>
</li>
<li>
<p><code class="codehilite"><span class="n">YY</span></code> This switch preserves the mesh on the exterior and interior boundary.</p>
</li>
<li>
<p><code class="codehilite"><span class="n">C</span></code> The consistency of the result's mesh is testing by TetGen.</p>
</li>
<li>
<p><code class="codehilite"><span class="n">CC</span></code> The consistency of the result's mesh is testing by TetGen and also constrained checks of Delaunay mesh (if <code class="codehilite"><span class="n">p</span></code> switch is selected) or the consistency of Conformal Delaunay (if <code class="codehilite"><span class="n">q</span></code> switch is selected).</p>
</li>
<li>
<p><code class="codehilite"><span class="n">V</span></code> Give information of the work of TetGen. More information can be obtained in specified <code class="codehilite"><span class="n">VV</span></code> or <code class="codehilite"><span class="n">VVV</span></code>.</p>
</li>
<li>
<p><code class="codehilite"><span class="n">Q</span></code> Quiet: No terminal output except errors</p>
</li>
<li>
<p><code class="codehilite"><span class="n">M</span></code> The coplanar facets are not merging.</p>
</li>
<li>
<p><code class="codehilite"><span class="n">T</span></code> Sets a tolerance for coplanar test. The default value is <span><span class="MathJax_Preview">1e-8</span><script type="math/tex">1e-8</script></span>.</p>
</li>
<li>
<p><code class="codehilite"><span class="nf">d</span></code> Intersections of facets are detected.</p>
</li>
</ul>
<p>To obtain a tetrahedral mesh with TetGen, we need the surface mesh of a three dimensional domain. We now give the command line in FreeFem++ to construct these meshes.</p>
<p><strong>keyword: <code class="codehilite"><span class="nf">movemesh23</span></code></strong></p>
<p>A simple method to construct a surface is to place a two dimensional domain in a three dimensional space. This corresponds to moving the domain by a displacement vector of this form <span><span class="MathJax_Preview">\mathbf{\Phi(x,y)} = (\Phi1(x,y), \Phi2(x,y), \Phi3(x,y))</span><script type="math/tex">\mathbf{\Phi(x,y)} = (\Phi1(x,y), \Phi2(x,y), \Phi3(x,y))</script></span>.</p>
<p>The result of moving a two dimensional mesh Th2 by this three dimensional displacement is obtained using:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">mesh3</span> <span class="n">Th3</span> <span class="o">=</span> <span class="nf">movemesh23</span><span class="p">(</span><span class="n">Th2</span><span class="p">,</span> <span class="kp">transfo</span><span class="o">=</span><span class="p">[</span><span class="n">Phi</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">Phi</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">Phi</span><span class="p">(</span><span class="mi">3</span><span class="p">)]);</span>
</pre></div>
</td></tr></table>

<p>The parameters of this command line are:</p>
<ul>
<li>
<p><code class="codehilite"><span class="kp">transfo</span><span class="o">=</span></code> [<span><span class="MathJax_Preview">\Phi 1</span><script type="math/tex">\Phi 1</script></span>, <span><span class="MathJax_Preview">\Phi 2</span><script type="math/tex">\Phi 2</script></span>, <span><span class="MathJax_Preview">\Phi 3</span><script type="math/tex">\Phi 3</script></span>] sets the displacement vector of transformation <span><span class="MathJax_Preview">\mathbf{\Phi(x,y)} = [\Phi1(x,y), \Phi2(x,y), \Phi3(x,y)]</span><script type="math/tex">\mathbf{\Phi(x,y)} = [\Phi1(x,y), \Phi2(x,y), \Phi3(x,y)]</script></span>.</p>
</li>
<li>
<p><code class="codehilite"><span class="kr">label</span><span class="o">=</span></code> sets an integer label of triangles.</p>
</li>
<li>
<p><code class="codehilite"><span class="kp">orientation</span><span class="o">=</span></code> sets an integer orientation of mesh.</p>
</li>
<li>
<p><code class="codehilite"><span class="kp">ptmerge</span><span class="o">=</span></code> A real expression. When you transform a mesh, some points can be merged. This parameter is the criteria to define two merging points. By default, we use
    <script type="math/tex; mode=display">
    ptmerge \: = \: 1e-7 \: \:Vol( B ),
    </script>
    where <span><span class="MathJax_Preview">B</span><script type="math/tex">B</script></span> is the smallest axis, parallel boxes containing the discretized domain of <span><span class="MathJax_Preview">\Omega</span><script type="math/tex">\Omega</script></span> and <span><span class="MathJax_Preview">Vol(B)</span><script type="math/tex">Vol(B)</script></span> is the volume of this box.</p>
</li>
</ul>
<p>We can do a "gluing" of surface meshes using the process given in <a href="#how-to-change-the-label-of-elements-and-border-elements-of-a-mesh">Change section</a>. An example to obtain a three dimensional mesh using the command line <code class="codehilite"><span class="nf">tetg</span></code> and <code class="codehilite"><span class="nf">movemesh23</span></code> is given below.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">load</span> <span class="s">&quot;msh3&quot;</span>
<span class="cp">load</span> <span class="s">&quot;tetgen&quot;</span>

<span class="c1">// Parameters</span>
<span class="kt">real</span> <span class="n">x10</span> <span class="o">=</span> <span class="mf">1.</span><span class="p">;</span>
<span class="kt">real</span> <span class="n">x11</span> <span class="o">=</span> <span class="mf">2.</span><span class="p">;</span>
<span class="kt">real</span> <span class="n">y10</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">;</span>
<span class="kt">real</span> <span class="n">y11</span> <span class="o">=</span> <span class="mf">2.</span><span class="o">*</span><span class="kr">pi</span><span class="p">;</span>

<span class="kt">func</span> <span class="n">ZZ1min</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kt">func</span> <span class="n">ZZ1max</span> <span class="o">=</span> <span class="mf">1.5</span><span class="p">;</span>
<span class="kt">func</span> <span class="n">XX1</span> <span class="o">=</span> <span class="kr">x</span><span class="p">;</span>
<span class="kt">func</span> <span class="n">YY1</span> <span class="o">=</span> <span class="kr">y</span><span class="p">;</span>

<span class="kt">real</span> <span class="n">x20</span> <span class="o">=</span> <span class="mf">1.</span><span class="p">;</span>
<span class="kt">real</span> <span class="n">x21</span> <span class="o">=</span> <span class="mf">2.</span><span class="p">;</span>
<span class="kt">real</span> <span class="n">y20</span><span class="o">=</span><span class="mf">0.</span><span class="p">;</span>
<span class="kt">real</span> <span class="n">y21</span><span class="o">=</span><span class="mf">1.5</span><span class="p">;</span>

<span class="kt">func</span> <span class="n">ZZ2</span> <span class="o">=</span> <span class="kr">y</span><span class="p">;</span>
<span class="kt">func</span> <span class="n">XX2</span> <span class="o">=</span> <span class="kr">x</span><span class="p">;</span>
<span class="kt">func</span> <span class="n">YY2min</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">;</span>
<span class="kt">func</span> <span class="n">YY2max</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="kr">pi</span><span class="p">;</span>

<span class="kt">real</span> <span class="n">x30</span><span class="o">=</span><span class="mf">0.</span><span class="p">;</span>
<span class="kt">real</span> <span class="n">x31</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="kr">pi</span><span class="p">;</span>
<span class="kt">real</span> <span class="n">y30</span><span class="o">=</span><span class="mf">0.</span><span class="p">;</span>
<span class="kt">real</span> <span class="n">y31</span><span class="o">=</span><span class="mf">1.5</span><span class="p">;</span>

<span class="kt">func</span> <span class="n">XX3min</span> <span class="o">=</span> <span class="mf">1.</span><span class="p">;</span>
<span class="kt">func</span> <span class="n">XX3max</span> <span class="o">=</span> <span class="mf">2.</span><span class="p">;</span>
<span class="kt">func</span> <span class="n">YY3</span> <span class="o">=</span> <span class="kr">x</span><span class="p">;</span>
<span class="kt">func</span> <span class="n">ZZ3</span> <span class="o">=</span> <span class="kr">y</span><span class="p">;</span>

<span class="c1">// Mesh</span>
<span class="kt">mesh</span> <span class="n">Thsq1</span> <span class="o">=</span> <span class="nf">square</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="p">[</span><span class="n">x10</span><span class="o">+</span><span class="p">(</span><span class="n">x11</span><span class="o">-</span><span class="n">x10</span><span class="p">)</span><span class="o">*</span><span class="kr">x</span><span class="p">,</span> <span class="n">y10</span><span class="o">+</span><span class="p">(</span><span class="n">y11</span><span class="o">-</span><span class="n">y10</span><span class="p">)</span><span class="o">*</span><span class="kr">y</span><span class="p">]);</span>
<span class="kt">mesh</span> <span class="n">Thsq2</span> <span class="o">=</span> <span class="nf">square</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="p">[</span><span class="n">x20</span><span class="o">+</span><span class="p">(</span><span class="n">x21</span><span class="o">-</span><span class="n">x20</span><span class="p">)</span><span class="o">*</span><span class="kr">x</span><span class="p">,</span> <span class="n">y20</span><span class="o">+</span><span class="p">(</span><span class="n">y21</span><span class="o">-</span><span class="n">y20</span><span class="p">)</span><span class="o">*</span><span class="kr">y</span><span class="p">]);</span>
<span class="kt">mesh</span> <span class="n">Thsq3</span> <span class="o">=</span> <span class="nf">square</span><span class="p">(</span><span class="mi">35</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="p">[</span><span class="n">x30</span><span class="o">+</span><span class="p">(</span><span class="n">x31</span><span class="o">-</span><span class="n">x30</span><span class="p">)</span><span class="o">*</span><span class="kr">x</span><span class="p">,</span> <span class="n">y30</span><span class="o">+</span><span class="p">(</span><span class="n">y31</span><span class="o">-</span><span class="n">y30</span><span class="p">)</span><span class="o">*</span><span class="kr">y</span><span class="p">]);</span>

<span class="c1">// Mesh 2D to 3D surface</span>
<span class="kt">mesh3</span> <span class="n">Th31h</span> <span class="o">=</span> <span class="nf">movemesh23</span><span class="p">(</span><span class="n">Thsq1</span><span class="p">,</span> <span class="kp">transfo</span><span class="o">=</span><span class="p">[</span><span class="n">XX1</span><span class="p">,</span> <span class="n">YY1</span><span class="p">,</span> <span class="n">ZZ1max</span><span class="p">]);</span>
<span class="kt">mesh3</span> <span class="n">Th31b</span> <span class="o">=</span> <span class="nf">movemesh23</span><span class="p">(</span><span class="n">Thsq1</span><span class="p">,</span> <span class="kp">transfo</span><span class="o">=</span><span class="p">[</span><span class="n">XX1</span><span class="p">,</span> <span class="n">YY1</span><span class="p">,</span> <span class="n">ZZ1min</span><span class="p">]);</span>

<span class="kt">mesh3</span> <span class="n">Th32h</span> <span class="o">=</span> <span class="nf">movemesh23</span><span class="p">(</span><span class="n">Thsq2</span><span class="p">,</span> <span class="kp">transfo</span><span class="o">=</span><span class="p">[</span><span class="n">XX2</span><span class="p">,</span> <span class="n">YY2max</span><span class="p">,</span> <span class="n">ZZ2</span><span class="p">]);</span>
<span class="kt">mesh3</span> <span class="n">Th32b</span> <span class="o">=</span> <span class="nf">movemesh23</span><span class="p">(</span><span class="n">Thsq2</span><span class="p">,</span> <span class="kp">transfo</span><span class="o">=</span><span class="p">[</span><span class="n">XX2</span><span class="p">,</span> <span class="n">YY2min</span><span class="p">,</span> <span class="n">ZZ2</span><span class="p">]);</span>

<span class="kt">mesh3</span> <span class="n">Th33h</span> <span class="o">=</span> <span class="nf">movemesh23</span><span class="p">(</span><span class="n">Thsq3</span><span class="p">,</span> <span class="kp">transfo</span><span class="o">=</span><span class="p">[</span><span class="n">XX3max</span><span class="p">,</span> <span class="n">YY3</span><span class="p">,</span> <span class="n">ZZ3</span><span class="p">]);</span>
<span class="kt">mesh3</span> <span class="n">Th33b</span> <span class="o">=</span> <span class="nf">movemesh23</span><span class="p">(</span><span class="n">Thsq3</span><span class="p">,</span> <span class="kp">transfo</span><span class="o">=</span><span class="p">[</span><span class="n">XX3min</span><span class="p">,</span> <span class="n">YY3</span><span class="p">,</span> <span class="n">ZZ3</span><span class="p">]);</span>

<span class="c1">// Gluing surfaces</span>
<span class="kt">mesh3</span> <span class="n">Th33</span> <span class="o">=</span> <span class="n">Th31h</span> <span class="o">+</span> <span class="n">Th31b</span> <span class="o">+</span> <span class="n">Th32h</span> <span class="o">+</span> <span class="n">Th32b</span> <span class="o">+</span> <span class="n">Th33h</span> <span class="o">+</span> <span class="n">Th33b</span><span class="p">;</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">Th33</span><span class="p">,</span> <span class="kp">cmm</span><span class="o">=</span><span class="s">&quot;Th33&quot;</span><span class="p">);</span>

<span class="c1">// Tetrahelize the interior of the cube with TetGen</span>
<span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">domain</span> <span class="o">=</span><span class="p">[</span><span class="mf">1.5</span><span class="p">,</span> <span class="kr">pi</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="mi">145</span><span class="p">,</span> <span class="mf">0.0025</span><span class="p">];</span>
<span class="kt">mesh3</span> <span class="n">Thfinal</span> <span class="o">=</span> <span class="nf">tetg</span><span class="p">(</span><span class="n">Th33</span><span class="p">,</span> <span class="kp">switch</span><span class="o">=</span><span class="s">&quot;paAAQY&quot;</span><span class="p">,</span> <span class="kp">regionlist</span><span class="o">=</span><span class="n">domain</span><span class="p">);</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">Thfinal</span><span class="p">,</span> <span class="kp">cmm</span><span class="o">=</span><span class="s">&quot;Thfinal&quot;</span><span class="p">);</span>

<span class="c1">// Build a mesh of a half cylindrical shell of interior radius 1, and exterior radius 2 and a height of 1.5</span>
<span class="kt">func</span> <span class="n">mv2x</span> <span class="o">=</span> <span class="kr">x</span><span class="o">*</span><span class="nf">cos</span><span class="p">(</span><span class="kr">y</span><span class="p">);</span>
<span class="kt">func</span> <span class="n">mv2y</span> <span class="o">=</span> <span class="kr">x</span><span class="o">*</span><span class="nf">sin</span><span class="p">(</span><span class="kr">y</span><span class="p">);</span>
<span class="kt">func</span> <span class="n">mv2z</span> <span class="o">=</span> <span class="kr">z</span><span class="p">;</span>
<span class="kt">mesh3</span> <span class="n">Thmv2</span> <span class="o">=</span> <span class="n">movemesh3</span><span class="p">(</span><span class="n">Thfinal</span><span class="p">,</span> <span class="kp">transfo</span><span class="o">=</span><span class="p">[</span><span class="n">mv2x</span><span class="p">,</span> <span class="n">mv2y</span><span class="p">,</span> <span class="n">mv2z</span><span class="p">]);</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">Thmv2</span><span class="p">,</span> <span class="kp">cmm</span><span class="o">=</span><span class="s">&quot;Thmv2&quot;</span><span class="p">);</span>
</pre></div>
</td></tr></table>

<p>The command <code class="codehilite"><span class="n">movemesh3</span></code> is described in the following section.</p>
<p><strong>The keyword <code class="codehilite"><span class="nf">tetgtransfo</span></code></strong></p>
<p>This keyword corresponds to a composition of command line <code class="codehilite"><span class="nf">tetg</span></code> and <code class="codehilite"><span class="nf">movemesh23</span></code>.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nf">tetgtransfo</span><span class="p">(</span><span class="n">Th2</span><span class="p">,</span> <span class="kp">transfo</span><span class="o">=</span><span class="p">[</span><span class="n">Phi</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">Phi</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">Phi</span><span class="p">(</span><span class="mi">3</span><span class="p">)]),</span> <span class="p">...)</span> <span class="o">=</span> <span class="nf">tetg</span><span class="p">(</span><span class="n">Th3surf</span><span class="p">,</span> <span class="p">...),</span>
</pre></div>
</td></tr></table>

<p>where <code class="codehilite"><span class="n">Th3surf</span> <span class="o">=</span> <span class="nf">movemesh23</span><span class="p">(</span><span class="n">Th2</span><span class="p">,</span> <span class="kp">transfo</span><span class="o">=</span><span class="p">[</span><span class="n">Phi</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">Phi</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">Phi</span><span class="p">(</span><span class="mi">3</span><span class="p">)])</span></code> and <code class="codehilite"><span class="n">Th2</span></code> is the input two dimensional mesh of <code class="codehilite"><span class="nf">tetgtransfo</span></code>.</p>
<p>The parameters of this command line are, on one hand, the parameters <code class="codehilite"><span class="kr">label</span></code>, <code class="codehilite"><span class="kp">switch</span></code>, <code class="codehilite"><span class="kp">regionlist</span></code>, <code class="codehilite"><span class="kp">nboffacetcl</span></code>, <code class="codehilite"><span class="kp">facetcl</span></code> of keyword <code class="codehilite"><span class="nf">tetg</span></code> and on the other hand, the parameter <code class="codehilite"><span class="kp">ptmerge</span></code> of keyword <code class="codehilite"><span class="nf">movemesh23</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To use <code class="codehilite"><span class="nf">tetgtransfo</span></code>, the result's mesh of <code class="codehilite"><span class="nf">movemesh23</span></code> must be a closed surface and define one region only. Therefore, the parameter <code class="codehilite"><span class="kp">regionlist</span></code> is defined for one region.</p>
<p>An example of this keyword can be found in line 61 of the <a href="/examples/#build-layer-mesh">Build layer mesh example</a>.</p>
</div>
<p><strong>The keyword <code class="codehilite"><span class="nf">tetgconvexhull</span></code></strong></p>
<p>FreeFem++, using TetGen, is able to build a tetrahedralization from a set of points. This tetrahedralization is a Delaunay mesh of the convex hull of the set of points.</p>
<p>The coordinates of the points can be initialized in two ways. The first is a file that contains the coordinate of points <span><span class="MathJax_Preview">X_{i}=(x_{i}, y_{i}, z_{i})</span><script type="math/tex">X_{i}=(x_{i}, y_{i}, z_{i})</script></span>. This file is organized as follows:</p>
<div>
<div class="MathJax_Preview">
\begin{array}{ccc}
n_{v} &amp; &amp; \\
x_{1} &amp; y_{1} &amp; z_{1} \\
x_{2} &amp; y_{2} &amp; z_{2} \\
\vdots &amp;\vdots &amp; \vdots \\
x_{n_v} &amp; y_{n_v} &amp; z_{n_v}
\end{array}
</div>
<script type="math/tex; mode=display">
\begin{array}{ccc}
n_{v} & & \\
x_{1} & y_{1} & z_{1} \\
x_{2} & y_{2} & z_{2} \\
\vdots &\vdots & \vdots \\
x_{n_v} & y_{n_v} & z_{n_v}
\end{array}
</script>
</div>
<p>The second way is to give three arrays that correspond respectively to the <span><span class="MathJax_Preview">x-</span><script type="math/tex">x-</script></span>coordinates, <span><span class="MathJax_Preview">y-</span><script type="math/tex">y-</script></span>coordinates and <span><span class="MathJax_Preview">z-</span><script type="math/tex">z-</script></span>coordinates.</p>
<p>The parameters of this command line are :</p>
<ul>
<li>
<p><code class="codehilite"><span class="kp">switch</span><span class="o">=</span></code> A string expression. This string corresponds to the command line <code class="codehilite"><span class="kp">switch</span></code> of TetGen see Section 3.2 of <a href="#refHang2006">Hang2006</a>.</p>
</li>
<li>
<p><code class="codehilite"><span class="kp">reftet</span><span class="o">=</span></code> An integer expression. Set the label of tetrahedra.</p>
</li>
<li>
<p><code class="codehilite"><span class="kr">label</span><span class="o">=</span></code> An integer expression. Set the label of triangles.</p>
</li>
</ul>
<p>In the string <code class="codehilite"><span class="kp">switch</span></code>, we can't used the option <code class="codehilite"><span class="n">p</span></code> and <code class="codehilite"><span class="n">q</span></code> of TetGen.</p>
<h3 id="reconstructrefine-a-three-dimensional-mesh-with-tetgen">Reconstruct/Refine a three dimensional mesh with TetGen<a class="headerlink" href="#reconstructrefine-a-three-dimensional-mesh-with-tetgen" title="Permanent link">#</a></h3>
<p>Meshes in three dimension can be refined using TetGen with the command line <code class="codehilite"><span class="nf">tetgreconstruction</span></code>.</p>
<p>The parameter of this keyword are</p>
<ul>
<li>
<p><code class="codehilite"><span class="kr">region</span><span class="o">=</span></code> an integer array that changes the region number of tetrahedra. This array is defined as the parameter <code class="codehilite"><span class="kp">reftet</span></code> in the keyword <code class="codehilite"><span class="nf">change</span></code>.</p>
</li>
<li>
<p><code class="codehilite"><span class="kr">label</span><span class="o">=</span></code> an integer array that changes the label of boundary triangles. This array is defined as the parameter <code class="codehilite"><span class="kr">label</span></code> in the keyword <code class="codehilite"><span class="nf">change</span></code>.</p>
</li>
<li>
<p><code class="codehilite"><span class="kp">sizeofvolume</span><span class="o">=</span></code> a reel function. This function constraints the volume size of the tetrahedra in the domain. (see <a href="#a-first-3d-isotrope-mesh-adaptation-process">Isotrope mesh adaption section</a> to build a 3d adapted mesh).</p>
</li>
</ul>
<p>The parameters <code class="codehilite"><span class="kp">switch</span></code>, <code class="codehilite"><span class="kp">nbofregions</span></code>, <code class="codehilite"><span class="kp">regionlist</span></code>, <code class="codehilite"><span class="kp">nboffacetcl</span></code> and <code class="codehilite"><span class="kp">facetcl</span></code> of the command line which call TetGen (<code class="codehilite"><span class="nf">tetg</span></code>) is used for <code class="codehilite"><span class="n">tetgrefine</span></code>.</p>
<p>In the parameter <code class="codehilite"><span class="kp">switch</span><span class="o">=</span></code>, the character <code class="codehilite"><span class="n">r</span></code> should be used without the character <code class="codehilite"><span class="n">p</span></code>.</p>
<p>For instance, see the manual of TetGen <a href="#refHang2006">Hang2006</a> for effect of <code class="codehilite"><span class="n">r</span></code> to other character.</p>
<p>The parameter <code class="codehilite"><span class="kp">regionlist</span></code> defines a new volume constraint in the region. The label in the <code class="codehilite"><span class="kp">regionlist</span></code> will be the previous label of region.</p>
<p>This parameter and <code class="codehilite"><span class="kp">nbofregions</span></code> can't be used with the parameter <code class="codehilite"><span class="kp">sizeofvolume</span></code>.</p>
<p><strong>Example <code class="codehilite"><span class="n">refinesphere</span><span class="p">.</span><span class="n">edp</span></code></strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">load</span> <span class="s">&quot;msh3&quot;</span>
<span class="cp">load</span> <span class="s">&quot;TetGen&quot;</span>
<span class="cp">load</span> <span class="s">&quot;</span><span class="nf">medit</span><span class="s">&quot;</span>

<span class="kt">mesh</span> <span class="n">Th</span> <span class="o">=</span> <span class="nf">square</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="p">[</span><span class="kr">x</span><span class="o">*</span><span class="kr">pi</span><span class="o">-</span><span class="kr">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="kr">y</span><span class="o">*</span><span class="kr">pi</span><span class="p">]);</span> <span class="c1">// $]-pi/2, pi/2[X]0, 2pi[ $</span>

<span class="c1">// A parametrization of a sphere</span>
<span class="kt">func</span> <span class="n">f1</span> <span class="o">=</span> <span class="nf">cos</span><span class="p">(</span><span class="kr">x</span><span class="p">)</span><span class="o">*</span><span class="nf">cos</span><span class="p">(</span><span class="kr">y</span><span class="p">);</span>
<span class="kt">func</span> <span class="n">f2</span> <span class="o">=</span> <span class="nf">cos</span><span class="p">(</span><span class="kr">x</span><span class="p">)</span><span class="o">*</span><span class="nf">sin</span><span class="p">(</span><span class="kr">y</span><span class="p">);</span>
<span class="kt">func</span> <span class="n">f3</span> <span class="o">=</span> <span class="nf">sin</span><span class="p">(</span><span class="kr">x</span><span class="p">);</span>
<span class="c1">// Partial derivative of the parametrization DF</span>
<span class="kt">func</span> <span class="n">f1x</span> <span class="o">=</span> <span class="nf">sin</span><span class="p">(</span><span class="kr">x</span><span class="p">)</span><span class="o">*</span><span class="nf">cos</span><span class="p">(</span><span class="kr">y</span><span class="p">);</span>
<span class="kt">func</span> <span class="n">f1y</span> <span class="o">=</span> <span class="o">-</span><span class="nf">cos</span><span class="p">(</span><span class="kr">x</span><span class="p">)</span><span class="o">*</span><span class="nf">sin</span><span class="p">(</span><span class="kr">y</span><span class="p">);</span>
<span class="kt">func</span> <span class="n">f2x</span> <span class="o">=</span> <span class="o">-</span><span class="nf">sin</span><span class="p">(</span><span class="kr">x</span><span class="p">)</span><span class="o">*</span><span class="nf">sin</span><span class="p">(</span><span class="kr">y</span><span class="p">);</span>
<span class="kt">func</span> <span class="n">f2y</span> <span class="o">=</span> <span class="nf">cos</span><span class="p">(</span><span class="kr">x</span><span class="p">)</span><span class="o">*</span><span class="nf">cos</span><span class="p">(</span><span class="kr">y</span><span class="p">);</span>
<span class="kt">func</span> <span class="n">f3x</span> <span class="o">=</span> <span class="nf">cos</span><span class="p">(</span><span class="kr">x</span><span class="p">);</span>
<span class="kt">func</span> <span class="n">f3y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="c1">// M = DF^t DF</span>
<span class="kt">func</span> <span class="n">m11</span> <span class="o">=</span> <span class="n">f1x</span><span class="o">^</span><span class="mi">2</span> <span class="o">+</span> <span class="n">f2x</span><span class="o">^</span><span class="mi">2</span> <span class="o">+</span> <span class="n">f3x</span><span class="o">^</span><span class="mi">2</span><span class="p">;</span>
<span class="kt">func</span> <span class="n">m21</span> <span class="o">=</span> <span class="n">f1x</span><span class="o">*</span><span class="n">f1y</span> <span class="o">+</span> <span class="n">f2x</span><span class="o">*</span><span class="n">f2y</span> <span class="o">+</span> <span class="n">f3x</span><span class="o">*</span><span class="n">f3y</span><span class="p">;</span>
<span class="kt">func</span> <span class="n">m22</span> <span class="o">=</span> <span class="n">f1y</span><span class="o">^</span><span class="mi">2</span> <span class="o">+</span> <span class="n">f2y</span><span class="o">^</span><span class="mi">2</span> <span class="o">+</span> <span class="n">f3y</span><span class="o">^</span><span class="mi">2</span><span class="p">;</span>

<span class="c1">// Mesh adaptation</span>
<span class="kt">func</span> <span class="n">perio</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">4</span><span class="p">,</span> <span class="kr">y</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="kr">y</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="kr">x</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="kr">x</span><span class="p">]];</span>
<span class="kt">real</span> <span class="n">hh</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">;</span>
<span class="kt">real</span> <span class="n">vv</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="nf">square</span><span class="p">(</span><span class="n">hh</span><span class="p">);</span>
<span class="kr">verbosity</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="n">Th</span> <span class="o">=</span> <span class="nf">adaptmesh</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="n">m11</span><span class="o">*</span><span class="n">vv</span><span class="p">,</span> <span class="n">m21</span><span class="o">*</span><span class="n">vv</span><span class="p">,</span> <span class="n">m22</span><span class="o">*</span><span class="n">vv</span><span class="p">,</span> <span class="kp">IsMetric</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="kp">periodic</span><span class="o">=</span><span class="n">perio</span><span class="p">);</span>
<span class="n">Th</span> <span class="o">=</span> <span class="nf">adaptmesh</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="n">m11</span><span class="o">*</span><span class="n">vv</span><span class="p">,</span> <span class="n">m21</span><span class="o">*</span><span class="n">vv</span><span class="p">,</span> <span class="n">m22</span><span class="o">*</span><span class="n">vv</span><span class="p">,</span> <span class="kp">IsMetric</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="kp">periodic</span><span class="o">=</span><span class="n">perio</span><span class="p">);</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="kp">wait</span><span class="o">=</span><span class="kr">true</span><span class="p">);</span>

<span class="c1">// Construction of the surface of spheres</span>
<span class="kt">real</span> <span class="n">Rmin</span> <span class="o">=</span> <span class="mf">1.</span><span class="p">;</span>
<span class="kt">func</span> <span class="n">f1min</span> <span class="o">=</span> <span class="n">Rmin</span><span class="o">*</span><span class="n">f1</span><span class="p">;</span>
<span class="kt">func</span> <span class="n">f2min</span> <span class="o">=</span> <span class="n">Rmin</span><span class="o">*</span><span class="n">f2</span><span class="p">;</span>
<span class="kt">func</span> <span class="n">f3min</span> <span class="o">=</span> <span class="n">Rmin</span><span class="o">*</span><span class="n">f3</span><span class="p">;</span>

<span class="kt">mesh3</span> <span class="n">Th3</span> <span class="o">=</span> <span class="nf">movemesh23</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="kp">transfo</span><span class="o">=</span><span class="p">[</span><span class="n">f1min</span><span class="p">,</span> <span class="n">f2min</span><span class="p">,</span> <span class="n">f3min</span><span class="p">]);</span>

<span class="c1">// Contruct the volume</span>
<span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">domain</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mi">145</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">];</span>
<span class="kt">mesh3</span> <span class="n">Th3sph</span> <span class="o">=</span> <span class="nf">tetg</span><span class="p">(</span><span class="n">Th3</span><span class="p">,</span> <span class="kp">switch</span><span class="o">=</span><span class="s">&quot;paAAQYY&quot;</span><span class="p">,</span> <span class="kp">nbofregions</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="kp">regionlist</span><span class="o">=</span><span class="n">domain</span><span class="p">);</span>

<span class="c1">// Refine</span>
<span class="kt">int</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">newlabel</span> <span class="o">=</span> <span class="p">[</span><span class="mi">145</span><span class="p">,</span> <span class="mi">18</span><span class="p">];</span>
<span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">domainrefine</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mi">145</span><span class="p">,</span> <span class="mf">0.0001</span><span class="p">];</span>
<span class="kt">mesh3</span> <span class="n">Th3sphrefine</span> <span class="o">=</span> <span class="nf">tetgreconstruction</span><span class="p">(</span><span class="n">Th3sph</span><span class="p">,</span> <span class="kp">switch</span><span class="o">=</span><span class="s">&quot;raAQ&quot;</span><span class="p">,</span> <span class="kp">reftet</span><span class="o">=</span><span class="n">newlabel</span><span class="p">,</span>
    <span class="kp">nbofregions</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="kp">regionlist</span><span class="o">=</span><span class="n">domain</span><span class="p">,</span> <span class="kp">sizeofvolume</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">);</span>

<span class="c1">// Re-Refine</span>
<span class="kt">int</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">newlabel2</span> <span class="o">=</span> <span class="p">[</span><span class="mi">145</span><span class="p">,</span> <span class="mi">53</span><span class="p">];</span>
<span class="kt">func</span> <span class="n">fsize</span> <span class="o">=</span> <span class="mf">0.01</span><span class="o">/</span><span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">5</span><span class="o">*</span><span class="nf">sqrt</span><span class="p">((</span><span class="kr">x</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span><span class="o">^</span><span class="mi">2</span><span class="o">+</span><span class="p">(</span><span class="kr">y</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span><span class="o">^</span><span class="mi">2</span><span class="o">+</span><span class="p">(</span><span class="kr">z</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span><span class="o">^</span><span class="mi">2</span><span class="p">))</span><span class="o">^</span><span class="mi">3</span><span class="p">);</span>
<span class="kt">mesh3</span> <span class="n">Th3sphrefine2</span> <span class="o">=</span> <span class="nf">tetgreconstruction</span><span class="p">(</span><span class="n">Th3sph</span><span class="p">,</span> <span class="kp">switch</span><span class="o">=</span><span class="s">&quot;raAQ&quot;</span><span class="p">,</span> <span class="kp">reftet</span><span class="o">=</span><span class="n">newlabel2</span><span class="p">,</span>
    <span class="kp">sizeofvolume</span><span class="o">=</span><span class="n">fsize</span><span class="p">);</span>

<span class="c1">// Medit</span>
<span class="nf">medit</span><span class="p">(</span><span class="s">&quot;sphere&quot;</span><span class="p">,</span> <span class="n">Th3sph</span><span class="p">);</span>
<span class="nf">medit</span><span class="p">(</span><span class="s">&quot;isotroperefine&quot;</span><span class="p">,</span> <span class="n">Th3sphrefine</span><span class="p">);</span>
<span class="nf">medit</span><span class="p">(</span><span class="s">&quot;anisotroperefine&quot;</span><span class="p">,</span> <span class="n">Th3sphrefine2</span><span class="p">);</span>
</pre></div>
</td></tr></table>

<h3 id="moving-mesh-in-three-dimensions">Moving mesh in three dimensions<a class="headerlink" href="#moving-mesh-in-three-dimensions" title="Permanent link">#</a></h3>
<p>Meshes in three dimensions can be translated, rotated, and deformed using the command line <code class="codehilite"><span class="nf">movemesh</span></code> as in the 2D case (see <a href="#movemesh">section <code class="codehilite"><span class="nf">movemesh</span></code></a>). If <span><span class="MathJax_Preview">\Omega</span><script type="math/tex">\Omega</script></span> is tetrahedrized as <span><span class="MathJax_Preview">T_{h}(\Omega)</span><script type="math/tex">T_{h}(\Omega)</script></span>, and <span><span class="MathJax_Preview">\Phi(x,y)=(\Phi1(x,y,z), \Phi2(x,y,z), \Phi3(x,y,z))</span><script type="math/tex">\Phi(x,y)=(\Phi1(x,y,z), \Phi2(x,y,z), \Phi3(x,y,z))</script></span> is a displacement vector then <span><span class="MathJax_Preview">\Phi(T_{h})</span><script type="math/tex">\Phi(T_{h})</script></span> is obtained by</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">mesh3</span> <span class="n">Th</span> <span class="o">=</span> <span class="nf">movemesh</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="p">[</span><span class="err">$\</span><span class="n">Phi</span><span class="err">$</span><span class="mi">1</span><span class="p">,</span> <span class="err">$\</span><span class="n">Phi</span><span class="err">$</span><span class="mi">2</span><span class="p">,</span> <span class="err">$\</span><span class="n">Phi</span><span class="err">$</span><span class="mi">3</span><span class="p">],</span> <span class="p">...);</span>
</pre></div>
</td></tr></table>

<p>The parameters of movemesh in three dimensions are:</p>
<ul>
<li>
<p><code class="codehilite"><span class="kr">region</span><span class="o">=</span></code> sets the integer labels of the tetrahedra. 0 by default.</p>
</li>
<li>
<p><code class="codehilite"><span class="kr">label</span><span class="o">=</span></code> sets the labels of the border faces. This parameter is initialized as the label for the keyword <a href="#how-to-change-the-label-of-elements-and-border-elements-of-a-mesh"><code class="codehilite"><span class="nf">change</span></code></a>.</p>
</li>
<li>
<p><code class="codehilite"><span class="kp">facemerge</span><span class="o">=</span></code> An integer expression. When you transform a mesh, some faces can be merged. This parameter equals to one if the merges' faces is considered. Otherwise it equals to zero. By default, this parameter is equal to 1.</p>
</li>
<li>
<p><code class="codehilite"><span class="kp">ptmerge</span> <span class="o">=</span></code> A real expression. When you transform a mesh, some points can be merged. This parameter is the criteria to define two merging points.
    By default, we use
    <script type="math/tex; mode=display">
    ptmerge \: = \: 1e-7 \: \:Vol( B ),
    </script>
    where <span><span class="MathJax_Preview">B</span><script type="math/tex">B</script></span> is the smallest axis parallel boxes containing the discretion domain of <span><span class="MathJax_Preview">\Omega</span><script type="math/tex">\Omega</script></span> and <span><span class="MathJax_Preview">Vol(B)</span><script type="math/tex">Vol(B)</script></span> is the volume of this box.</p>
</li>
<li>
<p><code class="codehilite"><span class="kp">orientation</span> <span class="o">=</span></code> An integer expression (1 by default), to reverse or not to reverse the orientation of the tetrahedra if it is not positive.</p>
</li>
</ul>
<p>An example of this command can be found in the <a href="/examples/#poissons-equation-3d">Poisson's equation 3D example</a>.</p>
<h3 id="layer-mesh">Layer mesh<a class="headerlink" href="#layer-mesh" title="Permanent link">#</a></h3>
<p>In this section, we present the command line to obtain a Layer mesh: <code class="codehilite"><span class="nf">buildlayers</span></code>. This mesh is obtained by extending a two dimensional mesh in the <span><span class="MathJax_Preview">z</span><script type="math/tex">z</script></span>-axis.</p>
<p>The domain <span><span class="MathJax_Preview">\Omega_{3d}</span><script type="math/tex">\Omega_{3d}</script></span> defined by the layer mesh is equal to <span><span class="MathJax_Preview">\Omega_{3d} = \Omega_{2d} \times [zmin, zmax]</span><script type="math/tex">\Omega_{3d} = \Omega_{2d} \times [zmin, zmax]</script></span> where <span><span class="MathJax_Preview">\Omega_{2d}</span><script type="math/tex">\Omega_{2d}</script></span> is the domain defined by the two dimensional meshes. <span><span class="MathJax_Preview">zmin</span><script type="math/tex">zmin</script></span> and <span><span class="MathJax_Preview">zmax</span><script type="math/tex">zmax</script></span> are functions of <span><span class="MathJax_Preview">\Omega_{2d}</span><script type="math/tex">\Omega_{2d}</script></span> in <span><span class="MathJax_Preview">\R</span><script type="math/tex">\R</script></span> that defines respectively the lower surface and upper surface of <span><span class="MathJax_Preview">\Omega_{3d}</span><script type="math/tex">\Omega_{3d}</script></span>.</p>
<p><center></p>
<table>
<thead>
<tr>
<th align="center"><a name="Fig35">Fig. 35</a>: Example of Layer mesh in three dimensions.</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="Layer Mesh 3D" src="../images/MeshGeneration_LayerMesh.png" /></td>
</tr>
</tbody>
</table>
<p></center></p>
<p>For a vertex of a two dimensional mesh <span><span class="MathJax_Preview">V_{i}^{2d} = (x_{i},y_{i})</span><script type="math/tex">V_{i}^{2d} = (x_{i},y_{i})</script></span>, we introduce the number of associated vertices in the <span><span class="MathJax_Preview">z-</span><script type="math/tex">z-</script></span>axis <span><span class="MathJax_Preview">M_{i}+1</span><script type="math/tex">M_{i}+1</script></span>.</p>
<p>We denote by <span><span class="MathJax_Preview">M</span><script type="math/tex">M</script></span> the maximum of <span><span class="MathJax_Preview">M_{i}</span><script type="math/tex">M_{i}</script></span> over the vertices of the two dimensional mesh. This value is called the number of layers (if <span><span class="MathJax_Preview">\forall i, \; M_{i}=M</span><script type="math/tex">\forall i, \; M_{i}=M</script></span> then there are <span><span class="MathJax_Preview">M</span><script type="math/tex">M</script></span> layers in the mesh of <span><span class="MathJax_Preview">\Omega_{3d}</span><script type="math/tex">\Omega_{3d}</script></span>). <span><span class="MathJax_Preview">V_{i}^{2d}</span><script type="math/tex">V_{i}^{2d}</script></span> generated <span><span class="MathJax_Preview">M+1</span><script type="math/tex">M+1</script></span> vertices which are defined by :</p>
<div>
<div class="MathJax_Preview">
\forall j=0, \ldots, M, \qquad V_{i,j}^{3d} = ( x_{i}, y_{i}, \theta_{i}(z_{i,j}) ),
</div>
<script type="math/tex; mode=display">
\forall j=0, \ldots, M, \qquad V_{i,j}^{3d} = ( x_{i}, y_{i}, \theta_{i}(z_{i,j}) ),
</script>
</div>
<p>where <span><span class="MathJax_Preview">(z_{i,j})_{j=0,\ldots,M}</span><script type="math/tex">(z_{i,j})_{j=0,\ldots,M}</script></span> are the <span><span class="MathJax_Preview">M+1</span><script type="math/tex">M+1</script></span> equidistant points on the interval <span><span class="MathJax_Preview">[zmin( V_{i}^{2d} ), zmax( V_{i}^{2d})]</span><script type="math/tex">[zmin( V_{i}^{2d} ), zmax( V_{i}^{2d})]</script></span>:</p>
<div>
<div class="MathJax_Preview">\begin{eqnarray*}
z_{i,j} = j \: \delta \alpha + zmin(V_{i}^{2d}), \qquad \delta \alpha= \frac{ zmax( V_{i}^{2d} ) - zmin( V_{i}^{2d}) }{M}.
\end{eqnarray*}</div>
<script type="math/tex; mode=display">\begin{eqnarray*}
z_{i,j} = j \: \delta \alpha + zmin(V_{i}^{2d}), \qquad \delta \alpha= \frac{ zmax( V_{i}^{2d} ) - zmin( V_{i}^{2d}) }{M}.
\end{eqnarray*}</script>
</div>
<p>The function <span><span class="MathJax_Preview">\theta_{i}</span><script type="math/tex">\theta_{i}</script></span>, defined on <span><span class="MathJax_Preview">[zmin( V_{i}^{2d} ), zmax( V_{i}^{2d} )]</span><script type="math/tex">[zmin( V_{i}^{2d} ), zmax( V_{i}^{2d} )]</script></span>, is given by :</p>
<div>
<div class="MathJax_Preview">
\theta_{i}(z) = \left \{
\begin{array}{cl}
\theta_{i,0} &amp; \mbox{if} \: z=zmin(V_{i}^{2d}), \\
\theta_{i,j} &amp; \mbox{if} \: z \in ] \theta_{i,j-1}, \theta_{i,j}],\\
\end{array}
\right.
</div>
<script type="math/tex; mode=display">
\theta_{i}(z) = \left \{
\begin{array}{cl}
\theta_{i,0} & \mbox{if} \: z=zmin(V_{i}^{2d}), \\
\theta_{i,j} & \mbox{if} \: z \in ] \theta_{i,j-1}, \theta_{i,j}],\\
\end{array}
\right.
</script>
</div>
<p>with <span><span class="MathJax_Preview">(\theta_{i,j})_{j=0,\ldots,M_{i}}</span><script type="math/tex">(\theta_{i,j})_{j=0,\ldots,M_{i}}</script></span> are the <span><span class="MathJax_Preview">M_{i}+1</span><script type="math/tex">M_{i}+1</script></span> equidistant points on the interval <span><span class="MathJax_Preview">[zmin( V_{i}^{2d} ), zmax( V_{i}^{2d} )]</span><script type="math/tex">[zmin( V_{i}^{2d} ), zmax( V_{i}^{2d} )]</script></span>.</p>
<p>Set a triangle <span><span class="MathJax_Preview">K=(V_{i1}^{2d}</span><script type="math/tex">K=(V_{i1}^{2d}</script></span>, <span><span class="MathJax_Preview">V_{i2}^{2d}</span><script type="math/tex">V_{i2}^{2d}</script></span>, <span><span class="MathJax_Preview">V_{i3}^{2d})</span><script type="math/tex">V_{i3}^{2d})</script></span> of the two dimensional mesh. <span><span class="MathJax_Preview">K</span><script type="math/tex">K</script></span> is associated with a triangle on the upper surface (resp. on the lower surface) of layer mesh:</p>
<p><span><span class="MathJax_Preview">( V_{i1,M}^{3d}, V_{i2,M}^{3d}, V_{i3,M}^{3d} )</span><script type="math/tex">( V_{i1,M}^{3d}, V_{i2,M}^{3d}, V_{i3,M}^{3d} )</script></span> (resp. <span><span class="MathJax_Preview">( V_{i1,0}^{3d}, V_{i2,0}^{3d}, V_{i3,0}^{3d})</span><script type="math/tex">( V_{i1,0}^{3d}, V_{i2,0}^{3d}, V_{i3,0}^{3d})</script></span>).</p>
<p>Also <span><span class="MathJax_Preview">K</span><script type="math/tex">K</script></span> is associated with <span><span class="MathJax_Preview">M</span><script type="math/tex">M</script></span> volume prismatic elements which are defined by :</p>
<div>
<div class="MathJax_Preview">
\forall j=0,\ldots,M, \quad H_{j} = ( V_{i1,j}^{3d}, V_{i2,j}^{3d}, V_{i3,j}^{3d}, V_{i1,j+1}^{3d}, V_{i2,j+1}^{3d}, V_{i3,j+1}^{3d} ).
</div>
<script type="math/tex; mode=display">
\forall j=0,\ldots,M, \quad H_{j} = ( V_{i1,j}^{3d}, V_{i2,j}^{3d}, V_{i3,j}^{3d}, V_{i1,j+1}^{3d}, V_{i2,j+1}^{3d}, V_{i3,j+1}^{3d} ).
</script>
</div>
<p>Theses volume elements can have some merged point:</p>
<ul>
<li>0 merged point : prism</li>
<li>1 merged points : pyramid</li>
<li>2 merged points : tetrahedra</li>
<li>3 merged points : no elements</li>
</ul>
<p>The elements with merged points are called degenerate elements. To obtain a mesh with tetrahedra, we decompose the pyramid into two tetrahedra and the prism into three tetrahedra. These tetrahedra are obtained by cutting the quadrilateral face of pyramid and prism with the diagonal which have the vertex with the maximum index (see <a href="#refHecht1992">Hecht1992</a>} for the reason of this choice).</p>
<p>The triangles on the middle surface obtained with the decomposition of the volume prismatic elements are the triangles generated by the edges on the border of the two dimensional mesh. The label of triangles on the border elements and tetrahedra are defined with the label of these associated elements.</p>
<p>The arguments of <code class="codehilite"><span class="nf">buildlayers</span></code> is a two dimensional mesh and the number of layers <span><span class="MathJax_Preview">M</span><script type="math/tex">M</script></span>.</p>
<p>The parameters of this command are:</p>
<ul>
<li>
<p><code class="codehilite"><span class="kp">zbound</span><span class="o">=</span></code> <span><span class="MathJax_Preview">[zmin,zmax]</span><script type="math/tex">[zmin,zmax]</script></span> where <span><span class="MathJax_Preview">zmin</span><script type="math/tex">zmin</script></span> and <span><span class="MathJax_Preview">zmax</span><script type="math/tex">zmax</script></span> are functions expression. Theses functions define the lower surface mesh and upper mesh of surface mesh.</p>
</li>
<li>
<p><code class="codehilite"><span class="kp">coef</span><span class="o">=</span></code> A function expression between [0,1]. This parameter is used to introduce degenerate element in mesh.</p>
<p>The number of associated points or vertex <span><span class="MathJax_Preview">V_{i}^{2d}</span><script type="math/tex">V_{i}^{2d}</script></span> is the integer part of <span><span class="MathJax_Preview">coef(V_{i}^{2d}) M</span><script type="math/tex">coef(V_{i}^{2d}) M</script></span>.</p>
</li>
<li>
<p><code class="codehilite"><span class="kr">region</span><span class="o">=</span></code> This vector is used to initialize the region of tetrahedra.</p>
<p>This vector contains successive pairs of the 2d region number at index <span><span class="MathJax_Preview">2i</span><script type="math/tex">2i</script></span> and the corresponding 3d region number at index <span><span class="MathJax_Preview">2i+1</span><script type="math/tex">2i+1</script></span>, like <a href="#how-to-change-the-label-of-elements-and-border-elements-of-a-mesh"><code class="codehilite"><span class="nf">change</span></code></a>.</p>
</li>
<li>
<p><code class="codehilite"><span class="kp">labelmid</span><span class="o">=</span></code> This vector is used to initialize the 3d labels number of the vertical face or mid face from the 2d label number.</p>
<p>This vector contains successive pairs of the 2d label number at index <span><span class="MathJax_Preview">2i</span><script type="math/tex">2i</script></span> and the corresponding 3d label number at index <span><span class="MathJax_Preview">2i+1</span><script type="math/tex">2i+1</script></span>, like <a href="#how-to-change-the-label-of-elements-and-border-elements-of-a-mesh"><code class="codehilite"><span class="nf">change</span></code></a>.</p>
</li>
<li>
<p><code class="codehilite"><span class="kp">labelup</span><span class="o">=</span></code> This vector is used to initialize the 3d label numbers of the upper/top face from the 2d region number.</p>
<p>This vector contains successive pairs of the 2d region number at index <span><span class="MathJax_Preview">2i</span><script type="math/tex">2i</script></span> and the corresponding 3d label number at index <span><span class="MathJax_Preview">2i+1</span><script type="math/tex">2i+1</script></span>, like <a href="#how-to-change-the-label-of-elements-and-border-elements-of-a-mesh"><code class="codehilite"><span class="nf">change</span></code></a>.</p>
</li>
<li>
<p><code class="codehilite"><span class="kp">labeldown</span><span class="o">=</span></code> Same as the previous case but for the lower/down face label.</p>
</li>
</ul>
<p>Moreover, we also add post processing parameters that allow to moving the mesh. These parameters correspond to parameters <code class="codehilite"><span class="kp">transfo</span></code>, <code class="codehilite"><span class="kp">facemerge</span></code> and <code class="codehilite"><span class="kp">ptmerge</span></code> of the command line <code class="codehilite"><span class="nf">movemesh</span></code>.</p>
<p>The vector <code class="codehilite"><span class="kr">region</span></code>, <code class="codehilite"><span class="kp">labelmid</span></code>, <code class="codehilite"><span class="kp">labelup</span></code> and <code class="codehilite"><span class="kp">labeldown</span></code> These vectors are composed of <span><span class="MathJax_Preview">n_{l}</span><script type="math/tex">n_{l}</script></span> successive pairs of number <span><span class="MathJax_Preview">O_i,N_l</span><script type="math/tex">O_i,N_l</script></span> where <span><span class="MathJax_Preview">n_{l}</span><script type="math/tex">n_{l}</script></span> is the number (label or region) that we want to get.</p>
<p>An example of this command is given in the <a href="/examples/#build-layer-mesh">Build layer mesh example</a>.</p>
<div class="admonition example">
<p class="admonition-title">Cube</p>
<p><code>Cube.idp</code>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">load</span> <span class="s">&quot;</span><span class="nf">medit</span><span class="s">&quot;</span>
<span class="cp">load</span> <span class="s">&quot;msh3&quot;</span>

<span class="kt">func</span> <span class="kt">mesh3</span> <span class="n">Cube</span> <span class="p">(</span><span class="kt">int</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="o">&amp;</span><span class="n">NN</span><span class="p">,</span> <span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">]</span> <span class="o">&amp;</span><span class="n">BB</span><span class="p">,</span> <span class="kt">int</span><span class="p">[</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">]</span> <span class="o">&amp;</span><span class="n">L</span><span class="p">){</span>
    <span class="kt">real</span> <span class="n">x0</span> <span class="o">=</span> <span class="n">BB</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">x1</span> <span class="o">=</span> <span class="n">BB</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
    <span class="kt">real</span> <span class="nf">y0</span> <span class="o">=</span> <span class="n">BB</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="nf">y1</span> <span class="o">=</span> <span class="n">BB</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
    <span class="kt">real</span> <span class="n">z0</span> <span class="o">=</span> <span class="n">BB</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">z1</span> <span class="o">=</span> <span class="n">BB</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>

    <span class="kt">int</span> <span class="n">nx</span> <span class="o">=</span> <span class="n">NN</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ny</span> <span class="o">=</span> <span class="n">NN</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">nz</span> <span class="o">=</span> <span class="n">NN</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>

    <span class="c1">// 2D mesh</span>
    <span class="kt">mesh</span> <span class="n">Thx</span> <span class="o">=</span> <span class="nf">square</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="p">[</span><span class="n">x0</span><span class="o">+</span><span class="p">(</span><span class="n">x1</span><span class="o">-</span><span class="n">x0</span><span class="p">)</span><span class="o">*</span><span class="kr">x</span><span class="p">,</span> <span class="nf">y0</span><span class="o">+</span><span class="p">(</span><span class="nf">y1</span><span class="o">-</span><span class="nf">y0</span><span class="p">)</span><span class="o">*</span><span class="kr">y</span><span class="p">]);</span>

    <span class="c1">// 3D mesh</span>
    <span class="kt">int</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">rup</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">L</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)],</span> <span class="n">rdown</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">L</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">)];</span>
    <span class="kt">int</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">rmid</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">L</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="n">L</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="mi">3</span><span class="p">,</span> <span class="n">L</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="mi">4</span><span class="p">,</span> <span class="n">L</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)];</span>
    <span class="kt">mesh3</span> <span class="n">Th</span> <span class="o">=</span> <span class="nf">buildlayers</span><span class="p">(</span><span class="n">Thx</span><span class="p">,</span> <span class="n">nz</span><span class="p">,</span> <span class="kp">zbound</span><span class="o">=</span><span class="p">[</span><span class="n">z0</span><span class="p">,</span><span class="n">z1</span><span class="p">],</span>
        <span class="kp">labelmid</span><span class="o">=</span><span class="n">rmid</span><span class="p">,</span> <span class="kp">labelup</span> <span class="o">=</span> <span class="n">rup</span><span class="p">,</span> <span class="kp">labeldown</span> <span class="o">=</span> <span class="n">rdown</span><span class="p">);</span>

    <span class="k">return</span> <span class="n">Th</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></p>
</div>
<div class="admonition example">
<p class="admonition-title">Unit cube</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">include</span> <span class="s">&quot;Cube.idp&quot;</span>

<span class="kt">int</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">NN</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">];</span> <span class="c1">//the number of step in each direction</span>
<span class="kt">real</span> <span class="p">[</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">]</span> <span class="n">BB</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]];</span> <span class="c1">//the bounding box</span>
<span class="kt">int</span> <span class="p">[</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">]</span> <span class="n">L</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">],[</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">]];</span> <span class="c1">//the label of the 6 face left,right, front, back, down, right</span>
<span class="kt">mesh3</span> <span class="n">Th</span> <span class="o">=</span> <span class="n">Cube</span><span class="p">(</span><span class="n">NN</span><span class="p">,</span> <span class="n">BB</span><span class="p">,</span> <span class="n">L</span><span class="p">);</span>
<span class="nf">medit</span><span class="p">(</span><span class="s">&quot;Th&quot;</span><span class="p">,</span> <span class="n">Th</span><span class="p">);</span>
</pre></div>
</td></tr></table>

<p><center></p>
<table>
<thead>
<tr>
<th align="center"><a name="Fig36">Fig. 36</a>: The mesh of a cube made with <code class="codehilite"><span class="nf">cube</span><span class="p">.</span><span class="n">edp</span></code></th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="Cube" src="../images/MeshGeneration_LayerMesh_Example1.png" /></td>
</tr>
</tbody>
</table>
<p></center></p>
</div>
<div class="admonition example">
<p class="admonition-title">Cone</p>
<p>An axisymtric mesh on a triangle with degenerateness
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">load</span> <span class="s">&quot;msh3&quot;</span>
<span class="cp">load</span> <span class="s">&quot;</span><span class="nf">medit</span><span class="s">&quot;</span>

<span class="c1">// Parameters</span>
<span class="kt">real</span> <span class="n">RR</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="kt">real</span> <span class="n">HH</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

<span class="kt">int</span> <span class="n">nn</span><span class="o">=</span><span class="mi">10</span><span class="p">;</span>

<span class="c1">// 2D mesh</span>
<span class="kt">border</span> <span class="nf">Taxe</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">HH</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="kp">t</span><span class="p">;</span> <span class="kr">y</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="kr">label</span><span class="o">=</span><span class="mi">0</span><span class="p">;}</span>
<span class="kt">border</span> <span class="nf">Hypo</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="n">HH</span><span class="o">*</span><span class="kp">t</span><span class="p">;</span> <span class="kr">y</span><span class="o">=</span><span class="n">RR</span><span class="o">*</span><span class="kp">t</span><span class="p">;</span> <span class="kr">label</span><span class="o">=</span><span class="mi">1</span><span class="p">;}</span>
<span class="kt">border</span> <span class="nf">Vert</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">RR</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="n">HH</span><span class="p">;</span> <span class="kr">y</span><span class="o">=</span><span class="kp">t</span><span class="p">;</span> <span class="kr">label</span><span class="o">=</span><span class="mi">2</span><span class="p">;}</span>
<span class="kt">mesh</span> <span class="n">Th2</span> <span class="o">=</span> <span class="nf">buildmesh</span><span class="p">(</span><span class="n">Taxe</span><span class="p">(</span><span class="n">HH</span><span class="o">*</span><span class="n">nn</span><span class="p">)</span> <span class="o">+</span> <span class="n">Hypo</span><span class="p">(</span><span class="nf">sqrt</span><span class="p">(</span><span class="n">HH</span><span class="o">*</span><span class="n">HH</span><span class="o">+</span><span class="n">RR</span><span class="o">*</span><span class="n">RR</span><span class="p">)</span><span class="o">*</span><span class="n">nn</span><span class="p">)</span> <span class="o">+</span> <span class="n">Vert</span><span class="p">(</span><span class="n">RR</span><span class="o">*</span><span class="n">nn</span><span class="p">));</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">Th2</span><span class="p">,</span> <span class="kp">wait</span><span class="o">=</span><span class="kr">true</span><span class="p">);</span>

<span class="c1">// 3D mesh</span>
<span class="kt">real</span> <span class="n">h</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="n">nn</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">MaxLayersT</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="kr">pi</span><span class="o">*</span><span class="n">RR</span><span class="o">/</span><span class="n">h</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span><span class="o">*</span><span class="mi">4</span><span class="p">;</span><span class="c1">//number of layers</span>
<span class="kt">real</span> <span class="n">zminT</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kt">real</span> <span class="n">zmaxT</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="kr">pi</span><span class="p">;</span> <span class="c1">//height 2*pi</span>
<span class="kt">func</span> <span class="n">fx</span> <span class="o">=</span> <span class="kr">y</span><span class="o">*</span><span class="nf">cos</span><span class="p">(</span><span class="kr">z</span><span class="p">);</span>
<span class="kt">func</span> <span class="n">fy</span> <span class="o">=</span> <span class="kr">y</span><span class="o">*</span><span class="nf">sin</span><span class="p">(</span><span class="kr">z</span><span class="p">);</span>
<span class="kt">func</span> <span class="n">fz</span> <span class="o">=</span> <span class="kr">x</span><span class="p">;</span>
<span class="kt">int</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">r1T</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">r2T</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="n">r4T</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">];</span>
<span class="c1">//trick function:</span>
<span class="c1">//The function defined the proportion</span>
<span class="c1">//of number layer close to axis with reference MaxLayersT</span>
<span class="kt">func</span> <span class="n">deg</span> <span class="o">=</span> <span class="kr">max</span><span class="p">(</span><span class="mf">.01</span><span class="p">,</span> <span class="kr">y</span><span class="o">/</span><span class="kr">max</span><span class="p">(</span><span class="kr">x</span><span class="o">/</span><span class="n">HH</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">)</span><span class="o">/</span><span class="n">RR</span><span class="p">);</span>
<span class="kt">mesh3</span> <span class="n">Th3T</span> <span class="o">=</span> <span class="nf">buildlayers</span><span class="p">(</span><span class="n">Th2</span><span class="p">,</span> <span class="kp">coef</span><span class="o">=</span><span class="n">deg</span><span class="p">,</span> <span class="n">MaxLayersT</span><span class="p">,</span>
    <span class="kp">zbound</span><span class="o">=</span><span class="p">[</span><span class="n">zminT</span><span class="p">,</span> <span class="n">zmaxT</span><span class="p">],</span> <span class="kp">transfo</span><span class="o">=</span><span class="p">[</span><span class="n">fx</span><span class="p">,</span> <span class="n">fy</span><span class="p">,</span> <span class="n">fz</span><span class="p">],</span>
    <span class="kp">facemerge</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="kr">region</span><span class="o">=</span><span class="n">r1T</span><span class="p">,</span> <span class="kp">labelmid</span><span class="o">=</span><span class="n">r2T</span><span class="p">);</span>
<span class="nf">medit</span><span class="p">(</span><span class="s">&quot;cone&quot;</span><span class="p">,</span> <span class="n">Th3T</span><span class="p">);</span>
</pre></div>
</td></tr></table></p>
<p><center></p>
<table>
<thead>
<tr>
<th align="center"><a name="Fig37">Fig. 37</a>: the mesh of a cone made with <code class="codehilite"><span class="n">cone</span><span class="p">.</span><span class="n">edp</span></code></th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="Cone" src="../images/MeshGeneration_LayerMesh_Example2.png" /></td>
</tr>
</tbody>
</table>
<p></center></p>
</div>
<div class="admonition example">
<p class="admonition-title">Buildlayer mesh</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">load</span> <span class="s">&quot;msh3&quot;</span>
<span class="cp">load</span> <span class="s">&quot;TetGen&quot;</span>
<span class="cp">load</span> <span class="s">&quot;</span><span class="nf">medit</span><span class="s">&quot;</span>

<span class="c1">// Parameters</span>
<span class="kt">int</span> <span class="n">C1</span> <span class="o">=</span> <span class="mi">99</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">C2</span> <span class="o">=</span> <span class="mi">98</span><span class="p">;</span>

<span class="c1">// 2D mesh</span>
<span class="kt">border</span> <span class="nf">C01</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="kr">pi</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="kp">t</span><span class="p">;</span> <span class="kr">y</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="kr">label</span><span class="o">=</span><span class="mi">1</span><span class="p">;}</span>
<span class="kt">border</span> <span class="nf">C02</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="kr">pi</span><span class="p">){</span> <span class="kr">x</span><span class="o">=</span><span class="kr">pi</span><span class="p">;</span> <span class="kr">y</span><span class="o">=</span><span class="kp">t</span><span class="p">;</span> <span class="kr">label</span><span class="o">=</span><span class="mi">1</span><span class="p">;}</span>
<span class="kt">border</span> <span class="nf">C03</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="kr">pi</span><span class="p">){</span> <span class="kr">x</span><span class="o">=</span><span class="kr">pi</span><span class="o">-</span><span class="kp">t</span><span class="p">;</span> <span class="kr">y</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="kr">pi</span><span class="p">;</span> <span class="kr">label</span><span class="o">=</span><span class="mi">1</span><span class="p">;}</span>
<span class="kt">border</span> <span class="nf">C04</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="kr">pi</span><span class="p">){</span> <span class="kr">x</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="kr">y</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="kr">pi</span><span class="o">-</span><span class="kp">t</span><span class="p">;</span> <span class="kr">label</span><span class="o">=</span><span class="mi">1</span><span class="p">;}</span>

<span class="kt">border</span> <span class="nf">C11</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="mf">0.5</span><span class="o">+</span><span class="kp">t</span><span class="p">;</span> <span class="kr">y</span><span class="o">=</span><span class="mf">2.5</span><span class="p">;</span> <span class="kr">label</span><span class="o">=</span><span class="n">C1</span><span class="p">;}</span>
<span class="kt">border</span> <span class="nf">C12</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="mf">1.2</span><span class="p">;</span> <span class="kr">y</span><span class="o">=</span><span class="mf">2.5</span><span class="o">+</span><span class="kp">t</span><span class="p">;</span> <span class="kr">label</span><span class="o">=</span><span class="n">C1</span><span class="p">;}</span>
<span class="kt">border</span> <span class="nf">C13</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="mf">1.2</span><span class="o">-</span><span class="kp">t</span><span class="p">;</span> <span class="kr">y</span><span class="o">=</span><span class="mf">4.5</span><span class="p">;</span> <span class="kr">label</span><span class="o">=</span><span class="n">C1</span><span class="p">;}</span>
<span class="kt">border</span> <span class="nf">C14</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="mf">0.5</span><span class="p">;</span> <span class="kr">y</span><span class="o">=</span><span class="mf">4.5</span><span class="o">-</span><span class="kp">t</span><span class="p">;</span> <span class="kr">label</span><span class="o">=</span><span class="n">C1</span><span class="p">;}</span>

<span class="kt">border</span> <span class="nf">C21</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="mf">2.3</span><span class="o">+</span><span class="kp">t</span><span class="p">;</span> <span class="kr">y</span><span class="o">=</span><span class="mf">2.5</span><span class="p">;</span> <span class="kr">label</span><span class="o">=</span><span class="n">C2</span><span class="p">;}</span>
<span class="kt">border</span> <span class="nf">C22</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="mi">3</span><span class="p">;</span> <span class="kr">y</span><span class="o">=</span><span class="mf">2.5</span><span class="o">+</span><span class="kp">t</span><span class="p">;</span> <span class="kr">label</span><span class="o">=</span><span class="n">C2</span><span class="p">;}</span>
<span class="kt">border</span> <span class="nf">C23</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="mi">3</span><span class="o">-</span><span class="kp">t</span><span class="p">;</span> <span class="kr">y</span><span class="o">=</span><span class="mf">4.5</span><span class="p">;</span> <span class="kr">label</span><span class="o">=</span><span class="n">C2</span><span class="p">;}</span>
<span class="kt">border</span> <span class="nf">C24</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="mf">2.3</span><span class="p">;</span> <span class="kr">y</span><span class="o">=</span><span class="mf">4.5</span><span class="o">-</span><span class="kp">t</span><span class="p">;</span> <span class="kr">label</span><span class="o">=</span><span class="n">C2</span><span class="p">;}</span>

<span class="kt">mesh</span> <span class="n">Th</span> <span class="o">=</span> <span class="nf">buildmesh</span><span class="p">(</span><span class="n">C01</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">+</span> <span class="n">C02</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">+</span> <span class="n">C03</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">+</span> <span class="n">C04</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
    <span class="o">+</span> <span class="n">C11</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="n">C12</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="n">C13</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="n">C14</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="o">+</span> <span class="n">C21</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="n">C22</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="n">C23</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="n">C24</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">));</span>

<span class="kt">mesh</span> <span class="n">Ths</span> <span class="o">=</span> <span class="nf">buildmesh</span><span class="p">(</span><span class="n">C01</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">+</span> <span class="n">C02</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">+</span> <span class="n">C03</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">+</span> <span class="n">C04</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
    <span class="o">+</span> <span class="n">C11</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="n">C12</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="n">C13</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="n">C14</span><span class="p">(</span><span class="mi">5</span><span class="p">));</span>

<span class="c1">// Construction of a box with one hole and two regions</span>
<span class="kt">func</span> <span class="n">zmin</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">;</span>
<span class="kt">func</span> <span class="n">zmax</span> <span class="o">=</span> <span class="mf">1.</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">MaxLayer</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>

<span class="kt">func</span> <span class="n">XX</span> <span class="o">=</span> <span class="kr">x</span><span class="o">*</span><span class="nf">cos</span><span class="p">(</span><span class="kr">y</span><span class="p">);</span>
<span class="kt">func</span> <span class="n">YY</span> <span class="o">=</span> <span class="kr">x</span><span class="o">*</span><span class="nf">sin</span><span class="p">(</span><span class="kr">y</span><span class="p">);</span>
<span class="kt">func</span> <span class="n">ZZ</span> <span class="o">=</span> <span class="kr">z</span><span class="p">;</span>

<span class="kt">int</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">r1</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">41</span><span class="p">],</span> <span class="n">r2</span> <span class="o">=</span> <span class="p">[</span><span class="mi">98</span><span class="p">,</span> <span class="mi">98</span><span class="p">,</span> <span class="mi">99</span><span class="p">,</span> <span class="mi">99</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">56</span><span class="p">];</span>
<span class="kt">int</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">r3</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">12</span><span class="p">];</span><span class="c1">//the triangles of uppper surface mesh</span>
                      <span class="c1">//generated by the triangle in the 2D region</span>
                      <span class="c1">//of mesh Th of label 4 as label 12</span>
<span class="kt">int</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">r4</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">45</span><span class="p">];</span><span class="c1">//the triangles of lower surface mesh</span>
                      <span class="c1">//generated by the triangle in the 2D region</span>
                      <span class="c1">//of mesh Th of label 4 as label 45.</span>

<span class="kt">mesh3</span> <span class="n">Th3</span> <span class="o">=</span> <span class="nf">buildlayers</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="n">MaxLayer</span><span class="p">,</span> <span class="kp">zbound</span><span class="o">=</span><span class="p">[</span><span class="n">zmin</span><span class="p">,</span> <span class="n">zmax</span><span class="p">],</span> <span class="kr">region</span><span class="o">=</span><span class="n">r1</span><span class="p">,</span>
    <span class="kp">labelmid</span><span class="o">=</span><span class="n">r2</span><span class="p">,</span> <span class="kp">labelup</span><span class="o">=</span><span class="n">r3</span><span class="p">,</span> <span class="kp">labeldown</span><span class="o">=</span><span class="n">r4</span><span class="p">);</span>
<span class="nf">medit</span><span class="p">(</span><span class="s">&quot;box 2 regions 1 hole&quot;</span><span class="p">,</span> <span class="n">Th3</span><span class="p">);</span>

<span class="c1">// Construction of a sphere with TetGen</span>
<span class="kt">func</span> <span class="n">XX1</span> <span class="o">=</span> <span class="nf">cos</span><span class="p">(</span><span class="kr">y</span><span class="p">)</span><span class="o">*</span><span class="nf">sin</span><span class="p">(</span><span class="kr">x</span><span class="p">);</span>
<span class="kt">func</span> <span class="n">YY1</span> <span class="o">=</span> <span class="nf">sin</span><span class="p">(</span><span class="kr">y</span><span class="p">)</span><span class="o">*</span><span class="nf">sin</span><span class="p">(</span><span class="kr">x</span><span class="p">);</span>
<span class="kt">func</span> <span class="n">ZZ1</span> <span class="o">=</span> <span class="nf">cos</span><span class="p">(</span><span class="kr">x</span><span class="p">);</span>

<span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">domain</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">];</span>
<span class="kt">string</span> <span class="n">test</span> <span class="o">=</span> <span class="s">&quot;paACQ&quot;</span><span class="p">;</span>
<span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;test = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">test</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
<span class="kt">mesh3</span> <span class="n">Th3sph</span> <span class="o">=</span> <span class="nf">tetgtransfo</span><span class="p">(</span><span class="n">Ths</span><span class="p">,</span> <span class="kp">transfo</span><span class="o">=</span><span class="p">[</span><span class="n">XX1</span><span class="p">,</span> <span class="n">YY1</span><span class="p">,</span> <span class="n">ZZ1</span><span class="p">],</span>
    <span class="kp">switch</span><span class="o">=</span><span class="n">test</span><span class="p">,</span> <span class="kp">nbofregions</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="kp">regionlist</span><span class="o">=</span><span class="n">domain</span><span class="p">);</span>
<span class="nf">medit</span><span class="p">(</span><span class="s">&quot;sphere 2 regions&quot;</span><span class="p">,</span> <span class="n">Th3sph</span><span class="p">);</span>
</pre></div>
</td></tr></table>

</div>
<h2 id="meshing-examples_1">Meshing examples<a class="headerlink" href="#meshing-examples_1" title="Permanent link">#</a></h2>
<div class="admonition example">
<p class="admonition-title">lake</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">load</span> <span class="s">&quot;msh3&quot;</span>
<span class="cp">load</span> <span class="s">&quot;</span><span class="nf">medit</span><span class="s">&quot;</span>

<span class="c1">// Parameters</span>
<span class="kt">int</span> <span class="n">nn</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>

<span class="c1">// 2D mesh</span>
<span class="kt">border</span> <span class="nf">cc</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="kr">pi</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="nf">cos</span><span class="p">(</span><span class="kp">t</span><span class="p">);</span> <span class="kr">y</span><span class="o">=</span><span class="nf">sin</span><span class="p">(</span><span class="kp">t</span><span class="p">);</span> <span class="kr">label</span><span class="o">=</span><span class="mi">1</span><span class="p">;}</span>
<span class="kt">mesh</span> <span class="n">Th2</span> <span class="o">=</span> <span class="nf">buildmesh</span><span class="p">(</span><span class="n">cc</span><span class="p">(</span><span class="mi">100</span><span class="p">));</span>

<span class="c1">// 3D mesh</span>
<span class="kt">int</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">rup</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">rlow</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">];</span>
<span class="kt">int</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">rmid</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">];</span>
<span class="kt">func</span> <span class="n">zmin</span> <span class="o">=</span> <span class="mi">2</span><span class="o">-</span><span class="nf">sqrt</span><span class="p">(</span><span class="mi">4</span><span class="o">-</span><span class="p">(</span><span class="kr">x</span><span class="o">*</span><span class="kr">x</span><span class="o">+</span><span class="kr">y</span><span class="o">*</span><span class="kr">y</span><span class="p">));</span>
<span class="kt">func</span> <span class="n">zmax</span> <span class="o">=</span> <span class="mi">2</span><span class="o">-</span><span class="nf">sqrt</span><span class="p">(</span><span class="mf">3.</span><span class="p">);</span>

<span class="kt">mesh3</span> <span class="n">Th</span> <span class="o">=</span> <span class="nf">buildlayers</span><span class="p">(</span><span class="n">Th2</span><span class="p">,</span> <span class="n">nn</span><span class="p">,</span>
    <span class="kp">coef</span><span class="o">=</span><span class="kr">max</span><span class="p">((</span><span class="n">zmax</span><span class="o">-</span><span class="n">zmin</span><span class="p">)</span><span class="o">/</span><span class="n">zmax</span><span class="p">,</span> <span class="mf">1.</span><span class="o">/</span><span class="n">nn</span><span class="p">),</span>
    <span class="kp">zbound</span><span class="o">=</span><span class="p">[</span><span class="n">zmin</span><span class="p">,</span><span class="n">zmax</span><span class="p">],</span>
    <span class="kp">labelmid</span><span class="o">=</span><span class="n">rmid</span><span class="p">,</span>
    <span class="kp">labelup</span><span class="o">=</span><span class="n">rup</span><span class="p">,</span>
    <span class="kp">labeldown</span><span class="o">=</span><span class="n">rlow</span><span class="p">);</span>

<span class="nf">medit</span><span class="p">(</span><span class="s">&quot;Th&quot;</span><span class="p">,</span> <span class="n">Th</span><span class="p">);</span>
</pre></div>
</td></tr></table>

</div>
<div class="admonition example">
<p class="admonition-title">Hole region</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">load</span> <span class="s">&quot;msh3&quot;</span>
<span class="cp">load</span> <span class="s">&quot;TetGen&quot;</span>
<span class="cp">load</span> <span class="s">&quot;</span><span class="nf">medit</span><span class="s">&quot;</span>

<span class="c1">// 2D mesh</span>
<span class="kt">mesh</span> <span class="n">Th</span> <span class="o">=</span> <span class="nf">square</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="p">[</span><span class="kr">x</span><span class="o">*</span><span class="kr">pi</span><span class="o">-</span><span class="kr">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="kr">y</span><span class="o">*</span><span class="kr">pi</span><span class="p">]);</span> <span class="c1">// ]-pi/2, pi/2[X]0,2pi[</span>

<span class="c1">// 3D mesh</span>
<span class="c1">//parametrization of a sphere</span>
<span class="kt">func</span> <span class="n">f1</span> <span class="o">=</span> <span class="nf">cos</span><span class="p">(</span><span class="kr">x</span><span class="p">)</span><span class="o">*</span><span class="nf">cos</span><span class="p">(</span><span class="kr">y</span><span class="p">);</span>
<span class="kt">func</span> <span class="n">f2</span> <span class="o">=</span> <span class="nf">cos</span><span class="p">(</span><span class="kr">x</span><span class="p">)</span><span class="o">*</span><span class="nf">sin</span><span class="p">(</span><span class="kr">y</span><span class="p">);</span>
<span class="kt">func</span> <span class="n">f3</span> <span class="o">=</span> <span class="nf">sin</span><span class="p">(</span><span class="kr">x</span><span class="p">);</span>
<span class="c1">//partial derivative of the parametrization</span>
<span class="kt">func</span> <span class="n">f1x</span> <span class="o">=</span> <span class="nf">sin</span><span class="p">(</span><span class="kr">x</span><span class="p">)</span><span class="o">*</span><span class="nf">cos</span><span class="p">(</span><span class="kr">y</span><span class="p">);</span>
<span class="kt">func</span> <span class="n">f1y</span> <span class="o">=</span> <span class="o">-</span><span class="nf">cos</span><span class="p">(</span><span class="kr">x</span><span class="p">)</span><span class="o">*</span><span class="nf">sin</span><span class="p">(</span><span class="kr">y</span><span class="p">);</span>
<span class="kt">func</span> <span class="n">f2x</span> <span class="o">=</span> <span class="o">-</span><span class="nf">sin</span><span class="p">(</span><span class="kr">x</span><span class="p">)</span><span class="o">*</span><span class="nf">sin</span><span class="p">(</span><span class="kr">y</span><span class="p">);</span>
<span class="kt">func</span> <span class="n">f2y</span> <span class="o">=</span> <span class="nf">cos</span><span class="p">(</span><span class="kr">x</span><span class="p">)</span><span class="o">*</span><span class="nf">cos</span><span class="p">(</span><span class="kr">y</span><span class="p">);</span>
<span class="kt">func</span> <span class="n">f3x</span> <span class="o">=</span> <span class="nf">cos</span><span class="p">(</span><span class="kr">x</span><span class="p">);</span>
<span class="kt">func</span> <span class="n">f3y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="c1">//M = DF^t DF</span>
<span class="kt">func</span> <span class="n">m11</span> <span class="o">=</span> <span class="n">f1x</span><span class="o">^</span><span class="mi">2</span> <span class="o">+</span> <span class="n">f2x</span><span class="o">^</span><span class="mi">2</span> <span class="o">+</span> <span class="n">f3x</span><span class="o">^</span><span class="mi">2</span><span class="p">;</span>
<span class="kt">func</span> <span class="n">m21</span> <span class="o">=</span> <span class="n">f1x</span><span class="o">*</span><span class="n">f1y</span> <span class="o">+</span> <span class="n">f2x</span><span class="o">*</span><span class="n">f2y</span> <span class="o">+</span> <span class="n">f3x</span><span class="o">*</span><span class="n">f3y</span><span class="p">;</span>
<span class="kt">func</span> <span class="n">m22</span> <span class="o">=</span> <span class="n">f1y</span><span class="o">^</span><span class="mi">2</span> <span class="o">+</span> <span class="n">f2y</span><span class="o">^</span><span class="mi">2</span> <span class="o">+</span> <span class="n">f3y</span><span class="o">^</span><span class="mi">2</span><span class="p">;</span>

<span class="kt">func</span> <span class="n">perio</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">4</span><span class="p">,</span> <span class="kr">y</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="kr">y</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="kr">x</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="kr">x</span><span class="p">]];</span>
<span class="kt">real</span> <span class="n">hh</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">;</span>
<span class="kt">real</span> <span class="n">vv</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="nf">square</span><span class="p">(</span><span class="n">hh</span><span class="p">);</span>
<span class="kr">verbosity</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="n">Th</span> <span class="o">=</span> <span class="nf">adaptmesh</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="n">m11</span><span class="o">*</span><span class="n">vv</span><span class="p">,</span> <span class="n">m21</span><span class="o">*</span><span class="n">vv</span><span class="p">,</span> <span class="n">m22</span><span class="o">*</span><span class="n">vv</span><span class="p">,</span> <span class="kp">IsMetric</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="kp">periodic</span><span class="o">=</span><span class="n">perio</span><span class="p">);</span>
<span class="n">Th</span> <span class="o">=</span> <span class="nf">adaptmesh</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="n">m11</span><span class="o">*</span><span class="n">vv</span><span class="p">,</span> <span class="n">m21</span><span class="o">*</span><span class="n">vv</span><span class="p">,</span> <span class="n">m22</span><span class="o">*</span><span class="n">vv</span><span class="p">,</span> <span class="kp">IsMetric</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="kp">periodic</span><span class="o">=</span><span class="n">perio</span><span class="p">);</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="kp">wait</span><span class="o">=</span><span class="kr">true</span><span class="p">);</span>

<span class="c1">//construction of the surface of spheres</span>
<span class="kt">real</span> <span class="n">Rmin</span> <span class="o">=</span> <span class="mf">1.</span><span class="p">;</span>
<span class="kt">func</span> <span class="n">f1min</span> <span class="o">=</span> <span class="n">Rmin</span><span class="o">*</span><span class="n">f1</span><span class="p">;</span>
<span class="kt">func</span> <span class="n">f2min</span> <span class="o">=</span> <span class="n">Rmin</span><span class="o">*</span><span class="n">f2</span><span class="p">;</span>
<span class="kt">func</span> <span class="n">f3min</span> <span class="o">=</span> <span class="n">Rmin</span><span class="o">*</span><span class="n">f3</span><span class="p">;</span>

<span class="kt">mesh3</span> <span class="n">Th3sph</span> <span class="o">=</span> <span class="nf">movemesh23</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="kp">transfo</span><span class="o">=</span><span class="p">[</span><span class="n">f1min</span><span class="p">,</span> <span class="n">f2min</span><span class="p">,</span> <span class="n">f3min</span><span class="p">]);</span>

<span class="kt">real</span> <span class="n">Rmax</span> <span class="o">=</span> <span class="mf">2.</span><span class="p">;</span>
<span class="kt">func</span> <span class="n">f1max</span> <span class="o">=</span> <span class="n">Rmax</span><span class="o">*</span><span class="n">f1</span><span class="p">;</span>
<span class="kt">func</span> <span class="n">f2max</span> <span class="o">=</span> <span class="n">Rmax</span><span class="o">*</span><span class="n">f2</span><span class="p">;</span>
<span class="kt">func</span> <span class="n">f3max</span> <span class="o">=</span> <span class="n">Rmax</span><span class="o">*</span><span class="n">f3</span><span class="p">;</span>

<span class="kt">mesh3</span> <span class="n">Th3sph2</span> <span class="o">=</span> <span class="nf">movemesh23</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="kp">transfo</span><span class="o">=</span><span class="p">[</span><span class="n">f1max</span><span class="p">,</span> <span class="n">f2max</span><span class="p">,</span> <span class="n">f3max</span><span class="p">]);</span>

<span class="c1">//gluing meshse</span>
<span class="kt">mesh3</span> <span class="n">Th3</span> <span class="o">=</span> <span class="n">Th3sph</span> <span class="o">+</span> <span class="n">Th3sph2</span><span class="p">;</span>

<span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; TetGen call without hole &quot;</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
<span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">domain2</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mi">145</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">];</span>
<span class="kt">mesh3</span> <span class="n">Th3fin</span> <span class="o">=</span> <span class="nf">tetg</span><span class="p">(</span><span class="n">Th3</span><span class="p">,</span> <span class="kp">switch</span><span class="o">=</span><span class="s">&quot;paAAQYY&quot;</span><span class="p">,</span> <span class="kp">nbofregions</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="kp">regionlist</span><span class="o">=</span><span class="n">domain2</span><span class="p">);</span>
<span class="nf">medit</span><span class="p">(</span><span class="s">&quot;Sphere with two regions&quot;</span><span class="p">,</span> <span class="n">Th3fin</span><span class="p">);</span>

<span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; TetGen call with hole &quot;</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
<span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">hole</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">];</span>
<span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">domain</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mi">53</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">];</span>
<span class="kt">mesh3</span> <span class="n">Th3finhole</span> <span class="o">=</span> <span class="nf">tetg</span><span class="p">(</span><span class="n">Th3</span><span class="p">,</span> <span class="kp">switch</span><span class="o">=</span><span class="s">&quot;paAAQYY&quot;</span><span class="p">,</span>
    <span class="kp">nbofholes</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="kp">holelist</span><span class="o">=</span><span class="n">hole</span><span class="p">,</span> <span class="kp">nbofregions</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="kp">regionlist</span><span class="o">=</span><span class="n">domain</span><span class="p">);</span>
<span class="nf">medit</span><span class="p">(</span><span class="s">&quot;Sphere with a hole&quot;</span><span class="p">,</span> <span class="n">Th3finhole</span><span class="p">);</span>
</pre></div>
</td></tr></table>

</div>
<h3 id="build-a-3d-mesh-of-a-cube-with-a-balloon">Build a 3d mesh of a cube with a balloon<a class="headerlink" href="#build-a-3d-mesh-of-a-cube-with-a-balloon" title="Permanent link">#</a></h3>
<p>First the <code>MeshSurface.idp</code> file to build boundary mesh of a Hexaedra and of a Sphere:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">func</span> <span class="kt">mesh3</span> <span class="nf">SurfaceHex</span> <span class="p">(</span><span class="kt">int</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="o">&amp;</span><span class="kr">N</span><span class="p">,</span> <span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">]</span> <span class="o">&amp;</span><span class="kp">B</span><span class="p">,</span> <span class="kt">int</span><span class="p">[</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">]</span> <span class="o">&amp;</span><span class="n">L</span><span class="p">,</span> <span class="kt">int</span> <span class="kp">orientation</span><span class="p">){</span>
    <span class="kt">real</span> <span class="n">x0</span> <span class="o">=</span> <span class="kp">B</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">x1</span> <span class="o">=</span> <span class="kp">B</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="kt">real</span> <span class="nf">y0</span> <span class="o">=</span> <span class="kp">B</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="nf">y1</span> <span class="o">=</span> <span class="kp">B</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="kt">real</span> <span class="n">z0</span> <span class="o">=</span> <span class="kp">B</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">z1</span> <span class="o">=</span> <span class="kp">B</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

    <span class="kt">int</span> <span class="n">nx</span> <span class="o">=</span> <span class="kr">N</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ny</span> <span class="o">=</span> <span class="kr">N</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">nz</span> <span class="o">=</span> <span class="kr">N</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>

    <span class="kt">mesh</span> <span class="n">Thx</span> <span class="o">=</span> <span class="nf">square</span><span class="p">(</span><span class="n">ny</span><span class="p">,</span> <span class="n">nz</span><span class="p">,</span> <span class="p">[</span><span class="nf">y0</span><span class="o">+</span><span class="p">(</span><span class="nf">y1</span><span class="o">-</span><span class="nf">y0</span><span class="p">)</span><span class="o">*</span><span class="kr">x</span><span class="p">,</span> <span class="n">z0</span><span class="o">+</span><span class="p">(</span><span class="n">z1</span><span class="o">-</span><span class="n">z0</span><span class="p">)</span><span class="o">*</span><span class="kr">y</span><span class="p">]);</span>
    <span class="kt">mesh</span> <span class="n">Thy</span> <span class="o">=</span> <span class="nf">square</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span> <span class="n">nz</span><span class="p">,</span> <span class="p">[</span><span class="n">x0</span><span class="o">+</span><span class="p">(</span><span class="n">x1</span><span class="o">-</span><span class="n">x0</span><span class="p">)</span><span class="o">*</span><span class="kr">x</span><span class="p">,</span> <span class="n">z0</span><span class="o">+</span><span class="p">(</span><span class="n">z1</span><span class="o">-</span><span class="n">z0</span><span class="p">)</span><span class="o">*</span><span class="kr">y</span><span class="p">]);</span>
    <span class="kt">mesh</span> <span class="n">Thz</span> <span class="o">=</span> <span class="nf">square</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="p">[</span><span class="n">x0</span><span class="o">+</span><span class="p">(</span><span class="n">x1</span><span class="o">-</span><span class="n">x0</span><span class="p">)</span><span class="o">*</span><span class="kr">x</span><span class="p">,</span> <span class="nf">y0</span><span class="o">+</span><span class="p">(</span><span class="nf">y1</span><span class="o">-</span><span class="nf">y0</span><span class="p">)</span><span class="o">*</span><span class="kr">y</span><span class="p">]);</span>

    <span class="kt">int</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">refx</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">L</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)],</span> <span class="n">refX</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">L</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)];</span> <span class="c1">//Xmin, Ymax faces labels renumbering</span>
    <span class="kt">int</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">refy</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">L</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)],</span> <span class="n">refY</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">L</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)];</span> <span class="c1">//Ymin, Ymax faces labesl renumbering</span>
    <span class="kt">int</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">refz</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">L</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">)],</span> <span class="n">refZ</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">L</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)];</span> <span class="c1">//Zmin, Zmax faces labels renumbering</span>

    <span class="kt">mesh3</span> <span class="n">Thx0</span> <span class="o">=</span> <span class="nf">movemesh23</span><span class="p">(</span><span class="n">Thx</span><span class="p">,</span> <span class="kp">transfo</span><span class="o">=</span><span class="p">[</span><span class="n">x0</span><span class="p">,</span> <span class="kr">x</span><span class="p">,</span> <span class="kr">y</span><span class="p">],</span> <span class="kp">orientation</span><span class="o">=-</span><span class="kp">orientation</span><span class="p">,</span> <span class="kr">label</span><span class="o">=</span><span class="n">refx</span><span class="p">);</span>
    <span class="kt">mesh3</span> <span class="n">Thx1</span> <span class="o">=</span> <span class="nf">movemesh23</span><span class="p">(</span><span class="n">Thx</span><span class="p">,</span> <span class="kp">transfo</span><span class="o">=</span><span class="p">[</span><span class="n">x1</span><span class="p">,</span> <span class="kr">x</span><span class="p">,</span> <span class="kr">y</span><span class="p">],</span> <span class="kp">orientation</span><span class="o">=+</span><span class="kp">orientation</span><span class="p">,</span> <span class="kr">label</span><span class="o">=</span><span class="n">refX</span><span class="p">);</span>
    <span class="kt">mesh3</span> <span class="n">Thy0</span> <span class="o">=</span> <span class="nf">movemesh23</span><span class="p">(</span><span class="n">Thy</span><span class="p">,</span> <span class="kp">transfo</span><span class="o">=</span><span class="p">[</span><span class="kr">x</span><span class="p">,</span> <span class="nf">y0</span><span class="p">,</span> <span class="kr">y</span><span class="p">],</span> <span class="kp">orientation</span><span class="o">=+</span><span class="kp">orientation</span><span class="p">,</span> <span class="kr">label</span><span class="o">=</span><span class="n">refy</span><span class="p">);</span>
    <span class="kt">mesh3</span> <span class="n">Thy1</span> <span class="o">=</span> <span class="nf">movemesh23</span><span class="p">(</span><span class="n">Thy</span><span class="p">,</span> <span class="kp">transfo</span><span class="o">=</span><span class="p">[</span><span class="kr">x</span><span class="p">,</span> <span class="nf">y1</span><span class="p">,</span> <span class="kr">y</span><span class="p">],</span> <span class="kp">orientation</span><span class="o">=-</span><span class="kp">orientation</span><span class="p">,</span> <span class="kr">label</span><span class="o">=</span><span class="n">refY</span><span class="p">);</span>
    <span class="kt">mesh3</span> <span class="n">Thz0</span> <span class="o">=</span> <span class="nf">movemesh23</span><span class="p">(</span><span class="n">Thz</span><span class="p">,</span> <span class="kp">transfo</span><span class="o">=</span><span class="p">[</span><span class="kr">x</span><span class="p">,</span> <span class="kr">y</span><span class="p">,</span> <span class="n">z0</span><span class="p">],</span> <span class="kp">orientation</span><span class="o">=-</span><span class="kp">orientation</span><span class="p">,</span> <span class="kr">label</span><span class="o">=</span><span class="n">refz</span><span class="p">);</span>
    <span class="kt">mesh3</span> <span class="n">Thz1</span> <span class="o">=</span> <span class="nf">movemesh23</span><span class="p">(</span><span class="n">Thz</span><span class="p">,</span> <span class="kp">transfo</span><span class="o">=</span><span class="p">[</span><span class="kr">x</span><span class="p">,</span> <span class="kr">y</span><span class="p">,</span> <span class="n">z1</span><span class="p">],</span> <span class="kp">orientation</span><span class="o">=+</span><span class="kp">orientation</span><span class="p">,</span> <span class="kr">label</span><span class="o">=</span><span class="n">refZ</span><span class="p">);</span>
    <span class="kt">mesh3</span> <span class="n">Th</span> <span class="o">=</span> <span class="n">Thx0</span> <span class="o">+</span> <span class="n">Thx1</span> <span class="o">+</span> <span class="n">Thy0</span> <span class="o">+</span> <span class="n">Thy1</span> <span class="o">+</span> <span class="n">Thz0</span> <span class="o">+</span> <span class="n">Thz1</span><span class="p">;</span>

    <span class="k">return</span> <span class="n">Th</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">func</span> <span class="kt">mesh3</span> <span class="nf">Sphere</span> <span class="p">(</span><span class="kt">real</span> <span class="n">R</span><span class="p">,</span> <span class="kt">real</span> <span class="n">h</span><span class="p">,</span> <span class="kt">int</span> <span class="n">L</span><span class="p">,</span> <span class="kt">int</span> <span class="kp">orientation</span><span class="p">){</span>
    <span class="kt">mesh</span> <span class="n">Th</span><span class="o">=</span><span class="nf">square</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="p">[</span><span class="kr">x</span><span class="o">*</span><span class="kr">pi</span><span class="o">-</span><span class="kr">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="kr">y</span><span class="o">*</span><span class="kr">pi</span><span class="p">]);</span> <span class="c1">//]-pi/2, pi/2[X]0,2pi[</span>

    <span class="kt">func</span> <span class="n">f1</span> <span class="o">=</span> <span class="nf">cos</span><span class="p">(</span><span class="kr">x</span><span class="p">)</span><span class="o">*</span><span class="nf">cos</span><span class="p">(</span><span class="kr">y</span><span class="p">);</span>
    <span class="kt">func</span> <span class="n">f2</span> <span class="o">=</span> <span class="nf">cos</span><span class="p">(</span><span class="kr">x</span><span class="p">)</span><span class="o">*</span><span class="nf">sin</span><span class="p">(</span><span class="kr">y</span><span class="p">);</span>
    <span class="kt">func</span> <span class="n">f3</span> <span class="o">=</span> <span class="nf">sin</span><span class="p">(</span><span class="kr">x</span><span class="p">);</span>

    <span class="kt">func</span> <span class="n">f1x</span> <span class="o">=</span> <span class="nf">sin</span><span class="p">(</span><span class="kr">x</span><span class="p">)</span><span class="o">*</span><span class="nf">cos</span><span class="p">(</span><span class="kr">y</span><span class="p">);</span>
    <span class="kt">func</span> <span class="n">f1y</span> <span class="o">=</span> <span class="o">-</span><span class="nf">cos</span><span class="p">(</span><span class="kr">x</span><span class="p">)</span><span class="o">*</span><span class="nf">sin</span><span class="p">(</span><span class="kr">y</span><span class="p">);</span>
    <span class="kt">func</span> <span class="n">f2x</span> <span class="o">=</span> <span class="o">-</span><span class="nf">sin</span><span class="p">(</span><span class="kr">x</span><span class="p">)</span><span class="o">*</span><span class="nf">sin</span><span class="p">(</span><span class="kr">y</span><span class="p">);</span>
    <span class="kt">func</span> <span class="n">f2y</span> <span class="o">=</span> <span class="nf">cos</span><span class="p">(</span><span class="kr">x</span><span class="p">)</span><span class="o">*</span><span class="nf">cos</span><span class="p">(</span><span class="kr">y</span><span class="p">);</span>
    <span class="kt">func</span> <span class="n">f3x</span> <span class="o">=</span> <span class="nf">cos</span><span class="p">(</span><span class="kr">x</span><span class="p">);</span>
    <span class="kt">func</span> <span class="n">f3y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="kt">func</span> <span class="n">m11</span> <span class="o">=</span> <span class="n">f1x</span><span class="o">^</span><span class="mi">2</span> <span class="o">+</span> <span class="n">f2x</span><span class="o">^</span><span class="mi">2</span> <span class="o">+</span> <span class="n">f3x</span><span class="o">^</span><span class="mi">2</span><span class="p">;</span>
    <span class="kt">func</span> <span class="n">m21</span> <span class="o">=</span> <span class="n">f1x</span><span class="o">*</span><span class="n">f1y</span> <span class="o">+</span> <span class="n">f2x</span><span class="o">*</span><span class="n">f2y</span> <span class="o">+</span> <span class="n">f3x</span><span class="o">*</span><span class="n">f3y</span><span class="p">;</span>
    <span class="kt">func</span> <span class="n">m22</span> <span class="o">=</span> <span class="n">f1y</span><span class="o">^</span><span class="mi">2</span> <span class="o">+</span> <span class="n">f2y</span><span class="o">^</span><span class="mi">2</span> <span class="o">+</span> <span class="n">f3y</span><span class="o">^</span><span class="mi">2</span><span class="p">;</span>

    <span class="kt">func</span> <span class="n">perio</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">4</span><span class="p">,</span> <span class="kr">y</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="kr">y</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="kr">x</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="kr">x</span><span class="p">]];</span> <span class="c1">//to store the periodic condition</span>

    <span class="kt">real</span> <span class="n">hh</span> <span class="o">=</span> <span class="n">h</span><span class="o">/</span><span class="n">R</span><span class="p">;</span> <span class="c1">//hh mesh size on unite sphere</span>
    <span class="kt">real</span> <span class="n">vv</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="nf">square</span><span class="p">(</span><span class="n">hh</span><span class="p">);</span>
    <span class="n">Th</span> <span class="o">=</span> <span class="nf">adaptmesh</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="n">m11</span><span class="o">*</span><span class="n">vv</span><span class="p">,</span> <span class="n">m21</span><span class="o">*</span><span class="n">vv</span><span class="p">,</span> <span class="n">m22</span><span class="o">*</span><span class="n">vv</span><span class="p">,</span> <span class="kp">IsMetric</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="kp">periodic</span><span class="o">=</span><span class="n">perio</span><span class="p">);</span>
    <span class="n">Th</span> <span class="o">=</span> <span class="nf">adaptmesh</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="n">m11</span><span class="o">*</span><span class="n">vv</span><span class="p">,</span> <span class="n">m21</span><span class="o">*</span><span class="n">vv</span><span class="p">,</span> <span class="n">m22</span><span class="o">*</span><span class="n">vv</span><span class="p">,</span> <span class="kp">IsMetric</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="kp">periodic</span><span class="o">=</span><span class="n">perio</span><span class="p">);</span>
    <span class="n">Th</span> <span class="o">=</span> <span class="nf">adaptmesh</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="n">m11</span><span class="o">*</span><span class="n">vv</span><span class="p">,</span> <span class="n">m21</span><span class="o">*</span><span class="n">vv</span><span class="p">,</span> <span class="n">m22</span><span class="o">*</span><span class="n">vv</span><span class="p">,</span> <span class="kp">IsMetric</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="kp">periodic</span><span class="o">=</span><span class="n">perio</span><span class="p">);</span>
    <span class="n">Th</span> <span class="o">=</span> <span class="nf">adaptmesh</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="n">m11</span><span class="o">*</span><span class="n">vv</span><span class="p">,</span> <span class="n">m21</span><span class="o">*</span><span class="n">vv</span><span class="p">,</span> <span class="n">m22</span><span class="o">*</span><span class="n">vv</span><span class="p">,</span> <span class="kp">IsMetric</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="kp">periodic</span><span class="o">=</span><span class="n">perio</span><span class="p">);</span>
    <span class="kt">int</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">ref</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">L</span><span class="p">];</span>

    <span class="kt">mesh3</span> <span class="n">ThS</span> <span class="o">=</span> <span class="nf">movemesh23</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="kp">transfo</span><span class="o">=</span><span class="p">[</span><span class="n">f1</span><span class="o">*</span><span class="n">R</span><span class="p">,</span> <span class="n">f2</span><span class="o">*</span><span class="n">R</span><span class="p">,</span> <span class="n">f3</span><span class="o">*</span><span class="n">R</span><span class="p">],</span> <span class="kp">orientation</span><span class="o">=</span><span class="kp">orientation</span><span class="p">,</span> <span class="n">refface</span><span class="o">=</span><span class="n">ref</span><span class="p">);</span>

    <span class="k">return</span> <span class="n">ThS</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>The test of the two functions and the call to <code class="codehilite"><span class="n">TetGen</span></code> mesh generator:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">load</span> <span class="s">&quot;msh3&quot;</span>
<span class="cp">load</span> <span class="s">&quot;TetGen&quot;</span>
<span class="cp">load</span> <span class="s">&quot;</span><span class="nf">medit</span><span class="s">&quot;</span>
<span class="cp">include</span> <span class="s">&quot;MeshSurface.idp&quot;</span>

<span class="c1">// Parameters</span>
<span class="kt">real</span> <span class="n">hs</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">;</span> <span class="c1">//mesh size on sphere</span>
<span class="kt">int</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="kr">N</span> <span class="o">=</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">];</span>
<span class="kt">real</span> <span class="p">[</span><span class="kt">int</span><span class="p">,</span><span class="kt">int</span><span class="p">]</span> <span class="kp">B</span> <span class="o">=</span> <span class="p">[[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]];</span>
<span class="kt">int</span> <span class="p">[</span><span class="kt">int</span><span class="p">,</span><span class="kt">int</span><span class="p">]</span> <span class="n">L</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]];</span>

<span class="c1">// Mesh</span>
<span class="kt">mesh3</span> <span class="n">ThH</span> <span class="o">=</span> <span class="n">SurfaceHex</span><span class="p">(</span><span class="kr">N</span><span class="p">,</span> <span class="kp">B</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="kt">mesh3</span> <span class="n">ThS</span> <span class="o">=</span> <span class="n">Sphere</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">hs</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

<span class="kt">mesh3</span> <span class="n">ThHS</span> <span class="o">=</span> <span class="n">ThH</span> <span class="o">+</span> <span class="n">ThS</span><span class="p">;</span>
<span class="nf">medit</span><span class="p">(</span><span class="s">&quot;Hex-Sphere&quot;</span><span class="p">,</span> <span class="n">ThHS</span><span class="p">);</span>

<span class="kt">real</span> <span class="n">voltet</span> <span class="o">=</span> <span class="p">(</span><span class="n">hs</span><span class="o">^</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="mf">6.</span><span class="p">;</span>
<span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;voltet = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">voltet</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
<span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">domain</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">voltet</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">voltet</span><span class="p">];</span>
<span class="kt">mesh3</span> <span class="n">Th</span> <span class="o">=</span> <span class="nf">tetg</span><span class="p">(</span><span class="n">ThHS</span><span class="p">,</span> <span class="kp">switch</span><span class="o">=</span><span class="s">&quot;pqaAAYYQ&quot;</span><span class="p">,</span> <span class="kp">nbofregions</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="kp">regionlist</span><span class="o">=</span><span class="n">domain</span><span class="p">);</span>
<span class="nf">medit</span><span class="p">(</span><span class="s">&quot;Cube with ball&quot;</span><span class="p">,</span> <span class="n">Th</span><span class="p">);</span>
</pre></div>
</td></tr></table>

<table>
<thead>
<tr>
<th align="center"><a name="Fig38">Fig. 38</a>: The surface mesh of the Hex with internal Sphere</th>
<th align="center"><a name="Fig39">Fig. 39</a>: The tetrahedral mesh of the cube with internal ball</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="Hex Sphere" src="../images/MeshGeneration_CubeSphere1.png" /></td>
<td align="center"><img alt="Cube with ball" src="../images/MeshGeneration_CubeSphere2.png" /></td>
</tr>
</tbody>
</table>
<h2 id="medit">Medit<a class="headerlink" href="#medit" title="Permanent link">#</a></h2>
<p>The keyword <code class="codehilite"><span class="nf">medit</span></code> allows to display a mesh alone or a mesh and one or several functions defined on the mesh using the Pascal Frey's freeware <code>medit</code>. <code>medit</code> opens its own window and uses OpenGL extensively. Naturally to use this command <code>medit</code> must be installed.</p>
<p>A vizualisation with <code class="codehilite"><span class="nf">medit</span></code> of scalar solutions <span><span class="MathJax_Preview">f1</span><script type="math/tex">f1</script></span> and <span><span class="MathJax_Preview">f2</span><script type="math/tex">f2</script></span> continuous, piecewise linear and known at the vertices of the mesh Th is obtained using :</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nf">medit</span><span class="p">(</span><span class="s">&quot;sol1 sol2&quot;</span><span class="p">,</span> <span class="n">Th</span><span class="p">,</span> <span class="n">f1</span><span class="p">,</span> <span class="n">f2</span><span class="p">,</span> <span class="kp">order</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
</pre></div>
</td></tr></table>

<p>The first plot named <code class="codehilite"><span class="n">sol1</span></code> display f1. The second plot names <code class="codehilite"><span class="n">sol2</span></code> display f2.</p>
<p>The arguments of the function <code class="codehilite"><span class="nf">medit</span></code> are the name of the differents scenes (separated by a space) of <code class="codehilite"><span class="nf">medit</span></code>, a mesh and solutions.</p>
<p>Each solution is associated with one scene. The scalar, vector and symmetric tensor solutions are specified in the format described in the section dealing with the keyword <code class="codehilite"><span class="nf">savesol</span></code>.</p>
<p>The parameters of this command line are :</p>
<ul>
<li>
<p><code class="codehilite"><span class="kp">order</span><span class="o">=</span></code> 0 if the solution is given at the center of gravity of elements. 1 is the solution is given at the vertices of elements.</p>
</li>
<li>
<p><code class="codehilite"><span class="kp">meditff</span><span class="o">=</span></code> set the name of execute command of medit. By default, this string is medit.</p>
</li>
<li>
<p><code class="codehilite"><span class="kp">save</span><span class="o">=</span></code> set the name of a file <code class="codehilite"><span class="p">.</span><span class="n">sol</span></code> or <code class="codehilite"><span class="p">.</span><span class="n">solb</span></code> to save solutions.</p>
</li>
</ul>
<p>This command line allows also to represent two differents meshes and solutions on them in the same windows. The nature of solutions must be the same. Hence, we can vizualize in the same window the different domains in a domain decomposition method for instance. A vizualisation with medit of scalar solutions <span><span class="MathJax_Preview">h1</span><script type="math/tex">h1</script></span> and <span><span class="MathJax_Preview">h2</span><script type="math/tex">h2</script></span> at vertices of the mesh Th1 and Th2 respectively are obtained using :</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nf">medit</span><span class="p">(</span><span class="s">&quot;sol2domain&quot;</span><span class="p">,</span> <span class="n">Th1</span><span class="p">,</span> <span class="n">h1</span><span class="p">,</span> <span class="n">Th2</span><span class="p">,</span> <span class="n">h2</span><span class="p">,</span> <span class="kp">order</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
</pre></div>
</td></tr></table>

<div class="admonition example">
<p class="admonition-title"><code class="codehilite"><span class="nf">medit</span></code></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">load</span> <span class="s">&quot;</span><span class="nf">medit</span><span class="s">&quot;</span>

<span class="c1">// Initial Problem:</span>
<span class="c1">// Resolution of the following EDP:</span>
<span class="c1">// -Delta u_s = f on \Omega = { (x,y) | 1 &lt;= sqrt(x^2+y^2) &lt;= 2 }</span>
<span class="c1">// -Delta u_1 = f1 on \Omega_1 = { (x,y) | 0.5 &lt;= sqrt(x^2+y^2) &lt;= 1. }</span>
<span class="c1">// u = 1 on Gamma</span>
<span class="c1">// Null Neumman condition on Gamma_1 and on Gamma_2</span>
<span class="c1">// We find the solution u by solving two EDP defined on domain Omega and Omega_1</span>
<span class="c1">// This solution is visualize with medit</span>

<span class="kr">verbosity</span><span class="o">=</span><span class="mi">3</span><span class="p">;</span>

<span class="c1">// Mesh</span>
<span class="kt">border</span> <span class="nf">Gamma</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="kr">pi</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="nf">cos</span><span class="p">(</span><span class="kp">t</span><span class="p">);</span> <span class="kr">y</span><span class="o">=</span><span class="nf">sin</span><span class="p">(</span><span class="kp">t</span><span class="p">);</span> <span class="kr">label</span><span class="o">=</span><span class="mi">1</span><span class="p">;};</span>
<span class="kt">border</span> <span class="nf">Gamma1</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="kr">pi</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="nf">cos</span><span class="p">(</span><span class="kp">t</span><span class="p">);</span> <span class="kr">y</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="nf">sin</span><span class="p">(</span><span class="kp">t</span><span class="p">);</span> <span class="kr">label</span><span class="o">=</span><span class="mi">2</span><span class="p">;};</span>
<span class="kt">border</span> <span class="nf">Gamma2</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="kr">pi</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="mf">0.5</span><span class="o">*</span><span class="nf">cos</span><span class="p">(</span><span class="kp">t</span><span class="p">);</span> <span class="kr">y</span><span class="o">=</span><span class="mf">0.5</span><span class="o">*</span><span class="nf">sin</span><span class="p">(</span><span class="kp">t</span><span class="p">);</span> <span class="kr">label</span><span class="o">=</span><span class="mi">3</span><span class="p">;};</span>

<span class="kt">mesh</span> <span class="n">Th</span> <span class="o">=</span> <span class="nf">buildmesh</span><span class="p">(</span><span class="n">Gamma1</span><span class="p">(</span><span class="mi">40</span><span class="p">)</span> <span class="o">+</span> <span class="n">Gamma</span><span class="p">(</span><span class="o">-</span><span class="mi">40</span><span class="p">));</span> <span class="c1">//Omega</span>
<span class="kt">mesh</span> <span class="n">Th1</span> <span class="o">=</span> <span class="nf">buildmesh</span><span class="p">(</span><span class="n">Gamma</span><span class="p">(</span><span class="mi">40</span><span class="p">)</span> <span class="o">+</span> <span class="n">Gamma2</span><span class="p">(</span><span class="o">-</span><span class="mi">40</span><span class="p">));</span> <span class="c1">//Omega_1</span>

<span class="c1">// Fespace</span>
<span class="kt">fespace</span> <span class="nf">Vh</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="nc">P2</span><span class="p">);</span>
<span class="kt">func</span> <span class="n">f</span> <span class="o">=</span> <span class="nf">sqrt</span><span class="p">(</span><span class="kr">x</span><span class="o">*</span><span class="kr">x</span> <span class="o">+</span> <span class="kr">y</span><span class="o">*</span><span class="kr">y</span><span class="p">);</span>
<span class="n">Vh</span> <span class="n">us</span><span class="p">,</span> <span class="n">v</span><span class="p">;</span>

<span class="kt">fespace</span> <span class="nf">Vh1</span><span class="p">(</span><span class="n">Th1</span><span class="p">,</span> <span class="nc">P2</span><span class="p">);</span>
<span class="kt">func</span> <span class="n">f1</span> <span class="o">=</span> <span class="mi">10</span><span class="o">*</span><span class="nf">sqrt</span><span class="p">(</span><span class="kr">x</span><span class="o">*</span><span class="kr">x</span><span class="o">+</span><span class="kr">y</span><span class="o">*</span><span class="kr">y</span><span class="p">);</span>
<span class="n">Vh1</span> <span class="n">u1</span><span class="p">,</span> <span class="n">v1</span><span class="p">;</span>

<span class="c1">// Macro</span>
<span class="kt">macro</span> <span class="nf">Grad2</span><span class="p">(</span><span class="n">us</span><span class="p">)</span> <span class="p">[</span><span class="nf">dx</span><span class="p">(</span><span class="n">us</span><span class="p">),</span> <span class="nf">dy</span><span class="p">(</span><span class="n">us</span><span class="p">)]</span> <span class="c1">// EOM</span>

<span class="c1">// Problem</span>
<span class="kt">problem</span> <span class="n">Lap2dOmega</span> <span class="p">(</span><span class="n">us</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="kp">init</span><span class="o">=</span><span class="kr">false</span><span class="p">)</span>
    <span class="o">=</span> <span class="nf">int2d</span><span class="p">(</span><span class="n">Th</span><span class="p">)(</span>
          <span class="n">Grad2</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">&#39;</span> <span class="o">*</span> <span class="n">Grad2</span><span class="p">(</span><span class="n">us</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="o">-</span> <span class="nf">int2d</span><span class="p">(</span><span class="n">Th</span><span class="p">)(</span>
          <span class="n">f</span><span class="o">*</span><span class="n">v</span>
    <span class="p">)</span>
    <span class="o">+</span><span class="nf">on</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">us</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="p">;</span>

<span class="kt">problem</span> <span class="nf">Lap2dOmega1</span> <span class="p">(</span><span class="n">u1</span><span class="p">,</span> <span class="n">v1</span><span class="p">,</span> <span class="kp">init</span><span class="o">=</span><span class="kr">false</span><span class="p">)</span>
    <span class="o">=</span> <span class="nf">int2d</span><span class="p">(</span><span class="n">Th1</span><span class="p">)(</span>
          <span class="n">Grad2</span><span class="p">(</span><span class="n">v1</span><span class="p">)</span><span class="o">&#39;</span> <span class="o">*</span> <span class="n">Grad2</span><span class="p">(</span><span class="n">u1</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="o">-</span> <span class="nf">int2d</span><span class="p">(</span><span class="n">Th1</span><span class="p">)(</span>
          <span class="n">f1</span><span class="o">*</span><span class="n">v1</span>
    <span class="p">)</span>
    <span class="o">+</span> <span class="nf">on</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">u1</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="p">;</span>

<span class="c1">// Solve</span>
<span class="n">Lap2dOmega</span><span class="p">;</span>
<span class="n">Lap2dOmega1</span><span class="p">;</span>

<span class="c1">// Plot with medit</span>
<span class="nf">medit</span><span class="p">(</span><span class="s">&quot;solution&quot;</span><span class="p">,</span> <span class="n">Th</span><span class="p">,</span> <span class="n">us</span><span class="p">,</span> <span class="n">Th1</span><span class="p">,</span> <span class="n">u1</span><span class="p">,</span> <span class="kp">order</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="kp">save</span><span class="o">=</span><span class="s">&quot;testsavemedit.solb&quot;</span><span class="p">);</span>
</pre></div>
</td></tr></table>

</div>
<h2 id="mshmet">Mshmet<a class="headerlink" href="#mshmet" title="Permanent link">#</a></h2>
<p>Mshmet is a software developed by P. Frey that allows to compute an anisotropic metric based on solutions (i.e. Hessian-based). This software can return also an isotropic metric. Moreover, <code>mshmet</code> can also construct a metric suitable for levelset interface capturing. The solution can be defined on 2D or 3D structured/unstructured meshes. For example, the solution can be an error estimate of a FE solution.</p>
<p>Solutions for <code class="codehilite"><span class="nf">mshmet</span></code> are given as an argument. The solution can be a <code class="codehilite"><span class="kt">func</span></code>, a vector <code class="codehilite"><span class="kt">func</span></code>, a symmetric tensor, a <code class="codehilite"><span class="kt">fespace</span></code> function, a <code class="codehilite"><span class="kt">fespace</span></code> vector function and a <code class="codehilite"><span class="kt">fespace</span></code> symmetric tensor. The symmetric tensor argument is defined as this type of data for datasol argument. This software accepts more than one solution.</p>
<p>For example, the metric <span><span class="MathJax_Preview">M</span><script type="math/tex">M</script></span> computed with <code class="codehilite"><span class="nf">mshmet</span></code> for the solution <span><span class="MathJax_Preview">u</span><script type="math/tex">u</script></span> defined on the mesh <span><span class="MathJax_Preview">Th</span><script type="math/tex">Th</script></span> is obtained by writing :</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">fespace</span> <span class="nf">Vh</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="nc">P1</span><span class="p">);</span>
<span class="n">Vh</span> <span class="n">u</span><span class="p">;</span> <span class="c1">//a scalar fespace function</span>
<span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">M</span> <span class="o">=</span> <span class="nf">mshmet</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="n">u</span><span class="p">);</span>
</pre></div>
</td></tr></table>

<p>The parameters of the keyword <code class="codehilite"><span class="nf">mshmet</span></code> are :</p>
<ul>
<li><code class="codehilite"><span class="kp">normalization</span> <span class="o">=</span></code> (b) do a normalization of all solution in <span><span class="MathJax_Preview">[0,1]</span><script type="math/tex">[0,1]</script></span>.</li>
<li><code class="codehilite"><span class="kp">aniso</span> <span class="o">=</span></code> (b) build anisotropic metric if 1 (default 0: isotropic)</li>
<li><code class="codehilite"><span class="kp">levelset</span> <span class="o">=</span></code> (b) build metric for levelset method (default: <code class="codehilite"><span class="kr">false</span></code>)</li>
<li><code class="codehilite"><span class="kr">verbosity</span> <span class="o">=</span></code> (l) level of verbosity</li>
<li><code class="codehilite"><span class="kp">nbregul</span> <span class="o">=</span></code> (l) number of regularization's iteration of solutions given (default 0).</li>
<li><code class="codehilite"><span class="kp">hmin</span> <span class="o">=</span></code> (d)</li>
<li><code class="codehilite"><span class="kp">hmax</span> <span class="o">=</span></code> (d)</li>
<li><code class="codehilite"><span class="kp">err</span> <span class="o">=</span></code> (d) level of error.</li>
<li><code class="codehilite"><span class="kp">width</span> <span class="o">=</span></code> (d) the width</li>
<li><code class="codehilite"><span class="kp">metric</span> <span class="o">=</span></code> a vector of double. This vector contains an initial metric given to <code class="codehilite"><span class="nf">mshmet</span></code>. The structure of the metric vector is described in the next paragraph.</li>
<li>
<p><code class="codehilite"><span class="kp">loptions</span> <span class="o">=</span></code> a vector of integer of size 7. This vector contains the integer parameters of <code class="codehilite"><span class="nf">mshmet</span></code> (for expert only).</p>
<ul>
<li>loptions(0): normalization (default 1).</li>
<li>loptions(1): isotropic parameters (default 0). 1 for isotropic metric results otherwise 0.</li>
<li>loptions(2): level set parameters (default 0). 1 for building level set metric otherwise 0.</li>
<li>loptions(3): debug parameters (default 0). 1 for turning on debug mode otherwise 0.</li>
<li>loptions(4): level of verbosity (default 10).</li>
<li>loptions(5): number of regularization's iteration of solutions given (default 0).</li>
<li>loptions(6): previously metric parameter (default 0). 1 for using previous metric otherwise 0.</li>
</ul>
</li>
<li>
<p><code class="codehilite"><span class="kp">doptions</span><span class="o">=</span></code> a vector of double of size 4. This vector contains the real parameters of <code class="codehilite"><span class="nf">mshmet</span></code> (for expert only).</p>
<ul>
<li>doptions(0): hmin : min size parameters (default 0.01).</li>
<li>doptions(1): hmax : max size parameters (default 1.0).</li>
<li>doptions(2): eps : tolerance parameters (default 0.01).</li>
<li>doptions(2): width : relative width for Level Set (<span><span class="MathJax_Preview">0&lt;w&lt;1</span><script type="math/tex">0<w<1</script></span>) (default 0.05).</li>
</ul>
</li>
</ul>
<p>The result of the keyword <code class="codehilite"><span class="nf">mshmet</span></code> is a <code class="codehilite"><span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span></code> which contains the metric computed by <code class="codehilite"><span class="nf">mshmet</span></code> at the different vertices <span><span class="MathJax_Preview">V_{i}</span><script type="math/tex">V_{i}</script></span> of the mesh.</p>
<p>With <span><span class="MathJax_Preview">nv</span><script type="math/tex">nv</script></span> is the number of vertices, the structure of this vector is
<script type="math/tex; mode=display"> M_{iso}= (m(V_0), m(V_1), \ldots, m(V_{nv}))^t</script>
for a isotropic metric <span><span class="MathJax_Preview">m</span><script type="math/tex">m</script></span>. For a symmetric tensor metric
<span><span class="MathJax_Preview">h=\left(\begin{array}{ccc}
m_{1 1} &amp; m_{1 2} &amp; m_{1 3}\\
m_{2 1} &amp; m_{2 2} &amp; m_{2 3} \\
m_{3 1} &amp; m_{3 2} &amp; m_{3 3}
\end{array}\right)</span><script type="math/tex">h=\left(\begin{array}{ccc}
m_{1 1} & m_{1 2} & m_{1 3}\\
m_{2 1} & m_{2 2} & m_{2 3} \\
m_{3 1} & m_{3 2} & m_{3 3}
\end{array}\right)</script></span>
, the parameters <code class="codehilite"><span class="kp">metric</span></code> is : <script type="math/tex; mode=display">M_{aniso}= (H(V_{0}), \ldots, H(V_{nv}) )^t </script> where <span><span class="MathJax_Preview">H(V_{i})</span><script type="math/tex">H(V_{i})</script></span> is the vector of size 6 defined by <span><span class="MathJax_Preview">[m11,m21,m22,m31,m32,m33]</span><script type="math/tex">[m11,m21,m22,m31,m32,m33]</script></span></p>
<div class="admonition example">
<p class="admonition-title"><code class="codehilite"><span class="nf">mshmet</span></code></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">load</span> <span class="s">&quot;</span><span class="nf">mshmet</span><span class="s">&quot;</span>
<span class="cp">load</span> <span class="s">&quot;</span><span class="nf">medit</span><span class="s">&quot;</span>
<span class="cp">load</span> <span class="s">&quot;msh3&quot;</span>

<span class="c1">// Parameters</span>
<span class="kt">real</span> <span class="n">error</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">;</span>
<span class="kt">func</span> <span class="n">zmin</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kt">func</span> <span class="n">zmax</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">MaxLayer</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>

<span class="c1">// Mesh</span>
<span class="kt">border</span> <span class="nf">a</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="kp">t</span><span class="p">;</span> <span class="kr">y</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="kr">label</span><span class="o">=</span><span class="mi">1</span><span class="p">;};</span>
<span class="kt">border</span> <span class="nf">b</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="kr">y</span><span class="o">=</span><span class="kp">t</span><span class="p">;</span> <span class="kr">label</span><span class="o">=</span><span class="mi">2</span><span class="p">;};</span>
<span class="kt">border</span> <span class="nf">c</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="mi">1</span><span class="o">-</span><span class="kp">t</span><span class="p">;</span> <span class="kr">y</span><span class="o">=</span><span class="mf">0.5</span><span class="p">;</span> <span class="kr">label</span><span class="o">=</span><span class="mi">3</span><span class="p">;};</span>
<span class="kt">border</span> <span class="nf">d</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="mf">0.5</span><span class="p">;</span> <span class="kr">y</span><span class="o">=</span><span class="kp">t</span><span class="p">;</span> <span class="kr">label</span><span class="o">=</span><span class="mi">4</span><span class="p">;};</span>
<span class="kt">border</span> <span class="nf">e</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="mi">1</span><span class="o">-</span><span class="kp">t</span><span class="p">;</span> <span class="kr">y</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="kr">label</span><span class="o">=</span><span class="mi">5</span><span class="p">;};</span>
<span class="kt">border</span> <span class="nf">f</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="mi">1</span><span class="p">){</span><span class="kr">x</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="kr">y</span><span class="o">=</span><span class="mi">1</span><span class="o">-</span><span class="kp">t</span><span class="p">;</span> <span class="kr">label</span><span class="o">=</span><span class="mi">6</span><span class="p">;};</span>
<span class="kt">mesh</span> <span class="n">Th</span> <span class="o">=</span> <span class="nf">buildmesh</span><span class="p">(</span><span class="n">a</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="o">+</span> <span class="n">b</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">c</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="nf">d</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">e</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">f</span><span class="p">(</span><span class="mi">6</span><span class="p">));</span>
<span class="kt">mesh3</span> <span class="n">Th3</span> <span class="o">=</span> <span class="nf">buildlayers</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="n">MaxLayer</span><span class="p">,</span> <span class="kp">zbound</span><span class="o">=</span><span class="p">[</span><span class="n">zmin</span><span class="p">,</span> <span class="n">zmax</span><span class="p">]);</span>

<span class="c1">// Fespace</span>
<span class="kt">fespace</span> <span class="nf">Vh3</span><span class="p">(</span><span class="n">Th3</span><span class="p">,</span> <span class="nc">P2</span><span class="p">);</span>
<span class="n">Vh3</span> <span class="n">u3</span><span class="p">,</span> <span class="n">v3</span><span class="p">;</span>

<span class="kt">fespace</span> <span class="nf">Vh3P1</span><span class="p">(</span><span class="n">Th3</span><span class="p">,</span> <span class="nc">P1</span><span class="p">);</span>
<span class="n">Vh3P1</span> <span class="n">usol</span><span class="p">;</span>

<span class="c1">// Problem</span>
<span class="kt">problem</span> <span class="nf">Problem2</span><span class="p">(</span><span class="n">u3</span><span class="p">,</span> <span class="n">v3</span><span class="p">,</span> <span class="kp">solver</span><span class="o">=</span><span class="kr">sparsesolver</span><span class="p">)</span>
    <span class="o">=</span> <span class="nf">int3d</span><span class="p">(</span><span class="n">Th3</span><span class="p">)(</span>
          <span class="n">u3</span><span class="o">*</span><span class="n">v3</span><span class="o">*</span><span class="mf">1.0e-10</span>
        <span class="o">+</span> <span class="nf">dx</span><span class="p">(</span><span class="n">u3</span><span class="p">)</span><span class="o">*</span><span class="nf">dx</span><span class="p">(</span><span class="n">v3</span><span class="p">)</span>
        <span class="o">+</span> <span class="nf">dy</span><span class="p">(</span><span class="n">u3</span><span class="p">)</span><span class="o">*</span><span class="nf">dy</span><span class="p">(</span><span class="n">v3</span><span class="p">)</span>
        <span class="o">+</span> <span class="nf">dz</span><span class="p">(</span><span class="n">u3</span><span class="p">)</span><span class="o">*</span><span class="nf">dz</span><span class="p">(</span><span class="n">v3</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="o">-</span> <span class="nf">int3d</span><span class="p">(</span><span class="n">Th3</span><span class="p">)(</span>
          <span class="n">v3</span>
    <span class="p">)</span>
    <span class="o">+</span><span class="nf">on</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="n">u3</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="p">;</span>

<span class="c1">// Solve</span>
<span class="n">Problem2</span><span class="p">;</span>
<span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="n">u3</span><span class="p">[].</span><span class="kr">min</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">u3</span><span class="p">[].</span><span class="kr">max</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>

<span class="nf">medit</span><span class="p">(</span><span class="s">&quot;Sol&quot;</span><span class="p">,</span> <span class="n">Th3</span><span class="p">,</span> <span class="n">u3</span><span class="p">);</span>

<span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="kp">bb</span> <span class="o">=</span> <span class="nf">mshmet</span><span class="p">(</span><span class="n">Th3</span><span class="p">,</span><span class="n">u3</span><span class="p">);</span>
<span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Metric:&quot;</span> <span class="o">&lt;&lt;</span> <span class="kp">bb</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">ii</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">ii</span> <span class="o">&lt;</span> <span class="n">Th3</span><span class="p">.</span><span class="kr">nv</span><span class="p">;</span> <span class="n">ii</span><span class="o">++</span><span class="p">)</span>
    <span class="n">usol</span><span class="p">[][</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="kp">bb</span><span class="p">[</span><span class="n">ii</span><span class="p">];</span>

<span class="nf">medit</span><span class="p">(</span><span class="s">&quot;Metric&quot;</span><span class="p">,</span> <span class="n">Th3</span><span class="p">,</span> <span class="n">usol</span><span class="p">);</span>
</pre></div>
</td></tr></table>

</div>
<h2 id="freeyams">FreeYams<a class="headerlink" href="#freeyams" title="Permanent link">#</a></h2>
<p>FreeYams is a surface mesh adaptation software which is developed by P. Frey. This software is a new version of yams. The adapted surface mesh is constructed with a geometric metric tensor field. This field is based on the intrinsic properties of the discrete surface.</p>
<p>Also, this software allows to construct a simplification of a mesh. This decimation is based on the Hausdorff distance between the initial and the current triangulation. Compared to the software yams, FreeYams can be used also to produce anisotropic triangulations adapted to levelset simulations. A technical report on freeYams documentation is available <a href="https://www.ljll.math.upmc.fr/frey/publications/RT-0252.pdf">here</a>.</p>
<p>To call FreeYams in FreeFem++, we used the keyword <code class="codehilite"><span class="nf">freeyams</span></code>. The arguments of this function are the initial mesh and/or metric. The metric with <code class="codehilite"><span class="nf">freeyams</span></code> are a <code class="codehilite"><span class="kt">func</span></code>, a <code class="codehilite"><span class="kt">fespace</span></code> function, a symmetric tensor function, a symmetric tensor <code class="codehilite"><span class="kt">fespace</span></code> function or a vector of double (<code class="codehilite"><span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span></code>). If the metric is a vector of double, this data must be given in <code class="codehilite"><span class="kp">metric</span></code> parameter. Otherwise, the metric is given in the argument.</p>
<p>For example, the adapted mesh of <code>Thinit</code> defined by the metric <span><span class="MathJax_Preview">u</span><script type="math/tex">u</script></span> defined as <code class="codehilite"><span class="kt">fespace</span></code> function is obtained by writing:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">fespace</span> <span class="nf">Vh</span><span class="p">(</span><span class="n">Thinit</span><span class="p">,</span> <span class="nc">P1</span><span class="p">);</span>
<span class="n">Vh</span> <span class="n">u</span><span class="p">;</span>
<span class="kt">mesh3</span> <span class="n">Th</span> <span class="o">=</span> <span class="nf">freeyams</span><span class="p">(</span><span class="n">Thinit</span><span class="p">,</span> <span class="n">u</span><span class="p">);</span>
</pre></div>
</td></tr></table>

<p>The symmetric tensor argument for <code class="codehilite"><span class="nf">freeyams</span></code> keyword is defined as this type of data for datasol argument.</p>
<ul>
<li><code class="codehilite"><span class="kp">aniso</span><span class="o">=</span></code> (b) aniso or iso metric (default 0, iso)</li>
<li><code class="codehilite"><span class="kp">mem</span><span class="o">=</span></code> (l) memory of for freeyams in Mb (default -1, freeyams choose)</li>
<li><code class="codehilite"><span class="kp">hmin</span><span class="o">=</span></code> (d)</li>
<li><code class="codehilite"><span class="kp">hmax</span><span class="o">=</span></code> (d)</li>
<li><code class="codehilite"><span class="kp">gradation</span><span class="o">=</span></code> (d)</li>
<li><code class="codehilite"><span class="kp">option</span><span class="o">=</span></code> (l)<ul>
<li>0 : mesh optimization (smoothing+swapping)</li>
<li>1 : decimation+enrichment adaptated to a metric map. (default)</li>
<li>-1 : decimation adaptated to a metric map.</li>
<li>2 : decimation+enrichment with a Hausdorff-like method</li>
<li>-2 : decimation with a Hausdorff-like method</li>
<li>4 : split triangles recursively.</li>
<li>9 : No-Shrinkage Vertex Smoothing</li>
</ul>
</li>
<li><code class="codehilite"><span class="kp">ridgeangle</span><span class="o">=</span></code> (d)</li>
<li><code class="codehilite"><span class="kp">absolute</span><span class="o">=</span></code> (b)</li>
<li><code class="codehilite"><span class="kr">verbosity</span><span class="o">=</span></code> (i)</li>
<li>
<p><code class="codehilite"><span class="kp">metric</span><span class="o">=</span></code> vector expression. This parameters contains the metric at the different vertices on the initial mesh. With <span><span class="MathJax_Preview">nv</span><script type="math/tex">nv</script></span> is the number of vertices, this vector is <script type="math/tex; mode=display"> M_{iso}= ( m(V_0), m(V_1), \ldots, m(V_{nv}) )^t</script> for a scalar metric <span><span class="MathJax_Preview">m</span><script type="math/tex">m</script></span>. For a symmetric tensor metric
<span><span class="MathJax_Preview">h=\left(\begin{array}{ccc}
m_{1 1} &amp; m_{1 2} &amp; m_{1 3}\\
m_{2 1} &amp; m_{2 2} &amp; m_{2 3} \\
m_{3 1} &amp; m_{3 2} &amp; m_{3 3}
\end{array}\right)</span><script type="math/tex">h=\left(\begin{array}{ccc}
m_{1 1} & m_{1 2} & m_{1 3}\\
m_{2 1} & m_{2 2} & m_{2 3} \\
m_{3 1} & m_{3 2} & m_{3 3}
\end{array}\right)</script></span>
, the parameters <code class="codehilite"><span class="kp">metric</span></code> is
<script type="math/tex; mode=display">M_{aniso}= ( H(V_{0}), \ldots, H(V_{nv}) )^t </script>
where <span><span class="MathJax_Preview">H(V_{i})</span><script type="math/tex">H(V_{i})</script></span> is the vector of size 6 defined by <span><span class="MathJax_Preview">[m11,m21,m22,m31,m32,m33]</span><script type="math/tex">[m11,m21,m22,m31,m32,m33]</script></span></p>
</li>
<li>
<p><code class="codehilite"><span class="kp">loptions</span><span class="o">=</span></code> a vector of integer of size 13. This vectors contains the integer options of FreeYams. (just for the expert)</p>
<ul>
<li>loptions(0): anisotropic parameter (default 0). If you give an anisotropic metric 1 otherwise 0.</li>
<li>loptions(1): Finite Element correction parameter (default 0). 1 for <em>no</em> Finite Element correction otherwise 0.</li>
<li>loptions(2): Split multiple connected points parameter (default 1). 1 for splitting multiple connected points otherwise 0.</li>
<li>loptions(3): maximum value of memory size in Mbytes (default -1: the size is given by freeyams).</li>
<li>loptions(4): set the value of the connected component which we want to obtain. (Remark: freeyams give an automatic value at each connected component).</li>
<li>loptions(5): level of verbosity</li>
<li>loptions(6): Create point on straight edge (no mapping) parameter (default 0). 1 for creating point on straight edge otherwise 0.</li>
<li>loptions(7): validity check during smoothing parameter. This parameter is only used with No-Shrinkage Vertex Smoothing optimization (optimization option parameter 9). 1 for No validity checking during smoothing otherwise 0.</li>
<li>loptions(8): number of desired's vertices (default -1).</li>
<li>loptions(9): number of iteration of optimizations (default 30).</li>
<li>loptions(10): no detection parameter (default 0) . 1 for detecting the ridge on the mesh otherwise 0. The ridge definition is given in the parameter doptions(12).</li>
<li>loptions(11): no vertex smoothing parameter (default 0). 1 for smoothing the vertices otherwise 0.</li>
<li>loptions(12): Optimization level parameter (default 0).<ul>
<li>0 : mesh optimization (smoothing+swapping)</li>
<li>1 : decimation+enrichment adaptated to a metric map.</li>
<li>-1: decimation adaptated to a metric map.</li>
<li>2 : decimation+enrichment with a Hausdorff-like method</li>
<li>-2: decimation with a Hausdorff-like method</li>
<li>4 : split triangles recursively.</li>
<li>9 : No-Shrinkage Vertex Smoothing</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code class="codehilite"><span class="kp">doptions</span><span class="o">=</span></code> a vector of double of size 11. This vectors contains the real options of freeyams.</p>
<ul>
<li>doptions(0): Set the geometric approximation (Tangent plane deviation) (default 0.01).</li>
<li>doptions(1): Set the lamda parameter (default -1).</li>
<li>doptions(2): Set the mu parmeter (default -1).</li>
<li>doptions(3): Set the gradation value (Mesh density control) (default 1.3).</li>
<li>doptions(4): Set the minimal size(hmin) (default -2.0: the size is automatically computed).</li>
<li>doptions(5): Set the maximal size(hmax) (default -2.0: the size is automatically computed).</li>
<li>doptions(6): Set the tolerance of the control of Chordal deviation (default -2.0).</li>
<li>doptions(7): Set the quality of degradation (default 0.599).</li>
<li>doptions(8): Set the declic parameter (default 2.0).</li>
<li>doptions(9): Set the angular walton limitation parameter (default 45 degree).</li>
<li>doptions(10): Set the angular ridge detection (default 45 degree).</li>
</ul>
</li>
</ul>
<div class="admonition example">
<p class="admonition-title"><code class="codehilite"><span class="nf">freeyams</span></code></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">load</span> <span class="s">&quot;msh3&quot;</span>
<span class="cp">load</span> <span class="s">&quot;</span><span class="nf">medit</span><span class="s">&quot;</span>
<span class="cp">load</span> <span class="s">&quot;</span><span class="nf">freeyams</span><span class="s">&quot;</span>

<span class="c1">// Parameters</span>
<span class="kt">int</span> <span class="n">nn</span> <span class="o">=</span> <span class="mi">20</span><span class="p">;</span>
<span class="kt">real</span> <span class="n">zmin</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kt">real</span> <span class="n">zmax</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

<span class="c1">// Mesh</span>
<span class="kt">mesh</span> <span class="n">Th2</span> <span class="o">=</span> <span class="nf">square</span><span class="p">(</span><span class="n">nn</span><span class="p">,</span> <span class="n">nn</span><span class="p">);</span>
<span class="kt">int</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">rup</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">rdown</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">];</span>
<span class="kt">int</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">rmid</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">];</span>
<span class="kt">mesh3</span> <span class="n">Th</span> <span class="o">=</span> <span class="nf">buildlayers</span><span class="p">(</span><span class="n">Th2</span><span class="p">,</span> <span class="n">nn</span><span class="p">,</span> <span class="kp">zbound</span><span class="o">=</span><span class="p">[</span><span class="n">zmin</span><span class="p">,</span> <span class="n">zmax</span><span class="p">],</span> <span class="kp">reffacemid</span><span class="o">=</span><span class="n">rmid</span><span class="p">,</span> <span class="kp">reffaceup</span><span class="o">=</span><span class="n">rup</span><span class="p">,</span> <span class="kp">reffacelow</span><span class="o">=</span><span class="n">rdown</span><span class="p">);</span>
<span class="kt">mesh3</span> <span class="n">Th3</span> <span class="o">=</span> <span class="nf">freeyams</span><span class="p">(</span><span class="n">Th</span><span class="p">);</span>

<span class="nf">medit</span><span class="p">(</span><span class="s">&quot;SurfaceMesh&quot;</span><span class="p">,</span> <span class="n">Th3</span><span class="p">);</span>
</pre></div>
</td></tr></table>

</div>
<h2 id="mmg3d">mmg3d<a class="headerlink" href="#mmg3d" title="Permanent link">#</a></h2>
<p><span><span class="MathJax_Preview">\codered</span><script type="math/tex">\codered</script></span> mmg3d-v4.0</p>
<p><a href="http://www.mmgtools.org">Mmg3d</a> is a 3D remeshing software developed by C. Dobrzynski and P. Frey.</p>
<p>This software allows to remesh an initial mesh made of tetrahedra. This initial mesh is adapted to a geometric metric tensor field or to a displacement vector (moving rigid body). The metric can be obtained with <a href="#mshmet"><code class="codehilite"><span class="nf">mshmet</span></code></a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul>
<li>If no metric is given, an isotropic metric is computed by analyzing the size of the edges in the initial mesh.</li>
<li>if a displacement is given, the vertices of the surface triangles are moved without verifying the geometrical structure of the new surface mesh.</li>
</ul>
</div>
<p>The parameters of <code class="codehilite"><span class="nf">mmg3d</span></code> are :</p>
<ul>
<li>
<p><code class="codehilite"><span class="kp">options</span><span class="o">=</span></code> vector expression. This vector contains the option parameters of <code class="codehilite"><span class="nf">mmg3d</span></code>. It is a vector of 6 values, with the following meaning:</p>
<ul>
<li>
<p>Optimization parameters : (default 1)</p>
<p>0 : mesh optimization.</p>
<p>1 : adaptation with metric (deletion and insertion vertices) and optimization.</p>
<p>-1 : adaptation with metric (deletion and insertion vertices) without optimization.</p>
<p>4 : split tetrahedra (be careful modify the surface).</p>
<p>9 : moving mesh with optimization.</p>
<p>-9 : moving mesh without optimization.</p>
</li>
<li>
<p>Debug mode : (default 0)</p>
<p>1 : turn on debug mode.</p>
<p>0 : otherwise.</p>
</li>
<li>
<p>Specify the size of bucket per dimension (default 64)</p>
</li>
<li>
<p>Swapping mode : (default 0)</p>
<p>1 : no edge or face flipping.</p>
<p>0 : otherwise.</p>
</li>
<li>
<p>Insert points mode : (default 0)</p>
<p>1 : no edge splitting or collapsing and no insert points.</p>
<p>0 : otherwise.</p>
</li>
<li>
<p>Verbosity level (default 3)</p>
</li>
</ul>
</li>
<li>
<p><code class="codehilite"><span class="kp">memory</span><span class="o">=</span></code> integer expression. Set the maximum memory size of new mesh in Mbytes. By default the number of maximum vertices, tetrahedra and triangles are respectively 500 000, 3000 000, 100000 which represent approximately a memory of 100 Mo.</p>
</li>
<li>
<p><code class="codehilite"><span class="kp">metric</span><span class="o">=</span></code> vector expression. This vector contains the metric given at <code class="codehilite"><span class="nf">mmg3d</span></code>. It is a vector of size <span><span class="MathJax_Preview">nv</span><script type="math/tex">nv</script></span> or 6 <span><span class="MathJax_Preview">nv</span><script type="math/tex">nv</script></span> respectively for an isotropic and anisotropic metric where <span><span class="MathJax_Preview">nv</span><script type="math/tex">nv</script></span> is the number of vertices in the initial mesh. The structure of <code class="codehilite"><span class="kp">metric</span></code> vector is described in the <a href="#mshmet"><code class="codehilite"><span class="nf">mshmet</span></code></a>.</p>
</li>
<li>
<p><code class="codehilite"><span class="kp">displacement</span><span class="o">=</span></code> <span><span class="MathJax_Preview">[\Phi1, \Phi2, \Phi3]</span><script type="math/tex">[\Phi1, \Phi2, \Phi3]</script></span> set the displacement vector of the initial mesh <span><span class="MathJax_Preview">\mathbf{\Phi(x,y)} = [\Phi1(x,y), \Phi2(x,y), \Phi3(x,y)]</span><script type="math/tex">\mathbf{\Phi(x,y)} = [\Phi1(x,y), \Phi2(x,y), \Phi3(x,y)]</script></span>.</p>
</li>
<li>
<p><code class="codehilite"><span class="n">displVect</span><span class="o">=</span></code> sets the vector displacement in a vector expression. This vector contains the displacement at each point of the initial mesh. It is a vector of size 3 <span><span class="MathJax_Preview">nv</span><script type="math/tex">nv</script></span>.</p>
</li>
</ul>
<div class="admonition example">
<p class="admonition-title"><code class="codehilite"><span class="nf">mmg3d</span></code></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">load</span> <span class="s">&quot;msh3&quot;</span>
<span class="cp">load</span> <span class="s">&quot;</span><span class="nf">medit</span><span class="s">&quot;</span>
<span class="cp">load</span> <span class="s">&quot;</span><span class="nf">mmg3d</span><span class="s">&quot;</span>
<span class="cp">include</span> <span class="s">&quot;Cube.idp&quot;</span>

<span class="c1">// Parameters</span>
<span class="kt">int</span> <span class="kr">n</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span>
<span class="kt">int</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">Nxyz</span> <span class="o">=</span> <span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">];</span>
<span class="kt">real</span> <span class="p">[</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">]</span> <span class="n">Bxyz</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">]];</span>
<span class="kt">int</span> <span class="p">[</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">]</span> <span class="n">Lxyz</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]];</span>

<span class="c1">// Mesh</span>
<span class="kt">mesh3</span> <span class="n">Th</span> <span class="o">=</span> <span class="n">Cube</span><span class="p">(</span><span class="n">Nxyz</span><span class="p">,</span> <span class="n">Bxyz</span><span class="p">,</span> <span class="n">Lxyz</span><span class="p">);</span>

<span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">isometric</span><span class="p">(</span><span class="n">Th</span><span class="p">.</span><span class="kr">nv</span><span class="p">);</span>
<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">ii</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">ii</span> <span class="o">&lt;</span> <span class="n">Th</span><span class="p">.</span><span class="kr">nv</span><span class="p">;</span> <span class="n">ii</span><span class="o">++</span><span class="p">)</span>
    <span class="n">isometric</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.17</span><span class="p">;</span>

<span class="kt">mesh3</span> <span class="n">Th3</span> <span class="o">=</span> <span class="nf">mmg3d</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="kp">memory</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="kp">metric</span><span class="o">=</span><span class="n">isometric</span><span class="p">);</span>

<span class="c1">// Plot</span>
<span class="nf">medit</span><span class="p">(</span><span class="s">&quot;Initial&quot;</span><span class="p">,</span> <span class="n">Th</span><span class="p">);</span>
<span class="nf">medit</span><span class="p">(</span><span class="s">&quot;Isometric&quot;</span><span class="p">,</span> <span class="n">Th3</span><span class="p">);</span>
</pre></div>
</td></tr></table>

</div>
<div class="admonition example">
<p class="admonition-title">Falling spheres</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">load</span> <span class="s">&quot;msh3&quot;</span>
<span class="cp">load</span> <span class="s">&quot;TetGen&quot;</span>
<span class="cp">load</span> <span class="s">&quot;</span><span class="nf">medit</span><span class="s">&quot;</span>
<span class="cp">load</span> <span class="s">&quot;</span><span class="nf">mmg3d</span><span class="s">&quot;</span>
<span class="cp">include</span> <span class="s">&quot;MeshSurface.idp&quot;</span>

<span class="c1">// Parameters</span>
<span class="kt">real</span> <span class="n">hs</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">;</span>
<span class="kt">int</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="kr">N</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="o">/</span><span class="n">hs</span><span class="p">,</span> <span class="mi">8</span><span class="o">/</span><span class="n">hs</span><span class="p">,</span> <span class="mf">11.5</span><span class="o">/</span><span class="n">hs</span><span class="p">];</span>
<span class="kt">real</span> <span class="p">[</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">]</span> <span class="kp">B</span> <span class="o">=</span> <span class="p">[[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">]];</span>
<span class="kt">int</span> <span class="p">[</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">]</span> <span class="n">L</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">311</span><span class="p">,</span> <span class="mi">311</span><span class="p">],</span> <span class="p">[</span><span class="mi">311</span><span class="p">,</span> <span class="mi">311</span><span class="p">],</span> <span class="p">[</span><span class="mi">311</span><span class="p">,</span> <span class="mi">311</span><span class="p">]];</span>

<span class="kt">int</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">opt</span> <span class="o">=</span> <span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">];</span>
<span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">vit</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.3</span><span class="p">];</span>
<span class="kt">func</span> <span class="n">zero</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">;</span>
<span class="kt">func</span> <span class="n">dep</span> <span class="o">=</span> <span class="n">vit</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>

<span class="c1">// Mesh</span>
<span class="kt">mesh3</span> <span class="n">ThH</span> <span class="o">=</span> <span class="n">SurfaceHex</span><span class="p">(</span><span class="kr">N</span><span class="p">,</span> <span class="kp">B</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="kt">mesh3</span> <span class="n">ThSg</span> <span class="o">=</span> <span class="n">Sphere</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">hs</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>
<span class="kt">mesh3</span> <span class="n">ThSd</span> <span class="o">=</span> <span class="n">Sphere</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">hs</span><span class="p">,</span> <span class="mi">310</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>
<span class="n">ThSd</span> <span class="o">=</span> <span class="n">movemesh3</span><span class="p">(</span><span class="n">ThSd</span><span class="p">,</span> <span class="kp">transfo</span><span class="o">=</span><span class="p">[</span><span class="kr">x</span><span class="p">,</span> <span class="mi">4</span><span class="o">+</span><span class="kr">y</span><span class="p">,</span> <span class="kr">z</span><span class="p">]);</span>
<span class="kt">mesh3</span> <span class="n">ThHS</span> <span class="o">=</span> <span class="n">ThH</span> <span class="o">+</span> <span class="n">ThSg</span> <span class="o">+</span> <span class="n">ThSd</span><span class="p">;</span><span class="c1">//gluing surface meshes</span>
<span class="nf">medit</span><span class="p">(</span><span class="s">&quot;ThHS&quot;</span><span class="p">,</span> <span class="n">ThHS</span><span class="p">);</span>

<span class="kt">real</span> <span class="n">voltet</span> <span class="o">=</span> <span class="p">(</span><span class="n">hs</span><span class="o">^</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="mf">6.</span><span class="p">;</span>
<span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">domain</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">voltet</span><span class="p">];</span>
<span class="kt">real</span> <span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">holes</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">];</span>
<span class="kt">mesh3</span> <span class="n">Th</span> <span class="o">=</span> <span class="nf">tetg</span><span class="p">(</span><span class="n">ThHS</span><span class="p">,</span> <span class="kp">switch</span><span class="o">=</span><span class="s">&quot;pqaAAYYQ&quot;</span><span class="p">,</span> <span class="kp">nbofregions</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="kp">regionlist</span><span class="o">=</span><span class="n">domaine</span><span class="p">,</span> <span class="kp">nbofholes</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="kp">holelist</span><span class="o">=</span><span class="n">holes</span><span class="p">);</span>
<span class="nf">medit</span><span class="p">(</span><span class="s">&quot;Box-With-two-Ball&quot;</span><span class="p">,</span> <span class="n">Th</span><span class="p">);</span>

<span class="c1">// Fespace</span>
<span class="kt">fespace</span> <span class="nf">Vh</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="nc">P1</span><span class="p">);</span>
<span class="n">Vh</span> <span class="n">uh</span><span class="p">,</span><span class="n">vh</span><span class="p">;</span>

<span class="c1">// Macro</span>
<span class="kt">macro</span> <span class="nf">Grad</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="p">[</span><span class="nf">dx</span><span class="p">(</span><span class="n">u</span><span class="p">),</span><span class="nf">dy</span><span class="p">(</span><span class="n">u</span><span class="p">),</span><span class="nf">dz</span><span class="p">(</span><span class="n">u</span><span class="p">)]</span>

<span class="c1">// Problem</span>
<span class="kt">problem</span> <span class="n">Lap</span> <span class="p">(</span><span class="n">uh</span><span class="p">,</span> <span class="n">vh</span><span class="p">,</span> <span class="kp">solver</span><span class="o">=</span><span class="kr">CG</span><span class="p">)</span>
    <span class="o">=</span> <span class="nf">int3d</span><span class="p">(</span><span class="n">Th</span><span class="p">)(</span>
          <span class="n">Grad</span><span class="p">(</span><span class="n">uh</span><span class="p">)</span><span class="o">&#39;</span> <span class="o">*</span> <span class="n">Grad</span><span class="p">(</span><span class="n">vh</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="o">+</span> <span class="nf">on</span><span class="p">(</span><span class="mi">310</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="n">uh</span><span class="o">=</span><span class="n">dep</span><span class="p">)</span>
    <span class="o">+</span> <span class="nf">on</span><span class="p">(</span><span class="mi">311</span><span class="p">,</span> <span class="n">uh</span><span class="o">=</span><span class="mf">0.</span><span class="p">)</span>
    <span class="p">;</span>

<span class="c1">// Falling loop</span>
<span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">it</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">it</span> <span class="o">&lt;</span> <span class="mi">29</span><span class="p">;</span> <span class="n">it</span><span class="o">++</span><span class="p">){</span>
    <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; ITERATION &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">it</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>

    <span class="c1">// Solve</span>
    <span class="n">Lap</span><span class="p">;</span>

    <span class="c1">// Plot</span>
    <span class="nf">plot</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="n">uh</span><span class="p">);</span>

    <span class="c1">// Sphere falling</span>
    <span class="n">Th</span> <span class="o">=</span> <span class="nf">mmg3d</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="kp">options</span><span class="o">=</span><span class="n">opt</span><span class="p">,</span> <span class="kp">displacement</span><span class="o">=</span><span class="p">[</span><span class="n">zero</span><span class="p">,</span> <span class="n">zero</span><span class="p">,</span> <span class="n">uh</span><span class="p">],</span> <span class="kp">memory</span><span class="o">=</span><span class="mi">1000</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

</div>
<h2 id="a-first-3d-isotrope-mesh-adaptation-process">A first 3d isotrope mesh adaptation process<a class="headerlink" href="#a-first-3d-isotrope-mesh-adaptation-process" title="Permanent link">#</a></h2>
<div class="admonition example">
<p class="admonition-title">Adaptation 3D</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">load</span> <span class="s">&quot;msh3&quot;</span>
<span class="cp">load</span> <span class="s">&quot;TetGen&quot;</span>
<span class="cp">load</span> <span class="s">&quot;</span><span class="nf">mshmet</span><span class="s">&quot;</span>
<span class="cp">load</span> <span class="s">&quot;</span><span class="nf">medit</span><span class="s">&quot;</span>

<span class="c1">// Parameters</span>
<span class="kt">int</span> <span class="n">nn</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span>
<span class="kt">int</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">l1111</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">];</span> <span class="c1">//labels</span>
<span class="kt">int</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">l01</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">];</span>
<span class="kt">int</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="n">l11</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">];</span>

<span class="kt">real</span> <span class="n">errm</span> <span class="o">=</span> <span class="mf">1e-2</span><span class="p">;</span> <span class="c1">//level of error</span>

<span class="c1">// Mesh</span>
<span class="kt">mesh3</span> <span class="n">Th3</span> <span class="o">=</span> <span class="nf">buildlayers</span><span class="p">(</span><span class="nf">square</span><span class="p">(</span><span class="n">nn</span><span class="p">,</span> <span class="n">nn</span><span class="p">,</span> <span class="kr">region</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="kr">label</span><span class="o">=</span><span class="n">l1111</span><span class="p">),</span>
    <span class="n">nn</span><span class="p">,</span> <span class="kp">zbound</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="kp">labelmid</span><span class="o">=</span><span class="n">l11</span><span class="p">,</span> <span class="kp">labelup</span><span class="o">=</span><span class="n">l01</span><span class="p">,</span> <span class="kp">labeldown</span><span class="o">=</span><span class="n">l01</span><span class="p">);</span>

<span class="n">Th3</span> <span class="o">=</span> <span class="nf">trunc</span><span class="p">(</span><span class="n">Th3</span><span class="p">,</span> <span class="p">(</span><span class="kr">x</span><span class="o">&lt;</span><span class="mf">0.5</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="kr">y</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="kr">z</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">),</span> <span class="kr">label</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span> <span class="c1">//remove the ]0.5,1[^3 cube</span>

<span class="c1">// Fespace</span>
<span class="kt">fespace</span> <span class="nf">Vh</span><span class="p">(</span><span class="n">Th3</span><span class="p">,</span> <span class="nc">P1</span><span class="p">);</span>
<span class="n">Vh</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">usol</span><span class="p">,</span> <span class="n">h</span><span class="p">;</span>

<span class="c1">// Macro</span>
<span class="kt">macro</span> <span class="nf">Grad</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="p">[</span><span class="nf">dx</span><span class="p">(</span><span class="n">u</span><span class="p">),</span> <span class="nf">dy</span><span class="p">(</span><span class="n">u</span><span class="p">),</span> <span class="nf">dz</span><span class="p">(</span><span class="n">u</span><span class="p">)]</span> <span class="c1">// EOM</span>

<span class="c1">// Problem</span>
<span class="kt">problem</span> <span class="n">Poisson</span> <span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="kp">solver</span><span class="o">=</span><span class="kr">CG</span><span class="p">)</span>
    <span class="o">=</span> <span class="nf">int3d</span><span class="p">(</span><span class="n">Th3</span><span class="p">)(</span>
          <span class="n">Grad</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">&#39;</span> <span class="o">*</span> <span class="n">Grad</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="o">-</span> <span class="nf">int3d</span><span class="p">(</span><span class="n">Th3</span><span class="p">)(</span>
          <span class="mi">1</span><span class="o">*</span><span class="n">v</span>
    <span class="p">)</span>
    <span class="o">+</span> <span class="nf">on</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">u</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="p">;</span>

<span class="c1">// Loop</span>
<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">ii</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">ii</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">;</span> <span class="n">ii</span><span class="o">++</span><span class="p">){</span>
    <span class="c1">// Solve</span>
    <span class="n">Poisson</span><span class="p">;</span>
    <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;u min, max = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">u</span><span class="p">[].</span><span class="kr">min</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; &quot;</span><span class="o">&lt;&lt;</span> <span class="n">u</span><span class="p">[].</span><span class="kr">max</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>

    <span class="n">h</span><span class="o">=</span><span class="mf">0.</span><span class="p">;</span> <span class="c1">//for resizing h[] because the mesh change</span>
    <span class="n">h</span><span class="p">[]</span> <span class="o">=</span> <span class="nf">mshmet</span><span class="p">(</span><span class="n">Th3</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="kp">normalization</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="kp">aniso</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="kp">nbregul</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="kp">hmin</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span> <span class="kp">hmax</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="kp">err</span><span class="o">=</span><span class="n">errm</span><span class="p">);</span>
    <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;h min, max = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">h</span><span class="p">[].</span><span class="kr">min</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; &quot;</span><span class="o">&lt;&lt;</span> <span class="n">h</span><span class="p">[].</span><span class="kr">max</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">h</span><span class="p">[].</span><span class="kr">n</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">Th3</span><span class="p">.</span><span class="kr">nv</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
    <span class="nf">plot</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="kp">wait</span><span class="o">=</span><span class="kr">true</span><span class="p">);</span>

    <span class="n">errm</span> <span class="o">*=</span> <span class="mf">0.8</span><span class="p">;</span> <span class="c1">//change the level of error</span>
    <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Th3 &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">Th3</span><span class="p">.</span><span class="kr">nv</span> <span class="o">&lt;</span> <span class="s">&quot; &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">Th3</span><span class="p">.</span><span class="kr">nt</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
    <span class="n">Th3</span> <span class="o">=</span> <span class="nf">tetgreconstruction</span><span class="p">(</span><span class="n">Th3</span><span class="p">,</span> <span class="kp">switch</span><span class="o">=</span><span class="s">&quot;raAQ&quot;</span><span class="p">,</span> <span class="kp">sizeofvolume</span><span class="o">=</span><span class="n">h</span><span class="o">*</span><span class="n">h</span><span class="o">*</span><span class="n">h</span><span class="o">/</span><span class="mf">6.</span><span class="p">);</span> <span class="c1">//rebuild mesh</span>
    <span class="nf">medit</span><span class="p">(</span><span class="s">&quot;U-adap-iso-&quot;</span><span class="o">+</span><span class="n">ii</span><span class="p">,</span> <span class="n">Th3</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="kp">wait</span><span class="o">=</span><span class="kr">true</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

</div>
<h2 id="build-a-2d-mesh-from-a-isoline">Build a 2d mesh from a isoline<a class="headerlink" href="#build-a-2d-mesh-from-a-isoline" title="Permanent link">#</a></h2>
<p>The idea is to get the discretization of an isoline of fluid meshes, this tool can be useful to construct meshes from image. First, we give an example of the isovalue meshes <span><span class="MathJax_Preview">0.2</span><script type="math/tex">0.2</script></span> of analytical function <span><span class="MathJax_Preview">\sqrt{(x-1/2)^2 +(y-1/2)^2}</span><script type="math/tex">\sqrt{(x-1/2)^2 +(y-1/2)^2}</script></span>, on unit square.</p>
<div class="admonition example">
<p class="admonition-title">iosline</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">load</span> <span class="s">&quot;</span><span class="nf">isoline</span><span class="s">&quot;</span>

<span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">,</span><span class="kt">int</span><span class="p">]</span> <span class="n">xy</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span> <span class="c1">//to store the isoline points</span>
<span class="kt">int</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="kr">be</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="c1">//to store the begin, end couple of lines</span>
<span class="p">{</span>
    <span class="kt">mesh</span> <span class="n">Th</span> <span class="o">=</span> <span class="nf">square</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
    <span class="kt">fespace</span> <span class="nf">Vh</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="nc">P1</span><span class="p">);</span>
    <span class="n">Vh</span> <span class="n">u</span> <span class="o">=</span> <span class="nf">sqrt</span><span class="p">(</span><span class="nf">square</span><span class="p">(</span><span class="kr">x</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span> <span class="o">+</span> <span class="nf">square</span><span class="p">(</span><span class="kr">y</span><span class="o">-</span><span class="mf">0.5</span><span class="p">));</span>
    <span class="kt">real</span> <span class="kp">iso</span> <span class="o">=</span> <span class="mf">0.2</span> <span class="p">;</span>
    <span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="kp">viso</span> <span class="o">=</span> <span class="p">[</span><span class="kp">iso</span><span class="p">];</span>
    <span class="nf">plot</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="kp">viso</span><span class="o">=</span><span class="kp">viso</span><span class="p">,</span><span class="n">Th</span><span class="p">);</span><span class="c1">//to see the iso line</span>

    <span class="kt">int</span> <span class="n">nbc</span> <span class="o">=</span> <span class="nf">isoline</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">xy</span><span class="p">,</span> <span class="kp">close</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="kp">iso</span><span class="o">=</span><span class="kp">iso</span><span class="p">,</span> <span class="kp">beginend</span><span class="o">=</span><span class="kr">be</span><span class="p">,</span> <span class="kp">smoothing</span><span class="o">=</span><span class="mf">0.1</span><span class="p">);</span>
</pre></div>
</td></tr></table>

</div>
<p>The <code class="codehilite"><span class="nf">isoline</span></code> parameters are <code class="codehilite"><span class="n">Th</span></code> the mesh, the expression <span><span class="MathJax_Preview">u</span><script type="math/tex">u</script></span>, the bidimentionnal array <code class="codehilite"><span class="n">xy</span></code> to store the list coordinate of the points. The list of named parameter are :</p>
<ul>
<li>
<p><code class="codehilite"><span class="kp">iso</span><span class="o">=</span></code> value of the isoline to compute (0 is the default value)</p>
</li>
<li>
<p><code class="codehilite"><span class="kp">close</span><span class="o">=</span></code> close the isoline with the border (default <code class="codehilite"><span class="kr">true</span></code>), we add the part of the mesh border such the value is less than the isovalue</p>
</li>
<li>
<p><code class="codehilite"><span class="kp">smoothing</span><span class="o">=</span></code> number of smoothing process is the <span><span class="MathJax_Preview">{l} ^{r} {s}</span><script type="math/tex">{l} ^{r} {s}</script></span> where <span><span class="MathJax_Preview">l</span><script type="math/tex">l</script></span> is the length of the current line component, <span><span class="MathJax_Preview">r</span><script type="math/tex">r</script></span> the ratio, <span><span class="MathJax_Preview">s</span><script type="math/tex">s</script></span> is smoothing value. The smoothing default value is 0.</p>
</li>
<li>
<p><code class="codehilite"><span class="kp">ratio</span><span class="o">=</span></code> the ratio (1 by default).</p>
</li>
<li>
<p><code class="codehilite"><span class="kp">eps</span><span class="o">=</span></code> relative <span><span class="MathJax_Preview">\varepsilon</span><script type="math/tex">\varepsilon</script></span> (default 1e-10)</p>
</li>
<li>
<p><code class="codehilite"><span class="kp">beginend</span><span class="o">=</span></code> array to get begin, end couple of each of sub line (resize automatically)</p>
</li>
<li>
<p><code class="codehilite"><span class="kp">file</span><span class="o">=</span></code> to save the data curve in data file for gnu plot</p>
</li>
</ul>
<p>In the array <code class="codehilite"><span class="n">xy</span></code> you get the list of vertices of the isoline, each connex line go from <span><span class="MathJax_Preview">i= i_0^c ,\dots, i_1^c-1</span><script type="math/tex">i= i_0^c ,\dots, i_1^c-1</script></span> with <span><span class="MathJax_Preview">i_0^c =be(2*c)</span><script type="math/tex">i_0^c =be(2*c)</script></span> <span><span class="MathJax_Preview">i_1^c =be(2*c+1)</span><script type="math/tex">i_1^c =be(2*c+1)</script></span>, and where <span><span class="MathJax_Preview">x_i= xy(0,i), y_i=yx( 1,i), l_i=xy(2,i)</span><script type="math/tex">x_i= xy(0,i), y_i=yx( 1,i), l_i=xy(2,i)</script></span>.</p>
<p>Here <span><span class="MathJax_Preview">l_i</span><script type="math/tex">l_i</script></span> is the length of the line (the origin of the line is point <span><span class="MathJax_Preview">i_0^c</span><script type="math/tex">i_0^c</script></span>).</p>
<p>The sense of the isoline is such that the upper part is at the left size of the isoline. So here : the minimum is a point <span><span class="MathJax_Preview">0.5,05</span><script type="math/tex">0.5,05</script></span> so the curve 1 turn in the clockwise sense, the order of each component are sort such that the number of point by component is decreasing.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Number of the line component = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">nbc</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
    <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Number of points = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">xy</span><span class="p">.</span><span class="kr">m</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
    <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;be = &quot;</span> <span class="o">&lt;&lt;</span> <span class="kr">be</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>

    <span class="c1">// shows the lines component</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">c</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">c</span> <span class="o">&lt;</span> <span class="n">nbc</span><span class="p">;</span> <span class="o">++</span><span class="n">c</span><span class="p">){</span>
        <span class="kt">int</span> <span class="n">i0</span> <span class="o">=</span> <span class="kr">be</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">c</span><span class="p">],</span> <span class="n">i1</span> <span class="o">=</span> <span class="kr">be</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">c</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span>
        <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Curve &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">c</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">i0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">i1</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
            <span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;x= &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">xy</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">i</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; y= &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">xy</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; s= &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">xy</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
        <span class="nf">plot</span><span class="p">([</span><span class="n">xy</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nl">i0</span><span class="o">:</span><span class="n">i1</span><span class="p">),</span> <span class="n">xy</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nl">i0</span><span class="o">:</span><span class="n">i1</span><span class="p">)],</span> <span class="kp">wait</span><span class="o">=</span><span class="kr">true</span><span class="p">,</span> <span class="kp">viso</span><span class="o">=</span><span class="kp">viso</span><span class="p">,</span> <span class="kp">cmm</span><span class="o">=</span><span class="s">&quot; curve &quot;</span><span class="o">+</span><span class="n">c</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;length of last curve = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">xy</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">xy</span><span class="p">.</span><span class="kr">m</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p>We also have a new function to easily parametrize a discrete curve defined by the couple <span><span class="MathJax_Preview">be, xy</span><script type="math/tex">be, xy</script></span>.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">border</span> <span class="nf">Curve0</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">){</span>
    <span class="kt">int</span> <span class="n">c</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="c1">//component 0</span>
    <span class="kt">int</span> <span class="n">i0</span><span class="o">=</span><span class="kr">be</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">c</span><span class="p">],</span> <span class="n">i1</span><span class="o">=</span><span class="kr">be</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">c</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="kr">P</span><span class="o">=</span><span class="n">Curve</span><span class="p">(</span><span class="n">xy</span><span class="p">,</span> <span class="n">i0</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="kp">t</span><span class="p">);</span> <span class="c1">//Curve 0</span>
    <span class="kr">label</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">border</span> <span class="nf">Curve1</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">){</span>
    <span class="kt">int</span> <span class="n">c</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="c1">//component 1</span>
    <span class="kt">int</span> <span class="n">i0</span><span class="o">=</span><span class="kr">be</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">c</span><span class="p">],</span> <span class="n">i1</span><span class="o">=</span><span class="kr">be</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">c</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="kr">P</span><span class="o">=</span><span class="n">Curve</span><span class="p">(</span><span class="n">xy</span><span class="p">,</span> <span class="n">i0</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="kp">t</span><span class="p">);</span> <span class="c1">//Curve 1</span>
    <span class="kr">label</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="nf">plot</span><span class="p">(</span><span class="n">Curve1</span><span class="p">(</span><span class="mi">100</span><span class="p">));</span> <span class="c1">//show curve</span>
<span class="kt">mesh</span> <span class="n">Th</span> <span class="o">=</span> <span class="nf">buildmesh</span><span class="p">(</span><span class="n">Curve1</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">));</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="kp">wait</span><span class="o">=</span><span class="kr">true</span><span class="p">);</span>
</pre></div>
</td></tr></table>

<p>Secondly, we use this idea to build meshes from an image, we use the plugins <code class="codehilite"><span class="n">ppm2rnm</span></code> to read <code class="codehilite"><span class="n">pgm</span></code> a gray scale image and then we extract the gray contour at level 0.25.</p>
<div class="admonition example">
<p class="admonition-title">Leman lake</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">load</span> <span class="s">&quot;ppm2rnm&quot;</span>
<span class="cp">load</span> <span class="s">&quot;</span><span class="nf">isoline</span><span class="s">&quot;</span>

<span class="c1">// Parameters</span>
<span class="kt">string</span> <span class="n">leman</span> <span class="o">=</span> <span class="s">&quot;LemanLake.pgm&quot;</span><span class="p">;</span>
<span class="kt">real</span> <span class="n">AreaLac</span> <span class="o">=</span> <span class="mf">580.03</span><span class="p">;</span> <span class="c1">//in km^2</span>
<span class="kt">real</span> <span class="n">hsize</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
<span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">]</span> <span class="n">Curves</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="kt">int</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="kr">be</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">nc</span><span class="p">;</span> <span class="c1">//nb of curve</span>
<span class="p">{</span>
    <span class="kt">real</span><span class="p">[</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">]</span> <span class="n">ff1</span><span class="p">(</span><span class="n">leman</span><span class="p">);</span> <span class="c1">//read image</span>
    <span class="c1">//and set it in a rect. array</span>
    <span class="kt">int</span> <span class="n">nx</span> <span class="o">=</span> <span class="n">ff1</span><span class="p">.</span><span class="kr">n</span><span class="p">,</span> <span class="n">ny</span> <span class="o">=</span> <span class="n">ff1</span><span class="p">.</span><span class="kr">m</span><span class="p">;</span>
    <span class="c1">//build a Cartesian mesh such that the origin is in the right place.</span>
    <span class="kt">mesh</span> <span class="n">Th</span> <span class="o">=</span> <span class="nf">square</span><span class="p">(</span><span class="n">nx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">ny</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">[(</span><span class="n">nx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="kr">x</span><span class="p">),</span> <span class="p">(</span><span class="n">ny</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="kr">y</span><span class="p">)]);</span>
    <span class="c1">//warning the numbering of the vertices (x,y) is</span>
    <span class="c1">//given by $i = x/nx + nx* y/ny $</span>
    <span class="kt">fespace</span> <span class="nf">Vh</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="nc">P1</span><span class="p">);</span>
    <span class="n">Vh</span> <span class="n">f1</span><span class="p">;</span>
    <span class="n">f1</span><span class="p">[]</span> <span class="o">=</span> <span class="n">ff1</span><span class="p">;</span> <span class="c1">//transform array in finite element functions.</span>
    <span class="n">nc</span> <span class="o">=</span> <span class="nf">isoline</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="n">f1</span><span class="p">,</span> <span class="kp">iso</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="kp">close</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">Curves</span><span class="p">,</span> <span class="kp">beginend</span><span class="o">=</span><span class="kr">be</span><span class="p">,</span> <span class="kp">smoothing</span><span class="o">=</span><span class="mf">.1</span><span class="p">,</span> <span class="kp">ratio</span><span class="o">=</span><span class="mf">0.5</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">//The longest isoline: the lake</span>
<span class="kt">int</span> <span class="n">ic0</span> <span class="o">=</span> <span class="kr">be</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">ic1</span> <span class="o">=</span> <span class="kr">be</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span>
<span class="nf">plot</span><span class="p">([</span><span class="n">Curves</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nl">ic0</span><span class="o">:</span><span class="n">ic1</span><span class="p">),</span> <span class="n">Curves</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nl">ic0</span><span class="o">:</span><span class="n">ic1</span><span class="p">)],</span> <span class="kp">wait</span><span class="o">=</span><span class="kr">true</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">NC</span> <span class="o">=</span> <span class="n">Curves</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">ic1</span><span class="p">)</span><span class="o">/</span><span class="n">hsize</span><span class="p">;</span>
<span class="kt">real</span> <span class="n">xl</span> <span class="o">=</span> <span class="n">Curves</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nl">ic0</span><span class="o">:</span><span class="n">ic1</span><span class="p">).</span><span class="kr">max</span> <span class="o">-</span> <span class="mi">5</span><span class="p">;</span>
<span class="kt">real</span> <span class="n">yl</span> <span class="o">=</span> <span class="n">Curves</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nl">ic0</span><span class="o">:</span><span class="n">ic1</span><span class="p">).</span><span class="kr">min</span> <span class="o">+</span> <span class="mi">5</span><span class="p">;</span>
<span class="kt">border</span> <span class="nf">G</span><span class="p">(</span><span class="kp">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">){</span><span class="kr">P</span><span class="o">=</span><span class="n">Curve</span><span class="p">(</span><span class="n">Curves</span><span class="p">,</span> <span class="n">ic0</span><span class="p">,</span> <span class="n">ic1</span><span class="p">,</span> <span class="kp">t</span><span class="p">);</span> <span class="kr">label</span><span class="o">=</span><span class="mi">1</span><span class="o">+</span><span class="p">(</span><span class="kr">x</span><span class="o">&gt;</span><span class="n">xl</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="p">(</span><span class="kr">y</span><span class="o">&lt;</span><span class="n">yl</span><span class="p">);}</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">G</span><span class="p">(</span><span class="o">-</span><span class="n">NC</span><span class="p">),</span> <span class="kp">wait</span><span class="o">=</span><span class="kr">true</span><span class="p">);</span>

<span class="kt">mesh</span> <span class="n">Th</span> <span class="o">=</span> <span class="nf">buildmesh</span><span class="p">(</span><span class="n">G</span><span class="p">(</span><span class="o">-</span><span class="n">NC</span><span class="p">));</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="kp">wait</span><span class="o">=</span><span class="kr">true</span><span class="p">);</span>

<span class="kt">real</span> <span class="n">scale</span> <span class="o">=</span> <span class="nf">sqrt</span><span class="p">(</span><span class="n">AreaLac</span><span class="o">/</span><span class="n">Th</span><span class="p">.</span><span class="kr">area</span><span class="p">);</span>
<span class="n">Th</span> <span class="o">=</span> <span class="nf">movemesh</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="p">[</span><span class="kr">x</span><span class="o">*</span><span class="n">scale</span><span class="p">,</span> <span class="kr">y</span><span class="o">*</span><span class="n">scale</span><span class="p">]);</span>
<span class="kr">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Th.area = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">Th</span><span class="p">.</span><span class="kr">area</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; Km^2 &quot;</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; == &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">AreaLac</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; Km^2 &quot;</span> <span class="o">&lt;&lt;</span> <span class="kr">endl</span><span class="p">;</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">Th</span><span class="p">,</span> <span class="kp">wait</span><span class="o">=</span><span class="kr">true</span><span class="p">,</span> <span class="kp">ps</span><span class="o">=</span><span class="s">&quot;leman.eps&quot;</span><span class="p">);</span>
</pre></div>
</td></tr></table>

</div>
<table>
<thead>
<tr>
<th align="center"><a name="Fig40">Fig. 40</a>: The image of the Leman lake meshes</th>
<th align="center"><a name="Fig41">Fig. 41</a>: the mesh of the lake</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="lake" src="../images/MeshGeneration_Isoline1.jpg" /></td>
<td align="center"><img alt="leman mesh" src="../images/MeshGeneration_Isoline2.png" /></td>
</tr>
</tbody>
</table>
<h2 id="references">References<a class="headerlink" href="#references" title="Permanent link">#</a></h2>
<p><a name="refHecht1998">HECHT, F. The mesh adapting software: bamg. INRIA report, 1998, vol. 250, p. 252.</a></p>
<p><a name="refHang2006">SI, Hang. TetGen Users’ guide: A quality tetrahedral mesh generator and three-dimensional delaunay triangulator. 2006</a></p>
<p><a name="refShewchuk1998">SHEWCHUK, Jonathan Richard. Tetrahedral mesh generation by Delaunay refinement. In : Proceedings of the fourteenth annual symposium on Computational geometry. ACM, 1998. p. 86-95.</a></p>
<p><a name="refHecht1992">HECHT, F. Outils et algorithmes pour la méthode des éléments finis. HdR, Université Pierre et Marie Curie, France, 1992.</a></p>
<p><a name="refHecht19982">HECHT, Frédéric. BAMG: bidimensional anisotropic mesh generator. User Guide. INRIA, Rocquencourt, 1998.</a></p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../Notations/" title="Some Notations" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Some Notations
              </span>
            </div>
          </a>
        
        
          <a href="../FiniteElement/" title="Finite Element" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Finite Element
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../assets/fonts/font-awesome.css">
    
      <a href="https://github.com/FreeFem/FreeFem-doc" class="md-footer-social__link fa fa-github"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.9e1f3b71.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AMS_CHTML"></script>
      
        <script src="../../mathjax-config.js"></script>
      
    
    
      
    
  </body>
</html>